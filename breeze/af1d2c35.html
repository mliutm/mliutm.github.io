<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>容车宝-车辆类型与缓存（五） | 清风</title><meta name="author" content="清风"><meta name="copyright" content="清风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="蓉车宝-车辆类型-缓存一 内容 车辆分类管理 车辆分类缓存优化  二.车辆分类管理​	整个平台有很多的车，需要对这些车进行分门别类的管理，车的类型是可能进行修改的，因此需要在后台管理系统对车辆类型进行维护管理。 1.需求分析与设计为了方便查看，实现车辆分类树状效果，同时满足CURD功能，效果如下  [注意]左边需要一个车辆分类树，使用ElementUI的tree来实现。  车辆类型是不限制层级的,"><meta property="og:type" content="article"><meta property="og:title" content="容车宝-车辆类型与缓存（五）"><meta property="og:url" content="https://mliutm.github.io/breeze/af1d2c35.html"><meta property="og:site_name" content="清风"><meta property="og:description" content="蓉车宝-车辆类型-缓存一 内容 车辆分类管理 车辆分类缓存优化  二.车辆分类管理​	整个平台有很多的车，需要对这些车进行分门别类的管理，车的类型是可能进行修改的，因此需要在后台管理系统对车辆类型进行维护管理。 1.需求分析与设计为了方便查看，实现车辆分类树状效果，同时满足CURD功能，效果如下  [注意]左边需要一个车辆分类树，使用ElementUI的tree来实现。  车辆类型是不限制层级的,"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mliutm.github.io/img/photo-1645943020355-305df166473d.jpg"><meta property="article:published_time" content="2023-11-20T12:41:58.000Z"><meta property="article:modified_time" content="2023-11-20T13:14:00.450Z"><meta property="article:author" content="清风"><meta property="article:tag" content="java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://mliutm.github.io/img/photo-1645943020355-305df166473d.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://mliutm.github.io/breeze/af1d2c35.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"容车宝-车辆类型与缓存（五）",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-11-20 21:14:00"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">156</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/photo-1645943020355-305df166473d.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="清风"><span class="site-name">清风</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">容车宝-车辆类型与缓存（五）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-20T12:41:58.000Z" title="发表于 2023-11-20 20:41:58">2023-11-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-20T13:14:00.450Z" title="更新于 2023-11-20 21:14:00">2023-11-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E8%93%89%E8%BD%A6%E5%AE%9D/">蓉车宝</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>33分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="容车宝-车辆类型与缓存（五）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="蓉车宝-车辆类型-缓存"><a href="#蓉车宝-车辆类型-缓存" class="headerlink" title="蓉车宝-车辆类型-缓存"></a>蓉车宝-车辆类型-缓存</h1><h2 id="一-内容"><a href="#一-内容" class="headerlink" title="一 内容"></a>一 内容</h2><ul><li>车辆分类管理</li><li>车辆分类缓存优化</li></ul><h2 id="二-车辆分类管理"><a href="#二-车辆分类管理" class="headerlink" title="二.车辆分类管理"></a>二.车辆分类管理</h2><p>​	整个平台有很多的车，需要对这些车进行分门别类的管理，车的类型是可能进行修改的，因此需要在后台管理系统对车辆类型进行维护管理。</p><h3 id="1-需求分析与设计"><a href="#1-需求分析与设计" class="headerlink" title="1.需求分析与设计"></a>1.需求分析与设计</h3><p>为了方便查看，实现车辆分类树状效果，同时满足CURD功能，效果如下</p><p><img src="/breeze/af1d2c35/image-20230129155726064.png" alt="image-20230129155726064"></p><p>[<code>注意</code>]左边需要一个车辆分类树，使用ElementUI的tree来实现。</p><p><img src="/breeze/af1d2c35/image-20220905165351151-1684682628028.png" alt="image-20220905165351151"></p><p>车辆类型是不限制层级的,理论上它可以有无限个层级,只是说一般在项目中,最多3,4层</p><h3 id="2-功能实现"><a href="#2-功能实现" class="headerlink" title="2.功能实现"></a>2.功能实现</h3><p>基础代码生成</p><p>菜单</p><h4 id="2-1-显示左边的无限极树"><a href="#2-1-显示左边的无限极树" class="headerlink" title="2.1 显示左边的无限极树"></a>2.1 显示左边的无限极树</h4><p>后端</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">CourseTypeController</span><br><span class="line">  <span class="meta">@GetMapping(&quot;/tree&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">tree</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;CarType&gt; list = carTypeService.tree(<span class="number">0L</span>);</span><br><span class="line">            <span class="keyword">return</span> AjaxResult.me().setResult(list);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setMessage(<span class="string">&quot;获取类型树失败！&quot;</span>+e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    service</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarTypeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseServiceImpl</span>&lt;CarType&gt; <span class="keyword">implements</span> <span class="title class_">ICarTypeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CarTypeMapper carTypeMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CarType&gt; <span class="title function_">tree</span><span class="params">(Long pid)</span> &#123; -- 递归方案</span><br><span class="line">        <span class="comment">//方案1：递归   自己方法调用自己方法   出口  n+1SQL效率太低</span></span><br><span class="line">        List&lt;CarType&gt; children = carTypeMapper.loadChildrenByPid(pid);</span><br><span class="line">        <span class="keyword">if</span> (children == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (CarType child : children) &#123;</span><br><span class="line">            List&lt;CarType&gt; grandson= tree(child.getId());</span><br><span class="line">            child.setChildren(grandson);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 循环算法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CarType&gt; <span class="title function_">getCarTypeTreeByLoop</span><span class="params">(Long pid)</span> &#123;</span><br><span class="line">        List&lt;CarType&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//1 查询出所有节点</span></span><br><span class="line">        List&lt;CarType&gt; allCarTypes = carTypeMapper.loadAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//为了方便获取父亲建立的id和类型的映射关系</span></span><br><span class="line">        Map&lt;Long,CarType&gt; allCarTypesMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (CarType carType : allCarTypes) &#123;</span><br><span class="line">            allCarTypesMap.put(carType.getId(),carType);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2 遍历所有的节点，判断是否是第一级(pid=传入pid)</span></span><br><span class="line">        allCarTypes.forEach(carType -&gt; &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">pidTmp</span> <span class="operator">=</span> carType.getPid();</span><br><span class="line">            <span class="keyword">if</span> (pidTmp.longValue()==pid.longValue())&#123;</span><br><span class="line">                <span class="comment">//2.1 如果是放入返回集合</span></span><br><span class="line">                result.add(carType);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//2.2 如果不是把它父亲的一个儿子放进去就OK</span></span><br><span class="line">                <span class="comment">//2.2.1 获取到父亲 不能发SQL</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//方案1：遍历所有的节点，父亲在里面   时间复杂度  n*n  100*100=10000</span></span><br><span class="line">               <span class="comment">/*  CarType parent = null;</span></span><br><span class="line"><span class="comment">                     for (CarType allCarType : allCarTypes) &#123;</span></span><br><span class="line"><span class="comment">                    if (allCarType.getId().longValue()==pidTmp.longValue())&#123;</span></span><br><span class="line"><span class="comment">                        parent = allCarType;</span></span><br><span class="line"><span class="comment">                        break;</span></span><br><span class="line"><span class="comment">                    &#125;</span></span><br><span class="line"><span class="comment">                &#125;*/</span></span><br><span class="line"></span><br><span class="line">               <span class="comment">//方案2：通过map获取 时间复杂度  2*N 100*2=200</span></span><br><span class="line">                <span class="type">CarType</span> <span class="variable">parent</span> <span class="operator">=</span> allCarTypesMap.get(pidTmp);</span><br><span class="line">                <span class="comment">//2.2.2 当做父亲儿子</span></span><br><span class="line">                parent.getChildren().add(carType); <span class="comment">//把自己放入父亲的集合就OK</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/breeze/af1d2c35/image-20220906104739610.png" alt="image-20220906104739610"></p><p>前端</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">id</span>=<span class="string">&quot;carType&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-row</span> <span class="attr">style</span>=<span class="string">&quot;height: 100%;border: 1px solid #DCDFE6;margin-top: 10px&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;6&quot;</span> <span class="attr">style</span>=<span class="string">&quot;border-right: 1px solid #DCDFE6; min-height:500px;&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid-content bg-purple&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-tree</span> <span class="attr">:data</span>=<span class="string">&quot;carTypes&quot;</span> <span class="attr">:props</span>=<span class="string">&quot;defaultProps&quot;</span>  @<span class="attr">node-click</span>=<span class="string">&quot;handleNodeClick&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-tree</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;17&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-left: 10px;padding-top: 10px&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--工具条--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-bottom: 0px;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:inline</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;filters&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;filters.keyword&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;关键字&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;getList&quot;</span>&gt;</span>查询<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleAdd&quot;</span>&gt;</span>新增<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!--列表--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">:data</span>=<span class="string">&quot;datas&quot;</span> <span class="attr">highlight-current-row</span>  @<span class="attr">selection-change</span>=<span class="string">&quot;selsChange&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%;&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">type</span>=<span class="string">&quot;selection&quot;</span> &gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span> <span class="attr">label</span>=<span class="string">&quot;标题&quot;</span> <span class="attr">width</span>=<span class="string">&quot;120&quot;</span> <span class="attr">sortable</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">label</span>=<span class="string">&quot;LOGO&quot;</span> <span class="attr">width</span>=<span class="string">&quot;120&quot;</span> <span class="attr">sortable</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span> <span class="attr">label</span>=<span class="string">&quot;描述&quot;</span> <span class="attr">width</span>=<span class="string">&quot;120&quot;</span> <span class="attr">sortable</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">prop</span>=<span class="string">&quot;totalCount&quot;</span> <span class="attr">label</span>=<span class="string">&quot;课程数量&quot;</span> <span class="attr">width</span>=<span class="string">&quot;120&quot;</span> <span class="attr">sortable</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-table-column</span> <span class="attr">label</span>=<span class="string">&quot;操作&quot;</span> <span class="attr">width</span>=<span class="string">&quot;150&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">template</span> <span class="attr">scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleEdit(scope.$index, scope.row)&quot;</span>&gt;</span>编辑<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleDel(scope.$index, scope.row)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">&lt;!--工具条--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-col</span> <span class="attr">:span</span>=<span class="string">&quot;24&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toolbar&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;batchRemove&quot;</span> <span class="attr">:disabled</span>=<span class="string">&quot;this.sels.length===0&quot;</span>&gt;</span>批量删除<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-col</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--新增界面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">title</span>=<span class="string">&quot;新增&quot;</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;addFormVisible&quot;</span>  <span class="attr">:close-on-click-modal</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;addForm&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;80px&quot;</span>  <span class="attr">ref</span>=<span class="string">&quot;addForm&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;分类标题&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.name&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;LOGO&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.logo&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;排序&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;sortIndex&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.sortIndex&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;描述&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;description&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.description&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;footer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dialog-footer&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click.native</span>=<span class="string">&quot;addFormVisible = false&quot;</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;addSubmit&quot;</span> &gt;</span>提交<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.el-row</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-pseudo">:last-child</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">margin-bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#carType</span> el-col &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.grid-content</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">min-height</span>: <span class="number">36px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">addForm</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">logo</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">sortIndex</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">description</span>:<span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">pid</span>:<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">addFormVisible</span>:<span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">sels</span>:[],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">filters</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">keyword</span>:<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">datas</span>:[],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">carTypes</span>:[],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">defaultProps</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">children</span>: <span class="string">&#x27;children&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">label</span>: <span class="string">&#x27;name&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleAdd</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="variable language_">this</span>.<span class="property">addFormVisible</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addSubmit</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//提交</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">put</span>(<span class="string">&quot;/carType&quot;</span>,<span class="variable language_">this</span>.<span class="property">addForm</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//&#123;success: true, ..</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">var</span> ajaxResult = res.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span>(ajaxResult.<span class="property">success</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="property">addFormVisible</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">message</span>: <span class="string">&#x27;提交成功&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.<span class="title function_">getTreeData</span>();</span></span><br><span class="line"><span class="language-javascript">                    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="variable language_">this</span>.$message(&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">message</span>: ajaxResult.<span class="property">message</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleCurrentChange</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">batchRemove</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleEdit</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleDel</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">selsChange</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">getList</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleNodeClick</span>(<span class="params">row</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">datas</span> = row.<span class="property">children</span>; <span class="comment">//每点一级只显示当前行节点儿子</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">addForm</span>.<span class="property">pid</span> = row.<span class="property">id</span>; <span class="comment">//把当前行的id作为添加表单父id</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">getTreeData</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 发送一个异步请求: get请求 /product/carType/treeData</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">get</span>(<span class="string">&quot;/carType/tree&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">carTypes</span> = res.<span class="property">data</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">datas</span> = <span class="variable language_">this</span>.<span class="property">carTypes</span>;  <span class="comment">//第一次进来只展示第一级</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">mounted</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//对carTypes数据赋值</span></span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">this</span>.<span class="title function_">getTreeData</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-crud"><a href="#2-2-crud" class="headerlink" title="2.2 crud"></a>2.2 crud</h4><p>​	略过</p><p>​	删除:当删除某个类型时,要删除这个类型和它下面所有的后代类型</p><h2 id="三-车辆类型树优化"><a href="#三-车辆类型树优化" class="headerlink" title="三. 车辆类型树优化"></a>三. 车辆类型树优化</h2><h3 id="1-为什么要优化"><a href="#1-为什么要优化" class="headerlink" title="1 为什么要优化"></a>1 为什么要优化</h3><p>​ 有问题？哪种场景有问题？</p><h4 id="1-1-使用到车辆类型树场景"><a href="#1-1-使用到车辆类型树场景" class="headerlink" title="1.1 使用到车辆类型树场景"></a>1.1 使用到车辆类型树场景</h4><p>​ 后台管理：</p><p><img src="/breeze/af1d2c35/image-20220906105206212.png" alt="image-20220906105206212"></p><p>​ 门户网站：</p><p><img src="/breeze/af1d2c35/image-20220906105325870.png" alt="image-20220906105325870"></p><h4 id="1-2-特定场景的问题"><a href="#1-2-特定场景的问题" class="headerlink" title="1.2 特定场景的问题"></a>1.2 特定场景的问题</h4><p>​ 后台管理：并发1000，1000并发获取类型树 1000并发访问数据 —数据库压力还是过大</p><p>​ 门户网站：并发50W 50W并发获取类型树 50W并发访问数据 —数据库压力非常大</p><h3 id="2-优化方案"><a href="#2-优化方案" class="headerlink" title="2 优化方案"></a>2 优化方案</h3><p>​ 后台管理优化方案： 缓存</p><p>​ 缓存优化，第一次访问的时候从数据库获取并放入缓存，以后直接从缓存获取。 1000打到缓存</p><p>​ 不能使用页面静态话，后台是一个单页面项目，不能搞成静态页面，就不是动态网站</p><p>​ 门户网站优化方案： 页面静态化</p><ul><li>不能使用缓存，50w并发全部打到缓存也不得行。</li><li>页面静态化，把页面做成静态页面，如果数据发生改变，重新生成静态页面就OK</li></ul><p>​</p><h2 id="四-分布式缓存"><a href="#四-分布式缓存" class="headerlink" title="四  分布式缓存"></a>四 分布式缓存</h2><h3 id="1-缓存技术概述-超级重要"><a href="#1-缓存技术概述-超级重要" class="headerlink" title="1  缓存技术概述   超级重要"></a>1 缓存技术概述 超级重要</h3><h4 id="1-1-选型"><a href="#1-1-选型" class="headerlink" title="1.1 选型"></a>1.1 选型</h4><ul><li><p>static Map 数据应用内存中</p></li><li><p>mybatis二级缓存 -小屁项目，不集群，数据量小的情况下用</p><p><img src="/breeze/af1d2c35/image-20220906111342188.png" alt="image-20220906111342188"></p></li><li><p>分布式缓存-redis–采纳，任何项目都可以</p><p><img src="/breeze/af1d2c35/image-20220906111901746.png" alt="image-20220906111901746"></p></li></ul><h4 id="1-2-使用缓存后流程"><a href="#1-2-使用缓存后流程" class="headerlink" title="1.2 使用缓存后流程"></a>1.2 使用缓存后流程</h4><p><img src="/breeze/af1d2c35/1633679021678.png" alt="1633679021678"></p><h4 id="1-3-使用缓存好处"><a href="#1-3-使用缓存好处" class="headerlink" title="1.3 使用缓存好处"></a>1.3 使用缓存好处</h4><p>​ 降低数据库压力，直接在内存中获取，不用大量访问数据库</p><p>​ 以内存操作代替文件操作，效率极高。 能够快速响应用户，提高用户体验度。</p><h4 id="1-4-使用缓存注意事项"><a href="#1-4-使用缓存注意事项" class="headerlink" title="1.4 使用缓存注意事项"></a>1.4 使用缓存注意事项</h4><p>​ 数据库中的数据如果发生改变（增删改），缓存中数据也要跟着变。</p><ul><li><p>经常查询</p><p>如果不经常查询，没必要放入缓存，缓存要占用资源。</p></li><li><p>很少变动（增删改）</p><p>​ 如果需要经常做增删改，每次都要同步redis，那么使用缓存就没什么意义</p></li></ul><h4 id="1-5-常见的使用缓存的场景"><a href="#1-5-常见的使用缓存的场景" class="headerlink" title="1.5 常见的使用缓存的场景"></a>1.5 常见的使用缓存的场景</h4><p>​ xxx类型（汽车类型，商品类型） 数据字典 首页推荐（至少按天）等等</p><h3 id="2-springboot-集成redis"><a href="#2-springboot-集成redis" class="headerlink" title="2 springboot 集成redis"></a>2 springboot 集成redis</h3><h4 id="2-1-集成Redis"><a href="#2-1-集成Redis" class="headerlink" title="2.1.集成Redis"></a>2.1.集成Redis</h4><p>有两种方案：</p><p>方案1：redisUtil工具类 Jedis</p><p>方案2：spring-data-redis</p><p>​ spring data：spring数据存储，包含数据库、redis、es、rabbitmq等</p><ul><li>spring data jpa(类似mybatis是做数据库持久化)：对数据库的支持</li><li>spring data redis：对redis存储数据的支持</li><li>spring data elastic search：对 elastic search存储数据的支持</li><li>spring data rabbtimq：对rabbitmq数据的支持</li></ul><p>​	springboot spring data redis 在springboot项目中使用 spring data redis，就是不用做太多配置了。只需要导入对应stater即可：spring-boot-starter-data-redis</p><h5 id="1-导入依赖"><a href="#1-导入依赖" class="headerlink" title="1.导入依赖"></a>1.导入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--整合Redis , 底层可以用jedis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-配置Redis"><a href="#2-配置Redis" class="headerlink" title="2.配置Redis"></a>2.配置Redis</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">2000ms</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure><h5 id="3-Redis序列化配置"><a href="#3-Redis序列化配置" class="headerlink" title="3.Redis序列化配置"></a>3.Redis序列化配置</h5><p>我们通常以JSON格式将数据存储到Redis中，<strong>这种格式是所有编程语言通用的</strong>，所以我们可以把Redis的序列化方式配置为JSON ,这样的话我们就可以不用自己去转JSON了</p><p><img src="/breeze/af1d2c35/image-20220906142345528.png" alt="image-20220906142345528"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//缓存的配置</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory factory;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用JSON进行序列化</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//JSON格式序列化</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">genericJackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line">         <span class="comment">//key的序列化</span></span><br><span class="line">        redisTemplate.setKeySerializer(genericJackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//value的序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(genericJackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">//hash结构key的虚拟化</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        <span class="comment">//hash结构value的虚拟化</span></span><br><span class="line">        redisTemplate.setHashValueSerializer(genericJackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-Redis测试"><a href="#2-2-Redis测试" class="headerlink" title="2.2.Redis测试"></a>2.2.Redis测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mliutm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTest</span> <span class="keyword">extends</span> <span class="title class_">BaseTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(obj);		</span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;user1&quot;</span>,<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>,<span class="string">&quot;zs&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) redisTemplate.opsForValue().get(<span class="string">&quot;user1&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五-项目实战"><a href="#五-项目实战" class="headerlink" title="五 项目实战"></a>五 项目实战</h2><h3 id="1-方案1：自己实现"><a href="#1-方案1：自己实现" class="headerlink" title="1  方案1：自己实现"></a>1 方案1：自己实现</h3><h4 id="1-1-缓存实现"><a href="#1-1-缓存实现" class="headerlink" title="1.1 缓存实现"></a>1.1 缓存实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarTypeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">BaseServiceImpl</span>&lt;CarType&gt; <span class="keyword">implements</span> <span class="title class_">ICarTypeService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CarTypeMapper carTypeMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CarType&gt; <span class="title function_">tree</span><span class="params">(Long pid)</span> &#123;</span><br><span class="line">        <span class="comment">//方案1：递归   自己方法调用自己方法   出口  n+1 SQL效率太低</span></span><br><span class="line">        <span class="comment">//return getCarTypeTreeByRecursion(pid);</span></span><br><span class="line">        <span class="comment">//方案2：循环方案   效率很高？是不是递归就没有用了？</span></span><br><span class="line">        <span class="comment">// 不是，只是递归中要查询数据库等存储系统的时候不要递归了，如果不查询数据库等存储系统还是用递归</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//加入缓存逻辑</span></span><br><span class="line">        <span class="comment">//1 从缓存中获取数据，并且判断是否存在</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> redisTemplate.opsForValue().get(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">        <span class="keyword">if</span> (obj!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//1.1 如果存在直接返回</span></span><br><span class="line">            System.out.println(<span class="string">&quot;缓存中存在数据...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (List&lt;CarType&gt;) obj;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//1.2 如果不存在，从数据库查询，放入缓存再返回</span></span><br><span class="line">            System.out.println(<span class="string">&quot;缓存中不存在数据...&quot;</span>);</span><br><span class="line">            List&lt;CarType&gt; carTypeTree = getCarTypeTreeByLoop(pid);</span><br><span class="line">            redisTemplate.opsForValue().set(BaseConstants.CAR_TYPE_TREE_IN_REDIS,carTypeTree);</span><br><span class="line">            <span class="keyword">return</span> carTypeTree;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="1-2-增删改更新缓存"><a href="#1-2-增删改更新缓存" class="headerlink" title="1.2 增删改更新缓存"></a>1.2 增删改更新缓存</h4><p>​ 方案1：做增删改的重新设置缓存-没人用</p><p>​ 做完以后，重新查询类型树，需要耗费时间</p><p>​ 方案2：做增删改的删除缓存，下一次获取再设置 ———–采纳</p><p>​ 只需要做一个简单删除</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CarType carType)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.add(carType);</span><br><span class="line">        <span class="comment">//删除缓存</span></span><br><span class="line">        redisTemplate.delete(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.del(id);</span><br><span class="line">        <span class="comment">//删除缓存</span></span><br><span class="line">        redisTemplate.delete(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(CarType carType)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.update(carType);</span><br><span class="line">        <span class="comment">//删除缓存</span></span><br><span class="line">        redisTemplate.delete(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="2-方案2：SpringCache"><a href="#2-方案2：SpringCache" class="headerlink" title="2  方案2：SpringCache"></a>2 方案2：SpringCache</h3><p>​	见下一章节</p><h2 id="六-SpringCache缓存"><a href="#六-SpringCache缓存" class="headerlink" title="六.SpringCache缓存"></a>六.SpringCache缓存</h2><h3 id="1-SpringCache概述"><a href="#1-SpringCache概述" class="headerlink" title="1.SpringCache概述"></a>1.SpringCache概述</h3><h4 id="1-1-什么是SpringCache"><a href="#1-1-什么是SpringCache" class="headerlink" title="1.1.什么是SpringCache"></a>1.1.什么是SpringCache</h4><p>Spring 3.1 引入了激动人心的基于凝视（annotation）的缓存（cache）技术，它本质上不是一个具体的缓存实现方案（比如EHCache 或者 OSCache），而是一个对缓存使用的抽象，通过在既有代码中加入少量它定义的各种 annotation，即能够达到缓存方法的返回对象的效果。</p><p>Spring 的缓存技术还具备相当的灵活性。不仅能够使用 SpEL（Spring Expression Language）来定义缓存的 key 和各种 condition，还提供开箱即用的缓存暂时存储方案，也支持和主流的专业缓存比如 EHCache 集成。</p><p><strong>说人话：SpringCahce对缓存流程进行了简化封装，提供了一些注解，我们通过简单的打注解就能实现缓存的添加，修改，删除等,注解如下：</strong></p><ul><li><p><strong>@Cacheable:触发缓存写入。</strong> 数据库查询写入缓存</p></li><li><p><strong>@CacheEvict:触发缓存清除。</strong> 数据库增删改清除缓存</p></li><li><p>@CachePut:更新缓存(不会影响到方法的运行)。</p></li><li><p>@Caching:重新组合要应用于方法的多个缓存操作。</p></li><li><p>@CacheConfig:设置类级别上共享的一些常见缓存设置。</p></li></ul><h4 id="1-2-Cacheable：写缓存"><a href="#1-2-Cacheable：写缓存" class="headerlink" title="1.2.@Cacheable：写缓存"></a>1.2.@Cacheable：写缓存</h4><p>@Cacheable可以用来进行缓存的写入，将结果存储在缓存中，以便于在后续调用的时候可以直接返回缓存中的值，而不必再执行实际的方法。 最简单的使用方式,注解名称&#x3D;缓存名称,使用例子如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames=“books”,key=”’book1’”)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(ISBN isbn)</span> &#123;..…&#125;</span><br></pre></td></tr></table></figure><p>一个方法可以对应多个缓存名称，如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames=&#123;“books”, “isbns”&#125;,key=”’book1’”)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(ISBN isbn)</span> &#123;..…&#125; </span><br></pre></td></tr></table></figure><p>@Cacheable的缓存名称是可以配置动态参数的，比如选择传入的参数,如下: (以下示例是使用SpEL声明,如果您不熟悉SpEL，可以阅读<a href="#expressions">Spring Expression Language</a>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames=“books”, key=“#isbn”)</span> <span class="comment">//参数值作为Key</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="meta">@Cacheable(cacheNames=“books”, key=“#isbn.rawNumber”)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(ISBN isbn, <span class="type">boolean</span> checkWarehouse, <span class="type">boolean</span> includeUsed)</span></span><br></pre></td></tr></table></figure><p>@Cacheable还可以设置根据条件判断是否需要缓存</p><ul><li><p>condition:取决于给定的参数是否满足条件</p></li><li><p>unless:取决于返回值是否满足条件</p></li></ul><p>以下是一个简单的例子:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(cacheNames=“book”, condition=“#name.length() &lt; 32”)</span> </span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(String name)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Cacheable(cacheNames=“book”,condition=“#name.length()&lt;32”, unless=“#result.hardback”)</span> </span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(String name)</span> </span><br></pre></td></tr></table></figure><p>@Cacheable还可以设置:keyGenerator(指定key自动生成方法),cacheManager(指定使用的缓存管理),cacheResolver(指定使用缓存的解析器)等,这些参数比较适合全局设置，这里就不多做介绍了。</p><h4 id="1-3-CachePut：修改缓存"><a href="#1-3-CachePut：修改缓存" class="headerlink" title="1.3.@CachePut：修改缓存"></a>1.3.@CachePut：修改缓存</h4><p>@CachePut:当需要更新缓存而不干扰方法的运行时 ，可以使用该注解。也就是说，始终执行该方法，并将结果放入缓存(已经有缓存就更新缓存)，注解参数与@Cacheable相同。 以下是一个简单的例子:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CachePut(cacheNames=&quot;book&quot;, key=&quot;#isbn&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">updateBook</span><span class="params">(ISBN isbn, BookDescriptor descriptor)</span> </span><br></pre></td></tr></table></figure><p>通常强烈建议不要对同一方法同时使用@CachePut和@Cacheable注解，因为它们具有不同的行为。可能会产生不可思议的BUG哦。</p><h4 id="1-4-CacheEvict-删除缓存"><a href="#1-4-CacheEvict-删除缓存" class="headerlink" title="1.4.@CacheEvict 删除缓存"></a>1.4.@CacheEvict 删除缓存</h4><p>@CacheEvict:删除缓存的注解,这对删除旧的数据和无用的数据是非常有用的。这里还多了一个参数(allEntries),设置allEntries&#x3D;true时，可以对整个条目进行批量删除。 以下是个简单的例子:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheEvict(cacheNames=&quot;books&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadBooks</span><span class="params">(InputStream batch)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//对cacheNames进行批量删除</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames=&quot;books&quot;, allEntries=true)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadBooks</span><span class="params">(InputStream batch)</span> </span><br></pre></td></tr></table></figure><h4 id="1-5-Caching：组合注解"><a href="#1-5-Caching：组合注解" class="headerlink" title="1.5.@Caching：组合注解"></a>1.5.@Caching：组合注解</h4><p>@Caching:在使用缓存的时候，有可能会同时进行更新和删除，会出现同时使用多个注解的情况.而@Caching可以实现。 以下是个简单的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Caching(evict = &#123; @CacheEvict(&quot;primary&quot;), @CacheEvict(cacheNames=&quot;secondary&quot;, key=&quot;#p0&quot;) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">importBooks</span><span class="params">(String deposit, Date date)</span> </span><br></pre></td></tr></table></figure><h4 id="1-6-CacheConfig-统一配置"><a href="#1-6-CacheConfig-统一配置" class="headerlink" title="1.6.@CacheConfig: 统一配置"></a>1.6.@CacheConfig: 统一配置</h4><p>@CacheConfig:缓存提供了许多的注解选项，但是有一些公用的操作，我们可以使用@CacheConfig在类上进行全局设置。 以下是个简单的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@CacheConfig(cacheName=&quot;books&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookRepositoryImpl</span> <span class="keyword">implements</span> <span class="title class_">BookRepository</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">findBook</span><span class="params">(ISBN isbn)</span> &#123;...&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="2-Cache缓存实战"><a href="#2-Cache缓存实战" class="headerlink" title="2.Cache缓存实战"></a>2.Cache缓存实战</h3><h4 id="2-1-导入依赖"><a href="#2-1-导入依赖" class="headerlink" title="2.1.导入依赖"></a>2.1.导入依赖</h4><p>这里配合Redis实现缓存，前面已经导入了redis的包，这里不再导入</p><h4 id="2-2-配置SpringCache"><a href="#2-2-配置SpringCache" class="headerlink" title="2.2.配置SpringCache"></a>2.2.配置SpringCache</h4><p>继承 CachingConfigurerSupport 对SpringCache进行配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义生成redis-key ， 类名.方法名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> KeyGenerator <span class="title function_">keyGenerator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (o, method, objects) -&gt; &#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            sb.append(o.getClass().getName()).append(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            sb.append(method.getName()).append(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Object obj : objects) &#123;</span><br><span class="line">                sb.append(obj.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;keyGenerator=&quot;</span> + sb.toString());</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CacheResolver <span class="title function_">cacheResolver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleCacheResolver</span>(cacheManager());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CacheErrorHandler <span class="title function_">errorHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 用于捕获从Cache中进行CRUD时的异常的回调处理器。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleCacheErrorHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//缓存管理器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">cacheConfiguration</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                        .disableCachingNullValues() <span class="comment">//不允许空值</span></span><br><span class="line">                        .serializeValuesWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                                             <span class="comment">//值使用JSON序列化</span></span><br><span class="line">                                             .fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(factory).cacheDefaults(cacheConfiguration).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h4 id="2-3-开启SpringCache"><a href="#2-3-开启SpringCache" class="headerlink" title="2.3.开启SpringCache"></a>2.3.开启SpringCache</h4><p>在启动类注解：@EnableCaching</p><h4 id="2-4-缓存实战"><a href="#2-4-缓存实战" class="headerlink" title="2.4.缓存实战"></a>2.4.缓存实战</h4><p>【<code>特别注意</code>】缓存注解不能加在内部方法上，比如：方法A调用方法B，给方法B加上缓存注解会失效，因为内部方法调用代理会失效。在A方法上打注解即可。</p><p>一个缓存名对应一个被注解的方法，但是一个方法可能传入不同的参数，那么结果也就会不同，这应该如何区分呢？这就需要用到 key 。在 spring 中，key 的生成有两种方式：显式指定和使用 keyGenerator 自动生成。</p><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/coding-one/p/12401630.html">https://www.cnblogs.com/coding-one/p/12401630.html</a></p><h5 id="1-添加缓存"><a href="#1-添加缓存" class="headerlink" title="1.添加缓存"></a>1.添加缓存</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = RedisConstants.KEY_COURSE_TYPE_TREE,key = &quot;&#x27;ALL&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;CourseType&gt; <span class="title function_">treeData</span><span class="params">()</span> &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;从数据库查询车辆分类..........................&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> treeDataMethodThree();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-剔除缓存"><a href="#2-剔除缓存" class="headerlink" title="2.剔除缓存"></a>2.剔除缓存</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = RedisConstants.KEY_COURSE_TYPE_TREE,key = &quot;&#x27;ALL&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">insert</span><span class="params">(CourseType entity)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.insert(entity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = RedisConstants.KEY_COURSE_TYPE_TREE,key = &quot;&#x27;ALL&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteById</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.deleteById(id);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = RedisConstants.KEY_COURSE_TYPE_TREE,key = &quot;&#x27;ALL&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">updateById</span><span class="params">(CourseType entity)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.updateById(entity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="七-缓存经典问题"><a href="#七-缓存经典问题" class="headerlink" title="七  缓存经典问题"></a>七 缓存经典问题</h2><h3 id="1-击穿、穿透，雪崩"><a href="#1-击穿、穿透，雪崩" class="headerlink" title="1 击穿、穿透，雪崩"></a>1 击穿、穿透，雪崩</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34827674/article/details/123463175">https://blog.csdn.net/qq_34827674/article/details/123463175</a></p><h4 id="1-1-缓存穿透-没有力度"><a href="#1-1-缓存穿透-没有力度" class="headerlink" title="1.1 缓存穿透-没有力度"></a>1.1 缓存穿透-没有力度</h4><p>​ 当用户访问的数据，<strong>既不在缓存中，也不在数据库中</strong>，导致请求在访问缓存时，发现缓存缺失，再去访问数据库时，发现数据库中也没有要访问的数据，没办法构建缓存数据，来服务后续的请求。那么当有大量这样的请求到来时，数据库的压力骤增，这就是<strong>缓存穿透</strong>的问题。</p><p><img src="/breeze/af1d2c35/image-20220906155729600.png" alt="image-20220906155729600"></p><p>应对缓存穿透的方案，常见的方案有三种。</p><p>第一种方案，非法请求的限制；<br>第二种方案，<strong>缓存默认值；</strong> 暂时实现它</p><p>第三种方案，使用<strong>布隆过滤器</strong>快速判断数据是否存在，<strong>避免通过查询数据库来判断数据是否存在；</strong></p><p>第一种方案，非法请求的限制</p><p>当有大量恶意请求访问不存在的数据的时候，也会发生缓存穿透，因此在 API 入口处我们要判断请求参数是否合理，请求参数是否含有非法值、请求字段是否存在，如果判断出是恶意请求就直接返回错误，避免进一步访问缓存和数据库。</p><p>第二种方案，缓存空值或者默认值</p><p>当我们线上业务发现缓存穿透的现象时，可以针对查询的数据，在缓存中设置一个空值或者默认值，这样后续请求就可以从缓存中读取到空值或者默认值，返回给应用，而不会继续查询数据库。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//1.2 如果不存在，从数据库查询，放入缓存再返回</span></span><br><span class="line">System.out.println(<span class="string">&quot;缓存中不存在数据...&quot;</span>);</span><br><span class="line">List&lt;CarType&gt; carTypeTree = getCarTypeTreeByLoop(pid);</span><br><span class="line"><span class="comment">//为了解决缓存穿透 即使是null也要缓存null</span></span><br><span class="line">redisTemplate.opsForValue().set(BaseConstants.CAR_TYPE_TREE_IN_REDIS,carTypeTree);</span><br><span class="line"><span class="keyword">return</span> carTypeTree;</span><br></pre></td></tr></table></figure><p>第三种方案，使用布隆过滤器快速判断数据是否存在，避免通过查询数据库来判断数据是否存在。</p><p><strong>我们可以在写入数据库数据时，使用布隆过滤器做个标记，然后在用户请求到来时，业务线程确认缓存失效后，可以通过查询布隆过滤器快速判断数据是否存在，如果不存在，就不用通过查询数据库来判断数据是否存在。</strong></p><p>即使发生了缓存穿透，大量请求只会查询 Redis 和布隆过滤器，而不会查询数据库，保证了数据库能正常运行，Redis 自身也是支持布隆过滤器的。</p><p>Redisson</p><h4 id="1-2-缓存击穿-有力度"><a href="#1-2-缓存击穿-有力度" class="headerlink" title="1.2 缓存击穿-有力度"></a>1.2 缓存击穿-有力度</h4><p>如果缓存中的<strong>某个热点数据过期</strong>了，此时大量的请求访问了该热点数据，就无法从缓存中读取，直接访问数据库，数据库很容易就被高并发的请求冲垮，这就是<strong>缓存击穿</strong>的问题。</p><p><img src="/breeze/af1d2c35/image-20220906164531103.png" alt="image-20220906164531103"></p><p>​ 增删改，删除缓存，相当于过期！后续大量的请求一起获取。</p><p>可以发现缓存击穿跟缓存雪崩很相似，你可以认为缓存击穿是缓存雪崩的一个子集。</p><p>应对缓存击穿可以采取前面说到两种方案：</p><p>​	<strong>互斥锁方案</strong>，保证同一时间只有一个业务线程更新缓存，未能获取互斥锁的请求，要么等待锁释放后重新读取缓存，要么就返回空值或者默认值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CarType&gt; <span class="title function_">tree</span><span class="params">(Long pid)</span> &#123;</span><br><span class="line">        <span class="comment">//方案1：递归   自己方法调用自己方法   出口  n+1 SQL效率太低</span></span><br><span class="line">        <span class="comment">//return getCarTypeTreeByRecursion(pid);</span></span><br><span class="line">        <span class="comment">//方案2：循环方案   效率很高？是不是递归就没有用了？</span></span><br><span class="line">        <span class="comment">// 不是，只是递归中要查询数据库等存储系统的时候不要递归了，如果不查询数据库等存储系统还是用递归</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//加入缓存逻辑</span></span><br><span class="line">        <span class="comment">//1 从缓存中获取数据，并且判断是否存在</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> redisTemplate.opsForValue().get(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">        <span class="keyword">if</span> (obj!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//1.1 如果存在直接返回</span></span><br><span class="line">            System.out.println(<span class="string">&quot;缓存中存在数据...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (List&lt;CarType&gt;) obj;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               <span class="comment">//t1 t2 ...1W</span></span><br><span class="line">            <span class="keyword">synchronized</span> (CarTypeServiceImpl.class)&#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">objTmp</span> <span class="operator">=</span> redisTemplate.opsForValue().get(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">                <span class="keyword">if</span> (objTmp!=<span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> (List&lt;CarType&gt;) objTmp;</span><br><span class="line">                <span class="comment">//1.2 如果不存在，从数据库查询，放入缓存再返回</span></span><br><span class="line">                System.out.println(<span class="string">&quot;缓存中不存在数据...&quot;</span>);</span><br><span class="line">                List&lt;CarType&gt; carTypeTree = getCarTypeTreeByLoop(pid);</span><br><span class="line">                <span class="comment">//为了解决缓存穿透 即使是null也要缓存null</span></span><br><span class="line">                redisTemplate.opsForValue().set(BaseConstants.CAR_TYPE_TREE_IN_REDIS,carTypeTree);</span><br><span class="line">                <span class="keyword">return</span> carTypeTree;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>​	<strong>不给热点数据设置过期时间</strong>，由后台异步更新缓存，或者在热点数据准备要过期前，提前通知后台线程更新缓存以及重新设置过期时间；</p><h4 id="1-3-缓存雪崩-多个缓存失效少量请求"><a href="#1-3-缓存雪崩-多个缓存失效少量请求" class="headerlink" title="1.3 缓存雪崩-多个缓存失效少量请求"></a>1.3 缓存雪崩-多个缓存失效少量请求</h4><p>​	当<strong>大量缓存数据在同一时间过期（失效）或者 Redis 故障宕机</strong>时，如果此时有大量的用户请求，都无法在 Redis 中处理，于是全部请求都直接访问数据库，从而导致数据库的压力骤增，严重的会造成数据库宕机，从而形成一系列连锁反应，造成整个系统崩溃，这就是<strong>缓存雪崩</strong>的问题。</p><p><img src="/breeze/af1d2c35/image-20220906170121953.png" alt="image-20220906170121953"></p><p>可以看到，发生缓存雪崩有两个原因：</p><p>大量数据同时过期；<br>Redis 故障宕机；<br>不同的诱因，应对的策略也会不同。</p><p><strong>大量数据同时过期</strong><br>针对大量数据同时过期而引发的缓存雪崩问题，常见的应对方法有下面这几种：</p><p><strong>均匀设置过期时间；</strong><br>互斥锁； 查询这个缓存的时候，另外的缓存等待 分布式锁<br>双 key 策略；</p><p>​ 给同一个数据设置两个key,主key备key,主key设置过期时间,备key不设置过期时间,如果主key过期,从备key查询,如果数据做了增删改,还要改两个key的内容</p><p>后台更新缓存；</p><ol><li>均匀设置过期时间</li></ol><p>如果要给缓存数据设置过期时间，应该避免将大量的数据设置成同一个过期时间。我们可以在对缓存数据设置过期时间时，给这些数据的过期时间加上一个随机数，这样就保证数据不会在同一时间过期。</p><ol start="2"><li>互斥锁</li></ol><p>当业务线程在处理用户请求时，如果发现访问的数据不在 Redis 里，就加个互斥锁，保证同一时间内只有一个请求来构建缓存（从数据库读取数据，再将数据更新到 Redis 里），当缓存构建完成后，再释放锁。未能获取互斥锁的请求，要么等待锁释放后重新读取缓存，要么就返回空值或者默认值。</p><p>实现互斥锁的时候，最好设置超时时间，不然第一个请求拿到了锁，然后这个请求发生了某种意外而一直阻塞，一直不释放锁，这时其他请求也一直拿不到锁，整个系统就会出现无响应的现象。</p><ol start="3"><li>双 key 策略</li></ol><p><strong>我们对缓存数据可以使用两个 key，一个是主 key，会设置过期时间，一个是备 key，不会设置过期，它们只是 key 不一样，但是 value 值是一样的，相当于给缓存数据做了个副本。</strong></p><p><strong>当业务线程访问不到「主 key 」的缓存数据时，就直接返回「备 key 」的缓存数据，然后在更新缓存的时候，同时更新「主 key 」和「备 key 」的数据。</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;CarType&gt; <span class="title function_">tree</span><span class="params">(Long pid)</span> &#123;</span><br><span class="line">        <span class="comment">//方案1：递归   自己方法调用自己方法   出口  n+1 SQL效率太低</span></span><br><span class="line">        <span class="comment">//return getCarTypeTreeByRecursion(pid);</span></span><br><span class="line">        <span class="comment">//方案2：循环方案   效率很高？是不是递归就没有用了？</span></span><br><span class="line">        <span class="comment">// 不是，只是递归中要查询数据库等存储系统的时候不要递归了，如果不查询数据库等存储系统还是用递归</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//加入缓存逻辑</span></span><br><span class="line">        <span class="comment">//1 从缓存中获取数据，并且判断是否存在</span></span><br><span class="line">        <span class="comment">// 第一种情况：主备都没有</span></span><br><span class="line">        <span class="comment">// 第二种情况：两种都有</span></span><br><span class="line">        <span class="comment">// 第三种情况： 主没有，备有 进行了增删改</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> getCacheData(BaseConstants.CAR_TYPE_TREE_IN_REDIS,pid);</span><br><span class="line">        <span class="keyword">if</span> (obj!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//1.1 如果存在直接返回</span></span><br><span class="line">            System.out.println(<span class="string">&quot;缓存中存在数据...&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> (List&lt;CarType&gt;) obj;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//t1 t2 ...1W</span></span><br><span class="line">            <span class="keyword">synchronized</span> (CarTypeServiceImpl.class)&#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">objTmp</span> <span class="operator">=</span> getCacheData(BaseConstants.CAR_TYPE_TREE_IN_REDIS,pid);</span><br><span class="line">                <span class="keyword">if</span> (objTmp!=<span class="literal">null</span>)</span><br><span class="line">                    <span class="keyword">return</span> (List&lt;CarType&gt;) objTmp;</span><br><span class="line">                <span class="comment">//1.2 如果不存在，从数据库查询，放入缓存再返回</span></span><br><span class="line">                System.out.println(<span class="string">&quot;缓存中不存在数据...&quot;</span>);</span><br><span class="line">                List&lt;CarType&gt; carTypeTree = getCarTypeTreeByLoop(pid);</span><br><span class="line">                <span class="comment">//为了解决缓存穿透 即使是null也要缓存null</span></span><br><span class="line">                setCacheData(BaseConstants.CAR_TYPE_TREE_IN_REDIS,carTypeTree);</span><br><span class="line">                <span class="keyword">return</span> carTypeTree;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setCacheData</span><span class="params">(String key,Object obj)</span>&#123;</span><br><span class="line">        <span class="comment">//查询主key</span></span><br><span class="line">        redisTemplate.opsForValue().set(key,obj);</span><br><span class="line">        redisTemplate.opsForValue().set(key+<span class="string">&quot;_bak&quot;</span>,obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getCacheData</span><span class="params">(String key,Long pid)</span>&#123;</span><br><span class="line">        <span class="comment">//查询主key</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">        <span class="keyword">if</span> (obj!=<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询备选key</span></span><br><span class="line">        obj = redisTemplate.opsForValue().get(key+<span class="string">&quot;_bak&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (obj!=<span class="literal">null</span>)&#123;</span><br><span class="line">            List&lt;CarType&gt; carTypeTree = getCarTypeTreeByLoop(pid);</span><br><span class="line">            <span class="comment">//为了解决缓存穿透 即使是null也要缓存null</span></span><br><span class="line">            setCacheData(key,carTypeTree);</span><br><span class="line">            <span class="keyword">return</span> carTypeTree;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(CarType carType)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.add(carType);</span><br><span class="line">        <span class="comment">//删除缓存</span></span><br><span class="line">        redisTemplate.delete(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(Serializable id)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.del(id);</span><br><span class="line">        <span class="comment">//删除缓存</span></span><br><span class="line">        redisTemplate.delete(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(CarType carType)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.update(carType);</span><br><span class="line">        <span class="comment">//删除缓存</span></span><br><span class="line">        redisTemplate.delete(BaseConstants.CAR_TYPE_TREE_IN_REDIS);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>后台更新缓存</li></ol><p>业务线程不再负责更新缓存，缓存也不设置有效期，而是让缓存“永久有效”，并将更新缓存的工作交由后台线程定时更新。</p><p>事实上，缓存数据不设置有效期，并不是意味着数据一直能在内存里，因为当系统内存紧张的时候，有些缓存数据会被“淘汰”，而在缓存被“淘汰”到下一次后台定时更新缓存的这段时间内，业务线程读取缓存失败就返回空值，业务的视角就以为是数据丢失了。</p><p>解决上面的问题的方式有两种。</p><p>第一种方式，后台线程不仅负责定时更新缓存，而且也负责频繁地检测缓存是否有效，检测到缓存失效了，原因可能是系统紧张而被淘汰的，于是就要马上从数据库读取数据，并更新到缓存。</p><p>这种方式的检测时间间隔不能太长，太长也导致用户获取的数据是一个空值而不是真正的数据，所以检测的间隔最好是毫秒级的，但是总归是有个间隔时间，用户体验一般。</p><p>第二种方式，在业务线程发现缓存数据失效后（缓存数据被淘汰），通过消息队列发送一条消息通知后台线程更新缓存，后台线程收到消息后，在更新缓存前可以判断缓存是否存在，存在就不执行更新缓存操作；不存在就读取数据库数据，并将数据加载到缓存。这种方式相比第一种方式缓存的更新会更及时，用户体验也比较好。</p><p>在业务刚上线的时候，我们最好提前把数据缓起来，而不是等待用户访问才来触发缓存构建，这就是所谓的缓存预热，后台更新缓存的机制刚好也适合干这个事情。</p><p><strong>Redis 故障宕机</strong><br>针对 Redis 故障宕机而引发的缓存雪崩问题，常见的应对方法有下面这几种：</p><p>服务熔断或请求限流机制；<br>构建 Redis 缓存高可靠集群；</p><ol><li>服务熔断或请求限流机制</li></ol><p>因为 Redis 故障宕机而导致缓存雪崩问题时，我们可以启动服务熔断机制，暂停业务应用对缓存服务的访问，直接返回错误，不用再继续访问数据库，从而降低对数据库的访问压力，保证数据库系统的正常运行，然后等到 Redis 恢复正常后，再允许业务应用访问缓存服务。</p><p>服务熔断机制是保护数据库的正常允许，但是暂停了业务应用访问缓存服系统，全部业务都无法正常工作</p><p>为了减少对业务的影响，我们可以启用请求限流机制，只将少部分请求发送到数据库进行处理，再多的请求就在入口直接拒绝服务，等到 Redis 恢复正常并把缓存预热完后，再解除请求限流的机制。</p><ol start="2"><li>构建 Redis 缓存高可靠集群</li></ol><p>服务熔断或请求限流机制是缓存雪崩发生后的应对方案，我们最好通过主从节点的方式构建 Redis 缓存高可靠集群。</p><p>如果 Redis 缓存的主节点故障宕机，从节点可以切换成为主节点，继续提供缓存服务，避免了由于 Redis 故障宕机而导致的缓存雪崩问题。</p><h3 id="2-双写一致性-Canal"><a href="#2-双写一致性-Canal" class="headerlink" title="2 双写一致性    Canal"></a>2 双写一致性 Canal</h3><blockquote><p>指的是数据库写操作和缓存更新操作的一致性问题</p></blockquote><h4 id="2-1-双写一致性的策略："><a href="#2-1-双写一致性的策略：" class="headerlink" title="2.1 双写一致性的策略："></a>2.1 双写一致性的策略：</h4><pre><code>- 先更新缓存，再更新数据库
- 先更新数据库，再更新缓存
- 先删除缓存，再更新数据库
- 先更新数据库，再删除缓存
</code></pre><h4 id="2-2-四种策略的优缺点"><a href="#2-2-四种策略的优缺点" class="headerlink" title="2.2 四种策略的优缺点"></a>2.2 四种策略的优缺点</h4><p>1、先更新缓存，再更新数据库</p><p>问题很明显如果更新缓存成功，更新数据库失败，就会造成缓存的脏数据</p><p>2、先更新数据库，再更新缓存</p><p>如果再高并发的情况下，可能会存在如下的情况，线程A更新了数据库，如果由于网络或者其他的原因，线程A还没来得及更新缓存，这时候有一个进程B更新了数据库，更新了缓存，这时候进程A才更新缓存，这时候就会导致线程B对缓存的更新丢失了，像事务丢失的情况</p><p>3、先删除缓存，再更新数据库</p><p>这种策略可能已经避免掉了，策略2中缓存丢失的情况，但是再高并发的情况下，也会有不一致的情况，比如线程A做写操作，首先删除缓存然后准备更新数据库，这时候，线程B执行了写操作，没有命中缓存，然后查询数据库，这时候读取的是旧值，并把查询到的旧值保存到缓存中，接着线程A完成了数据库的更新，这时候数据库和缓存又出现了不一致的情况，解决方案：我们只要再线程A，完成数据库的更新之后，稍作延迟再删除一次缓存，也叫作延迟双删。这里的延迟时间一定要大于业务的一次读操作的时间。</p><p>4、先更新数据库，再删除缓存</p><p>再高并发的情况下，也会有不一致的情况，比如线程A做读取数据的操作，正准备写入缓存的时候，线程B更新了数据库，然后执行了删除缓存的操作，这时候线程A才把旧值写入到缓存中，虽然这种情况出现的概率比较低，因为写操作的时候要大于一次读操作的时间的。解决方案：延迟双删，延时双删还是有问题的，如果删除缓存失败怎么办，当然是再次删除，不断的循环删除。删除失败后我们可以将要删除的key放入到队列中，然后尝试重复删除，直到删除成功。</p><h2 id="八-总结"><a href="#八-总结" class="headerlink" title="八.总结"></a>八.总结</h2><h3 id="1-重点内容"><a href="#1-重点内容" class="headerlink" title="1.重点内容"></a>1.重点内容</h3><ul><li>车辆树查询</li><li>Redis缓存</li><li>SpringCache缓存</li></ul><h3 id="2-面试必备"><a href="#2-面试必备" class="headerlink" title="2.面试必备"></a>2.面试必备</h3><ul><li>缓存的流程</li><li>你们项目怎么使用Redis的</li><li>你使用过Redis的哪些存储结构，为什么</li><li>SpringCache注解有哪些，分别有什么作用</li><li>你们Redis和数据库一致性怎么保证的</li><li>缓存击穿，缓存穿透，缓存雪崩了解吗，怎么解决</li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mliutm.github.io">清风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mliutm.github.io/breeze/af1d2c35.html">https://mliutm.github.io/breeze/af1d2c35.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mliutm.github.io" target="_blank">清风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post_share"><div class="social-share" data-image="/img/photo-1645943020355-305df166473d.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/breeze/326c49cc.html" title="容车宝-车辆crud（六）"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">容车宝-车辆crud（六）</div></div></a></div><div class="next-post pull-right"><a href="/breeze/78423a8.html" title="蓉车宝-店铺入驻-自定义异常-fastdfs（四）"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">蓉车宝-店铺入驻-自定义异常-fastdfs（四）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/breeze/c8b66f0a.html" title="File类"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">File类</div></div></a></div><div><a href="/breeze/fed4c017.html" title="IO流"><img class="cover" src="/img/photo-1688475747590-d0db5e2412cb.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">IO流</div></div></a></div><div><a href="/breeze/a4950fb1.html" title="Redis实战-黑马点评"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">Redis实战-黑马点评</div></div></a></div><div><a href="/breeze/ab319c68.html" title="SpringCloud-Alibaba快速入门"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-13</div><div class="title">SpringCloud-Alibaba快速入门</div></div></a></div><div><a href="/breeze/4c9bef51.html" title="base抽取与代码生成器（三）"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-28</div><div class="title">base抽取与代码生成器（三）</div></div></a></div><div><a href="/breeze/a197ec68.html" title="for和forEach的区别和使用"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-16</div><div class="title">for和forEach的区别和使用</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">清风</div><div class="author-info__description">清风洒六合，邈然不可攀</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">156</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:huangpan0805@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%93%89%E8%BD%A6%E5%AE%9D-%E8%BD%A6%E8%BE%86%E7%B1%BB%E5%9E%8B-%E7%BC%93%E5%AD%98"><span class="toc-text">蓉车宝-车辆类型-缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%86%85%E5%AE%B9"><span class="toc-text">一 内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E8%BD%A6%E8%BE%86%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86"><span class="toc-text">二.车辆分类管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%BE%E8%AE%A1"><span class="toc-text">1.需求分析与设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.功能实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%98%BE%E7%A4%BA%E5%B7%A6%E8%BE%B9%E7%9A%84%E6%97%A0%E9%99%90%E6%9E%81%E6%A0%91"><span class="toc-text">2.1 显示左边的无限极树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-crud"><span class="toc-text">2.2 crud</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E8%BD%A6%E8%BE%86%E7%B1%BB%E5%9E%8B%E6%A0%91%E4%BC%98%E5%8C%96"><span class="toc-text">三. 车辆类型树优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BC%98%E5%8C%96"><span class="toc-text">1 为什么要优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BD%BF%E7%94%A8%E5%88%B0%E8%BD%A6%E8%BE%86%E7%B1%BB%E5%9E%8B%E6%A0%91%E5%9C%BA%E6%99%AF"><span class="toc-text">1.1 使用到车辆类型树场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%89%B9%E5%AE%9A%E5%9C%BA%E6%99%AF%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">1.2 特定场景的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BC%98%E5%8C%96%E6%96%B9%E6%A1%88"><span class="toc-text">2 优化方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-%E5%88%86%E5%B8%83%E5%BC%8F%E7%BC%93%E5%AD%98"><span class="toc-text">四 分布式缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF%E6%A6%82%E8%BF%B0-%E8%B6%85%E7%BA%A7%E9%87%8D%E8%A6%81"><span class="toc-text">1 缓存技术概述 超级重要</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E9%80%89%E5%9E%8B"><span class="toc-text">1.1 选型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E5%90%8E%E6%B5%81%E7%A8%8B"><span class="toc-text">1.2 使用缓存后流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E5%A5%BD%E5%A4%84"><span class="toc-text">1.3 使用缓存好处</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">1.4 使用缓存注意事项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-text">1.5 常见的使用缓存的场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-springboot-%E9%9B%86%E6%88%90redis"><span class="toc-text">2 springboot 集成redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E9%9B%86%E6%88%90Redis"><span class="toc-text">2.1.集成Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1.导入依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AERedis"><span class="toc-text">2.配置Redis</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-Redis%E5%BA%8F%E5%88%97%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-text">3.Redis序列化配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Redis%E6%B5%8B%E8%AF%95"><span class="toc-text">2.2.Redis测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98"><span class="toc-text">五 项目实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%96%B9%E6%A1%881%EF%BC%9A%E8%87%AA%E5%B7%B1%E5%AE%9E%E7%8E%B0"><span class="toc-text">1 方案1：自己实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%BC%93%E5%AD%98%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.1 缓存实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98"><span class="toc-text">1.2 增删改更新缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%B9%E6%A1%882%EF%BC%9ASpringCache"><span class="toc-text">2 方案2：SpringCache</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-SpringCache%E7%BC%93%E5%AD%98"><span class="toc-text">六.SpringCache缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SpringCache%E6%A6%82%E8%BF%B0"><span class="toc-text">1.SpringCache概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFSpringCache"><span class="toc-text">1.1.什么是SpringCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Cacheable%EF%BC%9A%E5%86%99%E7%BC%93%E5%AD%98"><span class="toc-text">1.2.@Cacheable：写缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-CachePut%EF%BC%9A%E4%BF%AE%E6%94%B9%E7%BC%93%E5%AD%98"><span class="toc-text">1.3.@CachePut：修改缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-CacheEvict-%E5%88%A0%E9%99%A4%E7%BC%93%E5%AD%98"><span class="toc-text">1.4.@CacheEvict 删除缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-Caching%EF%BC%9A%E7%BB%84%E5%90%88%E6%B3%A8%E8%A7%A3"><span class="toc-text">1.5.@Caching：组合注解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-CacheConfig-%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE"><span class="toc-text">1.6.@CacheConfig: 统一配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Cache%E7%BC%93%E5%AD%98%E5%AE%9E%E6%88%98"><span class="toc-text">2.Cache缓存实战</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">2.1.导入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AESpringCache"><span class="toc-text">2.2.配置SpringCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%BC%80%E5%90%AFSpringCache"><span class="toc-text">2.3.开启SpringCache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E7%BC%93%E5%AD%98%E5%AE%9E%E6%88%98"><span class="toc-text">2.4.缓存实战</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%BC%93%E5%AD%98"><span class="toc-text">1.添加缓存</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%89%94%E9%99%A4%E7%BC%93%E5%AD%98"><span class="toc-text">2.剔除缓存</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-%E7%BC%93%E5%AD%98%E7%BB%8F%E5%85%B8%E9%97%AE%E9%A2%98"><span class="toc-text">七 缓存经典问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%BB%E7%A9%BF%E3%80%81%E7%A9%BF%E9%80%8F%EF%BC%8C%E9%9B%AA%E5%B4%A9"><span class="toc-text">1 击穿、穿透，雪崩</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F-%E6%B2%A1%E6%9C%89%E5%8A%9B%E5%BA%A6"><span class="toc-text">1.1 缓存穿透-没有力度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF-%E6%9C%89%E5%8A%9B%E5%BA%A6"><span class="toc-text">1.2 缓存击穿-有力度</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9-%E5%A4%9A%E4%B8%AA%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E5%B0%91%E9%87%8F%E8%AF%B7%E6%B1%82"><span class="toc-text">1.3 缓存雪崩-多个缓存失效少量请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8F%8C%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7-Canal"><span class="toc-text">2 双写一致性 Canal</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%8F%8C%E5%86%99%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E7%AD%96%E7%95%A5%EF%BC%9A"><span class="toc-text">2.1 双写一致性的策略：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%9B%9B%E7%A7%8D%E7%AD%96%E7%95%A5%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">2.2 四种策略的优缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-%E6%80%BB%E7%BB%93"><span class="toc-text">八.总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%87%8D%E7%82%B9%E5%86%85%E5%AE%B9"><span class="toc-text">1.重点内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9D%A2%E8%AF%95%E5%BF%85%E5%A4%87"><span class="toc-text">2.面试必备</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/breeze/2a548e97.html" title="面试实战"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="面试实战"></a><div class="content"><a class="title" href="/breeze/2a548e97.html" title="面试实战">面试实战</a><time datetime="2024-02-29T02:43:59.000Z" title="发表于 2024-02-29 10:43:59">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/4edde71e.html" title="Vue2-3-Vue3状态管理Pinia（十一）"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Vue2-3-Vue3状态管理Pinia（十一）"></a><div class="content"><a class="title" href="/breeze/4edde71e.html" title="Vue2-3-Vue3状态管理Pinia（十一）">Vue2-3-Vue3状态管理Pinia（十一）</a><time datetime="2024-02-03T13:31:25.000Z" title="发表于 2024-02-03 21:31:25">2024-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/da043fa1.html" title="Vue2-3-大事件管理系统（十）"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Vue2-3-大事件管理系统（十）"></a><div class="content"><a class="title" href="/breeze/da043fa1.html" title="Vue2-3-大事件管理系统（十）">Vue2-3-大事件管理系统（十）</a><time datetime="2024-02-03T13:30:11.000Z" title="发表于 2024-02-03 21:30:11">2024-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/3a02bcd7.html" title="Vue2-3-Vue3入门（九）"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Vue2-3-Vue3入门（九）"></a><div class="content"><a class="title" href="/breeze/3a02bcd7.html" title="Vue2-3-Vue3入门（九）">Vue2-3-Vue3入门（九）</a><time datetime="2024-02-03T13:28:47.000Z" title="发表于 2024-02-03 21:28:47">2024-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/e727cc3a.html" title="Vue2-3-智慧商城项目（八）"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Vue2-3-智慧商城项目（八）"></a><div class="content"><a class="title" href="/breeze/e727cc3a.html" title="Vue2-3-智慧商城项目（八）">Vue2-3-智慧商城项目（八）</a><time datetime="2024-02-03T13:27:28.000Z" title="发表于 2024-02-03 21:27:28">2024-02-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/photo-1645943020355-305df166473d.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 <i id="heartbeat" class="fa fas fa-heartbeat"></i> 清风</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/timing.js"></script><script id="canvas_nest" defer color="255,0,255" opacity="0.7" zindex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="天枢,天璇,天玑,天权,玉衡,开阳,瑶光" data-fontsize="15px" data-random="true" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>