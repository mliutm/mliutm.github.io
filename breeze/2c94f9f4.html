<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>ElasticSearch一文通关 | 清风</title><meta name="author" content="清风"><meta name="copyright" content="清风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ElasticSearch全文搜索引擎内容 全文搜索Lucene入门 ElasticSearch概述和安装 ElasticSearch的基本使用 ElasticSearch在Java中使用  一.全文搜索Lucene入门1.全文搜索概述1.1.什么是全文检索​	狭义的理解主要针对文本数据的搜索。数据可分为“结构化”数据(关系数据库表形式管理的数据)，半结构化数据(XML文档、JSON文档)，和非结"><meta property="og:type" content="article"><meta property="og:title" content="ElasticSearch一文通关"><meta property="og:url" content="https://mliutm.github.io/breeze/2c94f9f4.html"><meta property="og:site_name" content="清风"><meta property="og:description" content="ElasticSearch全文搜索引擎内容 全文搜索Lucene入门 ElasticSearch概述和安装 ElasticSearch的基本使用 ElasticSearch在Java中使用  一.全文搜索Lucene入门1.全文搜索概述1.1.什么是全文检索​	狭义的理解主要针对文本数据的搜索。数据可分为“结构化”数据(关系数据库表形式管理的数据)，半结构化数据(XML文档、JSON文档)，和非结"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mliutm.github.io/img/photo-1692708632140-ee01624d558d.jpg"><meta property="article:published_time" content="2023-12-06T10:55:08.000Z"><meta property="article:modified_time" content="2024-01-13T03:10:21.483Z"><meta property="article:author" content="清风"><meta property="article:tag" content="中间件"><meta property="article:tag" content="ElasticSearch"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://mliutm.github.io/img/photo-1692708632140-ee01624d558d.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://mliutm.github.io/breeze/2c94f9f4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:200,languages:{author:"作者: 清风",link:"链接: ",source:"来源: 清风",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"ElasticSearch一文通关",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-01-13 11:10:21"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">142</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/photo-1692708632140-ee01624d558d.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="清风"><span class="site-name">清风</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ElasticSearch一文通关</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-06T10:55:08.000Z" title="发表于 2023-12-06 18:55:08">2023-12-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-13T03:10:21.483Z" title="更新于 2024-01-13 11:10:21">2024-01-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="ElasticSearch一文通关"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ElasticSearch全文搜索引擎"><a href="#ElasticSearch全文搜索引擎" class="headerlink" title="ElasticSearch全文搜索引擎"></a>ElasticSearch全文搜索引擎</h1><h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><ul><li>全文搜索Lucene入门</li><li>ElasticSearch概述和安装</li><li>ElasticSearch的基本使用</li><li>ElasticSearch在Java中使用</li></ul><h2 id="一-全文搜索Lucene入门"><a href="#一-全文搜索Lucene入门" class="headerlink" title="一.全文搜索Lucene入门"></a>一.全文搜索Lucene入门</h2><h3 id="1-全文搜索概述"><a href="#1-全文搜索概述" class="headerlink" title="1.全文搜索概述"></a>1.全文搜索概述</h3><h4 id="1-1-什么是全文检索"><a href="#1-1-什么是全文检索" class="headerlink" title="1.1.什么是全文检索"></a>1.1.什么是全文检索</h4><p>​	狭义的理解主要针对<strong>文本数据</strong>的搜索。数据可分为“结构化”数据(关系数据库表形式管理的数据)，半结构化数据(XML文档、JSON文档)，和非结构化数据(WORD、PDF)，通常而言在结构化的数据中搜索性能是比较高的，全文搜索的目的就是把非结构化的数据变成有结构化的数据进行搜索，从而提高搜索效率。</p><p><img src="/breeze/2c94f9f4/image-20240113110023110.png" alt="image-20240113110023110"></p><h4 id="1-2-为什么要使用全文搜索"><a href="#1-2-为什么要使用全文搜索" class="headerlink" title="1.2.为什么要使用全文搜索"></a>1.2.为什么要使用全文搜索</h4><ul><li><p>搜索效率高，是like无法比拟的 like %keyword%</p></li><li><p>相关度最高的排在最前面，官网中相关的网页排在最前面； java</p></li><li><p>关键词的高亮。</p></li><li><p>搜索效果更好， 基于单词搜索</p></li><li><p>只处理文本,不处理语义。 以单词方式进行搜索，比如在输入框中输入“中国的首都在哪里”，搜索引擎不会以对话的形式告诉你“在北京”，而仅仅是列出包含了搜索关键字的网页。</p><p>java —-&gt;javascript java</p><p>代替<strong>大量数据</strong>表中的like查询</p></li></ul><h4 id="1-3-常见的全文搜索"><a href="#1-3-常见的全文搜索" class="headerlink" title="1.3.常见的全文搜索"></a>1.3.常见的全文搜索</h4><ul><li><p>全文搜索工具包（jar）-Lucene（核心）</p></li><li><p>全文搜索服务器 ，Elastic Search(ES) &#x2F; Solr等封装了lucene并扩展</p></li></ul><h3 id="2-Lucene概述"><a href="#2-Lucene概述" class="headerlink" title="2.Lucene概述"></a>2.Lucene概述</h3><h4 id="2-1-什么是Lucene"><a href="#2-1-什么是Lucene" class="headerlink" title="2.1.什么是Lucene"></a>2.1.什么是Lucene</h4><p>​	Lucene是apache下的一个开源的全文检索引擎工具包(一堆jar包)。它为软件开发人员提供一个简单易用的工具包（类库），以方便的在<strong>小型目标系统</strong>中实现全文检索的功能。Lucene适用于中小型项目 ，ES适用于中大型项目（它底层是基于lucene实现的）</p><h4 id="2-2-Lucene索引原理（重点）"><a href="#2-2-Lucene索引原理（重点）" class="headerlink" title="2.2.Lucene索引原理（重点）"></a>2.2.Lucene索引原理（重点）</h4><p>任何技术都有一些核心，Lucene也有核心，而它的核心分为：索引创建，索引搜索。接下来我们就一一的来看。</p><p><strong>索引创建和索引搜索不仅仅只是lucene的核心,它也是全文检索的核心</strong></p><p><img src="/breeze/2c94f9f4/1634871254810.png" alt="1634871254810"></p><p><img src="/breeze/2c94f9f4/image-20240113110403180.png" alt="image-20240113110403180"></p><h5 id="1-索引的创建"><a href="#1-索引的创建" class="headerlink" title="1.索引的创建"></a>1.索引的创建</h5><p>将现实世界中所有的结构化和非结构化数据提取信息，创建索引的过程。那么索引里面究竟存的什么，以及如何创建索引呢？在这通过下面的例子来解答这个问题。首先构造三个不同的句子，有长有短：</p><p><img src="/breeze/2c94f9f4/1634871347915.png" alt="1634871347915"></p><p>在①处分别为3个句子加上编号，然后进行分词，把被一个单词分解出来与编号对应放在②处；在搜索的过程总，对于搜索的过程中大写和小写指的都是同一个单词，在这就没有区分的必要，按规则统一变为小写放在③处；要加快搜索速度，就必须保证这些单词的排列时有一定规则，这里按照字母顺序排列后放在④处；最后再简化索引，合并相同的单词，就得到如下结果：</p><p><img src="/breeze/2c94f9f4/1634871382028.png" alt="1634871382028"></p><p>通常在数据库中我们都是根据文档找到内容，而这里是通过词，能够快速找到包含他的文档，这就是文档倒排链表。以上就是lucene索引结构中最核心的部分。我们注意到关键字是按字符顺序排列的（lucene没有使用B树结构），因此lucene可以用二元搜索算法快速定位关键词。</p><h5 id="2-索引的搜索"><a href="#2-索引的搜索" class="headerlink" title="2.索引的搜索"></a>2.索引的搜索</h5><p>就是得到用户的查询请求，搜索创建的索引，然后返回结果的过程。</p><p><img src="/breeze/2c94f9f4/1634871459893.png" alt="1634871459893"></p><p>索java world两个关键词，符合java的有1,2两个文档，符合world的有1,3两个文档，在搜索引擎中直接这样排列两个词他们之间是OR的关系，出现其中一个都可以被找到，所以这里3个都会出来。全文检索中是有相关性排序的，那么结果在是怎么排列的呢？hello java world中包含两个关键字排在第一，另两个都包含一个关键字，得到结果，hello lucene world排在第二，java在最长的句子中占的权重最低排在结果集的第三。从这里可以看出相关度排序还是有一定规则的。</p><h4 id="2-3-Lucene入门程序"><a href="#2-3-Lucene入门程序" class="headerlink" title="2.3.Lucene入门程序"></a>2.3.Lucene入门程序</h4><p>​	Lucene的索引库和数据库一样，都提供相应的API来便捷操作。Lucene中的索引维护使用<strong>IndexWriter</strong>，由这个类提供添删改相关的操作；索引的搜索则是使用<strong>IndexSearcher</strong>进行索引的搜索。</p><h5 id="1-导入依赖"><a href="#1-导入依赖" class="headerlink" title="1.导入依赖"></a>1.导入依赖</h5><p>HelloWorld代码如下,导入三个jar包：lucene-analyzers-common-5.5.0.jar，lucene-core-5.5.0.jar，lucene-queryparser-5.5.0.jar</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-analyzers-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.lucene<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lucene-queryparser<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="2-创建索引"><a href="#2-创建索引" class="headerlink" title="2.创建索引"></a>2.创建索引</h5><p><img src="/breeze/2c94f9f4/1634871618730.png" alt="1634871618730"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建索引的数据 现在写死，以后根据实际应用场景</span></span><br><span class="line"><span class="type">String</span> <span class="variable">doc1</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">doc2</span> <span class="operator">=</span> <span class="string">&quot;hello java world&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">doc3</span> <span class="operator">=</span> <span class="string">&quot;hello lucene world&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span><span class="string">&quot;F:/eclipse/workspace/lucene/index/hello&quot;</span>;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//2、准备IndexWriter（索引写入器）</span></span><br><span class="line">		<span class="comment">//索引库的位置 FS fileSystem</span></span><br><span class="line">		<span class="type">Directory</span> <span class="variable">d</span> <span class="operator">=</span> FSDirectory.open(Paths.get(path ));</span><br><span class="line">		<span class="comment">//分词器 -- 把文档进行分词</span></span><br><span class="line">		<span class="type">Analyzer</span> <span class="variable">analyzer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAnalyzer</span>();</span><br><span class="line">		<span class="comment">//索引写入器的配置对象</span></span><br><span class="line">		<span class="type">IndexWriterConfig</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriterConfig</span>(analyzer);</span><br><span class="line">		<span class="type">IndexWriter</span> <span class="variable">indexWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexWriter</span>(d, conf);</span><br><span class="line">		System.out.println(indexWriter);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1、 把文本内容转换为Document对象</span></span><br><span class="line">		<span class="comment">//把文本转换为document对象</span></span><br><span class="line">		<span class="type">Document</span> <span class="variable">document1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">		<span class="comment">//标题字段</span></span><br><span class="line">		document1.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;doc1&quot;</span>, Store.YES));</span><br><span class="line">		document1.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;content&quot;</span>, doc1, Store.YES));</span><br><span class="line">		<span class="comment">//添加document到缓冲区</span></span><br><span class="line">		indexWriter.addDocument(document1);</span><br><span class="line">		<span class="type">Document</span> <span class="variable">document2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">		<span class="comment">//标题字段</span></span><br><span class="line">		document2.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;doc2&quot;</span>, Store.YES));</span><br><span class="line">		document2.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;content&quot;</span>, doc2, Store.YES));</span><br><span class="line">		<span class="comment">//添加document到缓冲区</span></span><br><span class="line">		indexWriter.addDocument(document2);</span><br><span class="line">		<span class="type">Document</span> <span class="variable">document3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>();</span><br><span class="line">		<span class="comment">//标题字段</span></span><br><span class="line">		document3.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;doc3&quot;</span>, Store.YES));</span><br><span class="line">		document3.add(<span class="keyword">new</span> <span class="title class_">TextField</span>(<span class="string">&quot;content&quot;</span>, doc3, Store.YES));</span><br><span class="line">			</span><br><span class="line">		<span class="comment">//3 、通过IndexWriter，把Document添加到缓冲区并提交</span></span><br><span class="line">		<span class="comment">//添加document到缓冲区</span></span><br><span class="line">		indexWriter.addDocument(document3);</span><br><span class="line">		indexWriter.commit();</span><br><span class="line">	    indexWriter.close();</span><br><span class="line">			</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用luke工具可以看到索引库中的数据</p><p><img src="/breeze/2c94f9f4/1634871720652.png" alt="1634871720652"></p><p><a target="_blank" rel="noopener" href="https://github.com/DmitryKey/luke">https://github.com/DmitryKey/luke</a></p><h5 id="2-搜索索引"><a href="#2-搜索索引" class="headerlink" title="2.搜索索引"></a>2.搜索索引</h5><p><img src="/breeze/2c94f9f4/1634871745539.png" alt="1634871745539"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 封装查询提交为查询对象</span></span><br><span class="line"><span class="comment">// 2 准备IndexSearcher </span></span><br><span class="line"><span class="comment">// 3 使用IndexSearcher传入查询对象做查询-----查询出来只是文档编号DocID</span></span><br><span class="line"><span class="comment">// 4 通过IndexSearcher传入DocID获取文档</span></span><br><span class="line"><span class="comment">// 5 把文档转换为前台需要的对象</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSearch</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">keyWord</span> <span class="operator">=</span> <span class="string">&quot;lucene&quot;</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// * 1 封装查询提交为查询对象</span></span><br><span class="line">	    <span class="comment">//通过查询解析器解析一个字符串为查询对象</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">f</span> <span class="operator">=</span> <span class="string">&quot;content&quot;</span>; <span class="comment">//查询的默认字段名,</span></span><br><span class="line">		<span class="type">Analyzer</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAnalyzer</span>();<span class="comment">//查询关键字要分词，所有需要分词器</span></span><br><span class="line">		<span class="type">QueryParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryParser</span>(f, a);</span><br><span class="line">		<span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> parser.parse(<span class="string">&quot;content:&quot;</span>+keyWord); </span><br><span class="line"></span><br><span class="line">		<span class="comment">// * 2 准备IndexSearcher</span></span><br><span class="line">		<span class="type">Directory</span> <span class="variable">d</span> <span class="operator">=</span> FSDirectory.open(Paths.get(path ));</span><br><span class="line">		<span class="type">IndexReader</span> <span class="variable">r</span> <span class="operator">=</span> DirectoryReader.open(d);</span><br><span class="line">		<span class="type">IndexSearcher</span> <span class="variable">searcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexSearcher</span>(r);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// * 3 使用IndexSearcher传入查询对象做查询-----查询出来只是文档编号DocID</span></span><br><span class="line">		<span class="type">TopDocs</span> <span class="variable">topDocs</span> <span class="operator">=</span> searcher.search(query, <span class="number">1000</span>);<span class="comment">//查询ton条记录 前多少条记录</span></span><br><span class="line">		System.out.println(<span class="string">&quot;总命中数：&quot;</span>+topDocs.totalHits);</span><br><span class="line">		ScoreDoc[] scoreDocs = topDocs.scoreDocs;<span class="comment">//命中的所有的文档的封装（docId）</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">// * 4 通过IndexSearcher传入DocID获取文档</span></span><br><span class="line">		<span class="keyword">for</span> (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">			<span class="type">int</span> <span class="variable">docId</span> <span class="operator">=</span> scoreDoc.doc;</span><br><span class="line">			<span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> searcher.doc(docId);</span><br><span class="line">			<span class="comment">// * 5 把文档转换为前台需要的对象 Docment----&gt; Article</span></span><br><span class="line">			System.out.println(<span class="string">&quot;=======================================&quot;</span>);</span><br><span class="line">			System.out.println(<span class="string">&quot;title:&quot;</span>+document.get(<span class="string">&quot;title&quot;</span>)</span><br><span class="line">							+<span class="string">&quot;,content:&quot;</span>+document.get(<span class="string">&quot;content&quot;</span>));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="二-ElasticSearch相关概念"><a href="#二-ElasticSearch相关概念" class="headerlink" title="二.ElasticSearch相关概念"></a>二.ElasticSearch相关概念</h2><h3 id="1-ElasticSearch介绍"><a href="#1-ElasticSearch介绍" class="headerlink" title="1.ElasticSearch介绍"></a>1.ElasticSearch介绍</h3><h4 id="1-1-为什么要使用ElasticSearch"><a href="#1-1-为什么要使用ElasticSearch" class="headerlink" title="1.1. 为什么要使用ElasticSearch"></a>1.1. 为什么要使用ElasticSearch</h4><p>​	虽然全文搜索领域，Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。但是，Lucene只是一个库。想要使用它，你必须使用Java来作为开发语言并将其直接集成到你的应用中，更糟糕的是，Lucene的配置及使用非常复杂，你需要深入了解检索的相关知识来理解它是如何工作的。</p><h4 id="1-2-什么是ElasticSearch"><a href="#1-2-什么是ElasticSearch" class="headerlink" title="1.2.什么是ElasticSearch"></a>1.2.什么是ElasticSearch</h4><p>​	ES是一个分布式的全文搜索引擎，为了解决原生Lucene使用的不足，优化Lucene的调用方式，并实现了高可用的分布式集群的搜索方案，ES的索引库管理支持依然是基于Apache Lucene(TM)的开源搜索引擎。</p><p>​	ES也使用Java开发并使用Lucene作为其核心来实现所有索引和搜索的功能，但是它的目的是通过简单的 RESTful API来隐藏Lucene的复杂性，从而让全文搜索变得简单。</p><p>​	<strong>总的来说ElasticSearch简化了全文检索lucene的使用，同时增加了分布式的特性，使得构建大规模分布式全文检索变得非常容易。</strong></p><h4 id="1-3-ES的特点"><a href="#1-3-ES的特点" class="headerlink" title="1.3.ES的特点"></a>1.3.ES的特点</h4><ul><li><p>分布式的实时文件存储</p></li><li><p>分布式全文搜索引擎,每个字段都被索引并可被搜索</p></li><li><p>能在分布式项目&#x2F;集群中使用</p></li><li><p>本身支持集群扩展,可以扩展到上百台服务器</p></li><li><p>处理PB级结构化或非结构化数据</p></li><li><p>简单的 RESTful API通信方式</p></li><li><p>支持各种语言的客户端</p></li><li><p>基于Lucene封装，使操作简单</p></li></ul><h4 id="1-4-ES和lucene的区别"><a href="#1-4-ES和lucene的区别" class="headerlink" title="1.4.ES和lucene的区别"></a>1.4.ES和lucene的区别</h4><ul><li><p>Lucene只支持Java,ES支持多种语言</p><p>​	只要这个语言支持http请求,就可以使用es</p></li><li><p>Lucene使用非常复杂 ， ES屏蔽了Lucene的使用细节，操作更方便</p><p>ES发一个http请求就OK</p></li><li><p>Lucene非分布式的,索引目录只能在项目本地，多个服务器不能共享 ， 而es是一个单独服务器，多个应用服务器可以共享</p></li><li><p>Lucene非分布式，ES支持分布式，es本身也能分布式集群</p></li><li><p>小项目可以使用Lucene ，大项目,分布式项目(微服务)使用ES。但是杀鸡也能用牛刀</p></li></ul><h3 id="2-ES的使用案例"><a href="#2-ES的使用案例" class="headerlink" title="2.ES的使用案例"></a>2.ES的使用案例</h3><ul><li><p>Github(美国)使用Elasticsearch搜索20TB的数据，包括13亿的文件和1300亿行的代码.</p></li><li><p>Foursquare实时搜索5千万地点信息？Foursquare每天都用Elasticsearch做这样的事.</p></li><li><p>德国SoundCloud使用Elasticsearch来为1.8亿用户提供即时精准的音乐搜索服务.</p></li><li><p>Mozilla公司以火狐著名，它目前使用 WarOnOrange 这个项目来进行单元或功能测试，测试的结果以 json的方式索引到elasticsearch中，开发人员可以非常方便的查找 bug.</p></li><li><p>Sony公司使用elasticsearch 作为信息搜索引擎.</p></li></ul><h3 id="3-其他全文搜索引擎"><a href="#3-其他全文搜索引擎" class="headerlink" title="3.其他全文搜索引擎"></a>3.其他全文搜索引擎</h3><h4 id="2-1-Solr（重量级对手）"><a href="#2-1-Solr（重量级对手）" class="headerlink" title="2.1.Solr（重量级对手）"></a>2.1.Solr（重量级对手）</h4><p>Apache Lucene项目的开源企业搜索平台。其主要功能包括全文检索、命中标示、分面搜索、动态聚类、数据库集成，以及富文本（如Word、PDF）的处理。Solr是高度可扩展的，并提供了分布式搜索和索引复制。Solr是最流行的企业级搜索引擎，Solr4 还增加了NoSQL支持。</p><p>Solr和ES比较：</p><p>Solr 利用 Zookeeper(注册中心) 进行分布式管理，支持更多格式的数据（HTML&#x2F;PDF&#x2F;CSV），官方提供的功能更多在传统的搜索应用中表现好于 ES，但实时搜索效率低。</p><p>ES自身带有分布式协调管理功能，但仅支持json文件格式，本身更注重于核心功能，高级功能多有第三方插件提供，在处理实时搜索应用时效率明显高于 Solr。</p><h4 id="2-2-Katta"><a href="#2-2-Katta" class="headerlink" title="2.2.Katta"></a>2.2.Katta</h4><p>基于 Lucene 的，支持分布式，可扩展，具有容错功能，准实时的搜索方案。</p><p>优点：开箱即用，可以与 Hadoop (大数据)配合实现分布式。具备扩展和容错机制。</p><p>缺点：只是搜索方案，建索引部分还是需要自己实现。在搜索功能上，只实现了最基本的需求。成功案例较少，项目的成熟度稍微差一些。</p><h4 id="3-3-HadoopContrib"><a href="#3-3-HadoopContrib" class="headerlink" title="3.3.HadoopContrib"></a>3.3.HadoopContrib</h4><p>大数据相关的东西 (大数据工程师)</p><p>Map&#x2F;Reduce 模式(云计算)的，分布式建索引方案，可以跟 Katta 配合使用。</p><p>优点：分布式建索引，具备可扩展性。</p><p>缺点：只是建索引方案，不包括搜索实现。工作在批处理模式，对实时搜索的支持不佳。</p><h2 id="三-ES下载和安装"><a href="#三-ES下载和安装" class="headerlink" title="三.ES下载和安装"></a>三.ES下载和安装</h2><p>​	ES的安装比较简单，只需要官方下载ES的运行包，然后启动ES服务即可。ES的使用主要是通过能够发起HTTP请求的终端来接入，比如Poster插件、CURL、kibana5等。</p><h3 id="1-ElasticSearch安装"><a href="#1-ElasticSearch安装" class="headerlink" title="1.ElasticSearch安装"></a>1.ElasticSearch安装</h3><p>ES服务只依赖于JDK，推荐使用JDK1.8+。本课程以在window环境下，ES 6.8.6版本为例，下载对应的ZIP文件</p><h4 id="1-1-下载ElasticSearch"><a href="#1-1-下载ElasticSearch" class="headerlink" title="1.1.下载ElasticSearch"></a>1.1.下载ElasticSearch</h4><p>下载地址：<a target="_blank" rel="noopener" href="https://www.elastic.co/downloads/elasticsearch">https://www.elastic.co/downloads/elasticsearch</a></p><p>本课程以在window环境下，ES 6.8.6版本为例，下载对应的ZIP文件</p><p><img src="/breeze/2c94f9f4/1634879189476.png" alt="1634879189476"></p><h4 id="1-2-安装与启动"><a href="#1-2-安装与启动" class="headerlink" title="1.2.安装与启动"></a>1.2.安装与启动</h4><p>解压即可，双击安装目录 bin&#x2F;elasticsearch.bat即可启动</p><p><img src="/breeze/2c94f9f4/1634879246264.png" alt="1634879246264"></p><h4 id="1-3-ElasticSearch测试"><a href="#1-3-ElasticSearch测试" class="headerlink" title="1.3.ElasticSearch测试"></a>1.3.ElasticSearch测试</h4><p>使用浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:9200/">http://localhost:9200</a></p><p><img src="/breeze/2c94f9f4/1634879287182.png" alt="1634879287182"></p><p>看到上图信息，恭喜你，你的ES集群已经启动并且正常运行.</p><h4 id="1-4-ES内存配置"><a href="#1-4-ES内存配置" class="headerlink" title="1.4.ES内存配置"></a>1.4.ES内存配置</h4><p>如果ES启动占用的内存比较大可以通过修改 jvm.options 文件来修改内存</p><p><img src="/breeze/2c94f9f4/1634879370834.png" alt="1634879370834"></p><h3 id="2-Kibana5安装"><a href="#2-Kibana5安装" class="headerlink" title="2.Kibana5安装"></a>2.Kibana5安装</h3><h4 id="2-1-下载Kibana5"><a href="#2-1-下载Kibana5" class="headerlink" title="2.1.下载Kibana5"></a>2.1.下载Kibana5</h4><p>下载地址：<a target="_blank" rel="noopener" href="https://www.elastic.co/downloads/kibana">https://www.elastic.co/downloads/kibana</a></p><h4 id="2-2-安装与启动"><a href="#2-2-安装与启动" class="headerlink" title="2.2.安装与启动"></a>2.2.安装与启动</h4><p>解压即可安装 ， 执行bin\kibana.bat 即可启动Kibana</p><p>注意:启动kibana以前,要先启动Elasticsearch,kibana默认就是连接自己本机的9200</p><h4 id="2-3-Kinbana连接ES配置"><a href="#2-3-Kinbana连接ES配置" class="headerlink" title="2.3.Kinbana连接ES配置"></a>2.3.Kinbana连接ES配置</h4><p>解压并编辑config&#x2F;kibana.yml，设置elasticsearch.url的值为已启动的ES</p><p>默认情况下，Kibana会链接本地的默认ES <code>http://localhost:9200</code> ,如果需要修改链接的ES服务器，通过修改安装目录下 config&#x2F;kibana.yml，将配置项 <code>#elasticsearch.url: &quot;http://localhost:9200&quot;</code> 取消注释即可修改连接的ES服务器地址。</p><h4 id="2-4-测试Kibana"><a href="#2-4-测试Kibana" class="headerlink" title="2.4.测试Kibana"></a>2.4.测试Kibana</h4><p>浏览器访问 <a target="_blank" rel="noopener" href="http://localhost:5601/">http://localhost:5601</a> Kibana默认地址</p><p>Kibana组件详细说明：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hunttown/p/6768864.html">https://www.cnblogs.com/hunttown/p/6768864.html</a></p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Discover：可视化查询分析器</span><br><span class="line"></span><br><span class="line">Visualize：统计分析图表</span><br><span class="line"></span><br><span class="line">Dashboard：自定义主面板（添加图表）</span><br><span class="line"></span><br><span class="line">Timelion：Timelion是一个kibana时间序列展示组件（暂时不用）</span><br><span class="line"></span><br><span class="line">Dev Tools ：Console（同CURL/POSTER，操作ES代码工具，代码提示，很方便）</span><br><span class="line"></span><br><span class="line">Management：管理索引库(<span class="built_in">index</span>)、已保存的搜索和可视化结果(<span class="keyword">save</span> objects)、设置 kibana 服务器属性。</span><br></pre></td></tr></table></figure><h2 id="四-ElasticSearch基础"><a href="#四-ElasticSearch基础" class="headerlink" title="四.ElasticSearch基础"></a>四.ElasticSearch基础</h2><h3 id="1-几个基本概念"><a href="#1-几个基本概念" class="headerlink" title="1.几个基本概念"></a>1.几个基本概念</h3><h4 id="1-1-Near-Realtime（NRT）"><a href="#1-1-Near-Realtime（NRT）" class="headerlink" title="1.1.Near Realtime（NRT）"></a>1.1.Near Realtime（NRT）</h4><p>近实时，两个意思，从写入数据到数据可以被搜索到有一个小延迟（大概1秒）；基于es执行搜索和分析可以达到秒级</p><h4 id="1-2-Index：索引库"><a href="#1-2-Index：索引库" class="headerlink" title="1.2.Index：索引库"></a>1.2.Index：索引库</h4><p>包含一堆有相似结构的文档数据，比如可以有一个客户索引，商品分类索引，订单索引，索引有一个名称。一个index包含很多document，一个index就代表了一类类似的或者相同的document。比如说建立一个product index，商品索引，里面可能就存放了所有的商品数据，所有的商品document。</p><p>​	类似于关系型数据库中的 数据库</p><h4 id="1-3-Type：类型"><a href="#1-3-Type：类型" class="headerlink" title="1.3.Type：类型"></a>1.3.Type：类型</h4><p>每个索引库里都可以有一个或多个type，type是index中的一个逻辑数据分类，一个type下的document，都有相同的field，比如博客系统，有一个索引，可以定义用户数据type，博客数据type，评论数据type。</p><p>​	类似于关系型数据库中的表</p><p>​ 新版本的es,一个索引库下只能有一个type</p><h4 id="1-4-Document-field"><a href="#1-4-Document-field" class="headerlink" title="1.4.Document&amp;field"></a>1.4.Document&amp;field</h4><p>文档，es中的最小数据单元，一个document可以是一条客户数据，一条商品分类数据，一条订单数据，通常用JSON数据结构表示，每个index下的type中，都可以去存储多个document。一个document里面有多个field，每个field就是一个数据字段。</p><p>document类似于关系型数据库表中的一行数据</p><p><img src="/breeze/2c94f9f4/1661842989595.png" alt="1661842989595"></p><table><thead><tr><th>ElastciSearch全文搜索</th><th>Mysql关系型数据库</th></tr></thead><tbody><tr><td>索引库(index)</td><td>数据库(database)</td></tr><tr><td>文档类型(Type)</td><td>数据表(Table)</td></tr><tr><td>文档(Document)</td><td>一行数据(Row)</td></tr><tr><td>字段(field)</td><td>一个列(column)</td></tr><tr><td>文档ID</td><td>主键ID</td></tr><tr><td>查询(Query DSL)</td><td>查询(SQL)</td></tr><tr><td>GET http:&#x2F;&#x2F;..</td><td>SELECT * FROM …</td></tr><tr><td>PUT http:&#x2F;&#x2F;</td><td>UPDATE table set…</td></tr></tbody></table><h3 id="2-索引库CRUD"><a href="#2-索引库CRUD" class="headerlink" title="2.索引库CRUD"></a>2.索引库CRUD</h3><h4 id="2-1增加索引库"><a href="#2-1增加索引库" class="headerlink" title="2.1增加索引库"></a>2.1增加索引库</h4><p>创建一个名字为 <code>shopping</code>的索引库，5个<code>Master Shard</code>分片，每个Master Shard分片有1个<code>Replica Shard</code>从分片</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT shopping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span><span class="number">1</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-查询索引库"><a href="#2-2-查询索引库" class="headerlink" title="2.2.查询索引库"></a>2.2.查询索引库</h4><p>查询所有索引库</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> _cat/indices?v</span><br></pre></td></tr></table></figure><p>查看指定索引库</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> _cat/indices/shopping</span><br></pre></td></tr></table></figure><h4 id="2-3-删除索引库"><a href="#2-3-删除索引库" class="headerlink" title="2.3.删除索引库"></a>2.3.删除索引库</h4><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> 名字</span><br></pre></td></tr></table></figure><h4 id="2-4-修改索引库"><a href="#2-4-修改索引库" class="headerlink" title="2.4.修改索引库"></a>2.4.修改索引库</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除再添加</span><br></pre></td></tr></table></figure><h3 id="3-文档的CRUD"><a href="#3-文档的CRUD" class="headerlink" title="3.文档的CRUD"></a>3.文档的CRUD</h3><h4 id="3-1-添加文档"><a href="#3-1-添加文档" class="headerlink" title="3.1.添加文档"></a>3.1.添加文档</h4><p>我们以员工对象为例，我们首先要做的是存储员工数据，每个文档代表一个员工。在ES中存储数据的行为就叫做索引(indexing)，文档归属于一种类型(type),而这些类型存在于索引(index)中，我们可以简单的对比传统数据库和ES的对应关系：</p><table><thead><tr><th>ES</th><th>Mysql</th></tr></thead><tbody><tr><td>_index(索引库)</td><td>数据库</td></tr><tr><td>_type(文档类型)</td><td>表</td></tr><tr><td>_document(文档对象)</td><td>一行数据</td></tr><tr><td>_id(文档ID)</td><td>主键ID</td></tr><tr><td>field(字段)</td><td>列</td></tr></tbody></table><p><img src="/breeze/2c94f9f4/1661844998833.png" alt="1661844998833"></p><p>ES集群可以包含多个索引(indices)（数据库），每一个索引库中可以包含多个类型(types)（表），每一个类型含有多个文档(documents)（行），然后每个文档包含多个字段(Fields)（列）。</p><ul><li>基本语法</li></ul><p>指定ID创建索引文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT index/type/id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	JSON，文档内容</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">--解释---------------------------------------</span><br><span class="line"></span><br><span class="line">PUT 索引库/文档类型/文档id</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	JSON格式，文档原始数据</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>使用内置ID创建索引文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST index/type/</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	JSON，文档内容</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">--解释---------------------------------------</span><br><span class="line">PUT 索引库/文档类型/</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	JSON格式，文档原始数据</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">没有指定文档ID，ES会自动生成ID</span><br></pre></td></tr></table></figure><ul><li>案例</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT crm/user/<span class="number">11</span>	</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;zs&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;zs&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;join_date&quot;</span><span class="punctuation">:</span> <span class="number">1584092062348</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>解释：添加id为11的用户 ， 索引库为 crm，类型为 User</p><p>【<code>注意</code>】：如果不指定文档的id，ES会自动生成文档id</p><h4 id="3-2-获取文档"><a href="#3-2-获取文档" class="headerlink" title="3.2.获取文档"></a>3.2.获取文档</h4><ul><li>获取指定文档</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> 索引库/类型/文档ID </span><br></pre></td></tr></table></figure><ul><li>指定返回的列</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> /crm/user/123?<span class="attribute">_source</span>=fullName,email</span><br></pre></td></tr></table></figure><ul><li>只要内容不要元数据</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /crm/user/123/_source</span><br></pre></td></tr></table></figure><h4 id="3-3-修改文档"><a href="#3-3-修改文档" class="headerlink" title="3.3.修改文档"></a>3.3.修改文档</h4><ul><li><p>整体修改</p><p>全量修改的语法跟添加文档语法一样，如果文档已经存在就是修改，否则就是新增，</p><p>文档修改过程：1.标记删除旧文档，2.添加新文档</p></li></ul><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PUT</span> &#123;index&#125;/&#123;<span class="keyword">type</span>&#125;/&#123;id&#125;</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;id&quot;</span>:<span class="number">11</span>,</span><br><span class="line">	<span class="string">&quot;username&quot;</span>:<span class="string">&quot;zs&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：上面的修改会把ES中的数据全部覆盖，即age字段会消失。</p><ul><li><p>局部修改</p><p>局部修改过程： 1.检索旧文档 ， 2.修改文档 ，3.标记删除旧文档 ， 4.添加新文档</p></li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="regexp">/crm/u</span>ser<span class="regexp">/123/</span>_update</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;doc&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span> : <span class="number">11</span>, </span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;xx&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：上面修改只会修改id，和username字段，age字段不会作任何改变。</p><h4 id="2-4-删除文档"><a href="#2-4-删除文档" class="headerlink" title="2.4.删除文档"></a>2.4.删除文档</h4><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">DELETE </span><span class="template-variable">&#123;index&#125;</span><span class="language-xml">/</span><span class="template-variable">&#123;type&#125;</span><span class="language-xml">/</span><span class="template-variable">&#123;id&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-文档简单查询"><a href="#4-文档简单查询" class="headerlink" title="4.文档简单查询"></a>4.文档简单查询</h3><h4 id="4-1-基本查询"><a href="#4-1-基本查询" class="headerlink" title="4.1.基本查询"></a>4.1.基本查询</h4><ul><li>查询所有 - 查询所有库里面的</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> _search</span><br></pre></td></tr></table></figure><ul><li>查询指定索引库</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GET</span> crm/_search</span><br></pre></td></tr></table></figure><ul><li>查询指定类型</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> crm/<span class="keyword">user</span>/_search</span><br></pre></td></tr></table></figure><ul><li>查询指定文档</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> crm/<span class="keyword">user</span>/<span class="number">11</span></span><br></pre></td></tr></table></figure><h4 id="4-2-分页查询"><a href="#4-2-分页查询" class="headerlink" title="4.2.分页查询"></a>4.2.分页查询</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">&amp;size</span>=<span class="number">2</span><span class="variable">&amp;from</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure><ul><li><p>size: 每页条数</p></li><li><p>form:从多少条数据开始查</p></li></ul><h4 id="4-3-字符串查询"><a href="#4-3-字符串查询" class="headerlink" title="4.3.字符串查询"></a>4.3.字符串查询</h4><p>条件查询+分页+排序</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET crm<span class="keyword">/user/</span>_search?q=age:<span class="number">17</span><span class="variable">&amp;size</span>=<span class="number">2</span><span class="variable">&amp;from</span>=<span class="number">2</span><span class="variable">&amp;sort</span>=id:desc<span class="variable">&amp;_source</span>=id,username</span><br></pre></td></tr></table></figure><p>字符串查询(query string)其实就是在url后面以字符串的方式拼接各种查询条件，这种方式不推荐，因为条件过多，拼接起来比较麻烦</p><p>查询URL可携带参数：</p><p><img src="/breeze/2c94f9f4/1634880061236.png" alt="1634880061236"></p><p><img src="/breeze/2c94f9f4/1634880083092.png" alt="1634880083092"></p><h4 id="4-4-批量查询"><a href="#4-4-批量查询" class="headerlink" title="4.4.批量查询"></a>4.4.批量查询</h4><p>批量查询很重要,对相比单个查询来说，批量查询性能更高。</p><ul><li>同索引库同类型 - 推荐</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET mliutm/blog/_mget</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;ids&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1&quot;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="五-DSL查询与DSL过滤"><a href="#五-DSL查询与DSL过滤" class="headerlink" title="五.DSL查询与DSL过滤"></a>五.DSL查询与DSL过滤</h2><h3 id="1-DSL查询"><a href="#1-DSL查询" class="headerlink" title="1.DSL查询"></a>1.DSL查询</h3><h4 id="1-1-什么是DSL查询"><a href="#1-1-什么是DSL查询" class="headerlink" title="1.1.什么是DSL查询"></a>1.1.什么是DSL查询</h4><p>​	对于简单查询，使用查询字符串比较好，但是对于复杂查询，由于条件多，逻辑嵌套复杂，查询字符串不易组织与表达，且容易出错，因此推荐复杂查询通过DSL使用JSON内容格式的请求体代替。</p><p>​	DSL查询是由ES提供丰富且灵活的查询语言叫做DSL查询(Query DSL),它允许你构建更加复杂、强大的查询。DSL(Domain Specific Language特定领域语言)以JSON请求体的形式出现。DSL有两部分组成：DSL查询(like)和DSL过滤(非like)。</p><h4 id="1-2-DSL查询语法"><a href="#1-2-DSL查询语法" class="headerlink" title="1.2.DSL查询语法"></a>1.2.DSL查询语法</h4><p>一个常用的相对完整的DSL查询：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /crm/user/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   		<span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> </span><br><span class="line">	<span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;username&quot;</span><span class="punctuation">,</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span> <span class="string">&quot;id&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;join_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>上面查询 ， <code>match_all</code> 表示 查询所有数据，查询返回fullName，age和email几个列，按照加入日期和年龄进行排序</p><h4 id="1-3-DSL查询案例"><a href="#1-3-DSL查询案例" class="headerlink" title="1.3.DSL查询案例"></a>1.3.DSL查询案例</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /crm/user/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   		<span class="attr">&quot;match&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   			<span class="attr">&quot;username&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;老郑&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>查询username中包含“老郑”的内容，<code>match</code>指的是“标准查询”，该查询方式会对查询的内容进行分词。DSL查询可以支持的查询方式很多，如<code>term</code>词元查询 ，<code>range</code>范围查询等等。</p><h3 id="2-DSL过滤"><a href="#2-DSL过滤" class="headerlink" title="2.DSL过滤"></a>2.DSL过滤</h3><h4 id="2-1-什么是DSL过滤"><a href="#2-1-什么是DSL过滤" class="headerlink" title="2.1.什么是DSL过滤"></a>2.1.什么是DSL过滤</h4><p>DSL过滤语句和DSL查询语句非常相似，但是它们的使用目的却不同：DSL过滤查询文档的方式更像是对于我的条件”有”或者”没有”（等于 ；不等于），而DSL查询语句则像是”有多像”(模糊查询)。</p><h4 id="2-2-查询与过滤的区别"><a href="#2-2-查询与过滤的区别" class="headerlink" title="2.2.查询与过滤的区别"></a>2.2.查询与过滤的区别</h4><p>DSL过滤和DSL查询在性能上的区别：</p><ul><li><p>过滤结果可以缓存并应用到后续请求。-&gt; 精确过滤后的结果拿去模糊查询性能高</p></li><li><p>查询语句同时匹配文档，计算相关性，所以更耗时，且不缓存。</p></li><li><p>过滤语句可有效地配合查询语句完成文档过滤。</p></li></ul><p>总结：需要模糊查询的使用<strong>DSL查询</strong> ，需要精确查询的使用<strong>DSL过滤</strong>，在开发中组合使用(组合查询) ，关键字查询使用DSL查询，其他的都是用DSL过滤。</p><h4 id="2-3-DSL查询-过滤语法"><a href="#2-3-DSL查询-过滤语法" class="headerlink" title="2.3.DSL查询+过滤语法"></a>2.3.DSL查询+过滤语法</h4><p>存储的内容：chen whale 搜索的内容： whale zhang</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">GET /crm/user/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">		<span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> 		<span class="comment">//booleanQuery 组合</span></span><br><span class="line">			<span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span>	<span class="comment">//与(must) 或(should) 非(must not) </span></span><br><span class="line">				<span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">//match : 匹配，吧查询的内容分词后去查询</span></span><br><span class="line">					<span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span>	<span class="comment">//与(must) 或(should) 非(must not) </span></span><br><span class="line">				<span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">//match : 匹配，吧查询的内容分词后去查询</span></span><br><span class="line">					<span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs ls&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs ls&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs ls&quot;</span>  # name = <span class="string">&quot;zs ls&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;name&quot;</span><span class="punctuation">,</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span> <span class="string">&quot;username&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;join_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>gt &gt; gte &gt;&#x3D; lt &lt; lte &lt;&#x3D;</p><p>解释：</p><ul><li><p>query : 查询，所有的查询条件在query里面</p></li><li><p>bool : 组合搜索bool可以组合多个查询条件为一个查询对象，这里包含了 DSL查询和DSL过滤的条件</p></li><li><p>must : 必须匹配 ：与(must) 或(should) 非(must_not)</p></li><li><p>match：分词匹配查询，会对查询条件分词 ， multi_match :多字段匹配</p></li><li><p>filter： 过滤条件</p></li><li><p>term：词元查询，不会对查询条件分词,是做等值查询的</p></li><li><p>from，size :分页</p></li><li><p>_source ：查询结果中需要哪些列</p></li><li><p>sort：排序</p></li></ul><h4 id="2-4-综合案例"><a href="#2-4-综合案例" class="headerlink" title="2.4.综合案例"></a>2.4.综合案例</h4><p>名称(name)中有 “zs” 的用户 ，性别sex是男生(1),年龄（age）在 18- 20之间,按照年龄（age）倒排序，查询第 1 页，每页10 条 ，查询结果中只需要 ：id,name,username,age</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">GET /aigou/product/_search </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			</span><br><span class="line">			<span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>	<span class="comment">//范围查询</span></span><br><span class="line">                        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span><span class="number">20</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>	<span class="comment">//词元查询</span></span><br><span class="line">						<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;id&quot;</span><span class="punctuation">,</span> <span class="string">&quot;name&quot;</span><span class="punctuation">,</span> <span class="string">&quot;age&quot;</span><span class="punctuation">,</span><span class="string">&quot;username&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-查询方式"><a href="#3-查询方式" class="headerlink" title="3.查询方式"></a>3.查询方式</h3><p>在上面的案例中，我们接触了 <code>match</code> ， <code>range</code> 等查询方式(查询对象)，在ES还有很多其他的查询方式，在不同的场景中我们需要根据情况进行合理的选择。</p><h4 id="3-1-全匹配（match-all）"><a href="#3-1-全匹配（match-all）" class="headerlink" title="3.1.全匹配（match_all）"></a>3.1.全匹配（match_all）</h4><p>普通搜索(匹配所有文档)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET _search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zs1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="3-2-标准查询（match和multi-match）"><a href="#3-2-标准查询（match和multi-match）" class="headerlink" title="3.2.标准查询（match和multi_match）"></a>3.2.标准查询（<strong>match</strong>和multi_match）</h4><p>标准查询，可以理解为,分词查询有点像模糊匹配(<strong>like</strong>),会对查询的内容进行分词后，得到多个单词，分别带着多个单词去检索ES库，只要有一个单词能查出结果，整个查询就有结果。不管你需要全文本查询还是精确查询基本上都要用到它。</p><p>如下面的搜索会对Steven King分词，并找到包含Steven或King的文档，然后给出排序分值。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Steven King&quot;</span>		</span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>注意：上面效果如同 <code>where fullName like &quot;%Steven%&quot; or fullName like &quot;%King%&quot;</code></p><p>提示：match一般只用于全文字段的匹配与查询，一般不用于过滤。</p><p><strong>multi_match 查询允许你做 match查询的基础上同时搜索多个字段：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">		<span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">			<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Steven King&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">			<span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;fullName&quot;</span><span class="punctuation">,</span> <span class="string">&quot;title&quot;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>注意：上面的搜索同时在fullName和title字段中匹配。</p><h4 id="3-3-单词搜索与过滤（Term和Terms）"><a href="#3-3-单词搜索与过滤（Term和Terms）" class="headerlink" title="3.3.单词搜索与过滤（Term和Terms）"></a>3.3.单词搜索与过滤（Term和Terms）</h4><p>单词&#x2F;词元查询 ， 可以理解为<strong>等值查询</strong>，字符串，数字等都可以使用它，把查询的内容看成一个整体去检索ES库</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    </span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Steven King&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>提示：上面的“Steven King”会被当成一个去term中匹配，它跟match不同的地方在于match会把“Steven King”分成“steven”和“king”分别取username中查询。</p><p>Terms支持多个字段查询</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;terms&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;jvm&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;hadoop&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;lucene&quot;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;minimum_match&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>提示：minimum_match:至少匹配个数，默认为1</p><h4 id="3-4-组合条件搜索与过滤（Bool）"><a href="#3-4-组合条件搜索与过滤（Bool）" class="headerlink" title="3.4.组合条件搜索与过滤（Bool）"></a>3.4.组合条件搜索与过滤（Bool）</h4><p>组合搜索bool可以组合多个查询条件为一个查询对象，查询条件包括must、should和must_not。</p><p>例如：查询爱好有美女，同时也有喜欢游戏或运动，且出生于1990-06-30及之后的人。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span> <span class="string">&quot;美女&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span> <span class="string">&quot;游戏&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;hobby&quot;</span><span class="punctuation">:</span> <span class="string">&quot;运动&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;birth_date&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1990-06-30&quot;</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                ...</span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>上面案例如同：Hobby&#x3D;美女 and （hobby&#x3D;游戏 or hobby&#x3D;运动) and birth_date &gt;&#x3D; 1990-06-30</p><p>提示： 如果 bool 查询下没有must子句，那至少应该有一个should子句。但是 如果有 must子句，那么没有 should子句也可以进行查询。</p><h4 id="3-5-范围查询与过滤（range）"><a href="#3-5-范围查询与过滤（range）" class="headerlink" title="3.5.范围查询与过滤（range）"></a>3.5.范围查询与过滤（range）</h4><p>range过滤允许我们按照指定范围查找一批数据</p><p>gt 大于 gte 大于等于 lt 小于 lte 小于等于</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> </span><br><span class="line">                <span class="attr">&quot;lt&quot;</span><span class="punctuation">:</span> <span class="number">30</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>上例中查询年龄大于等于20并且小于30。</p><p>gt:&gt; gte:&gt;&#x3D; lt:&lt; lte:&lt;&#x3D;</p><h4 id="3-6-存在和缺失过滤器（exists和missing）"><a href="#3-6-存在和缺失过滤器（exists和missing）" class="headerlink" title="3.6.存在和缺失过滤器（exists和missing）"></a>3.6.存在和缺失过滤器（exists和missing）</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        </span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;exists&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gps&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>提示：exists和missing只能用于过滤结果。</p><h4 id="3-7-前匹配搜索与过滤（prefix）"><a href="#3-7-前匹配搜索与过滤（prefix）" class="headerlink" title="3.7.前匹配搜索与过滤（prefix）"></a>3.7.前匹配搜索与过滤（prefix）</h4><p>和term查询相似，前匹配搜索不是精确匹配，而是类似于SQL中的like ‘key%’</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;王&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>提示：上例即查询姓王的所有人。</p><h4 id="3-8-通配符搜索（wildcard）"><a href="#3-8-通配符搜索（wildcard）" class="headerlink" title="3.8.通配符搜索（wildcard）"></a>3.8.通配符搜索（wildcard）</h4><p>使用*代表0~N个，使用?代表1个。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;wildcard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;姚*鹏&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="六-分词器安装和使用"><a href="#六-分词器安装和使用" class="headerlink" title="六.分词器安装和使用"></a>六.分词器安装和使用</h2><h3 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1.基本概念"></a>1.基本概念</h3><h4 id="1-1-什么是分词"><a href="#1-1-什么是分词" class="headerlink" title="1.1.什么是分词"></a>1.1.什么是分词</h4><p>​	在全文检索理论中，文档的查询是通过关键字查询文档索引来进行匹配，因此将文本拆分为有意义的单词，对于搜索结果的准确性至关重要，因此，在建立索引的过程中和分析搜索语句的过程中都需要对文本进行分词。ES的倒排索引是分词的结果。</p><p>​ 正排索引：通过id查找内容，mysql就是正排索引</p><p>​ 倒排索引：先将原始数据根据分词器进行分词，语义转换，排序，分组等操作生成词元，词元对应文档id，再搜索时先通过词元找到文档id，再通过文档id找到对应的文档. 索引创建&amp;索引搜索</p><h4 id="1-2-理解分词的作用"><a href="#1-2-理解分词的作用" class="headerlink" title="1.2.理解分词的作用"></a>1.2.理解分词的作用</h4><p>分词器的作用至关重要,数据的查询结果是否精准跟分词器有很大的关系</p><p>为了方便理解，我们用一个模拟图跟踪一下ES创建倒排索引的过程,如有原始数据：</p><table><thead><tr><th>ID</th><th>username</th><th>intro</th></tr></thead><tbody><tr><td>1</td><td>zs</td><td>my name is zs</td></tr><tr><td>2</td><td>ls</td><td>my name is ls</td></tr></tbody></table><p>如果对intro进行倒排索引，ES会根据分词器进行分词 , 语义转换，排序， 分组等操作最终倒排索引如下：</p><table><thead><tr><th>词元</th><th>ID倒排</th></tr></thead><tbody><tr><td>is</td><td>1 -&gt; 2</td></tr><tr><td>ls</td><td>2</td></tr><tr><td>my</td><td>1 -&gt; 2</td></tr><tr><td>name</td><td>1 -&gt; 2</td></tr><tr><td>zs</td><td>1</td></tr></tbody></table><p>当ES进行关键字查询的时候，如需要查询<code>“my”</code> ，那么ES可以根据二分查找更快的定位到 <code>my | 1 -&gt; 2</code> ， 根据ID值1 ，2直接取出结果。</p><h3 id="2-IK分词器"><a href="#2-IK分词器" class="headerlink" title="2.IK分词器"></a>2.IK分词器</h3><h4 id="2-1-为什么用IK分词器"><a href="#2-1-为什么用IK分词器" class="headerlink" title="2.1.为什么用IK分词器"></a>2.1.为什么用IK分词器</h4><p>​	ES默认对英文文本的分词器支持较好，但和lucene一样，如果需要对中文进行全文检索，那么需要使用中文分词器，同lucene一样，在使用中文全文检索前，需要集成IK分词器 - 大家都在用IK</p><p>​ 在es以插件方式集成ik分词器</p><p>​ 发请求使用分词器</p><h4 id="2-2-安装IK分词器"><a href="#2-2-安装IK分词器" class="headerlink" title="2.2.安装IK分词器"></a>2.2.安装IK分词器</h4><h5 id="1-下载ES的IK分词器"><a href="#1-下载ES的IK分词器" class="headerlink" title="1.下载ES的IK分词器"></a>1.下载ES的IK分词器</h5><p>插件源码地址：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p><h5 id="2-解压elasticsearch-analysis-ik-5-2-2-zip文件"><a href="#2-解压elasticsearch-analysis-ik-5-2-2-zip文件" class="headerlink" title="2.解压elasticsearch-analysis-ik-5.2.2.zip文件"></a>2.解压elasticsearch-analysis-ik-5.2.2.zip文件</h5><p>并将解压后的内容放置于ES根目录&#x2F;plugins&#x2F;ik</p><p><img src="/breeze/2c94f9f4/1634880300486.png" alt="1634880300486"></p><h5 id="3-IK分词器配置"><a href="#3-IK分词器配置" class="headerlink" title="3.IK分词器配置"></a>3.IK分词器配置</h5><p>在ik&#x2F;config 目录可以对分词器进行配置，如停词 ， 自定义字典等。</p><h5 id="4-IK分词测试"><a href="#4-IK分词测试" class="headerlink" title="4.IK分词测试"></a>4.IK分词测试</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;中国驻洛杉矶领事馆遭亚裔男子枪击 嫌犯已自首&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>提示：IK分词器指定：ik_smart ； ik_max_word ， ik_max_word 相比 ik_smart 来说会将文本做最细粒度的拆</p><p>分。</p><p>ik_smart XX教育</p><p>ik_max_word XX教育 XX 教育</p><h2 id="七-文档类型映射"><a href="#七-文档类型映射" class="headerlink" title="七.文档类型映射"></a>七.文档类型映射</h2><h3 id="1什么是文档映射"><a href="#1什么是文档映射" class="headerlink" title="1什么是文档映射"></a>1什么是文档映射</h3><p>ES的文档映射(mapping)机制用于进行字段类型确认，将每个字段匹配为一种确定的数据类型。就如果Mysql创建表时候指定的每个column列的类型。 为了方便字段的检索，我们会指定存储在ES中的字段是否进行分词，但是有些字段类型可以分词，有些字段类型不可以分词，所以对于字段的类型需要我们自己去指定。</p><p>需要注意的是，我们在Mysql建表过程是：</p><p>Mysql创建数据库 -&gt; 创建表(指定字段类型) -&gt; crud数据 而在ES中也是一样，</p><p>ES创建索引库 -&gt; 文档类型映射 -&gt; crud文档</p><h3 id="2-默认映射"><a href="#2-默认映射" class="headerlink" title="2 默认映射"></a>2 默认映射</h3><p>没有进行自定义类型映射的时候，直接添加数据。就会安装默认规则进行映射，这种映射叫做默认映射</p><p>查看索引类型的映射配置：GET {indexName}&#x2F;_mapping&#x2F;{typeName}</p><p><img src="/breeze/2c94f9f4/1661851641207.png" alt="1661851641207"></p><p>ES在没有配置Mapping的情况下新增文档，ES会尝试对字段类型进行猜测，并动态生成字段和类型的映射关系。</p><table><thead><tr><th>内容</th><th>默认映射类型</th></tr></thead><tbody><tr><td>JSON type</td><td>Field type</td></tr><tr><td>Boolean: true or false</td><td>“boolean”</td></tr><tr><td>Whole number: 123</td><td>“long”</td></tr><tr><td>Floating point: 123.45</td><td>“double”</td></tr><tr><td>String, valid date:”2014-09-15”</td><td>“date”</td></tr><tr><td>String: “foo bar”</td><td>“string”</td></tr></tbody></table><h3 id="3-自定义映射"><a href="#3-自定义映射" class="headerlink" title="3 自定义映射"></a>3 自定义映射</h3><h4 id="3-1-es支持哪些字段类型"><a href="#3-1-es支持哪些字段类型" class="headerlink" title="3.1 es支持哪些字段类型"></a>3.1 es支持哪些字段类型</h4><ul><li>基本字段类型</li></ul><table><thead><tr><th>字符串</th><th align="left">text(分词lucene TextField)</th><th>keyword(不分词lucene StringField)</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>数字</td><td align="left">long</td><td>integer</td><td>short</td><td>double</td><td>float</td></tr><tr><td>日期</td><td align="left">date</td><td></td><td></td><td></td><td></td></tr><tr><td>逻辑</td><td align="left">boolean</td><td></td><td></td><td></td><td></td></tr></tbody></table><ul><li>复杂字段类型</li></ul><table><thead><tr><th>对象类型</th><th>object</th></tr></thead><tbody><tr><td>数组类型</td><td>array</td></tr><tr><td>地理位置</td><td>geo_point,geo_shape</td></tr></tbody></table><h4 id="3-2-详细映射写法"><a href="#3-2-详细映射写法" class="headerlink" title="3.2 详细映射写法"></a>3.2 详细映射写法</h4><p>字段映射的常用属性配置列表 - 即给某个字段执行类的时候可以指定以下属性</p><table><thead><tr><th>type</th><th>类型：基本数据类型，integer,long,date,boolean,keyword,text…</th></tr></thead><tbody><tr><td>enable</td><td>是否启用：默认为true。 false：不能索引、不能搜索过滤，仅在_source中存储</td></tr><tr><td><strong>boost</strong></td><td>权重提升倍数：用于查询时加权计算最终的得分。</td></tr><tr><td>format</td><td>格式：一般用于指定日期格式，如 yyyy-MM-dd HH:mm:ss.SSS</td></tr><tr><td><strong>ignore_above</strong></td><td>长度限制：长度大于该值的字符串将不会被索引和存储。</td></tr><tr><td>ignore_malformed</td><td>转换错误忽略：true代表当格式转换错误时，忽略该值，被忽略后不会被存储和索引。</td></tr><tr><td>include_in_all</td><td>是否将该字段值组合到_all中。</td></tr><tr><td>null_value</td><td>默认控制替换值。如空字符串替换为”NULL”，空数字替换为-1</td></tr><tr><td>store</td><td>是否存储：默认为false。true意义不大，因为**_source**中已有数据</td></tr><tr><td><strong>index</strong></td><td>索引模式：analyzed (索引并分词，text默认模式), not_analyzed (索引不分词，keyword默认模式)，no（不索引）</td></tr><tr><td><strong>analyzer</strong></td><td>索引分词器：索引创建时使用的分词器，如ik_smart,ik_max_word,standard</td></tr><tr><td><strong>search_analyzer</strong></td><td>搜索分词器：搜索该字段的值时，传入的查询内容的分词器。</td></tr><tr><td>&#x3D;&#x3D;fields&#x3D;&#x3D;</td><td>多字段索引：当对该字段需要使用多种索引模式时使用。如：城市搜索<br><br>New York”city”:”city”:{</td></tr></tbody></table><pre><code>&quot;type&quot;: &quot;text&quot;,   
&quot;analyzer&quot;: &quot;ik_smart&quot;,   
&quot;fields&quot;: &#123;      
    &quot;raw&quot;: &#123;         
        &quot;type&quot;:  &quot;keyword&quot;       
    &#125;   
&#125;
</code></pre><p>}<br></p><p>city -&gt; 来做分词查询 city.raw -&gt; 不做分词</p><p>解释：相当于给 city取了一个别名 city.raw，city的类型为text , city.raw的类型keyword<br>搜索 city分词 ; 搜索city.raw 不分词那么以后搜索过滤和排序就可以使用city.raw字段名 |</p><h4 id="3-3-自定义映射简单实现"><a href="#3-3-自定义映射简单实现" class="headerlink" title="3.3.自定义映射简单实现"></a>3.3.自定义映射简单实现</h4><p>注意：<strong>如果索引库已经有数据了，就不能再添加映射了</strong></p><h5 id="2-1-创建新的索引库"><a href="#2-1-创建新的索引库" class="headerlink" title="2.1.创建新的索引库"></a>2.1.创建新的索引库</h5><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">put</span> yaoasang</span><br></pre></td></tr></table></figure><h5 id="2-2-单类型创建映射"><a href="#2-2-单类型创建映射" class="headerlink" title="2.2.单类型创建映射"></a>2.2.单类型创建映射</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">put yaoasang/goods/_mapping</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;goods&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_smart&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>解释：给aigou索引库中的是goods类型创建映射 ，id指定为long类型 ， name指定为text类型(要分词)，analyzer分词使用ik，查询分词器也使用ik</p><h4 id="3-4-自定义映射细节"><a href="#3-4-自定义映射细节" class="headerlink" title="3.4. 自定义映射细节"></a>3.4. 自定义映射细节</h4><h5 id="1-对象映射"><a href="#1-对象映射" class="headerlink" title="1.对象映射"></a>1.对象映射</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;girl&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;王小花&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;age&quot;</span>  <span class="punctuation">:</span> <span class="number">22</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>文档映射</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">       <span class="attr">&quot;girl&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">           		<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">           		<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">           <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="2-基本类型数组映射"><a href="#2-基本类型数组映射" class="headerlink" title="2.基本类型数组映射"></a>2.基本类型数组映射</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;hobbys&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;王小花&quot;</span><span class="punctuation">,</span><span class="string">&quot;林志玲&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>文档映射</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">		<span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;hobbys&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>解释：数组的映射只需要映射一个元素即可，因为数组中的元素类型是一样的。</p><h5 id="3-对象数组"><a href="#3-对象数组" class="headerlink" title="3.对象数组"></a>3.对象数组</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;girl&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;林志玲&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">32</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;赵丽颖&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">22</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>文档映射</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;girl&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;long&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="2-5-全局映射-了解"><a href="#2-5-全局映射-了解" class="headerlink" title="2.5.全局映射(了解)"></a>2.5.全局映射(了解)</h4><p>索引库中多个类型(表)的字段是有相同的映射，如所有的ID都可以指定为integer类型，基于这种思想，我们可以做全局映射，让所有的文档都使用全局文档映射。全局映射可以通过动态模板和默认设置两种方式实现。</p><ul><li>默认方式：<em>default</em></li></ul><p>索引下所有的类型映射配置会继承_default_的配置，如：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="punctuation">&#123;</span>indexName<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_default_&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">       <span class="attr">&quot;_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        	<span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;dept&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">     <span class="attr">&quot;_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      	<span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>关闭默认的 _all ，dept自定义开启 <em>all</em></p><ul><li>动态模板</li></ul><p>在实际应用场景中，一个对象的属性中，需要全文检索的字段较少，大部分字符串不需要分词，因此，需要利用全局模板覆盖自带的默认模板</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">PUT _template/global_template  <span class="comment">//创建名为global_template的模板</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;*&quot;</span><span class="punctuation">,</span>  <span class="comment">//匹配所有索引库</span></span><br><span class="line">  <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="number">1</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">//匹配到的索引库只创建1个主分片</span></span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_default_&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span> <span class="comment">//关闭所有类型的_all字段</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dynamic_templates&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;string_as_text&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">            <span class="attr">&quot;match_mapping_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span><span class="comment">//匹配类型string    username=&quot;xxx xxx&quot;</span></span><br><span class="line">            <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span>   <span class="string">&quot;*_text&quot;</span><span class="punctuation">,</span> <span class="comment">//匹配字段名字以_text结尾</span></span><br><span class="line">            <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span><span class="comment">//将类型为string的字段映射为text类型</span></span><br><span class="line">              <span class="attr">&quot;analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;search_analyzer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ik_max_word&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;raw&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span>  <span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="attr">&quot;ignore_above&quot;</span><span class="punctuation">:</span> <span class="number">256</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;string_as_keyword&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">            <span class="attr">&quot;match_mapping_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span><span class="punctuation">,</span><span class="comment">//匹配类型string</span></span><br><span class="line">            <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;keyword&quot;</span><span class="comment">//将类型为string的字段映射为keyword类型</span></span><br><span class="line">             <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>PS : 映射方式优先级 (低 -&gt; 高)：默认 -&gt; 全局 -&gt; 自定义</p><h4 id="2-6-最佳实践"><a href="#2-6-最佳实践" class="headerlink" title="2.6.最佳实践"></a>2.6.最佳实践</h4><p>在实际项目中，我们按照如下流程操作ES</p><h5 id="1-建索引库"><a href="#1-建索引库" class="headerlink" title="1.建索引库"></a>1.建索引库</h5><h5 id="2-全局映射-可选"><a href="#2-全局映射-可选" class="headerlink" title="2.全局映射-可选"></a>2.全局映射-可选</h5><h5 id="3-自定义映射-1"><a href="#3-自定义映射-1" class="headerlink" title="3.自定义映射"></a>3.自定义映射</h5><h5 id="4-Java-API做CRUD"><a href="#4-Java-API做CRUD" class="headerlink" title="4.Java-API做CRUD"></a>4.Java-API做CRUD</h5><h2 id="八-JavaApi操作ES"><a href="#八-JavaApi操作ES" class="headerlink" title="八.JavaApi操作ES"></a>八.JavaApi操作ES</h2><h3 id="1-集成ES"><a href="#1-集成ES" class="headerlink" title="1.集成ES"></a>1.集成ES</h3><p>官方文档API：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/index.html">https://www.elastic.co/guide/en/elasticsearch/client/java-api/index.html</a></p><h4 id="1-1-导入依赖"><a href="#1-1-导入依赖" class="headerlink" title="1.1.导入依赖"></a>1.1.导入依赖</h4><p>下面采用ES提供的Jar进行ES操作</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-2-连接ElasticSearch"><a href="#1-2-连接ElasticSearch" class="headerlink" title="1.2.连接ElasticSearch"></a>1.2.连接ElasticSearch</h4><p>编写工具</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESClientUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TransportClient <span class="title function_">getClient</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Settings</span> <span class="variable">settings</span> <span class="operator">=</span> Settings.builder()</span><br><span class="line">                .put(<span class="string">&quot;cluster.name&quot;</span>, <span class="string">&quot;elasticsearch&quot;</span>).build();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = <span class="keyword">new</span> <span class="title class_">PreBuiltTransportClient</span>(settings)</span><br><span class="line">                    .addTransportAddress(<span class="keyword">new</span> <span class="title class_">TransportAddress</span>(InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>), <span class="number">9300</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-文档CRUD"><a href="#2-文档CRUD" class="headerlink" title="2.文档CRUD"></a>2.文档CRUD</h3><h4 id="2-1-添加文档"><a href="#2-1-添加文档" class="headerlink" title="2.1.添加文档"></a>2.1.添加文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="comment">//获取客户端对象</span></span><br><span class="line">  <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClientUtil.getClient();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建索引</span></span><br><span class="line">  <span class="type">IndexRequestBuilder</span> <span class="variable">indexRequestBuilder</span> <span class="operator">=</span> client.prepareIndex(<span class="string">&quot;shopping&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">  Map&lt;String,Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  data.put(<span class="string">&quot;id&quot;</span>,<span class="number">1</span>);</span><br><span class="line">  data.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">  data.put(<span class="string">&quot;age&quot;</span>,<span class="number">11</span>);</span><br><span class="line">  <span class="comment">//获取结果</span></span><br><span class="line">  <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> indexRequestBuilder.setSource(data).get();</span><br><span class="line"></span><br><span class="line">  System.out.println(indexResponse);</span><br><span class="line">  client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-获取文档"><a href="#2-2-获取文档" class="headerlink" title="2.2.获取文档"></a>2.2.获取文档</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetResponse response = client.prepareGet(<span class="string">&quot;crm&quot;</span>, <span class="string">&quot;vip&quot;</span>, <span class="string">&quot;1&quot;</span>).<span class="built_in">get</span>();</span><br></pre></td></tr></table></figure><h4 id="2-3-更新文档"><a href="#2-3-更新文档" class="headerlink" title="2.3.更新文档"></a>2.3.更新文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取客户端对象</span></span><br><span class="line">        <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClientUtil.getClient();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改索引</span></span><br><span class="line">        <span class="type">UpdateRequestBuilder</span> <span class="variable">updateRequestBuilder</span> <span class="operator">=</span> client.prepareUpdate(<span class="string">&quot;shopping&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        Map&lt;String,Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        data.put(<span class="string">&quot;id&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        data.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">        data.put(<span class="string">&quot;age&quot;</span>,<span class="number">11</span>);</span><br><span class="line">        <span class="comment">//获取结果设置修改内容</span></span><br><span class="line">        <span class="type">UpdateResponse</span> <span class="variable">updateResponse</span> <span class="operator">=</span> updateRequestBuilder.setDoc(data).get();</span><br><span class="line"></span><br><span class="line">        System.out.println(updateResponse);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="2-4-删除文档-1"><a href="#2-4-删除文档-1" class="headerlink" title="2.4.删除文档"></a>2.4.删除文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//获取客户端对象</span></span><br><span class="line">       <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClientUtil.getClient();</span><br><span class="line"></span><br><span class="line">       <span class="type">DeleteRequestBuilder</span> <span class="variable">deleteRequestBuilder</span> <span class="operator">=</span> client.prepareDelete(<span class="string">&quot;shopping&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">       <span class="type">DeleteResponse</span> <span class="variable">deleteResponse</span> <span class="operator">=</span> deleteRequestBuilder.get();</span><br><span class="line"></span><br><span class="line">       System.out.println(deleteResponse);</span><br><span class="line">       client.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="2-5-批量操作"><a href="#2-5-批量操作" class="headerlink" title="2.5.批量操作"></a>2.5.批量操作</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBuilkAdd</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//获取客户端对象</span></span><br><span class="line">       <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClientUtil.getClient();</span><br><span class="line"></span><br><span class="line">       <span class="type">BulkRequestBuilder</span> <span class="variable">bulkRequestBuilder</span> <span class="operator">=</span> client.prepareBulk();</span><br><span class="line"></span><br><span class="line">       Map&lt;String,Object&gt; data1 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       data1.put(<span class="string">&quot;id&quot;</span>,<span class="number">11</span>);</span><br><span class="line">       data1.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">       data1.put(<span class="string">&quot;age&quot;</span>,<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">       bulkRequestBuilder.add(client.prepareIndex(<span class="string">&quot;shopping&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;11&quot;</span>).setSource(data1));</span><br><span class="line"></span><br><span class="line">       Map&lt;String,Object&gt; data2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">       data2.put(<span class="string">&quot;id&quot;</span>,<span class="number">22</span>);</span><br><span class="line">       data2.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;zs&quot;</span>);</span><br><span class="line">       data2.put(<span class="string">&quot;age&quot;</span>,<span class="number">11</span>);</span><br><span class="line"></span><br><span class="line">       bulkRequestBuilder.add(client.prepareIndex(<span class="string">&quot;shopping&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;11&quot;</span>).setSource(data2));</span><br><span class="line"></span><br><span class="line">       <span class="type">BulkResponse</span> <span class="variable">bulkItemResponses</span> <span class="operator">=</span> bulkRequestBuilder.get();</span><br><span class="line">       Iterator&lt;BulkItemResponse&gt; iterator = bulkItemResponses.iterator();</span><br><span class="line">       <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">           <span class="type">BulkItemResponse</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">           System.out.println(next.getResponse());</span><br><span class="line">       &#125;</span><br><span class="line">       client.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="2-6-查询"><a href="#2-6-查询" class="headerlink" title="2.6.查询"></a>2.6.查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSearch</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取客户端对象</span></span><br><span class="line">        <span class="type">TransportClient</span> <span class="variable">client</span> <span class="operator">=</span> ESClientUtil.getClient();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">SearchRequestBuilder</span> <span class="variable">searchRequestBuilder</span> <span class="operator">=</span> client.prepareSearch(<span class="string">&quot;shopping&quot;</span>);</span><br><span class="line">        searchRequestBuilder.setTypes(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        searchRequestBuilder.setFrom(<span class="number">0</span>);</span><br><span class="line">        searchRequestBuilder.setSize(<span class="number">10</span>);</span><br><span class="line">        searchRequestBuilder.addSort(<span class="string">&quot;age&quot;</span>, SortOrder.ASC);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询条件</span></span><br><span class="line">        <span class="type">BoolQueryBuilder</span> <span class="variable">boolQueryBuilder</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">        List&lt;QueryBuilder&gt; must = boolQueryBuilder.must();</span><br><span class="line">        must.add(QueryBuilders.matchQuery(<span class="string">&quot;username&quot;</span> , <span class="string">&quot;zs&quot;</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;QueryBuilder&gt; filter = boolQueryBuilder.filter();</span><br><span class="line">        filter.add(QueryBuilders.rangeQuery(<span class="string">&quot;age&quot;</span>).lte(<span class="number">20</span>).gte(<span class="number">10</span>));</span><br><span class="line">        filter.add(QueryBuilders.termQuery(<span class="string">&quot;id&quot;</span>,<span class="number">11</span>));</span><br><span class="line"></span><br><span class="line">        searchRequestBuilder.setQuery(boolQueryBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="type">SearchResponse</span> <span class="variable">searchResponse</span> <span class="operator">=</span> searchRequestBuilder.get();</span><br><span class="line"></span><br><span class="line">        <span class="type">SearchHits</span> <span class="variable">hits</span> <span class="operator">=</span> searchResponse.getHits();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;条数：&quot;</span>+hits.getTotalHits());</span><br><span class="line">        <span class="keyword">for</span> (SearchHit hit : hits.getHits()) &#123;</span><br><span class="line">            System.out.println(hit.getSourceAsMap());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="九-总结"><a href="#九-总结" class="headerlink" title="九.总结"></a>九.总结</h2><h3 id="1-重点内容"><a href="#1-重点内容" class="headerlink" title="1.重点内容"></a>1.重点内容</h3><ul><li>文档的CRUD</li><li>DSL查询过滤</li><li>文档映射</li><li>Java操作ES</li></ul><h3 id="2-面试必备"><a href="#2-面试必备" class="headerlink" title="2.面试必备"></a>2.面试必备</h3><ul><li>数据库，表，列 在ES分别怎么对应的？</li><li>ES用到了什么数据结构</li><li>ES为什么比like快</li><li>ES的优势是什么</li><li>ES怎么做查询分页排序</li><li>Keyword和text的区别</li><li>索引创建原理</li><li>Lucene和ES区别</li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mliutm.github.io">清风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mliutm.github.io/breeze/2c94f9f4.html">https://mliutm.github.io/breeze/2c94f9f4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mliutm.github.io" target="_blank">清风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="/img/photo-1692708632140-ee01624d558d.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/breeze/6fb0f153.html" title="java面试题全覆盖-RH"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">java面试题全覆盖-RH</div></div></a></div><div class="next-post pull-right"><a href="/breeze/ef8195d4.html" title="RabbitMQ一文通关"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RabbitMQ一文通关</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/breeze/ddc45bf.html" title="RabbitMQ部署指南"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">RabbitMQ部署指南</div></div></a></div><div><a href="/breeze/ef8195d4.html" title="RabbitMQ一文通关"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-06</div><div class="title">RabbitMQ一文通关</div></div></a></div><div><a href="/breeze/523a62b6.html" title="RocketMQ一文通关"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-06</div><div class="title">RocketMQ一文通关</div></div></a></div><div><a href="/breeze/6d5c94a5.html" title="SpringCloud-RabbitMQ-SpringAMQP（三）"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SpringCloud-RabbitMQ-SpringAMQP（三）</div></div></a></div><div><a href="/breeze/3204d47c.html" title="SpringCloud-RabbitMQ部署指南"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SpringCloud-RabbitMQ部署指南</div></div></a></div><div><a href="/breeze/84124361.html" title="SpringCloud-RabbitMQ高级篇（九）"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SpringCloud-RabbitMQ高级篇（九）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">清风</div><div class="author-info__description">清风洒六合，邈然不可攀</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">142</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:huangpan0805@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-text">ElasticSearch全文搜索引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AE%B9"><span class="toc-text">内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2Lucene%E5%85%A5%E9%97%A8"><span class="toc-text">一.全文搜索Lucene入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E6%A6%82%E8%BF%B0"><span class="toc-text">1.全文搜索概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-text">1.1.什么是全文检索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2"><span class="toc-text">1.2.为什么要使用全文搜索</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%B8%B8%E8%A7%81%E7%9A%84%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2"><span class="toc-text">1.3.常见的全文搜索</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Lucene%E6%A6%82%E8%BF%B0"><span class="toc-text">2.Lucene概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%BB%80%E4%B9%88%E6%98%AFLucene"><span class="toc-text">2.1.什么是Lucene</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Lucene%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-text">2.2.Lucene索引原理（重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-text">1.索引的创建</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%B4%A2%E5%BC%95%E7%9A%84%E6%90%9C%E7%B4%A2"><span class="toc-text">2.索引的搜索</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Lucene%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">2.3.Lucene入门程序</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1.导入依赖</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">2.创建索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%90%9C%E7%B4%A2%E7%B4%A2%E5%BC%95"><span class="toc-text">2.搜索索引</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-ElasticSearch%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">二.ElasticSearch相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ElasticSearch%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.ElasticSearch介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8ElasticSearch"><span class="toc-text">1.1. 为什么要使用ElasticSearch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BB%80%E4%B9%88%E6%98%AFElasticSearch"><span class="toc-text">1.2.什么是ElasticSearch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-ES%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">1.3.ES的特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-ES%E5%92%8Clucene%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">1.4.ES和lucene的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ES%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">2.ES的使用案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B6%E4%BB%96%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-text">3.其他全文搜索引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-Solr%EF%BC%88%E9%87%8D%E9%87%8F%E7%BA%A7%E5%AF%B9%E6%89%8B%EF%BC%89"><span class="toc-text">2.1.Solr（重量级对手）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-Katta"><span class="toc-text">2.2.Katta</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-HadoopContrib"><span class="toc-text">3.3.HadoopContrib</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-ES%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-text">三.ES下载和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ElasticSearch%E5%AE%89%E8%A3%85"><span class="toc-text">1.ElasticSearch安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%B8%8B%E8%BD%BDElasticSearch"><span class="toc-text">1.1.下载ElasticSearch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85%E4%B8%8E%E5%90%AF%E5%8A%A8"><span class="toc-text">1.2.安装与启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-ElasticSearch%E6%B5%8B%E8%AF%95"><span class="toc-text">1.3.ElasticSearch测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-ES%E5%86%85%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="toc-text">1.4.ES内存配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Kibana5%E5%AE%89%E8%A3%85"><span class="toc-text">2.Kibana5安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%B8%8B%E8%BD%BDKibana5"><span class="toc-text">2.1.下载Kibana5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85%E4%B8%8E%E5%90%AF%E5%8A%A8"><span class="toc-text">2.2.安装与启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Kinbana%E8%BF%9E%E6%8E%A5ES%E9%85%8D%E7%BD%AE"><span class="toc-text">2.3.Kinbana连接ES配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%B5%8B%E8%AF%95Kibana"><span class="toc-text">2.4.测试Kibana</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-ElasticSearch%E5%9F%BA%E7%A1%80"><span class="toc-text">四.ElasticSearch基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">1.几个基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-Near-Realtime%EF%BC%88NRT%EF%BC%89"><span class="toc-text">1.1.Near Realtime（NRT）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-Index%EF%BC%9A%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">1.2.Index：索引库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-Type%EF%BC%9A%E7%B1%BB%E5%9E%8B"><span class="toc-text">1.3.Type：类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-Document-field"><span class="toc-text">1.4.Document&amp;field</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%B4%A2%E5%BC%95%E5%BA%93CRUD"><span class="toc-text">2.索引库CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1%E5%A2%9E%E5%8A%A0%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">2.1增加索引库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">2.2.查询索引库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">2.3.删除索引库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E4%BF%AE%E6%94%B9%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">2.4.修改索引库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%96%87%E6%A1%A3%E7%9A%84CRUD"><span class="toc-text">3.文档的CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3"><span class="toc-text">3.1.添加文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3"><span class="toc-text">3.2.获取文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-text">3.3.修改文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-text">2.4.删除文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%96%87%E6%A1%A3%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.文档简单查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.1.基本查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.2.分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.3.字符串查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.4.批量查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-DSL%E6%9F%A5%E8%AF%A2%E4%B8%8EDSL%E8%BF%87%E6%BB%A4"><span class="toc-text">五.DSL查询与DSL过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-DSL%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.DSL查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFDSL%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1.什么是DSL查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-DSL%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="toc-text">1.2.DSL查询语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-DSL%E6%9F%A5%E8%AF%A2%E6%A1%88%E4%BE%8B"><span class="toc-text">1.3.DSL查询案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-DSL%E8%BF%87%E6%BB%A4"><span class="toc-text">2.DSL过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%BB%80%E4%B9%88%E6%98%AFDSL%E8%BF%87%E6%BB%A4"><span class="toc-text">2.1.什么是DSL过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%9F%A5%E8%AF%A2%E4%B8%8E%E8%BF%87%E6%BB%A4%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">2.2.查询与过滤的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-DSL%E6%9F%A5%E8%AF%A2-%E8%BF%87%E6%BB%A4%E8%AF%AD%E6%B3%95"><span class="toc-text">2.3.DSL查询+过滤语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-text">2.4.综合案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F"><span class="toc-text">3.查询方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%85%A8%E5%8C%B9%E9%85%8D%EF%BC%88match-all%EF%BC%89"><span class="toc-text">3.1.全匹配（match_all）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%A0%87%E5%87%86%E6%9F%A5%E8%AF%A2%EF%BC%88match%E5%92%8Cmulti-match%EF%BC%89"><span class="toc-text">3.2.标准查询（match和multi_match）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%8D%95%E8%AF%8D%E6%90%9C%E7%B4%A2%E4%B8%8E%E8%BF%87%E6%BB%A4%EF%BC%88Term%E5%92%8CTerms%EF%BC%89"><span class="toc-text">3.3.单词搜索与过滤（Term和Terms）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E7%BB%84%E5%90%88%E6%9D%A1%E4%BB%B6%E6%90%9C%E7%B4%A2%E4%B8%8E%E8%BF%87%E6%BB%A4%EF%BC%88Bool%EF%BC%89"><span class="toc-text">3.4.组合条件搜索与过滤（Bool）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2%E4%B8%8E%E8%BF%87%E6%BB%A4%EF%BC%88range%EF%BC%89"><span class="toc-text">3.5.范围查询与过滤（range）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-%E5%AD%98%E5%9C%A8%E5%92%8C%E7%BC%BA%E5%A4%B1%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%88exists%E5%92%8Cmissing%EF%BC%89"><span class="toc-text">3.6.存在和缺失过滤器（exists和missing）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-%E5%89%8D%E5%8C%B9%E9%85%8D%E6%90%9C%E7%B4%A2%E4%B8%8E%E8%BF%87%E6%BB%A4%EF%BC%88prefix%EF%BC%89"><span class="toc-text">3.7.前匹配搜索与过滤（prefix）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%90%9C%E7%B4%A2%EF%BC%88wildcard%EF%BC%89"><span class="toc-text">3.8.通配符搜索（wildcard）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E5%88%86%E8%AF%8D%E5%99%A8%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-text">六.分词器安装和使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-text">1.基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E8%AF%8D"><span class="toc-text">1.1.什么是分词</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%90%86%E8%A7%A3%E5%88%86%E8%AF%8D%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">1.2.理解分词的作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">2.IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">2.1.为什么用IK分词器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">2.2.安装IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%B8%8B%E8%BD%BDES%E7%9A%84IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-text">1.下载ES的IK分词器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%A7%A3%E5%8E%8Belasticsearch-analysis-ik-5-2-2-zip%E6%96%87%E4%BB%B6"><span class="toc-text">2.解压elasticsearch-analysis-ik-5.2.2.zip文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-IK%E5%88%86%E8%AF%8D%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">3.IK分词器配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-IK%E5%88%86%E8%AF%8D%E6%B5%8B%E8%AF%95"><span class="toc-text">4.IK分词测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83-%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E6%98%A0%E5%B0%84"><span class="toc-text">七.文档类型映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E6%A1%A3%E6%98%A0%E5%B0%84"><span class="toc-text">1什么是文档映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%BB%98%E8%AE%A4%E6%98%A0%E5%B0%84"><span class="toc-text">2 默认映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84"><span class="toc-text">3 自定义映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-es%E6%94%AF%E6%8C%81%E5%93%AA%E4%BA%9B%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-text">3.1 es支持哪些字段类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%AF%A6%E7%BB%86%E6%98%A0%E5%B0%84%E5%86%99%E6%B3%95"><span class="toc-text">3.2 详细映射写法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.3.自定义映射简单实现</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">2.1.创建新的索引库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%8D%95%E7%B1%BB%E5%9E%8B%E5%88%9B%E5%BB%BA%E6%98%A0%E5%B0%84"><span class="toc-text">2.2.单类型创建映射</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84%E7%BB%86%E8%8A%82"><span class="toc-text">3.4. 自定义映射细节</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84"><span class="toc-text">1.对象映射</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%95%B0%E7%BB%84%E6%98%A0%E5%B0%84"><span class="toc-text">2.基本类型数组映射</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84"><span class="toc-text">3.对象数组</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E5%85%A8%E5%B1%80%E6%98%A0%E5%B0%84-%E4%BA%86%E8%A7%A3"><span class="toc-text">2.5.全局映射(了解)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">2.6.最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%BA%93"><span class="toc-text">1.建索引库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%85%A8%E5%B1%80%E6%98%A0%E5%B0%84-%E5%8F%AF%E9%80%89"><span class="toc-text">2.全局映射-可选</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84-1"><span class="toc-text">3.自定义映射</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-Java-API%E5%81%9ACRUD"><span class="toc-text">4.Java-API做CRUD</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB-JavaApi%E6%93%8D%E4%BD%9CES"><span class="toc-text">八.JavaApi操作ES</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%9B%86%E6%88%90ES"><span class="toc-text">1.集成ES</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1.1.导入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%BF%9E%E6%8E%A5ElasticSearch"><span class="toc-text">1.2.连接ElasticSearch</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%87%E6%A1%A3CRUD"><span class="toc-text">2.文档CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3"><span class="toc-text">2.1.添加文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3"><span class="toc-text">2.2.获取文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-text">2.3.更新文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-1"><span class="toc-text">2.4.删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-text">2.5.批量操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.6.查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D-%E6%80%BB%E7%BB%93"><span class="toc-text">九.总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%87%8D%E7%82%B9%E5%86%85%E5%AE%B9"><span class="toc-text">1.重点内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9D%A2%E8%AF%95%E5%BF%85%E5%A4%87"><span class="toc-text">2.面试必备</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/breeze/a9f7ca04.html" title="Vue2-3-基础（二）"><img src="/img/photo-1692708632140-ee01624d558d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Vue2-3-基础（二）"></a><div class="content"><a class="title" href="/breeze/a9f7ca04.html" title="Vue2-3-基础（二）">Vue2-3-基础（二）</a><time datetime="2024-02-03T13:15:02.000Z" title="发表于 2024-02-03 21:15:02">2024-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/736eb1c8.html" title="分布式任务调度--xxl-job"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="分布式任务调度--xxl-job"></a><div class="content"><a class="title" href="/breeze/736eb1c8.html" title="分布式任务调度--xxl-job">分布式任务调度--xxl-job</a><time datetime="2024-01-16T12:29:19.000Z" title="发表于 2024-01-16 20:29:19">2024-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/6f71bf87.html" title="SpringCloud-oauth2"><img src="/img/photo-1692708632140-ee01624d558d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="SpringCloud-oauth2"></a><div class="content"><a class="title" href="/breeze/6f71bf87.html" title="SpringCloud-oauth2">SpringCloud-oauth2</a><time datetime="2024-01-16T01:50:00.000Z" title="发表于 2024-01-16 09:50:00">2024-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7a1a4477.html" title="认证授权-SpringSecurity"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="认证授权-SpringSecurity"></a><div class="content"><a class="title" href="/breeze/7a1a4477.html" title="认证授权-SpringSecurity">认证授权-SpringSecurity</a><time datetime="2024-01-16T01:41:55.000Z" title="发表于 2024-01-16 09:41:55">2024-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7913ff38.html" title="ElasticSearch集群"><img src="/img/photo-1653549892896-dde02867edee.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="ElasticSearch集群"></a><div class="content"><a class="title" href="/breeze/7913ff38.html" title="ElasticSearch集群">ElasticSearch集群</a><time datetime="2024-01-14T14:34:16.000Z" title="发表于 2024-01-14 22:34:16">2024-01-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/photo-1692708632140-ee01624d558d.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 <i id="heartbeat" class="fa fas fa-heartbeat"></i> 清风</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/timing.js"></script><script id="canvas_nest" defer color="255,0,255" opacity="0.7" zindex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="天枢,天璇,天玑,天权,玉衡,开阳,瑶光" data-fontsize="15px" data-random="true" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>