<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>蓉车宝-店铺入驻-自定义异常-fastdfs（四） | 清风</title><meta name="author" content="清风"><meta name="copyright" content="清风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs一 内容 异常处理 fastdfs文件系统 项目图片统一处理概述  二 异常处理1.自定义异常 ​		系统中的异常可以分为我们能预知的异常和未知的系统异常，对于我们能预知的异常如空值判断，用户名错误，密码错误等异常我们需要返回客户端，对于系统内部异常如SQL语法错误，参数格式转换错误等需要统一包装成友好的提示后再返回客户端，否则用户也看不懂系"><meta property="og:type" content="article"><meta property="og:title" content="蓉车宝-店铺入驻-自定义异常-fastdfs（四）"><meta property="og:url" content="https://mliutm.github.io/breeze/78423a8.html"><meta property="og:site_name" content="清风"><meta property="og:description" content="蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs一 内容 异常处理 fastdfs文件系统 项目图片统一处理概述  二 异常处理1.自定义异常 ​		系统中的异常可以分为我们能预知的异常和未知的系统异常，对于我们能预知的异常如空值判断，用户名错误，密码错误等异常我们需要返回客户端，对于系统内部异常如SQL语法错误，参数格式转换错误等需要统一包装成友好的提示后再返回客户端，否则用户也看不懂系"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mliutm.github.io/img/premium_photo-1695185954894-e9382c6f4da8.jpg"><meta property="article:published_time" content="2023-11-20T12:40:55.000Z"><meta property="article:modified_time" content="2023-11-20T13:14:00.450Z"><meta property="article:author" content="清风"><meta property="article:tag" content="java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://mliutm.github.io/img/premium_photo-1695185954894-e9382c6f4da8.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://mliutm.github.io/breeze/78423a8.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"蓉车宝-店铺入驻-自定义异常-fastdfs（四）",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-11-20 21:14:00"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">169</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/premium_photo-1695185954894-e9382c6f4da8.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="清风"><span class="site-name">清风</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">蓉车宝-店铺入驻-自定义异常-fastdfs（四）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-20T12:40:55.000Z" title="发表于 2023-11-20 20:40:55">2023-11-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-20T13:14:00.450Z" title="更新于 2023-11-20 21:14:00">2023-11-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E8%93%89%E8%BD%A6%E5%AE%9D/">蓉车宝</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="蓉车宝-店铺入驻-自定义异常-fastdfs（四）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs"><a href="#蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs" class="headerlink" title="蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs"></a>蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs</h1><h2 id="一-内容"><a href="#一-内容" class="headerlink" title="一 内容"></a>一 内容</h2><ul><li>异常处理</li><li>fastdfs文件系统</li><li>项目图片统一处理概述</li></ul><h2 id="二-异常处理"><a href="#二-异常处理" class="headerlink" title="二 异常处理"></a>二 异常处理</h2><h3 id="1-自定义异常"><a href="#1-自定义异常" class="headerlink" title="1.自定义异常"></a>1.自定义异常</h3><p><img src="/breeze/78423a8/image-20231120181453291.png" alt="image-20231120181453291"></p><p>​ 系统中的异常可以分为我们能预知的异常和未知的系统异常，对于我们能预知的异常如空值判断，用户名错误，密码错误等异常我们需要返回客户端，对于系统内部异常如SQL语法错误，参数格式转换错误等需要统一包装成友好的提示后再返回客户端，否则用户也看不懂系统内部的异常。</p><p>​ 方案是可以自定义异常来封装我们能够预知的异常(业务相关异常)，和系统未知的异常做一个区分，自定义异常如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 业务类的异常，系统已知的异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>以上代码存在着以下这两个问题：</p><p>问题1：判断空等逻辑很多地方都是一样的。到处都要抛异常!!!</p><p>问题2：controller中需要写大量重复的try{}catch() 代码</p><h3 id="2-断言工具抽取"><a href="#2-断言工具抽取" class="headerlink" title="2.断言工具抽取"></a>2.断言工具抽取</h3><p>​ 我们现在的业务中，很多地方做了非空校验或者字符串是否相等校验后，都要去手动抛异常，非常麻烦，所以我们可以抽取断言工具统一做一些校验，然后抛异常。</p><p>​ 什么是断言？断言(assertion)是一种在程序中的一阶逻辑(如：一个结果为真或假的逻辑判断式)，目的为了表示与验证软件开发者预期的结果——当程序执行到断言的位置时，对应的断言应该为真。若断言不为真时，程序会中止执行，并给出错误信息。</p><p>​ 比如：我断言这个对象为空，那么如果这个对象不为空，它就要抛出异常。或者我断言这个结果为真，如果它为假，则抛出异常。</p><p>​ 即可以把以前的这种代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!admin.getPassword().equals(admin.getConfirmPassword()))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;两次密码不一致,请检查后重新提交!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>抽取到工具类AssertUtil，即如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 断言两个字符串值相等</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isEq</span><span class="params">(String str1,String str2,String message)</span>&#123;</span><br><span class="line">    <span class="comment">// 如果两个字符串不相等，就抛出异常</span></span><br><span class="line">    <span class="keyword">if</span>(!str1.equals(str2))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以后在使用时，只需要如下使用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RonghuaAssert.isEq(admin.getPassword(), admin.getConfirmPassword(), <span class="string">&quot;两次密码不一致,请检查后重新提交!&quot;</span>);</span><br></pre></td></tr></table></figure><p>断言工具类如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 断言工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RonghuaAssert</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// StringUtils.isBlank  StringUtils.isEmpty的区别</span></span><br><span class="line">    <span class="comment">// StringUtils.isEmpty()只判断字符串是否为空和空字符串，如果字符串是&quot;    &quot;它认为它不是空字符串的</span></span><br><span class="line">    <span class="comment">// StringUtils.isBlank()不仅判断字符串是否为空和空字符串，而且会判断其中的每一个字符是否是空字符串，如果字符串是&quot;   &quot;，</span></span><br><span class="line">    <span class="comment">// 它也会认为是空字符串</span></span><br><span class="line">    <span class="comment">// 断言字符串为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isBlank</span><span class="params">(String str,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果字符串不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(str))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言字符串不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotBlank</span><span class="params">(String str,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果字符串为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(str))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言对象为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Object obj,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果对象不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.nonNull(obj))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言对象不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotNull</span><span class="params">(Object obj,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果对象为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(obj))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言集合为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Collection collection, String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果集合不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(collection != <span class="literal">null</span> &amp;&amp; collection.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言集合不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotNull</span><span class="params">(Collection collection, String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果集合为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(collection == <span class="literal">null</span> || collection.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言两个字符串值相等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isEq</span><span class="params">(String str1,String str2,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果两个字符串不相等，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(!str1.equals(str2))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-全局异常处理"><a href="#3-全局异常处理" class="headerlink" title="3.全局异常处理"></a>3.全局异常处理</h3><p>​ controller中需要写大量重复的try{}catch() 代码，对于这种情况我们可以将相同异常类的代码放在全局异常类中处理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.basic.utils.AjaxResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span>   <span class="comment">// 在执行controller方法的前/后执行该代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理业务异常类的异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">businessExceptionHandler</span><span class="params">(BusinessException e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setMessage(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">exceptionHandler</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setMessage(<span class="string">&quot;网络异常!请稍后重试!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​ 这里的 RestControllerAdvice + ExceptionHandler 注解可以拦截到异常，针对不同的异常做不同的拦截，然后做出不同的处理，在controller执行不包异常的时候就会返回正确的结果，如果出现异常，走GlobalExceptionHandler 异常拦截类进行处理。</p><p>​ controller类中如下处理即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/settlement&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">settlement</span><span class="params">(<span class="meta">@RequestBody</span> ShopRegisterDTO shop)</span> &#123;</span><br><span class="line">        shopService.settlement(shop);</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>全局异常流程图解：</strong></p><p><img src="/breeze/78423a8/image-20231120181926342.png" alt="image-20231120181926342"></p><h3 id="4-JSR303校验"><a href="#4-JSR303校验" class="headerlink" title="4.JSR303校验"></a>4.JSR303校验</h3><h4 id="4-1-后端校验参数是否为空的方法："><a href="#4-1-后端校验参数是否为空的方法：" class="headerlink" title="4.1.后端校验参数是否为空的方法："></a>4.1.后端校验参数是否为空的方法：</h4><ul><li>@RequestParam(value &#x3D; “name”,required &#x3D; true)注解，一般用于Get方法，如果参数是在请求体中传递的话，则无法使用</li><li>后端做if判断，需要手动判断并抛异常，比较麻烦</li><li>断言处理，适用于大部分场景，但是如果遇到大规模对象字段校验，则也很麻烦</li><li>JSR303校验，适合用于大规模对象字段校验</li></ul><h4 id="4-2-JSR303校验"><a href="#4-2-JSR303校验" class="headerlink" title="4.2.JSR303校验"></a>4.2.JSR303校验</h4><p>​ JSR303是 Java 为 Bean 数据合法性校验提供的标准框架，它已经包含在 JavaEE 6.0 中 . JSR 303 (Java Specification Requests意思是Java 规范提案)通过<strong>在</strong> <strong>Bean</strong> <strong>属性上标注</strong>类似于 @NotNull、@Max 等标准的注解指定校验规则，并通过标准的验证接口对 Bean进行验证。在springmvc中我们经常用来做一些校验</p><p><strong>引入依赖</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-validation --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="4-2-1-基础用法"><a href="#4-2-1-基础用法" class="headerlink" title="4.2.1.基础用法"></a>4.2.1.基础用法</h5><p>在要做校验的对象的字段上加注解，比如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopRegisterDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> ShopAdminDTO admin; <span class="comment">// 店铺管理员信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller层中，在要做校验方法的参数前加注解@Valid</p><h5 id="4-2-2-高级用法"><a href="#4-2-2-高级用法" class="headerlink" title="4.2.2.高级用法"></a>4.2.2.高级用法</h5><p>​ 以上方法可以减少大量自己做参数校验的代码，但是异常信息却不是我们想要的，如果我们想自定义返回的错误信息，可以使用以下方式。</p><ul><li>在注解中使用message指定要展示的错误信息</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.org.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopRegisterDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;店铺名称不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;店铺电话不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;店铺地址不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;店铺管理员不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ShopAdminDTO admin; <span class="comment">// 店铺管理员信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>添加全局异常处理</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">methodArgumentNotValidExceptionHandler</span><span class="params">(MethodArgumentNotValidException e)</span>&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    List&lt;FieldError&gt; fieldErrors = e.getBindingResult().getFieldErrors();</span><br><span class="line">    <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">    <span class="keyword">for</span> (FieldError fieldError : fieldErrors) &#123;</span><br><span class="line">        sb.append(fieldError.getDefaultMessage());</span><br><span class="line">        sb.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sb.substring(<span class="number">0</span>,sb.length()-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setMessage(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>进阶版，错误信息不在代码中写死，而是定义在properties中</p><p>在resources包下重写ValidationMessages.properties配置文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mliutm.error.org.shop.name.blank=\u5e97\u94fa\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a</span><br><span class="line">mliutm.error.org.shop.tel.blank=\u5e97\u94fa\u7535\u8bdd\u4e0d\u80fd\u4e3a\u7a7a</span><br><span class="line">mliutm.error.org.shop.address.blank=\u5e97\u94fa\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a</span><br></pre></td></tr></table></figure><p>ValidationMessages.properties配置文件原本是在org.hibernate.validator包下的，因为javaapi中只定义了jsr303规范，具体实现是由其他包实现的，springboot-starter下是由org.hibernate.validator来实现的</p></li></ul><h3 id="5-响应码抽取"><a href="#5-响应码抽取" class="headerlink" title="5.响应码抽取"></a>5.响应码抽取</h3><p>​ 在有些业务场景中，后端在返回信息给前端时，不仅要返回响应信息还要返回响应码，比如我们常见的200,500,400,404,403等。</p><p>​ 除了以上这些常见的响应码，我们在编写代码时也可以定义一些属于本项目自己的响应码，特别是如果代码有第三方调用的话，都会返回响应码给三方调用者，并要提供专门的响应码对应信息，供用户查看具体的信息。</p><p>​ 比如百度地图的错误码参考地址： <a target="_blank" rel="noopener" href="https://lbsyun.baidu.com/index.php?title=androidsdk/guide/addition-func/errorcode">https://lbsyun.baidu.com/index.php?title=androidsdk/guide/addition-func/errorcode</a></p><h4 id="5-1-AjaxResult中增加响应码字段"><a href="#5-1-AjaxResult中增加响应码字段" class="headerlink" title="5.1.AjaxResult中增加响应码字段"></a>5.1.AjaxResult中增加响应码字段</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.basic.exception.ResponseCode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个类是用来封装往前端返回的参数的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AjaxResult</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span> ResponseCode.RESPONSE_CODE_200.getCode();     <span class="comment">// 默认200，表示操作成功</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">success</span> <span class="operator">=</span> <span class="literal">true</span>;    <span class="comment">// 表示当前操作是成功还是失败 true:成功 false:失败</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> ResponseCode.RESPONSE_CODE_200.getMessage();     <span class="comment">// 失败的原因</span></span><br><span class="line">    <span class="keyword">private</span> Object resultObj;   <span class="comment">// 返回给前端的查询结果对象,是一定不能把类型写死的,因为这个AjaxResult类是公共的,每个controller都是返回AjaxResult类的</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 公共的静态方法,用来获取AjaxResult对象的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AjaxResult <span class="title function_">me</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AjaxResult</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">getSuccess</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">setSuccess</span><span class="params">(Boolean success)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.success = success;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;    <span class="comment">// this它的意思是:谁调用我我就是谁</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getResultObj</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> resultObj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">setResultObj</span><span class="params">(Object resultObj)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.resultObj = resultObj;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="5-2-将响应信息抽取枚举"><a href="#5-2-将响应信息抽取枚举" class="headerlink" title="5.2.将响应信息抽取枚举"></a>5.2.将响应信息抽取枚举</h4><p>​	因为响应信息有很多，且每一个响应码都会对应一个响应信息，如果在代码中写死的话，一旦某个响应信息在代码中多个地方使用，而需要修改时，就需要大范围的修改，因此我们一般都定义一个枚举类来处理这类信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 响应信息枚举类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">ResponseCode</span> &#123;</span><br><span class="line">    RESPONSE_CODE_200(<span class="number">200</span>,<span class="string">&quot;操作成功!&quot;</span>),</span><br><span class="line">    RESPONSE_CODE_400(<span class="number">400</span>,<span class="string">&quot;参数错误!&quot;</span>),</span><br><span class="line">    RESPONSE_CODE_400001(<span class="number">400001</span>,<span class="string">&quot;两次密码不一致,请检查后重新提交!&quot;</span>),</span><br><span class="line">    RESPONSE_CODE_400002(<span class="number">400002</span>,<span class="string">&quot;店铺已存在,请检查后重新提交!&quot;</span>),</span><br><span class="line">    RESPONSE_CODE_500(<span class="number">500</span>,<span class="string">&quot;网络异常!请稍后重试!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ResponseCode(Integer code, String message) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="5-3-修改全局异常处理类"><a href="#5-3-修改全局异常处理类" class="headerlink" title="5.3.修改全局异常处理类"></a>5.3.修改全局异常处理类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.basic.utils.AjaxResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.FieldError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span>   <span class="comment">// 在执行controller方法的前/后执行该代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理业务异常类的异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">businessExceptionHandler</span><span class="params">(BusinessException e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setCode(e.getCode()).setMessage(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">methodArgumentNotValidExceptionHandler</span><span class="params">(MethodArgumentNotValidException e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        List&lt;FieldError&gt; fieldErrors = e.getBindingResult().getFieldErrors();</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (FieldError fieldError : fieldErrors) &#123;</span><br><span class="line">            sb.append(fieldError.getDefaultMessage());</span><br><span class="line">            sb.append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sb.substring(<span class="number">0</span>,sb.length()-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setCode(ResponseCode.RESPONSE_CODE_400.getCode())</span><br><span class="line">                .setMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">exceptionHandler</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setCode(ResponseCode.RESPONSE_CODE_500.getCode())</span><br><span class="line">                .setMessage(<span class="string">&quot;网络异常!请稍后重试!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="5-4-修改自定义异常类"><a href="#5-4-修改自定义异常类" class="headerlink" title="5.4.修改自定义异常类"></a>5.4.修改自定义异常类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.exception;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 业务类的异常，系统已知的异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(code.getMessage());</span><br><span class="line">        <span class="built_in">this</span>.code = code.getCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="5-5-修改断言工具类"><a href="#5-5-修改断言工具类" class="headerlink" title="5.5.修改断言工具类"></a>5.5.修改断言工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 断言工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RonghuaAssert</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// StringUtils.isBlank  StringUtils.isEmpty的区别</span></span><br><span class="line">    <span class="comment">// StringUtils.isEmpty()只判断字符串是否为空和空字符串，如果字符串是&quot;    &quot;它认为它不是空字符串的</span></span><br><span class="line">    <span class="comment">// StringUtils.isBlank()不仅判断字符串是否为空和空字符串，而且会判断其中的每一个字符是否是空字符串，如果字符串是&quot;   &quot;，</span></span><br><span class="line">    <span class="comment">// 它也会认为是空字符串</span></span><br><span class="line">    <span class="comment">// 断言字符串为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isBlank</span><span class="params">(String str,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果字符串不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(str))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言字符串不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotBlank</span><span class="params">(String str,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果字符串为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(str))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言对象为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Object obj,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果对象不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.nonNull(obj))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言对象不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotNull</span><span class="params">(Object obj,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果对象为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(obj))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言集合为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Collection collection, String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果集合不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(collection != <span class="literal">null</span> &amp;&amp; collection.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言集合不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotNull</span><span class="params">(Collection collection, String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果集合为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(collection == <span class="literal">null</span> || collection.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言两个字符串值相等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isEq</span><span class="params">(String str1,String str2,String message)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果两个字符串不相等，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(!str1.equals(str2))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//====================================================================</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isBlank</span><span class="params">(String str,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果字符串不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isNotBlank(str))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言字符串不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotBlank</span><span class="params">(String str,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果字符串为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(str))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言对象为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Object obj,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果对象不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.nonNull(obj))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言对象不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotNull</span><span class="params">(Object obj,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果对象为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(Objects.isNull(obj))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言集合为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Collection collection,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果集合不为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(collection != <span class="literal">null</span> &amp;&amp; collection.size() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言集合不为空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNotNull</span><span class="params">(Collection collection,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果集合为空，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(collection == <span class="literal">null</span> || collection.size() == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 断言两个字符串值相等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isEq</span><span class="params">(String str1,String str2,ResponseCode code)</span>&#123;</span><br><span class="line">        <span class="comment">// 如果两个字符串不相等，就抛出异常</span></span><br><span class="line">        <span class="keyword">if</span>(!str1.equals(str2))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="5-6-修改业务代码"><a href="#5-6-修改业务代码" class="headerlink" title="5.6.修改业务代码"></a>5.6.修改业务代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RonghuaAssert.isEq(admin.getPassword(), admin.getConfirmPassword(), ResponseCode.RESPONSE_CODE_400001);</span><br><span class="line">RonghuaAssert.isNull(shopByDB, ResponseCode.RESPONSE_CODE_400002);</span><br></pre></td></tr></table></figure><h2 id="三-Fastdfs文件存储"><a href="#三-Fastdfs文件存储" class="headerlink" title="三 .Fastdfs文件存储"></a>三 .Fastdfs文件存储</h2><h3 id="1-认识分布式文件服务器"><a href="#1-认识分布式文件服务器" class="headerlink" title="1.认识分布式文件服务器"></a>1.认识分布式文件服务器</h3><p><img src="/breeze/78423a8/image-20220905095209671.png" alt="image-20220905095209671"></p><h4 id="1-1-为什么需要分布式文件服务器"><a href="#1-1-为什么需要分布式文件服务器" class="headerlink" title="1.1.为什么需要分布式文件服务器"></a>1.1.为什么需要分布式文件服务器</h4><p>在分布式系统 ，或者集群环境中，如果按照传统的图片存储方式把图片传出到应用本地，那么其他应用如果想要获取图片就获取不到了，如下：</p><p><img src="/breeze/78423a8/1619860224090.png" alt="1619860224090"></p><p>解决方案：</p><ul><li>方案一：如果是小型集群&#x2F;分布式环境， 多个服务器部署在同一个电脑上，可以使用一个<code>中转目录</code>进行文件共享，如下：</li></ul><p><img src="/breeze/78423a8/1619860645171.png" alt="1619860645171"></p><p>这种方案对环境有要求，就是多个应用是在同一台服务器进行部署才可以，否则没办法设置中转目录。</p><ul><li>方案二：如果把上面的中转目录变成一个独立的文件服务器是不是所有的问题都得到了解决了？这个文件服务器就是我们今天探讨的分布式文件服务器：</li></ul><p><img src="/breeze/78423a8/1619861355229.png" alt="1619861355229"></p><p>除了上面的问题，对于Tomcat来说处理图片或者本身就是不擅长的工作，为了减轻Tomcat压力，应该把图片剥离出去交由专门的文件服务器去处理。</p><h4 id="1-2-分布式文件系统（dfs）选型"><a href="#1-2-分布式文件系统（dfs）选型" class="headerlink" title="1.2. 分布式文件系统（dfs）选型"></a>1.2. 分布式文件系统（dfs）选型</h4><p>dfs：distributed file system</p><ul><li><p>自己搭建dfs</p><p>​ 自己搭建的话就需要在一台服务器上面安装分布式文件系统的软件。常见的分布式文件系统的软件有：</p><p>​ hdfs（重量级），<strong>fastdfs（轻量级，尤其擅长图片处理）</strong></p><p>当然安装的常见方式有两种：</p><pre><code>- 普通linux命令安装
- 通过docker来安装（非常so easy只需要执行一个命令就可以）
</code></pre></li><li><p>购买云服务-别人已经搭建好了dfs</p><p>​ 阿里云对象存储oss 百度云 华为云 腾讯云都有—–<strong>-下个项目玩</strong></p></li></ul><h3 id="2-什么是Fastdfs"><a href="#2-什么是Fastdfs" class="headerlink" title="2 什么是Fastdfs"></a>2 什么是Fastdfs</h3><ol><li>基本概念</li></ol><p>FastDFS 是用 c 语言编写的一款开源的分布式文件系统。FastDFS 为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，<strong>使用 FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。</strong></p><p>FastDFS 架构包括 Tracker server 和 Storage server。客户端请求 Tracker server 进行文件上传、下载，通过 Tracker server 调度最终由 Storage server 完成文件上传和下载。</p><p>Tracker server 作用是负载均衡和调度，通过 Tracker server 在文件上传时可以根据一些策略找到 Storage server 提供文件上传服务。可以将 tracker 称为追踪服务器或调度服务器。</p><ol start="2"><li>Fastdfs系统结构</li></ol><p>Storage server 作用是文件存储，客户端上传的文件最终存储在 Storage 服务器上，Storageserver 没有实现自己的文件系统而是利用操作系统 的文件系统来管理文件。可以将storage称为存储服务器。</p><p><img src="/breeze/78423a8/1619861524240.png" alt="1619861524240"></p><p>服务端两个角色：</p><ul><li><p>Tracker：管理集群，tracker 也可以实现集群。每个 tracker 节点地位平等。收集 Storage 集群的状态。</p></li><li><p>Storage：实际保存文件 Storage 分为多个组，每个组之间保存的文件是不同的。每个组内部可以有多个成员，组成员内部保存的内容是一样的，组成员的地位是一致的，没有主从的概念。</p></li></ul><ol start="3"><li>Fastdfs上传流程</li></ol><p><img src="/breeze/78423a8/1619861623425.png" alt="1619861623425"></p><p>客户端上传文件后存储服务器将文件 ID 返回给客户端，此文件 ID 用于以后访问该文件的索引信息。文件索引信息包括：组名，虚拟磁盘路径，数据两级目录，文件名。如：</p><p><img src="/breeze/78423a8/1619861684900.png" alt="1619861684900"></p><ul><li><p>组名（卷）：文件上传后所在的 storage 组名称，在文件上传成功后有 storage 服务器返回，需要客户端自行保存。</p></li><li><p>虚拟磁盘路径：storage 配置的虚拟路径，与磁盘选项 store_path*对应。如果配置了store_path0 则是 M00，如果配置了 store_path1 则是 M01，以此类推。</p></li><li><p>数据两级目录：storage 服务器在每个虚拟磁盘路径下创建的两级目录，用于存储数据文件。</p></li><li><p>文件名：与文件上传时不同。是由存储服务器根据特定信息生成，文件名包含：源存储服务器 IP 地址、文件创建时间戳、文件大小、随机数和文件拓展名等信息。</p></li></ul><ol start="4"><li>下载流程</li></ol><p><img src="/breeze/78423a8/1619861792385.png" alt="1619861792385"></p><h3 id="3-Fastdfs文件服务器搭建"><a href="#3-Fastdfs文件服务器搭建" class="headerlink" title="3.Fastdfs文件服务器搭建"></a>3.Fastdfs文件服务器搭建</h3><p>搭建Fastdfs服务器，官方文档：<a target="_blank" rel="noopener" href="https://github.com/happyfish100/fastdfs/wiki">https://github.com/happyfish100/fastdfs/wiki</a></p><p>有兴趣可以自己根据文档去搭建一下，这里就省略搭建步骤了…</p><p>nginx-fastdfs—-&gt;项目结束以后 Docker—一行命令搞定fastDfs</p><h3 id="4-Java对接Fastdfs文件服务器"><a href="#4-Java对接Fastdfs文件服务器" class="headerlink" title="4.Java对接Fastdfs文件服务器"></a>4.Java对接Fastdfs文件服务器</h3><h4 id="4-1-导入依赖"><a href="#4-1-导入依赖" class="headerlink" title="4.1.导入依赖"></a>4.1.导入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- fastdfs依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.bestwu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastdfs-client-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--用来获取文件扩展名的包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-2-配置Fastdfs"><a href="#4-2-配置Fastdfs" class="headerlink" title="4.2.配置Fastdfs"></a>4.2.配置Fastdfs</h4><p>添加配置文件fdfs_client.conf ，将其中的服务器地址设置为Fastdfs服务器IP，比如：115.159.217.249</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tracker_server</span>=<span class="string">115.159.217.249:22122</span></span><br></pre></td></tr></table></figure><h4 id="4-3-测试代码"><a href="#4-3-测试代码" class="headerlink" title="4.3.测试代码"></a>4.3.测试代码</h4><p>创建java类，main方法代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 1、加载配置文件，配置文件中的内容就是 tracker 服务的地址。</span></span><br><span class="line">ClientGlobal.init(<span class="string">&quot;D:/maven_work/fastDFS-demo/src/fdfs_client.conf&quot;</span>);</span><br><span class="line"><span class="comment">// 2、创建一个 TrackerClient 对象。直接 new 一个。</span></span><br><span class="line"><span class="type">TrackerClient</span> <span class="variable">trackerClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrackerClient</span>();</span><br><span class="line"><span class="comment">// 3、使用 TrackerClient 对象创建连接，获得一个 TrackerServer 对象。</span></span><br><span class="line"><span class="type">TrackerServer</span> <span class="variable">trackerServer</span> <span class="operator">=</span> trackerClient.getConnection();</span><br><span class="line"><span class="comment">// 4、创建一个 StorageServer 的引用，值为 null</span></span><br><span class="line"><span class="type">StorageServer</span> <span class="variable">storageServer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 5、创建一个 StorageClient 对象，需要两个参数 TrackerServer 对象、StorageServer 的引用</span></span><br><span class="line"><span class="type">StorageClient</span> <span class="variable">storageClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StorageClient</span>(trackerServer, storageServer);</span><br><span class="line"><span class="comment">// 6、使用 StorageClient 对象上传图片。</span></span><br><span class="line"><span class="comment">//扩展名不带“.”</span></span><br><span class="line">String[] strings = storageClient.upload_file(<span class="string">&quot;D:/pic/benchi.jpg&quot;</span>, <span class="string">&quot;jpg&quot;</span>,</span><br><span class="line">                                             <span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 7、返回数组。包含组名和图片的路径。</span></span><br><span class="line"><span class="keyword">for</span> (String string : strings) &#123;</span><br><span class="line">    System.out.println(string);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台输出如下结果：</p><p>​	group1 组名</p><p>​	M00&#x2F;00&#x2F;00&#x2F;wKgZhVkMP4KAZEy-AAA-tCf93Fo973.jpg 虚拟磁盘路径&#x2F;文件名字</p><p>测试地址：</p><p><a target="_blank" rel="noopener" href="http://115.159.217.249:8888/group1/M00/00/8D/rBEAA2VA7HeAI79MAABAQCGR3QA019.jpg">http://115.159.217.249:8888/group1/M00/00/8D/rBEAA2VA7HeAI79MAABAQCGR3QA019.jpg</a></p><h4 id="4-4-工具类"><a href="#4-4-工具类" class="headerlink" title="4.4.工具类"></a>4.4.工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.basic.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.csource.common.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastdfsUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载配置文件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">CONF_FILENAME</span>  <span class="operator">=</span> FastdfsUtil.class.getClassLoader() .getResource(<span class="string">&quot;fdfs_client.conf&quot;</span>).getFile();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file ：byte数组格式的文件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> extName ：文件扩展名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] file,String extName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//初始化配置</span></span><br><span class="line">            ClientGlobal.init(CONF_FILENAME);</span><br><span class="line">            <span class="comment">//创建Tracker客户端</span></span><br><span class="line">            <span class="type">TrackerClient</span> <span class="variable">tracker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrackerClient</span>();</span><br><span class="line">            <span class="type">TrackerServer</span> <span class="variable">trackerServer</span> <span class="operator">=</span> tracker.getConnection();</span><br><span class="line">            <span class="type">StorageServer</span> <span class="variable">storageServer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="comment">//创建Storage 客户端</span></span><br><span class="line">            <span class="type">StorageClient</span> <span class="variable">storageClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StorageClient</span>(trackerServer, storageServer);</span><br><span class="line">            <span class="comment">//设置而外的参数</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">            NameValuePair nvp [] = new NameValuePair[]&#123;</span></span><br><span class="line"><span class="comment">                    new NameValuePair(&quot;width&quot;, &quot;100&quot;),</span></span><br><span class="line"><span class="comment">                    new NameValuePair(&quot;height&quot;, &quot;100&quot;)</span></span><br><span class="line"><span class="comment">            &#125;; **/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//执行上传</span></span><br><span class="line">            String fileIds[] = storageClient.upload_file(file,extName,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span>  <span class="string">&quot;/&quot;</span>+fileIds[<span class="number">0</span>]+<span class="string">&quot;/&quot;</span>+fileIds[<span class="number">1</span>];</span><br><span class="line">            System.out.println(<span class="string">&quot;文件上传成功，path=&quot;</span>+path);</span><br><span class="line">            <span class="keyword">return</span> path;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>  <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> extName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  String <span class="title function_">upload</span><span class="params">(String path,String extName)</span> &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            ClientGlobal.init(CONF_FILENAME);</span><br><span class="line"> </span><br><span class="line">            <span class="type">TrackerClient</span> <span class="variable">tracker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrackerClient</span>(); </span><br><span class="line">            <span class="type">TrackerServer</span> <span class="variable">trackerServer</span> <span class="operator">=</span> tracker.getConnection(); </span><br><span class="line">            <span class="type">StorageServer</span> <span class="variable">storageServer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">StorageClient</span> <span class="variable">storageClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StorageClient</span>(trackerServer, storageServer);</span><br><span class="line">            String fileIds[] = storageClient.upload_file(path, extName,<span class="literal">null</span>);</span><br><span class="line">             </span><br><span class="line">            System.out.println(fileIds.length); </span><br><span class="line">            <span class="keyword">return</span>  <span class="string">&quot;/&quot;</span>+fileIds[<span class="number">0</span>]+<span class="string">&quot;/&quot;</span>+fileIds[<span class="number">1</span>];</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>  <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] download(String groupName,String fileName) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            ClientGlobal.init(CONF_FILENAME);</span><br><span class="line"> </span><br><span class="line">            <span class="type">TrackerClient</span> <span class="variable">tracker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrackerClient</span>(); </span><br><span class="line">            <span class="type">TrackerServer</span> <span class="variable">trackerServer</span> <span class="operator">=</span> tracker.getConnection(); </span><br><span class="line">            <span class="type">StorageServer</span> <span class="variable">storageServer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="type">StorageClient</span> <span class="variable">storageClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StorageClient</span>(trackerServer, storageServer); </span><br><span class="line">            <span class="keyword">return</span> storageClient.download_file(groupName, fileName);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>  <span class="literal">null</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">delete</span><span class="params">(String path)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            ClientGlobal.init(CONF_FILENAME);</span><br><span class="line"> </span><br><span class="line">            <span class="type">TrackerClient</span> <span class="variable">tracker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrackerClient</span>(); </span><br><span class="line">            <span class="type">TrackerServer</span> <span class="variable">trackerServer</span> <span class="operator">=</span> tracker.getConnection(); </span><br><span class="line">            <span class="type">StorageServer</span> <span class="variable">storageServer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="type">StorageClient</span> <span class="variable">storageClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StorageClient</span>(trackerServer, </span><br><span class="line">                    storageServer);</span><br><span class="line">            <span class="comment">// /group1/M00/00/0F/rBEAA2PXYVKAMMIJAAEBKYFk7Jc89.jpeg</span></span><br><span class="line">            path = path.substring(<span class="number">1</span>);   <span class="comment">// group1/M00/00/0F/rBEAA2PXYVKAMMIJAAEBKYFk7Jc89.jpeg</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> path.indexOf(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">groupName</span> <span class="operator">=</span> path.substring(<span class="number">0</span>,length);    <span class="comment">// group1</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> path.substring(length+<span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> storageClient.delete_file(groupName,fileName);</span><br><span class="line">            System.out.println( i==<span class="number">0</span> ? <span class="string">&quot;删除成功&quot;</span> : <span class="string">&quot;删除失败:&quot;</span>+i);</span><br><span class="line">            <span class="keyword">return</span> i == <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;删除异常,&quot;</span>+e.getMessage());</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/*String path = &quot;C:\\Users\\EDY\\Desktop\\2.jpeg&quot;;</span></span><br><span class="line"><span class="comment">        String filePath = upload(path, &quot;jpeg&quot;);</span></span><br><span class="line"><span class="comment">        System.out.println(filePath);*/</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/group1/M00/00/0F/rBEAA2PXYVKAMMIJAAEBKYFk7Jc89.jpeg&quot;</span>;</span><br><span class="line">        delete(path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="四-fastdfs项目图片统一处理"><a href="#四-fastdfs项目图片统一处理" class="headerlink" title="四 fastdfs项目图片统一处理"></a>四 fastdfs项目图片统一处理</h2><h4 id="1-Logo上传前端"><a href="#1-Logo上传前端" class="headerlink" title="1.Logo上传前端"></a>1.Logo上传前端</h4><p>先见[FastDFS] ; 上传流程</p><p><img src="/breeze/78423a8/image-20221102223203321.png" alt="image-20221102223203321"></p><ol><li>文件上传插件</li></ol><p>这里使用的是ElementUI的上传插件， action是图片上传地址，写我们自己的后台</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;logo&quot;</span> <span class="attr">label</span>=<span class="string">&quot;店铺Logo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">               <span class="attr">class</span>=<span class="string">&quot;upload-demo&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">action</span>=<span class="string">&quot;http://localhost:80/fastDfs/&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:on-preview</span>=<span class="string">&quot;handlePreview&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:on-remove</span>=<span class="string">&quot;handleRemove&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:on-success</span>=<span class="string">&quot;handleSuccess&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">:file-list</span>=<span class="string">&quot;fileList&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">list-type</span>=<span class="string">&quot;picture&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;small&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>点击上传<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">&quot;tip&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-upload__tip&quot;</span>&gt;</span>只能上传jpg/png文件，且不超过500kb<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>handleSuccess ：是上传成功之后的回调</li></ul><ol start="2"><li>文件上传回调</li></ol><p>把从后台响应中拿到图片地址，复制给表单数据，提交表单的时候一起提交</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件上传成功回调</span></span><br><span class="line"><span class="title function_">handleSuccess</span>(<span class="params">response, file, fileList</span>)&#123;</span><br><span class="line">    <span class="comment">//把从后台响应中拿到图片地址，复制给表单数据，提交表单的时候一起提交</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">shop</span>.<span class="property">logo</span> = response.<span class="property">result</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h4 id="2-Logo上传后端"><a href="#2-Logo上传后端" class="headerlink" title="2.Logo上传后端"></a>2.Logo上传后端</h4><ol><li><p>集成Fastdfs</p><p>见“Fastdfs”文件存储</p></li><li><p>controller</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/fastDfs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastDfsController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IFastDfsService fastDfsService;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> AjaxResult <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = file.getBytes(); <span class="comment">//文件的内容</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">extName</span> <span class="operator">=</span> FilenameUtils.getExtension(originalFilename);</span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> fastDfsService.upload(bytes,extName); <span class="comment">//上传成功返回地址</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> AjaxResult.me().setResult(path); <span class="comment">//地址返回前端</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setMessage(<span class="string">&quot;上传失败！&quot;</span>+e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>service</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastDfsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IFastDfsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;fastdfs.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fastDfsUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] bytes, String extName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fastDfsUrl+FastdfsUtil.upload(bytes,extName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>4 application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.mliutm.org.domain,com.mliutm.org.query</span></span><br><span class="line"><span class="attr">fastdfs:</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://115.159.217.249:8888</span></span><br></pre></td></tr></table></figure><h4 id="3-图片删除"><a href="#3-图片删除" class="headerlink" title="3 图片删除"></a>3 图片删除</h4><p><img src="/breeze/78423a8/image-20220905144654962.png" alt="image-20220905144654962"></p><p>在这个地方已经上传图片到fastdfs，点叉的时候，需要发一个请求到后端controller，由conroller调用service，进而通过FastdfsUtil来删除文件</p><p>前端：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//文件删除</span></span><br><span class="line">            <span class="title function_">handleRemove</span>(<span class="params">file, fileList</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> filePath =file.<span class="property">response</span>.<span class="property">result</span>; <span class="comment">//http://115.159.217.249:8888/group1/M00/00/00/rBEAA2MVmliAWdWWAACLuUIEKsg899.jpg</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">$http</span>.<span class="title function_">delete</span>(<span class="string">&quot;/fastDfs/?path=&quot;</span>+filePath) <span class="comment">//非restfull风格</span></span><br><span class="line">                    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">success</span>)&#123;</span><br><span class="line">                            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                                <span class="attr">message</span>: <span class="string">&#x27;删除成功!&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                                <span class="attr">message</span>: <span class="string">&#x27;删除失败!&#x27;</span>,</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br></pre></td></tr></table></figure><p><strong>controller</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> AjaxResult <span class="title function_">delete</span><span class="params">(String path)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        fastDfsService.delete(path);</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> AjaxResult.me().setSuccess(<span class="literal">false</span>).setMessage(<span class="string">&quot;删除失败！&quot;</span>+e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>service</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    <span class="comment">//传入的path是有http://ip:port</span></span><br><span class="line">    <span class="comment">//但是我们的工具类不要</span></span><br><span class="line">    <span class="comment">//http://115.159.217.249:8888/group1/M00/00/00/rBEAA2MVmliAWdWWAACLuUIEKsg899.jpg</span></span><br><span class="line">    path = path.substring(fastDfsUrl.length()); <span class="comment">//     /group1/M00/00/00/rBEAA2MVmliAWdWWAACLuUIEKsg899.jpg</span></span><br><span class="line">    FastdfsUtil.delete(path);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="五-总结"><a href="#五-总结" class="headerlink" title="五.总结"></a>五.总结</h2><h3 id="1-重点"><a href="#1-重点" class="headerlink" title="1.重点"></a>1.重点</h3><p>​	1.理解为什么是fastdfs</p><p>​	2.店铺入驻的业务需求</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mliutm.github.io">清风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mliutm.github.io/breeze/78423a8.html">https://mliutm.github.io/breeze/78423a8.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mliutm.github.io" target="_blank">清风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post_share"><div class="social-share" data-image="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/breeze/af1d2c35.html" title="容车宝-车辆类型与缓存（五）"><img class="cover" src="/img/photo-1688475747590-d0db5e2412cb.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">容车宝-车辆类型与缓存（五）</div></div></a></div><div class="next-post pull-right"><a href="/breeze/3119132.html" title="荣车宝-店铺入驻（三）"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">荣车宝-店铺入驻（三）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/breeze/c8b66f0a.html" title="File类"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">File类</div></div></a></div><div><a href="/breeze/ecebeadb.html" title="BIO-NIO-AIO深入剖析"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">BIO-NIO-AIO深入剖析</div></div></a></div><div><a href="/breeze/fed4c017.html" title="IO流"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">IO流</div></div></a></div><div><a href="/breeze/a4950fb1.html" title="Redis实战-黑马点评"><img class="cover" src="/img/photo-1688475747590-d0db5e2412cb.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">Redis实战-黑马点评</div></div></a></div><div><a href="/breeze/ab319c68.html" title="SpringCloud-Alibaba快速入门"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-13</div><div class="title">SpringCloud-Alibaba快速入门</div></div></a></div><div><a href="/breeze/4c9bef51.html" title="base抽取与代码生成器（三）"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-28</div><div class="title">base抽取与代码生成器（三）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">清风</div><div class="author-info__description">清风洒六合，邈然不可攀</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">169</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:huangpan0805@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%93%89%E8%BD%A6%E5%AE%9D-%E5%BA%97%E9%93%BA%E5%85%A5%E9%A9%BB-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9Ffastdfs"><span class="toc-text">蓉车宝-店铺入驻-异常处理-分布式文件系统fastdfs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%86%85%E5%AE%B9"><span class="toc-text">一 内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">二 异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8"><span class="toc-text">1.自定义异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%96%AD%E8%A8%80%E5%B7%A5%E5%85%B7%E6%8A%BD%E5%8F%96"><span class="toc-text">2.断言工具抽取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">3.全局异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-JSR303%E6%A0%A1%E9%AA%8C"><span class="toc-text">4.JSR303校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%90%8E%E7%AB%AF%E6%A0%A1%E9%AA%8C%E5%8F%82%E6%95%B0%E6%98%AF%E5%90%A6%E4%B8%BA%E7%A9%BA%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-text">4.1.后端校验参数是否为空的方法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-JSR303%E6%A0%A1%E9%AA%8C"><span class="toc-text">4.2.JSR303校验</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-1-%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95"><span class="toc-text">4.2.1.基础用法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-2-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-text">4.2.2.高级用法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%93%8D%E5%BA%94%E7%A0%81%E6%8A%BD%E5%8F%96"><span class="toc-text">5.响应码抽取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-AjaxResult%E4%B8%AD%E5%A2%9E%E5%8A%A0%E5%93%8D%E5%BA%94%E7%A0%81%E5%AD%97%E6%AE%B5"><span class="toc-text">5.1.AjaxResult中增加响应码字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%B0%86%E5%93%8D%E5%BA%94%E4%BF%A1%E6%81%AF%E6%8A%BD%E5%8F%96%E6%9E%9A%E4%B8%BE"><span class="toc-text">5.2.将响应信息抽取枚举</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%B1%BB"><span class="toc-text">5.3.修改全局异常处理类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E4%BF%AE%E6%94%B9%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E7%B1%BB"><span class="toc-text">5.4.修改自定义异常类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-%E4%BF%AE%E6%94%B9%E6%96%AD%E8%A8%80%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">5.5.修改断言工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-%E4%BF%AE%E6%94%B9%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81"><span class="toc-text">5.6.修改业务代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-Fastdfs%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="toc-text">三 .Fastdfs文件存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%AE%A4%E8%AF%86%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1.认识分布式文件服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">1.1.为什么需要分布式文件服务器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%88dfs%EF%BC%89%E9%80%89%E5%9E%8B"><span class="toc-text">1.2. 分布式文件系统（dfs）选型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BB%80%E4%B9%88%E6%98%AFFastdfs"><span class="toc-text">2 什么是Fastdfs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Fastdfs%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA"><span class="toc-text">3.Fastdfs文件服务器搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Java%E5%AF%B9%E6%8E%A5Fastdfs%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">4.Java对接Fastdfs文件服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">4.1.导入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E9%85%8D%E7%BD%AEFastdfs"><span class="toc-text">4.2.配置Fastdfs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-text">4.3.测试代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">4.4.工具类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-fastdfs%E9%A1%B9%E7%9B%AE%E5%9B%BE%E7%89%87%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86"><span class="toc-text">四 fastdfs项目图片统一处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Logo%E4%B8%8A%E4%BC%A0%E5%89%8D%E7%AB%AF"><span class="toc-text">1.Logo上传前端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Logo%E4%B8%8A%E4%BC%A0%E5%90%8E%E7%AB%AF"><span class="toc-text">2.Logo上传后端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9B%BE%E7%89%87%E5%88%A0%E9%99%A4"><span class="toc-text">3 图片删除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-%E6%80%BB%E7%BB%93"><span class="toc-text">五.总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%87%8D%E7%82%B9"><span class="toc-text">1.重点</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/breeze/1d13ce0d.html" title="WYDG-产品目录列表-20200506"><img src="/img/photo-1653549892896-dde02867edee.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="WYDG-产品目录列表-20200506"></a><div class="content"><a class="title" href="/breeze/1d13ce0d.html" title="WYDG-产品目录列表-20200506">WYDG-产品目录列表-20200506</a><time datetime="2025-04-13T05:43:05.000Z" title="发表于 2025-04-13 13:43:05">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/6f268337.html" title="雨雀文件下载"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="雨雀文件下载"></a><div class="content"><a class="title" href="/breeze/6f268337.html" title="雨雀文件下载">雨雀文件下载</a><time datetime="2024-05-22T12:25:08.000Z" title="发表于 2024-05-22 20:25:08">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7832219d.html" title="十万字面试总结"><img src="/img/photo-1692708632140-ee01624d558d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="十万字面试总结"></a><div class="content"><a class="title" href="/breeze/7832219d.html" title="十万字面试总结">十万字面试总结</a><time datetime="2024-02-29T02:50:00.000Z" title="发表于 2024-02-29 10:50:00">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7ae0ca37.html" title="Redis_30道经典面试题"><img src="/img/photo-1653549892896-dde02867edee.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Redis_30道经典面试题"></a><div class="content"><a class="title" href="/breeze/7ae0ca37.html" title="Redis_30道经典面试题">Redis_30道经典面试题</a><time datetime="2024-02-29T02:45:00.000Z" title="发表于 2024-02-29 10:45:00">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/2a548e97.html" title="面试实战"><img src="/img/photo-1653549892896-dde02867edee.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="面试实战"></a><div class="content"><a class="title" href="/breeze/2a548e97.html" title="面试实战">面试实战</a><time datetime="2024-02-29T02:43:59.000Z" title="发表于 2024-02-29 10:43:59">2024-02-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/premium_photo-1695185954894-e9382c6f4da8.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 <i id="heartbeat" class="fa fas fa-heartbeat"></i> 清风</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/timing.js"></script><script id="canvas_nest" defer color="255,0,255" opacity="0.7" zindex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="天枢,天璇,天玑,天权,玉衡,开阳,瑶光" data-fontsize="15px" data-random="true" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>