<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>RabbitMQ一文通关 | 清风</title><meta name="author" content="清风"><meta name="copyright" content="清风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Rabbitmq消息队列介绍 RabbitMQ认识  RabbitMQ安装  RabbitMQ常用模型(重点)-原生代码  SpringBoot集成RabbitMQ   一. RabbitMQ认识1. RabbitMQ介绍1.1. 是什么​	MQ全称为Message Queue，即消息队列. 它也是一个队列,遵循FIFO原则 。RabbitMQ是由erlang语言开发，基于AMQP（Advance"><meta property="og:type" content="article"><meta property="og:title" content="RabbitMQ一文通关"><meta property="og:url" content="https://mliutm.github.io/breeze/ef8195d4.html"><meta property="og:site_name" content="清风"><meta property="og:description" content="Rabbitmq消息队列介绍 RabbitMQ认识  RabbitMQ安装  RabbitMQ常用模型(重点)-原生代码  SpringBoot集成RabbitMQ   一. RabbitMQ认识1. RabbitMQ介绍1.1. 是什么​	MQ全称为Message Queue，即消息队列. 它也是一个队列,遵循FIFO原则 。RabbitMQ是由erlang语言开发，基于AMQP（Advance"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mliutm.github.io/img/photo-1692708632140-ee01624d558d.jpg"><meta property="article:published_time" content="2023-12-06T10:50:08.000Z"><meta property="article:modified_time" content="2024-01-13T03:10:21.489Z"><meta property="article:author" content="清风"><meta property="article:tag" content="中间件"><meta property="article:tag" content="RocketMQ"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://mliutm.github.io/img/photo-1692708632140-ee01624d558d.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://mliutm.github.io/breeze/ef8195d4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"RabbitMQ一文通关",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-01-13 11:10:21"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">169</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/photo-1692708632140-ee01624d558d.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="清风"><span class="site-name">清风</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">RabbitMQ一文通关</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-06T10:50:08.000Z" title="发表于 2023-12-06 18:50:08">2023-12-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-13T03:10:21.489Z" title="更新于 2024-01-13 11:10:21">2024-01-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>36分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="RabbitMQ一文通关"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Rabbitmq消息队列"><a href="#Rabbitmq消息队列" class="headerlink" title="Rabbitmq消息队列"></a>Rabbitmq消息队列</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul><li><p>RabbitMQ认识</p></li><li><p>RabbitMQ安装</p></li><li><p>RabbitMQ常用模型(重点)-原生代码</p></li><li><p>SpringBoot集成RabbitMQ</p></li></ul><h2 id="一-RabbitMQ认识"><a href="#一-RabbitMQ认识" class="headerlink" title="一. RabbitMQ认识"></a>一. RabbitMQ认识</h2><h3 id="1-RabbitMQ介绍"><a href="#1-RabbitMQ介绍" class="headerlink" title="1. RabbitMQ介绍"></a>1. RabbitMQ介绍</h3><h4 id="1-1-是什么"><a href="#1-1-是什么" class="headerlink" title="1.1. 是什么"></a>1.1. 是什么</h4><p>​	MQ全称为Message Queue，即消息队列. 它也是一个队列,遵循FIFO原则 。RabbitMQ是由erlang语言开发，基于AMQP（Advanced Message Queue Protocol高级消息队列协议）协议实现的消息队列，它是一种应用程序之间的通信方法，消息队列在分布式系统开发中应用非常广泛。</p><p>​	官方地址：<a target="_blank" rel="noopener" href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a></p><h4 id="1-2-特点-消息队列的特点"><a href="#1-2-特点-消息队列的特点" class="headerlink" title="1.2. 特点 - 消息队列的特点"></a>1.2. 特点 - 消息队列的特点</h4><p>开发中消息队列通常有如下应用场景：</p><h5 id="1-2-1-提高系统响应速度"><a href="#1-2-1-提高系统响应速度" class="headerlink" title="1.2.1. 提高系统响应速度"></a>1.2.1. 提高系统响应速度</h5><p>任务异步处理。 将不需要同步处理的并且耗时长的操作由消息队列通知消息接收方进行异步处理。 提高了应用程序的响应时间。</p><p><img src="/breeze/ef8195d4/clip_image002.jpg" alt="img"></p><h5 id="1-2-2-提高系统稳定性"><a href="#1-2-2-提高系统稳定性" class="headerlink" title="1.2.2. 提高系统稳定性"></a>1.2.2. 提高系统稳定性</h5><p>系统挂了没关系,操作内容放到消息队列.</p><p><img src="/breeze/ef8195d4/clip_image004.gif" alt="img"></p><h5 id="1-2-3-服务调用异步化"><a href="#1-2-3-服务调用异步化" class="headerlink" title="1.2.3. 服务调用异步化"></a>1.2.3. 服务调用异步化</h5><p>服务没有直接的调用关系，而是通过队列进行服务通信</p><p><img src="/breeze/ef8195d4/clip_image006.jpg" alt="img"></p><h5 id="1-2-4-服务解耦"><a href="#1-2-4-服务解耦" class="headerlink" title="1.2.4. 服务解耦"></a>1.2.4. 服务解耦</h5><p>应用程序解耦合 MQ相当于一个中介，生产方通过MQ与消费方交互，它将应用程序进行解耦合。</p><p><img src="/breeze/ef8195d4/clip_image007.jpg" alt="img"></p><h5 id="1-2-5-排序保证-FIFO"><a href="#1-2-5-排序保证-FIFO" class="headerlink" title="1.2.5. 排序保证 FIFO"></a>1.2.5. 排序保证 FIFO</h5><p>遵循队列先进先出的特点,秒杀</p><h5 id="1-2-6-消除峰值"><a href="#1-2-6-消除峰值" class="headerlink" title="1.2.6. 消除峰值"></a>1.2.6. 消除峰值</h5><p><img src="/breeze/ef8195d4/clip_image009.gif" alt="img"></p><p>异步化提速(发消息),提高系统稳定性(多系统调用),服务解耦(5-10个服务),排序保证,消除峰值</p><p><strong>消息队列的特点:削峰,异步,解耦</strong></p><h4 id="1-3-市场上还有哪些消息队列"><a href="#1-3-市场上还有哪些消息队列" class="headerlink" title="1.3. 市场上还有哪些消息队列"></a>1.3. 市场上还有哪些消息队列</h4><p>ActiveMQ，<strong>RabbitMQ（轻量级，简易）</strong>，ZeroMQ，<strong>Kafka</strong>，MetaMQ，<strong>RocketMQ</strong>、Redis。</p><h4 id="1-4-为什么使用RabbitMQ呢？"><a href="#1-4-为什么使用RabbitMQ呢？" class="headerlink" title="1.4. 为什么使用RabbitMQ呢？"></a>1.4. 为什么使用RabbitMQ呢？</h4><p>1、使用简单，功能强大。</p><p>2、基于AMQP协议。-跨语言</p><p>3、社区活跃，文档完善。</p><p>4、高并发性能好，这主要得益于Erlang语言。</p><p>5、Spring Boot默认已集成RabbitMQ</p><h4 id="1-5-AMQP协议"><a href="#1-5-AMQP协议" class="headerlink" title="1.5. AMQP协议"></a>1.5. AMQP协议</h4><h5 id="1-5-1-AMQP是什么？"><a href="#1-5-1-AMQP是什么？" class="headerlink" title="1.5.1. AMQP是什么？"></a>1.5.1. AMQP是什么？</h5><p>​	AMQP是一套公开的消息队列协议，最早在2003年被提出，它旨在从协议层定义消息通信数据的标准格式， 为的就是解决MQ市场上协议不统一的问题。RabbitMQ就是遵循AMQP标准协议开发的MQ服务。</p><p>​	官方：<a target="_blank" rel="noopener" href="http://www.amqp.org/">http://www.amqp.org</a></p><h5 id="1-5-2-JMS是什么"><a href="#1-5-2-JMS是什么" class="headerlink" title="1.5.2. JMS是什么 ?"></a>1.5.2. JMS是什么 ?</h5><p>​	JMS是Java消息服务，是java提供的一套消息服务API标准，其目的是为所有的java应用程序提供统一的消息通信的标准，类似java的 jdbc，只要遵循jms标准的应用程序之间都可以进行消息通信。</p><p>​	它和AMQP有什么 不同，jms是java语言专属的消息服务标准，它是在api层定义标准，并且只能用于java应用；而AMQP是在协议层定义的标准，是跨语言的 。</p><h2 id="二-RabbitMQ安装"><a href="#二-RabbitMQ安装" class="headerlink" title="二. RabbitMQ安装"></a>二. RabbitMQ安装</h2><h3 id="1-下载安装"><a href="#1-下载安装" class="headerlink" title="1. 下载安装"></a>1. 下载安装</h3><p>​	RabbitMQ由Erlang语言开发，Erlang语言用于并发及分布式系统的开发，在电信领域应用广泛，OTP（Open Telecom Platform）作为Erlang语言的一部分，包含了很多基于Erlang开发的中间件及工具库，安装RabbitMQ需要安装Erlang&#x2F;OTP，并保持版本匹配，如下图：</p><p>RabbitMQ的下载地址：<a target="_blank" rel="noopener" href="http://www.rabbitmq.com/download.html">http://www.rabbitmq.com/download.html</a></p><p><img src="/breeze/ef8195d4/clip_image011.jpg" alt="img"></p><p>本项目使用Erlang&#x2F;OTP 20.3版本和RabbitMQ3.7.3版本。</p><blockquote><p>RabbitMQ是使用Erlang语言开发的，要使用RabbitMQ就必须先安装Erlang语言。</p></blockquote><h4 id="1）下载erlang"><a href="#1）下载erlang" class="headerlink" title="1）下载erlang"></a>1）下载erlang</h4><p>地址:<a target="_blank" rel="noopener" href="http://erlang.org/download/otp_win64_20.3.exe">http://erlang.org/download/otp_win64_20.3.exe</a> 或去提供的软件包中找到 otp_win64_20.3.exe，以管理员方式运行此文件，安装。</p><p>erlang安装完成需要配置erlang环境变量：</p><p>ERLANG_HOME&#x3D;D:\Program Files\erl9.3</p><p>在path中添加：%ERLANG_HOME%\bin</p><p>测试是否安装成功：erl -v</p><h4 id="2）安装RabbitMQ"><a href="#2）安装RabbitMQ" class="headerlink" title="2）安装RabbitMQ"></a>2）安装RabbitMQ</h4><p>地址：<a target="_blank" rel="noopener" href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3">https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3</a> 或去提供的软件包中找到 rabbitmq-server-3.7.3.exe，以管理员方式运行此文件，安装。</p><h4 id="3）启动RabbitMQ"><a href="#3）启动RabbitMQ" class="headerlink" title="3）启动RabbitMQ"></a>3）启动RabbitMQ</h4><p>​	安装成功会自动创建RabbitMQ服务并且启动</p><p>​	从开始菜单启动RabbitMQ 完成在开始菜单找到RabbitMQ的菜单：</p><p>​	服务启动或停止就ok了</p><p>​ RabbitMQ Service-install :安装服务 RabbitMQ Service-remove 删除服务 RabbitMQ Service-start 启动 RabbitMQ Service-stop 停止</p><p>如果没有开始菜单则进入安装目录下sbin目录手动启动：</p><p><img src="/breeze/ef8195d4/clip_image013.jpg" alt="img"></p><p>安装并运行服务</p><p>rabbitmq-service.bat install 安装服务</p><p>rabbitmq-service.bat stop 停止服务</p><p>rabbitmq-service.bat start 启动服务</p><h4 id="4）安装管理插件"><a href="#4）安装管理插件" class="headerlink" title="4）安装管理插件"></a>4）安装管理插件</h4><p>安装rabbitMQ的管理插件，方便在浏览器端管理RabbitMQ ,进入到Rabbit的sbin目录，使用cmd执行命令： rabbitmq-plugins.bat enable rabbitmq_management ， 安装成功后重新RabbitMQ</p><p><img src="/breeze/ef8195d4/clip_image015.jpg" alt="img"></p><h4 id="5）登录RabbitMQ"><a href="#5）登录RabbitMQ" class="headerlink" title="5）登录RabbitMQ"></a>5）登录RabbitMQ</h4><p>进入浏览器，输入：<a target="_blank" rel="noopener" href="http://localhost:15672/">http://localhost:15672</a> ,初始账号和密码：guest&#x2F;guest</p><p><img src="/breeze/ef8195d4/clip_image017.jpg" alt="img"></p><p>rabbitmq的端口号:</p><p>​	15672 浏览器访问的端口</p><p>​	5672	代码连接的端口</p><p>注意：</p><ol><li>如果安装路径有中文，或者系统登录用户是中文账户，启动RabbitMQ会闪退，需要修改MQ的配置</li></ol><p>解决方案：<a target="_blank" rel="noopener" href="https://blog.csdn.net/leoma2012/article/details/97636859">https://blog.csdn.net/leoma2012/article/details/97636859</a></p><ol start="2"><li><p>安装erlang和rabbitMQ以管理员身份运行。</p></li><li><p>当卸载重新安装时会出现RabbitMQ服务注册失败，此时需要进入注册表清理erlang 搜索RabbitMQ、ErlSrv，将对应的项全部删除。</p></li></ol><h2 id="三-RabbitMQ的工作原理"><a href="#三-RabbitMQ的工作原理" class="headerlink" title="三. RabbitMQ的工作原理"></a>三. RabbitMQ的工作原理</h2><p><img src="/breeze/ef8195d4/clip_image019.jpg" alt="img"></p><h3 id="1-组成部分说明如下："><a href="#1-组成部分说明如下：" class="headerlink" title="1. 组成部分说明如下："></a>1. 组成部分说明如下：</h3><p>Broker：消息队列服务进程，此进程包括两个部分：Exchange和Queue。</p><p>Exchange：消息队列交换机，按一定的规则将消息路由转发到某个队列和某些对了，对消息进行过虑。</p><p>Queue：消息队列，存储消息的队列，消息到达队列并转发给指定的消费方。</p><p>Producer：消息生产者，即生产方客户端，生产方客户端将消息发送到MQ。</p><p>Consumer：消息消费者，即消费方客户端，接收MQ转发的消息。</p><h3 id="2-消息发布接收流程："><a href="#2-消息发布接收流程：" class="headerlink" title="2. 消息发布接收流程："></a>2. 消息发布接收流程：</h3><p>1.发送消息</p><ul><li><p>生产者和Broker建立TCP连接。</p></li><li><p>生产者和Broker建立通道。</p></li><li><p>生产者通过通道消息发送给Broker，由Exchange将消息进行转发。</p></li><li><p>Exchange将消息转发到指定的Queue（队列）</p></li></ul><p>2.接收消息</p><ul><li><p>消费者和Broker建立TCP连接</p></li><li><p>消费者和Broker建立通道</p></li><li><p>消费者监听指定的Queue（队列）</p></li><li><p>当有消息到达Queue时Broker默认将消息推送给消费者。</p></li><li><p>消费者接收到消息处理自己的业务逻辑。</p></li></ul><h2 id="四-RabbitMQ-常见模型-重点"><a href="#四-RabbitMQ-常见模型-重点" class="headerlink" title="四. RabbitMQ 常见模型 - 重点"></a>四. RabbitMQ 常见模型 - 重点</h2><p>rabbitMQ提供了6种消息模型，但是第6种其实是RPC（远程调用），并不是MQ，因此不予学习。那么也就剩下5种。但是其实3、4、5这三种都属于订阅模型，只不过进行路由的方式不同。</p><p><img src="/breeze/ef8195d4/clip_image021.jpg" alt="img"></p><h3 id="1-Helloworld-基本消息模型"><a href="#1-Helloworld-基本消息模型" class="headerlink" title="1. Helloworld-基本消息模型"></a>1. Helloworld-基本消息模型</h3><p><img src="/breeze/ef8195d4/clip_image023.jpg" alt="img"></p><p>一对一</p><h4 id="1-1-搭建环境"><a href="#1-1-搭建环境" class="headerlink" title="1.1. 搭建环境"></a>1.1. 搭建环境</h4><p>创建maven工程 test-rabbitmq，加入RabbitMQ java client的依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.rabbitmq/amqp-client --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--和springboot2.2.5对应--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-2-连接工具"><a href="#1-2-连接工具" class="headerlink" title="1.2. 连接工具"></a>1.2. 连接工具</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConnectionUtil</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建立与RabbitMQ的连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//定义连接工厂</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">//设置服务地址</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">        <span class="comment">//端口</span></span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        <span class="comment">//设置账号信息，用户名、密码、vhost</span></span><br><span class="line">        factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="comment">// 通过工程获取连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>管理端的端口是15672，但是我们代码端口是5672</p><h4 id="1-3-生产者"><a href="#1-3-生产者" class="headerlink" title="1.3. 生产者"></a>1.3. 生产者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._01_base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer01</span> &#123;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE</span> <span class="operator">=</span> <span class="string">&quot;helloworld&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取连接</span></span><br><span class="line">            connection = ConnectionUtil.getConnection();</span><br><span class="line">            <span class="comment">//创建与Exchange的通道，每个连接可以创建多个通道，每个通道代表一个会话任务</span></span><br><span class="line">            channel = connection.createChannel();</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 声明队列，如果Rabbit中没有此队列将自动创建</span></span><br><span class="line"><span class="comment">             * param1:队列名称</span></span><br><span class="line"><span class="comment">             * param2:是否持久化</span></span><br><span class="line"><span class="comment">             * param3:队列是否独占此连接</span></span><br><span class="line"><span class="comment">             * param4:队列不再使用时是否自动删除此队列</span></span><br><span class="line"><span class="comment">             * param5:队列参数</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.queueDeclare(QUEUE, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;helloworld小明&quot;</span> + System.currentTimeMillis();</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 消息发布方法</span></span><br><span class="line"><span class="comment">             * param1：Exchange的名称，如果没有指定，则使用Default Exchange</span></span><br><span class="line"><span class="comment">             * param2:routingKey,消息的路由Key，是用于Exchange（交换机）将消息转发到指定的消息队列</span></span><br><span class="line"><span class="comment">             * param3:消息包含的属性</span></span><br><span class="line"><span class="comment">             * param4：消息体</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 这里没有指定交换机，消息将发送给默认交换机，每个队列也会绑定那个默认的交换机，但是不能显</span></span><br><span class="line"><span class="comment">             示绑定或解除绑定</span></span><br><span class="line"><span class="comment">             * 默认的交换机，routingKey等于队列名称</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>, QUEUE, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;Send Message is:&#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="literal">null</span>) &#123;</span><br><span class="line">                channel.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动后管理工具查看： <img src="/breeze/ef8195d4/clip_image025.jpg" alt="img"></p><p>点击队列名称，进入详情页，可以查看消息：</p><p><img src="/breeze/ef8195d4/clip_image027.jpg" alt="img"></p><h4 id="1-4-消费者"><a href="#1-4-消费者" class="headerlink" title="1.4. 消费者"></a>1.4. 消费者</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._01_base;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE</span> <span class="operator">=</span> <span class="string">&quot;helloworld&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">//定义消费方法</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 消费者接收消息调用此方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> consumerTag 消费者的标签，在channel.basicConsume()去指定</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> envelope 消息包的内容，可从中获取消息id，消息routingkey，交换机，消息和重传标志</span></span><br><span class="line"><span class="comment">            (收到消息失败后是否需要重新发送)</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> properties</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag,</span></span><br><span class="line"><span class="params">                                       Envelope envelope,</span></span><br><span class="line"><span class="params">                                       AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span></span><br><span class="line">                    <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">//交换机</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">exchange</span> <span class="operator">=</span> envelope.getExchange();</span><br><span class="line">                <span class="comment">//路由key</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> envelope.getRoutingKey();</span><br><span class="line">                <span class="comment">//消息id</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> envelope.getDeliveryTag();</span><br><span class="line">                <span class="comment">//消息内容</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;receive message..&quot;</span> + msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 监听队列String queue, boolean autoAck,Consumer callback</span></span><br><span class="line"><span class="comment">         * 参数明细</span></span><br><span class="line"><span class="comment">         * 1、队列名称</span></span><br><span class="line"><span class="comment">         * 2、是否自动回复，设置为true为表示消息接收到自动向mq回复接收到了，mq接收到回复会删除消息，设置</span></span><br><span class="line"><span class="comment">         为false则需要手动回复</span></span><br><span class="line"><span class="comment">         * 3、消费消息的方法，消费者接收到消息后调用此方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicConsume(QUEUE, <span class="literal">true</span>, consumer);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/breeze/ef8195d4/clip_image029.jpg" alt="img"></p><p>​	我们发现，消费者已经获取了消息，但是程序没有停止，一直在监听队列中是否有新的消息。一旦有新的消息进入队列，就会立即打印.</p><h4 id="1-5-消息确认机制（ACK）超级重要"><a href="#1-5-消息确认机制（ACK）超级重要" class="headerlink" title="1.5. 消息确认机制（ACK）超级重要"></a>1.5. 消息确认机制（ACK）超级重要</h4><p>​	通过刚才的案例可以看出，消息一旦被消费者接收，队列中的消息就会被删除。那么问题来了：RabbitMQ怎么知道消息被接收了呢？</p><p>​	如果消费者领取消息后，还没执行操作就挂掉了呢？或者抛出了异常？消息消费失败，但是RabbitMQ*<em>无从得知，这样消息就丢失了！</em></p><p>​	因此，RabbitMQ有一个ACK机制。当消费者获取消息后，会向RabbitMQ发送回执ACK，告知消息已经被接收。不过这种回执ACK分两种情况：</p><ul><li><p>自动ACK：消息一旦被接收，消费者自动发送ACK</p></li><li><p>手动ACK：消息接收后，不会发送ACK，需要手动调用</p></li></ul><p>大家觉得哪种更好呢？这需要看消息的重要性：</p><p>​	如果消息不太重要，丢失也没有影响，那么自动ACK会比较方便</p><p>​	如果消息非常重要，不容丢失。那么最好在消费完成后手动ACK，否则接收消息后就自动ACK，RabbitMQ就会把消息从队列中删除。如果此时消费者宕机，那么消息就丢失了。</p><p>我们之前的测试都是自动ACK的，如果要手动ACK，需要改动我们的代码：</p><h6 id="1-5-1-自动确认存在问题"><a href="#1-5-1-自动确认存在问题" class="headerlink" title="1.5.1. 自动确认存在问题"></a>1.5.1. 自动确认存在问题</h6><p>修改消费者，添加异常，如下：</p><p><img src="/breeze/ef8195d4/clip_image031.jpg" alt="img"></p><p>生产者不做任何修改，直接运行，消息发送成功：</p><p><img src="/breeze/ef8195d4/clip_image033.jpg" alt="img"></p><p>运行消费者，程序抛出异常。但是消息依然被消费</p><p><img src="/breeze/ef8195d4/clip_image035.jpg" alt="img"></p><p><img src="/breeze/ef8195d4/clip_image037.jpg" alt="img"></p><h6 id="1-5-2-手动确认实现"><a href="#1-5-2-手动确认实现" class="headerlink" title="1.5.2. 手动确认实现"></a>1.5.2. 手动确认实现</h6><p>修改消费者，把自动改成手动（去掉之前制造的异常）</p><p><img src="/breeze/ef8195d4/clip_image039.jpg" alt="img"></p><p>生产者不变，再次运行：</p><p><img src="/breeze/ef8195d4/clip_image041.jpg" alt="img"></p><p><img src="/breeze/ef8195d4/clip_image043.jpg" alt="img"></p><p>这是因为虽然我们设置了手动ACK，但是代码中并没有进行消息确认！所以消息并未被真正消费掉。</p><p>当我们关掉这个消费者，消息的状态再次称为Ready</p><p><img src="/breeze/ef8195d4/clip_image045.jpg" alt="img"></p><p><img src="/breeze/ef8195d4/clip_image047.jpg" alt="img"></p><h4 id="1-6-小结"><a href="#1-6-小结" class="headerlink" title="1.6. 小结"></a>1.6. 小结</h4><p>发送端操作流程</p><p>1）创建连接</p><p>2）创建通道</p><p>3）声明队列</p><p>4）发送消息</p><p>接收端</p><p>1）创建连接</p><p>2）创建通道</p><p>3）声明队列</p><p>4）监听队列</p><p>5）接收消息</p><p>6）ack回复</p><h3 id="2-Work-queues"><a href="#2-Work-queues" class="headerlink" title="2. Work queues"></a>2. Work queues</h3><p><img src="/breeze/ef8195d4/clip_image049.jpg" alt="img"></p><p>work queues与入门程序相比，多了一个消费端，两个消费端共同消费同一个队列中的消息。</p><p>应用场景：对于任务过重或任务较多情况使用工作队列可以提高任务处理的速度。</p><p>测试：</p><ul><li><p>使用入门程序，启动多个消费者。</p></li><li><p>生产者发送多个消息。</p></li></ul><p>结果：</p><ul><li><p>一条消息只会被一个消费者接收；</p></li><li><p>rabbit采用轮询的方式将消息是平均发送给消费者的；</p></li><li><p>消费者在处理完某条消息后，才会收到下一条消息。</p></li></ul><p>工作队列，又称任务队列。主要思想就是避免执行资源密集型任务时，必须等待它执行完成。相反我们稍后完成任务，我们将任务封装为消息并将其发送到队列。 在后台运行的工作进程将获取任务并最终执行作业。<em>当你运行许多工人时，任务将在他们之间共享，但是一个消息只能被一个消费者获取。</em></p><p>这个概念在Web应用程序中特别有用，因为在短的HTTP请求窗口中无法处理复杂的任务。</p><p>接下来我们来模拟这个流程：</p><p>P：生产者：任务的发布者</p><p>C1：消费者，领取任务并且完成任务，假设完成速度较快</p><p>C2：消费者：领取任务并完成任务，假设完成速度慢</p><h4 id="2-1-生产者"><a href="#2-1-生产者" class="headerlink" title="2.1.  生产者"></a>2.1. 生产者</h4><p>省略…</p><h4 id="2-2-消费者1"><a href="#2-2-消费者1" class="headerlink" title="2.2.  消费者1"></a>2.2. 消费者1</h4><p>省略</p><h4 id="2-3-消费者2"><a href="#2-3-消费者2" class="headerlink" title="2.3.  消费者2"></a>2.3. 消费者2</h4><p>消费者 C1 在消费逻辑中睡眠一会儿，代表工作能力慢</p><p><img src="/breeze/ef8195d4/clip_image051.jpg" alt="img"></p><h4 id="2-4-测试"><a href="#2-4-测试" class="headerlink" title="2.4.  测试"></a>2.4. 测试</h4><p>发送50条消息，2个消费者各自收到25条消息，实现了任务的分发，但是消费者C2处理任务的速度会慢很多，最终2个消费者总共处理完所有任务的速度就更慢了，这个是因为C2有睡眠操作，而这种work-queue模型是吧任务平均分配给所有的消费者，就会到账C2那边堆积了大量的消息，从而整体处理速度比较慢。</p><p><img src="/breeze/ef8195d4/clip_image053.jpg" alt="img"></p><h4 id="2-5-能者多劳"><a href="#2-5-能者多劳" class="headerlink" title="2.5.  能者多劳"></a>2.5. 能者多劳</h4><p>刚才的实现有问题吗？显然不合理</p><p>- 消费者1比消费者2的效率要高，一次任务的耗时较短</p><p>- 然而两人最终消费的消息数量是一样的</p><p>- 消费者1大量时间处于空闲状态，消费者2一直忙碌</p><p>现在的状态属于是把任务平均分配，正确的做法应该是消费越快的人，消费的越多。怎么实现呢？</p><p>我们可以使用basicQos方法和<em>prefetchCount &#x3D; 1</em>设置，简单理解就是一个消费者同时只能处理一个消息。 这告诉RabbitMQ一次不要向工作人员发送多于一条消息。 或者换句话说，不要向工作人员发送新消息，直到它处理并确认了前一个消息。 相反，它会将其分派给不是仍然忙碌的下一个工作人员。</p><p>要将应答模式改为手动应答</p><p><img src="/breeze/ef8195d4/clip_image055.jpg" alt="img"></p><p>测试结果</p><p><img src="/breeze/ef8195d4/clip_image057.jpg" alt="img">这里可以看到，工作速度快的消费者处理了更多的消息</p><h3 id="3-交换机分类"><a href="#3-交换机分类" class="headerlink" title="3. 交换机分类"></a>3. 交换机分类</h3><h4 id="3-1-概述订阅模型"><a href="#3-1-概述订阅模型" class="headerlink" title="3.1.  概述订阅模型"></a>3.1. 概述订阅模型</h4><p>在之前的模式中，我们创建了一个工作队列。 工作队列背后的假设是：每个任务只被传递给一个工作人员。 在这一部分，我们将做一些完全不同的事情 - 我们将会传递一个信息给多个消费者。 这种模式被称为“发布&#x2F;订阅”。</p><p>订阅模型示意图：</p><p><img src="/breeze/ef8195d4/clip_image059.jpg" alt="img"></p><p>解读：</p><p>1、1个生产者，多个消费者</p><p>2、每一个消费者都有自己的一个队列</p><p>3、生产者没有将消息直接发送到队列，而是发送到了交换机</p><p>4、每个队列都要绑定到交换机</p><p>5、生产者发送的消息，经过交换机到达队列，实现一个消息被多个消费者获取的目的</p><p><em>X<strong>（Exchanges</strong>）：交换机一方面：接收生产者发送的消息。另一方面：知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange**的类型。</em></p><h4 id="3-2-分类"><a href="#3-2-分类" class="headerlink" title="3.2.  分类"></a>3.2. 分类</h4><p>Exchange类型有以下几种：</p><ul><li><p>Fanout：广播，将消息交给所有绑定到交换机的队列 all</p></li><li><p>Direct：定向，把消息交给符合指定routing key的队列一堆或一个</p><p><em>Emploee_add</em></p><p><em>Employee_del</em></p><p><em>Employee_xxx</em></p></li></ul><p><em>…..</em></p><p><em>100</em></p><ul><li><p>Topic：通配符，把消息交给符合routing pattern（路由模式）的队列* <em>一堆或者一个</em></p><p>Employee_*</p></li></ul><p>我们这里先学习 Fanout：即广播模式</p><p><em>Exchange<strong>（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与Exchange</strong>绑定，或者没有符合路由规则的队列，那么消息会丢失！</em></p><h4 id="3-3-订阅模型-FANOUT-广播模式"><a href="#3-3-订阅模型-FANOUT-广播模式" class="headerlink" title="3.3. 订阅模型-FANOUT(广播模式)"></a>3.3. 订阅模型-FANOUT(广播模式)</h4><h5 id="3-3-1-工作模式"><a href="#3-3-1-工作模式" class="headerlink" title="3.3.1.  工作模式"></a>3.3.1. 工作模式</h5><p><img src="/breeze/ef8195d4/clip_image061.jpg" alt="img"></p><p>发布订阅模式：</p><p>在广播模式下，消息发送流程是这样的：</p><p>1） 可以有多个消费者</p><p>2） 每个消费者有自己的queue（队列）</p><p>3） 每个队列都要绑定到Exchange（交换机）</p><p>4） 生产者发送的消息，只能发送到交换机，交换机来决定要发给哪个队列，生产者无法决定。</p><p>5） 交换机把消息发送给绑定过的所有队列</p><p>6） 队列的消费者都能拿到消息。实现一条消息被多个消费者消费</p><h5 id="3-3-2-生产者"><a href="#3-3-2-生产者" class="headerlink" title="3.3.2.  生产者"></a>3.3.2. 生产者</h5><p>两个变化：</p><p>1）声明Exchange，不再声明Queue</p><p>2）发送消息到Exchange，不再发送到Queue</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._02_fanout;</span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Send</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fanout_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 声明exchange，指定类型为fanout</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 消息内容</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello everyone&quot;</span>;</span><br><span class="line">        <span class="comment">// 发布消息到Exchange</span></span><br><span class="line"></span><br><span class="line">        channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;&quot;</span>, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot; [生产者] Sent &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-3-3-消费者1"><a href="#3-3-3-消费者1" class="headerlink" title="3.3.3.  消费者1"></a>3.3.3. 消费者1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._02_fanout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Recv</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fanout_exchange_queue_1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fanout_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定队列到交换机</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义队列的消费者</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// body 即消息体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                System.out.println(<span class="string">&quot; [消费者1] received : &quot;</span> + msg + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 监听队列，自动返回完成</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-3-4-消费者2"><a href="#3-3-4-消费者2" class="headerlink" title="3.3.4.  消费者2"></a>3.3.4. 消费者2</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._02_fanout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Recv2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fanout_exchange_queue_2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;fanout_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定队列到交换机</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 定义队列的消费者</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// body 即消息体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                System.out.println(<span class="string">&quot; [消费者2] received : &quot;</span> + msg + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 监听队列，手动返回完成</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-3-5-测试"><a href="#3-3-5-测试" class="headerlink" title="3.3.5.  测试"></a>3.3.5. 测试</h5><p><img src="/breeze/ef8195d4/clip_image063.jpg" alt="img"></p><p>注意：先启动一下生产者,来创建交换机</p><p>在哪儿用?</p><ul><li><p>注册成功发送邮件和短信</p></li><li><p>消息推送</p></li></ul><h4 id="3-3-订阅模型-Direct"><a href="#3-3-订阅模型-Direct" class="headerlink" title="3.3. 订阅模型-Direct"></a>3.3. 订阅模型-Direct</h4><h5 id="3-3-1-工作模式-1"><a href="#3-3-1-工作模式-1" class="headerlink" title="3.3.1.  工作模式"></a>3.3.1. 工作模式</h5><p>这种模式是有选择性的接收消息，在订阅模式中，生产者发布消息，所有消费者都可以获取所有消息。</p><p>在路由模式中，我们将添加一个功能 - 我们将只能订阅一部分消息。 例如，我们只能将重要的错误消息引导到日志文件（以节省磁盘空间），同时仍然能够在控制台上打印所有日志消息。</p><p>但是，在某些场景下，我们希望不同的消息被不同的队列消费。这时就要用到Direct类型的Exchange。</p><p>在Direct模型下，队列与交换机的绑定，不能是任意绑定了，而是要指定一个RoutingKey（路由key）</p><p>消息的发送方在向Exchange发送消息时，也必须指定消息的routing key。</p><p><img src="/breeze/ef8195d4/clip_image065.jpg" alt="img"></p><p>² P：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。</p><p>² X：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列</p><p>² C1：消费者，其所在队列指定了需要routing key 为 error 的消息</p><p>² C2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息</p><h5 id="3-3-2-生产者-1"><a href="#3-3-2-生产者-1" class="headerlink" title="3.3.2.  生产者"></a>3.3.2. 生产者</h5><p>此处我们模拟商品的增删改，发送消息的RoutingKey分别是：insert、update、delete</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._03_direct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Send</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明exchange，指定类型为direct</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="comment">// 消息内容</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;商品新增了， id = 1001&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息，并且指定routing key 为：insert ,代表新增商品</span></span><br><span class="line">        channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;insert&quot;</span>, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot; [商品服务：] Sent &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-3-3-消费者1-1"><a href="#3-3-3-消费者1-1" class="headerlink" title="3.3.3.  消费者1"></a>3.3.3. 消费者1</h5><p>我们此处假设消费者1只接收两种类型的消息：更新商品和删除商品。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._03_direct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Recv</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange_queue_1&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 绑定队列到交换机，同时指定需要订阅的routing key。假设此处需要update和delete消息</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;update&quot;</span>);</span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;delete&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义队列的消费者</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// body 即消息体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                System.out.println(<span class="string">&quot; [消费者1] received : &quot;</span> + msg + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 监听队列，自动ACK</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-3-4-消费者2-1"><a href="#3-3-4-消费者2-1" class="headerlink" title="3.3.4.  消费者2"></a>3.3.4. 消费者2</h5><p>我们此处假设消费者2接收所有类型的消息：新增商品，更新商品和删除商品。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._03_direct;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Recv2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange_queue_2&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;direct_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定队列到交换机，同时指定需要订阅的routing key。订阅 insert、update、delete</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;insert&quot;</span>);</span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;update&quot;</span>);</span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;delete&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义队列的消费者</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// body 即消息体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                System.out.println(<span class="string">&quot; [消费者2] received : &quot;</span> + msg + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 监听队列，自动ACK</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-3-5-测试-1"><a href="#3-3-5-测试-1" class="headerlink" title="3.3.5.  测试"></a>3.3.5. 测试</h5><p>我们分别发送增、删、改的RoutingKey，发现结果：</p><p><img src="/breeze/ef8195d4/clip_image067.jpg" alt="img"></p><p>我们项目中就要用,特定站点静态页面,只能发到特定站点服务器</p><p>sendMsg routingKey:sitesn rev:绑定到交换机要以sitesn来作为routingkey</p><h4 id="3-4-订阅模型-Topic"><a href="#3-4-订阅模型-Topic" class="headerlink" title="3.4. 订阅模型-Topic"></a>3.4. 订阅模型-Topic</h4><h5 id="3-4-1-工作模式"><a href="#3-4-1-工作模式" class="headerlink" title="3.4.1.  工作模式"></a>3.4.1. 工作模式</h5><p>Topic<strong>类型的Exchange</strong>与Direct<strong>相比，都是可以根据RoutingKey</strong>把消息路由到不同的队列。只不过Topic<strong>类型Exchange</strong>可以让队列在绑定Routing key* <em>的时候使用通配符！</em></p><p>Routingkey 一般都是有一个或多个单词组成，多个单词之间以<em>”.”</em>分割，例如： goods.insert pet.insert *.insert</p><p>通配符规则：</p><p>​	#：匹配一个或多个词</p><p>​	*：匹配不多不少恰好1个词</p><p>举例：</p><p>audit.#：能够匹配audit.irs.corporate 或者 audit.irs</p><p>audit.*：只能匹配audit.irs</p><p><img src="/breeze/ef8195d4/clip_image069.jpg" alt="img"></p><p>路由模式：</p><p>1、每个消费者监听自己的队列，并且设置带统配符的routingkey。</p><p>2、生产者将消息发给broker，由交换机根据routingkey来转发消息到指定的队列。</p><h5 id="3-4-2-生产者"><a href="#3-4-2-生产者" class="headerlink" title="3.4.2.  生产者"></a>3.4.2. 生产者</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._04_topic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Send</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明exchange，指定类型为topic</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, <span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">// 消息内容</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;新增商品 : id = 1001&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息，并且指定routing key 为：insert ,代表新增商品</span></span><br><span class="line">        channel.basicPublish(EXCHANGE_NAME, <span class="string">&quot;item.insert&quot;</span>, <span class="literal">null</span>, message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot; [商品服务：] Sent &#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        channel.close();</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-4-3-消费者1"><a href="#3-4-3-消费者1" class="headerlink" title="3.4.3.  消费者1"></a>3.4.3. 消费者1</h5><p>消费者1：我们此处假设消费者1只接收两种类型的消息：更新商品和删除商品</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._04_topic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Recv</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange_queue_1&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 绑定队列到交换机，同时指定需要订阅的routing key。需要 update、delete</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;item.update&quot;</span>);</span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;item.delete&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义队列的消费者</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// body 即消息体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                System.out.println(<span class="string">&quot; [消费者1] received : &quot;</span> + msg + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 监听队列，自动ACK</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-4-4-消费者2"><a href="#3-4-4-消费者2" class="headerlink" title="3.4.4.  消费者2"></a>3.4.4. 消费者2</h5><p>消费者2：我们此处假设消费者2接收所有类型的消息：新增商品，更新商品和删除商品。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm._04_topic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.util.ConnectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消费者2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Recv2</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange_queue_2&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;topic_exchange_test&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取到连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> ConnectionUtil.getConnection();</span><br><span class="line">        <span class="comment">// 获取通道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="comment">// 声明队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定队列到交换机，同时指定需要订阅的routing key。订阅 insert、update、delete</span></span><br><span class="line">        channel.queueBind(QUEUE_NAME, EXCHANGE_NAME, <span class="string">&quot;item.*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义队列的消费者</span></span><br><span class="line">        <span class="type">DefaultConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultConsumer</span>(channel) &#123;</span><br><span class="line">            <span class="comment">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class="line"><span class="params">                                       <span class="type">byte</span>[] body)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">// body 即消息体</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(body);</span><br><span class="line">                System.out.println(<span class="string">&quot; [消费者2] received : &quot;</span> + msg + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 监听队列，自动ACK</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME, <span class="literal">true</span>, consumer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-4-5-测试"><a href="#3-4-5-测试" class="headerlink" title="3.4.5.  测试"></a>3.4.5. 测试</h5><h4 id="3-5-Header模式"><a href="#3-5-Header模式" class="headerlink" title="3.5. Header模式"></a>3.5. Header模式</h4><p>header模式与routing不同的地方在于，header模式取消routingkey，使用header中的 key&#x2F;value（键值对）匹配 队列。</p><p>案例： 根据用户的通知设置去通知用户，设置接收Email的用户只接收Email，设置接收sms的用户只接收sms，设置两种 通知类型都接收的则两种通知都有效。</p><h5 id="3-5-1-生产者"><a href="#3-5-1-生产者" class="headerlink" title="3.5.1.  生产者"></a>3.5.1. 生产者</h5><p>队列与交换机绑定的代码与之前不同，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;email inform to user&quot;</span>+i; </span><br><span class="line">Map&lt;String,Object&gt; headers = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String, Object&gt;(); </span><br><span class="line">headers.put(<span class="string">&quot;inform_type&quot;</span>, <span class="string">&quot;email&quot;</span>);<span class="comment">//匹配email通知消费者绑定的header </span></span><br><span class="line">AMQP.BasicProperties.<span class="type">Builder</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties.Builder(); </span><br><span class="line">properties.headers(headers); </span><br><span class="line"><span class="comment">//Email通知 </span></span><br><span class="line">channel.basicPublish(EXCHANGE_HEADERS_INFORM, <span class="string">&quot;&quot;</span>, properties.build(), message.getBytes()); </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-5-2-消费者"><a href="#3-5-2-消费者" class="headerlink" title="3.5.2.  消费者"></a>3.5.2. 消费者</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">channel.exchangeDeclare(EXCHANGE_HEADERS_INFORM, BuiltinExchangeType.HEADERS); </span><br><span class="line">Map&lt;String, Object&gt; headers_email = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String, Object&gt;(); </span><br><span class="line">headers_email.put(<span class="string">&quot;inform_type&quot;</span>, <span class="string">&quot;email&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="comment">//交换机和队列绑定 </span></span><br><span class="line">channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_HEADERS_INFORM,<span class="string">&quot;&quot;</span>,headers_email); </span><br><span class="line"><span class="comment">//指定消费队列 </span></span><br><span class="line">channel.basicConsume(QUEUE_INFORM_EMAIL, <span class="literal">true</span>, consumer); </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-5-3-测试"><a href="#3-5-3-测试" class="headerlink" title="3.5.3.  测试"></a>3.5.3. 测试</h5><p><img src="/breeze/ef8195d4/clip_image071.jpg" alt="img"></p><h4 id="3-6-RPC"><a href="#3-6-RPC" class="headerlink" title="3.6. RPC"></a>3.6. RPC</h4><p><img src="/breeze/ef8195d4/clip_image073.jpg" alt="img"></p><p>RPC即客户端远程调用服务端的方法 ，使用MQ可以实现RPC的异步调用，基于Direct交换机实现，流程如下：</p><p>1、客户端即是生产者就是消费者，向RPC请求队列发送RPC调用消息，同时监听RPC响应队列。</p><p>2、服务端监听RPC请求队列的消息，收到消息后执行服务端的方法，得到方法返回的结果</p><p>3、服务端将RPC方法 的结果发送到RPC响应队列</p><p>4、客户端（RPC调用方）监听RPC响应队列，接收到RPC调用结果。</p><h4 id="3-7-持久化-解决数据安全"><a href="#3-7-持久化-解决数据安全" class="headerlink" title="3.7. 持久化-解决数据安全"></a>3.7. 持久化-解决数据安全</h4><p>如何避免消息丢失？</p><p>1） 消费者的ACK机制。可以防止消费者丢失消息。-手动ack</p><p>2） 但是，如果在消费者消费之前，MQ就宕机了，消息就没了。-持久化</p><p>3） 因为网络问题，消息发送失败 -回调</p><p>4） 代码BUG，交换机或队列的routingkey找不到</p><p>是可以将消息进行持久化呢？要将消息持久化，前提是：队列、Exchange都持久化</p><h5 id="3-7-1-交换机持久化"><a href="#3-7-1-交换机持久化" class="headerlink" title="3.7.1.  交换机持久化"></a>3.7.1. 交换机持久化</h5><p><img src="/breeze/ef8195d4/clip_image075.jpg" alt="img"></p><h5 id="3-7-2-队列持久化"><a href="#3-7-2-队列持久化" class="headerlink" title="3.7.2.  队列持久化"></a>3.7.2. 队列持久化</h5><p><img src="/breeze/ef8195d4/clip_image077.jpg" alt="img"></p><h5 id="3-7-3-消息持久化"><a href="#3-7-3-消息持久化" class="headerlink" title="3.7.3.  消息持久化"></a>3.7.3. 消息持久化</h5><p><img src="/breeze/ef8195d4/clip_image079.jpg" alt="img"></p><h2 id="五-Springboot整合Rabbitmq"><a href="#五-Springboot整合Rabbitmq" class="headerlink" title="五.  Springboot整合Rabbitmq"></a>五. Springboot整合Rabbitmq</h2><h3 id="1-搭建boot环境"><a href="#1-搭建boot环境" class="headerlink" title="1. 搭建boot环境"></a>1. 搭建boot环境</h3><p>我们选择基于Spring-Rabbit去操作RabbitMQ</p><p><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-amqp">https://github.com/spring-projects/spring-amqp</a> 使用spring-boot-starter-amqp会自动添加spring-rabbit依赖，如下：</p><h3 id="2-pom"><a href="#2-pom" class="headerlink" title="2. pom"></a>2. pom</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spirngboot集成rabbitmq--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h3><h4 id="3-1-Yml"><a href="#3-1-Yml" class="headerlink" title="3.1.  Yml"></a>3.1. Yml</h4><p>配置连接rabbitmq的参数</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">44000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">test‐rabbitmq‐producer</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">guest</span></span><br><span class="line">    <span class="attr">virtualHost:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span> <span class="comment">#手动签收</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">publisher-confirms:</span> <span class="literal">true</span> <span class="comment">#消息发送到交换机回调</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span>  <span class="comment">#消息发送到队列失败回调</span></span><br><span class="line">    <span class="attr">template:</span> </span><br><span class="line">    	<span class="attr">mandatory:</span> <span class="literal">true</span> <span class="comment"># 必须设置成true 消息路由失败通知监听者，而不是将消息丢弃 </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-2-配置类"><a href="#3-2-配置类" class="headerlink" title="3.2.  配置类"></a>3.2. 配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitmqConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_INFORM_EMAIL</span> <span class="operator">=</span> <span class="string">&quot;queue_inform_email&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">QUEUE_INFORM_SMS</span> <span class="operator">=</span> <span class="string">&quot;queue_inform_sms&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXCHANGE_TOPICS_INFORM</span> <span class="operator">=</span> <span class="string">&quot;exchange_topics_inform&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 交换机配置</span></span><br><span class="line"><span class="comment">     * ExchangeBuilder提供了fanout、direct、topic、header交换机类型的配置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the exchange</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(EXCHANGE_TOPICS_INFORM)</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">EXCHANGE_TOPICS_INFORM</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//durable(true)持久化，消息队列重启后交换机仍然存在</span></span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.topicExchange(EXCHANGE_TOPICS_INFORM).durable(<span class="literal">true</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明队列</span></span><br><span class="line">    <span class="meta">@Bean(QUEUE_INFORM_SMS)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">QUEUE_INFORM_SMS</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(QUEUE_INFORM_SMS,<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> queue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明队列</span></span><br><span class="line">    <span class="meta">@Bean(QUEUE_INFORM_EMAIL)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">QUEUE_INFORM_EMAIL</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Queue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(QUEUE_INFORM_EMAIL,<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> queue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * channel.queueBind(INFORM_QUEUE_SMS,&quot;inform_exchange_topic&quot;,&quot;inform.#.sms.#&quot;);</span></span><br><span class="line"><span class="comment">     * 绑定队列到交换机 .</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queue    the queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange the exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the binding</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">BINDING_QUEUE_INFORM_SMS</span><span class="params">(<span class="meta">@Qualifier(QUEUE_INFORM_SMS)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@Qualifier(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="string">&quot;inform.#.sms.#&quot;</span>).noargs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">BINDING_QUEUE_INFORM_EMAIL</span><span class="params">(<span class="meta">@Qualifier(QUEUE_INFORM_EMAIL)</span> Queue queue,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@Qualifier(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="string">&quot;inform.#.email.#&quot;</span>).noargs();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-3-入口类"><a href="#3-3-入口类" class="headerlink" title="3.3.  入口类"></a>3.3. 入口类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yaohuaipeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019/9/8-22:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(App.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-生产者"><a href="#4-生产者" class="headerlink" title="4. 生产者"></a>4. 生产者</h3><p>使用RabbitTemplate发送消息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.config.RabbitmqConfig;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest(classes = App.class)</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer05_topics_springboot</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendByTopics</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;sms email inform to user&quot;</span> + i;</span><br><span class="line">            rabbitTemplate.convertAndSend(RabbitmqConfig.EXCHANGE_TOPICS_INFORM, <span class="string">&quot;inform.sms.email&quot;</span>, message);</span><br><span class="line">            System.out.println(<span class="string">&quot;Send Message is:&#x27;&quot;</span> + message + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>设置失败回调</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">rabbitTemplate.setMandatory(<span class="literal">true</span>); <span class="comment">//发送失败，把消息返回给回调</span></span><br><span class="line"></span><br><span class="line">rabbitTemplate.setConfirmCallback((correlationData,ack,cause)-&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消息发送到交换机成功...&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消息发送到交换机失败...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;correlationData:&quot;</span>+correlationData);</span><br><span class="line">    System.out.println(<span class="string">&quot;ack:&quot;</span>+ack);</span><br><span class="line">    System.out.println(<span class="string">&quot;cause:&quot;</span>+cause);</span><br><span class="line">&#125;);</span><br><span class="line">rabbitTemplate.setReturnCallback((message,replyCode,replyText,exchange,routingKey)-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消息发送到队列失败...&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;message:&quot;</span>+message);</span><br><span class="line">    System.out.println(<span class="string">&quot;replyCode:&quot;</span>+replyCode);</span><br><span class="line">    System.out.println(<span class="string">&quot;replyText:&quot;</span>+replyText);</span><br><span class="line">    System.out.println(<span class="string">&quot;exchange:&quot;</span>+exchange);</span><br><span class="line">    System.out.println(<span class="string">&quot;routingKey:&quot;</span>+routingKey);</span><br><span class="line"><span class="keyword">if</span>(i &gt; <span class="number">0</span>)&#123; <span class="comment">//最大重试次数</span></span><br><span class="line">      System.out.println(<span class="string">&quot;再次发送...&quot;</span>);</span><br><span class="line">      rabbitTemplate.convertAndSend(</span><br><span class="line">            RabbitmqConfig.EXCHANGE_TOPICS_INFORM,   <span class="comment">//交换机</span></span><br><span class="line">            <span class="string">&quot;sms.xxxxxxxxxxx&quot;</span>,</span><br><span class="line">            message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-消费端"><a href="#5-消费端" class="headerlink" title="5. 消费端"></a>5. 消费端</h3><p>使用@RabbitListener注解监听队列。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mliutm.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.mliutm.config.RabbitmqConfig;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveHandler</span> &#123;</span><br><span class="line">    <span class="comment">//监听email队列</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &#123;RabbitmqConfig.QUEUE_INFORM_EMAIL&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive_email</span><span class="params">(String msg, Message message, Channel channel)</span> &#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//监听sms队列</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &#123;RabbitmqConfig.QUEUE_INFORM_SMS&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive_sms</span><span class="params">(String msg, Message message, Channel channel)</span> &#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="6-测试"><a href="#6-测试" class="headerlink" title="6. 测试"></a>6. 测试</h3><p><img src="/breeze/ef8195d4/clip_image081.jpg" alt="img"></p><h3 id="7-手动签收"><a href="#7-手动签收" class="headerlink" title="7. 手动签收"></a>7. 手动签收</h3><h4 id="7-1-修改签收模式"><a href="#7-1-修改签收模式" class="headerlink" title="7.1.  修改签收模式"></a>7.1. 修改签收模式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: rabbitmq</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    port: <span class="number">5672</span></span><br><span class="line">    username: guest</span><br><span class="line">    password: guest</span><br><span class="line">    virtualHost: /</span><br><span class="line">    listener:</span><br><span class="line">      simple:</span><br><span class="line">        acknowledge-mode: manual #手动签收</span><br><span class="line">        prefetch: <span class="number">1</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="7-2-触发签收"><a href="#7-2-触发签收" class="headerlink" title="7.2.  触发签收"></a>7.2. 触发签收</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消费短信</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = RabbitMQConfig.QUEUE_NAME_SMS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerSMS</span><span class="params">(String content, Message message, Channel channel)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">deliveryTag</span> <span class="operator">=</span> message.getMessageProperties().getDeliveryTag();</span><br><span class="line">    System.out.println(<span class="string">&quot;消息ID：&quot;</span>+deliveryTag);</span><br><span class="line">    System.out.println(<span class="string">&quot;短信收到消息：&quot;</span>+content);</span><br><span class="line">    channel.basicAck(deliveryTag , <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="六-总结"><a href="#六-总结" class="headerlink" title="六.  总结"></a>六. 总结</h2><h3 id="1-总结5种模式"><a href="#1-总结5种模式" class="headerlink" title="1. 总结5种模式"></a>1. 总结5种模式</h3><h4 id="1-1-HelloWorld"><a href="#1-1-HelloWorld" class="headerlink" title="1.1.  HelloWorld"></a>1.1. HelloWorld</h4><p>生产者：</p><ul><li><p>通过工具创建连接</p></li><li><p>通过连接创建通道</p></li><li><p>通过通道声明队列</p></li><li><p>准备消息</p></li><li><p>发布消息：使用默认交换机，指定队列名</p></li></ul><p>消费者</p><ul><li><p>通过工具创建连接</p></li><li><p>通过连接创建通道</p></li><li><p>通过通道声明队列</p></li><li><p>创建一个消息消费回调</p></li><li><p>接受消息：指定队列，签收模式（true,false），回调</p></li></ul><p>签收模式：</p><ul><li><p>自动签收</p></li><li><p>手动签收：消息消费成功之后，触发手动签收</p></li></ul><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel.basicAck(deliveryTag ,<span class="literal">false</span>);</span><br></pre></td></tr></table></figure><h4 id="1-2-WorkQueue"><a href="#1-2-WorkQueue" class="headerlink" title="1.2.  WorkQueue"></a>1.2. WorkQueue</h4><p>生产者：</p><ul><li>跟helloworld一样</li></ul><p>消费者：</p><ul><li>多个消费者，代码一模一样</li></ul><p>能者多劳 ：一个消费者处理一个消息</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">channel.<span class="keyword">basic</span>Q<span class="keyword">os</span>(<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">上面两种方式都是一个消息只能被一个消费者消费</span><br></pre></td></tr></table></figure><h4 id="1-3-Fanout广播"><a href="#1-3-Fanout广播" class="headerlink" title="1.3.  Fanout广播"></a>1.3. Fanout广播</h4><p>生产者</p><ul><li><p>创建交换机：类型是fanout</p></li><li><p>不创建队列</p></li><li><p>发送消息：指定交换机，不指定队列名</p></li></ul><p>消费者</p><ul><li><p>创建队列</p></li><li><p>把队列绑定到交换机：不需要指定队列名</p></li></ul><h4 id="1-4-Direct定向"><a href="#1-4-Direct定向" class="headerlink" title="1.4.  Direct定向"></a>1.4. Direct定向</h4><p>生产者：</p><ul><li><p>创建交换机：类型direct</p></li><li><p>不创建队列</p></li><li><p>发送消息：指定交换机，要指定队列名</p></li></ul><p>消费者：</p><ul><li><p>创建队列</p></li><li><p>把队列绑定到交换机：需要指定队列名</p></li></ul><h4 id="1-5-topoc通配符"><a href="#1-5-topoc通配符" class="headerlink" title="1.5.  topoc通配符"></a>1.5. topoc通配符</h4><p>生产者：</p><ul><li><p>创建交换机：类型topic</p></li><li><p>不创建队列</p></li><li><p>发送消息：指定交换机，要指定队列名（队列不适用通配符）</p></li></ul><p>消费者：</p><ul><li><p>创建队列</p></li><li><p>把队列绑定到交换机：需要指定队列名（队列可以用通配符）</p></li></ul><h3 id="2-重点"><a href="#2-重点" class="headerlink" title="2. 重点"></a>2. 重点</h3><ul><li><p>RabbitMQ安装</p></li><li><p>RabbitMQ常用模型</p></li><li><p>手动确认机制</p></li><li><p>消息持久化</p></li><li><p>课程发布消息推送</p></li></ul><h3 id="3-难点"><a href="#3-难点" class="headerlink" title="3. 难点"></a>3. 难点</h3><ul><li><p>RabbitMQ常用模型</p></li><li><p>消息推送</p></li></ul><h3 id="5-面试题"><a href="#5-面试题" class="headerlink" title="5. 面试题"></a>5. 面试题</h3><ul><li><p>什么情况下消息会丢失，如何防止消息丢失</p></li><li><p>你说4种消息模型，以及他们的区别</p></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mliutm.github.io">清风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mliutm.github.io/breeze/ef8195d4.html">https://mliutm.github.io/breeze/ef8195d4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mliutm.github.io" target="_blank">清风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><a class="post-meta__tags" href="/tags/RocketMQ/">RocketMQ</a></div><div class="post_share"><div class="social-share" data-image="/img/photo-1692708632140-ee01624d558d.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/breeze/2c94f9f4.html" title="ElasticSearch一文通关"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ElasticSearch一文通关</div></div></a></div><div class="next-post pull-right"><a href="/breeze/523a62b6.html" title="RocketMQ一文通关"><img class="cover" src="/img/photo-1688475747590-d0db5e2412cb.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">RocketMQ一文通关</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/breeze/523a62b6.html" title="RocketMQ一文通关"><img class="cover" src="/img/photo-1688475747590-d0db5e2412cb.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-06</div><div class="title">RocketMQ一文通关</div></div></a></div><div><a href="/breeze/2c94f9f4.html" title="ElasticSearch一文通关"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-06</div><div class="title">ElasticSearch一文通关</div></div></a></div><div><a href="/breeze/ddc45bf.html" title="RabbitMQ部署指南"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">RabbitMQ部署指南</div></div></a></div><div><a href="/breeze/3204d47c.html" title="SpringCloud-RabbitMQ部署指南"><img class="cover" src="/img/photo-1688475747590-d0db5e2412cb.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SpringCloud-RabbitMQ部署指南</div></div></a></div><div><a href="/breeze/6d5c94a5.html" title="SpringCloud-RabbitMQ-SpringAMQP（三）"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SpringCloud-RabbitMQ-SpringAMQP（三）</div></div></a></div><div><a href="/breeze/84124361.html" title="SpringCloud-RabbitMQ高级篇（九）"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-21</div><div class="title">SpringCloud-RabbitMQ高级篇（九）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">清风</div><div class="author-info__description">清风洒六合，邈然不可攀</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">169</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:huangpan0805@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Rabbitmq%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-text">Rabbitmq消息队列</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-RabbitMQ%E8%AE%A4%E8%AF%86"><span class="toc-text">一. RabbitMQ认识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-RabbitMQ%E4%BB%8B%E7%BB%8D"><span class="toc-text">1. RabbitMQ介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1.1. 是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E7%89%B9%E7%82%B9-%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">1.2. 特点 - 消息队列的特点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-%E6%8F%90%E9%AB%98%E7%B3%BB%E7%BB%9F%E5%93%8D%E5%BA%94%E9%80%9F%E5%BA%A6"><span class="toc-text">1.2.1. 提高系统响应速度</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-2-%E6%8F%90%E9%AB%98%E7%B3%BB%E7%BB%9F%E7%A8%B3%E5%AE%9A%E6%80%A7"><span class="toc-text">1.2.2. 提高系统稳定性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-3-%E6%9C%8D%E5%8A%A1%E8%B0%83%E7%94%A8%E5%BC%82%E6%AD%A5%E5%8C%96"><span class="toc-text">1.2.3. 服务调用异步化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-4-%E6%9C%8D%E5%8A%A1%E8%A7%A3%E8%80%A6"><span class="toc-text">1.2.4. 服务解耦</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-5-%E6%8E%92%E5%BA%8F%E4%BF%9D%E8%AF%81-FIFO"><span class="toc-text">1.2.5. 排序保证 FIFO</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-6-%E6%B6%88%E9%99%A4%E5%B3%B0%E5%80%BC"><span class="toc-text">1.2.6. 消除峰值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%B8%82%E5%9C%BA%E4%B8%8A%E8%BF%98%E6%9C%89%E5%93%AA%E4%BA%9B%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-text">1.3. 市场上还有哪些消息队列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8RabbitMQ%E5%91%A2%EF%BC%9F"><span class="toc-text">1.4. 为什么使用RabbitMQ呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-AMQP%E5%8D%8F%E8%AE%AE"><span class="toc-text">1.5. AMQP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5-1-AMQP%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">1.5.1. AMQP是什么？</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-5-2-JMS%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1.5.2. JMS是什么 ?</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-RabbitMQ%E5%AE%89%E8%A3%85"><span class="toc-text">二. RabbitMQ安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-text">1. 下载安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E4%B8%8B%E8%BD%BDerlang"><span class="toc-text">1）下载erlang</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%AE%89%E8%A3%85RabbitMQ"><span class="toc-text">2）安装RabbitMQ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%90%AF%E5%8A%A8RabbitMQ"><span class="toc-text">3）启动RabbitMQ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E5%AE%89%E8%A3%85%E7%AE%A1%E7%90%86%E6%8F%92%E4%BB%B6"><span class="toc-text">4）安装管理插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E7%99%BB%E5%BD%95RabbitMQ"><span class="toc-text">5）登录RabbitMQ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-RabbitMQ%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">三. RabbitMQ的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86%E8%AF%B4%E6%98%8E%E5%A6%82%E4%B8%8B%EF%BC%9A"><span class="toc-text">1. 组成部分说明如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B6%88%E6%81%AF%E5%8F%91%E5%B8%83%E6%8E%A5%E6%94%B6%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="toc-text">2. 消息发布接收流程：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B-RabbitMQ-%E5%B8%B8%E8%A7%81%E6%A8%A1%E5%9E%8B-%E9%87%8D%E7%82%B9"><span class="toc-text">四. RabbitMQ 常见模型 - 重点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Helloworld-%E5%9F%BA%E6%9C%AC%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B"><span class="toc-text">1. Helloworld-基本消息模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-text">1.1. 搭建环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E8%BF%9E%E6%8E%A5%E5%B7%A5%E5%85%B7"><span class="toc-text">1.2. 连接工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">1.3. 生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">1.4. 消费者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6%EF%BC%88ACK%EF%BC%89%E8%B6%85%E7%BA%A7%E9%87%8D%E8%A6%81"><span class="toc-text">1.5. 消息确认机制（ACK）超级重要</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-5-1-%E8%87%AA%E5%8A%A8%E7%A1%AE%E8%AE%A4%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98"><span class="toc-text">1.5.1. 自动确认存在问题</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-5-2-%E6%89%8B%E5%8A%A8%E7%A1%AE%E8%AE%A4%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.5.2. 手动确认实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-%E5%B0%8F%E7%BB%93"><span class="toc-text">1.6. 小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Work-queues"><span class="toc-text">2. Work queues</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">2.1. 生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%B6%88%E8%B4%B9%E8%80%851"><span class="toc-text">2.2. 消费者1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%B6%88%E8%B4%B9%E8%80%852"><span class="toc-text">2.3. 消费者2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.4. 测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E8%83%BD%E8%80%85%E5%A4%9A%E5%8A%B3"><span class="toc-text">2.5. 能者多劳</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%88%86%E7%B1%BB"><span class="toc-text">3. 交换机分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%A6%82%E8%BF%B0%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B"><span class="toc-text">3.1. 概述订阅模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%86%E7%B1%BB"><span class="toc-text">3.2. 分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B-FANOUT-%E5%B9%BF%E6%92%AD%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.3. 订阅模型-FANOUT(广播模式)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.3.1. 工作模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-2-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">3.3.2. 生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-%E6%B6%88%E8%B4%B9%E8%80%851"><span class="toc-text">3.3.3. 消费者1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-4-%E6%B6%88%E8%B4%B9%E8%80%852"><span class="toc-text">3.3.4. 消费者2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">3.3.5. 测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B-Direct"><span class="toc-text">3.3. 订阅模型-Direct</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-1-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F-1"><span class="toc-text">3.3.1. 工作模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-2-%E7%94%9F%E4%BA%A7%E8%80%85-1"><span class="toc-text">3.3.2. 生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-3-%E6%B6%88%E8%B4%B9%E8%80%851-1"><span class="toc-text">3.3.3. 消费者1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-4-%E6%B6%88%E8%B4%B9%E8%80%852-1"><span class="toc-text">3.3.4. 消费者2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-5-%E6%B5%8B%E8%AF%95-1"><span class="toc-text">3.3.5. 测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B-Topic"><span class="toc-text">3.4. 订阅模型-Topic</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-1-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.4.1. 工作模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-2-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">3.4.2. 生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-3-%E6%B6%88%E8%B4%B9%E8%80%851"><span class="toc-text">3.4.3. 消费者1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-4-%E6%B6%88%E8%B4%B9%E8%80%852"><span class="toc-text">3.4.4. 消费者2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-5-%E6%B5%8B%E8%AF%95"><span class="toc-text">3.4.5. 测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-Header%E6%A8%A1%E5%BC%8F"><span class="toc-text">3.5. Header模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-1-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">3.5.1. 生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-2-%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-text">3.5.2. 消费者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-3-%E6%B5%8B%E8%AF%95"><span class="toc-text">3.5.3. 测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-RPC"><span class="toc-text">3.6. RPC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-%E6%8C%81%E4%B9%85%E5%8C%96-%E8%A7%A3%E5%86%B3%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8"><span class="toc-text">3.7. 持久化-解决数据安全</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-7-1-%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">3.7.1. 交换机持久化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-7-2-%E9%98%9F%E5%88%97%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">3.7.2. 队列持久化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-7-3-%E6%B6%88%E6%81%AF%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">3.7.3. 消息持久化</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94-Springboot%E6%95%B4%E5%90%88Rabbitmq"><span class="toc-text">五. Springboot整合Rabbitmq</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%90%AD%E5%BB%BAboot%E7%8E%AF%E5%A2%83"><span class="toc-text">1. 搭建boot环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-pom"><span class="toc-text">2. pom</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE"><span class="toc-text">3. 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Yml"><span class="toc-text">3.1. Yml</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">3.2. 配置类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%85%A5%E5%8F%A3%E7%B1%BB"><span class="toc-text">3.3. 入口类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-text">4. 生产者</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B6%88%E8%B4%B9%E7%AB%AF"><span class="toc-text">5. 消费端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B5%8B%E8%AF%95"><span class="toc-text">6. 测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%89%8B%E5%8A%A8%E7%AD%BE%E6%94%B6"><span class="toc-text">7. 手动签收</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E4%BF%AE%E6%94%B9%E7%AD%BE%E6%94%B6%E6%A8%A1%E5%BC%8F"><span class="toc-text">7.1. 修改签收模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E8%A7%A6%E5%8F%91%E7%AD%BE%E6%94%B6"><span class="toc-text">7.2. 触发签收</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD-%E6%80%BB%E7%BB%93"><span class="toc-text">六. 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%80%BB%E7%BB%935%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-text">1. 总结5种模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-HelloWorld"><span class="toc-text">1.1. HelloWorld</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-WorkQueue"><span class="toc-text">1.2. WorkQueue</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-Fanout%E5%B9%BF%E6%92%AD"><span class="toc-text">1.3. Fanout广播</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-Direct%E5%AE%9A%E5%90%91"><span class="toc-text">1.4. Direct定向</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-topoc%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="toc-text">1.5. topoc通配符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%87%8D%E7%82%B9"><span class="toc-text">2. 重点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%9A%BE%E7%82%B9"><span class="toc-text">3. 难点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-text">5. 面试题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/breeze/1d13ce0d.html" title="WYDG-产品目录列表-20200506"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="WYDG-产品目录列表-20200506"></a><div class="content"><a class="title" href="/breeze/1d13ce0d.html" title="WYDG-产品目录列表-20200506">WYDG-产品目录列表-20200506</a><time datetime="2025-04-13T05:43:05.000Z" title="发表于 2025-04-13 13:43:05">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/6f268337.html" title="雨雀文件下载"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="雨雀文件下载"></a><div class="content"><a class="title" href="/breeze/6f268337.html" title="雨雀文件下载">雨雀文件下载</a><time datetime="2024-05-22T12:25:08.000Z" title="发表于 2024-05-22 20:25:08">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7832219d.html" title="十万字面试总结"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="十万字面试总结"></a><div class="content"><a class="title" href="/breeze/7832219d.html" title="十万字面试总结">十万字面试总结</a><time datetime="2024-02-29T02:50:00.000Z" title="发表于 2024-02-29 10:50:00">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7ae0ca37.html" title="Redis_30道经典面试题"><img src="/img/photo-1688475747590-d0db5e2412cb.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Redis_30道经典面试题"></a><div class="content"><a class="title" href="/breeze/7ae0ca37.html" title="Redis_30道经典面试题">Redis_30道经典面试题</a><time datetime="2024-02-29T02:45:00.000Z" title="发表于 2024-02-29 10:45:00">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/2a548e97.html" title="面试实战"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="面试实战"></a><div class="content"><a class="title" href="/breeze/2a548e97.html" title="面试实战">面试实战</a><time datetime="2024-02-29T02:43:59.000Z" title="发表于 2024-02-29 10:43:59">2024-02-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/photo-1692708632140-ee01624d558d.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 <i id="heartbeat" class="fa fas fa-heartbeat"></i> 清风</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/timing.js"></script><script id="canvas_nest" defer color="255,0,255" opacity="0.7" zindex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="天枢,天璇,天玑,天权,玉衡,开阳,瑶光" data-fontsize="15px" data-random="true" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>