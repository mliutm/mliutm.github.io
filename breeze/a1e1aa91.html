<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>瑞吉外卖 | 清风</title><meta name="author" content="清风"><meta name="copyright" content="清风"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一章 瑞吉外卖项目概述01.前置知识 Java基础知识 Java Web MySQL Spring Boot SSM（Spring、Spring MVC、MyBatis） Maven  02.软件开发整体介绍 软件开发流程    角色分公 项目经理：对整个项目负责，任务分配、把控进度 产品经理：进行需求调研，输出需求调研文档、产品原型等 UI设计师：根据产品原型输出界面效果图 架构师：项目整体架"><meta property="og:type" content="article"><meta property="og:title" content="瑞吉外卖"><meta property="og:url" content="https://mliutm.github.io/breeze/a1e1aa91.html"><meta property="og:site_name" content="清风"><meta property="og:description" content="第一章 瑞吉外卖项目概述01.前置知识 Java基础知识 Java Web MySQL Spring Boot SSM（Spring、Spring MVC、MyBatis） Maven  02.软件开发整体介绍 软件开发流程    角色分公 项目经理：对整个项目负责，任务分配、把控进度 产品经理：进行需求调研，输出需求调研文档、产品原型等 UI设计师：根据产品原型输出界面效果图 架构师：项目整体架"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://mliutm.github.io/img/photo-1653549892896-dde02867edee.jpg"><meta property="article:published_time" content="2023-10-30T01:32:03.000Z"><meta property="article:modified_time" content="2023-12-27T03:29:54.050Z"><meta property="article:author" content="清风"><meta property="article:tag" content="java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://mliutm.github.io/img/photo-1653549892896-dde02867edee.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://mliutm.github.io/breeze/a1e1aa91.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!1,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"瑞吉外卖",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-12-27 11:29:54"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,a){0!==a&&(a=864e5*a,t={value:t,expiry:(new Date).getTime()+a},localStorage.setItem(e,JSON.stringify(t)))},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!((new Date).getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=o=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">169</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/photo-1653549892896-dde02867edee.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="清风"><span class="site-name">清风</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">瑞吉外卖</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-30T01:32:03.000Z" title="发表于 2023-10-30 09:32:03">2023-10-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-27T03:29:54.050Z" title="更新于 2023-12-27 11:29:54">2023-12-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96/">瑞吉外卖</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">51.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>205分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="瑞吉外卖"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第一章-瑞吉外卖项目概述"><a href="#第一章-瑞吉外卖项目概述" class="headerlink" title="第一章 瑞吉外卖项目概述"></a>第一章 瑞吉外卖项目概述</h1><h2 id="01-前置知识"><a href="#01-前置知识" class="headerlink" title="01.前置知识"></a>01.前置知识</h2><ul><li>Java基础知识</li><li>Java Web</li><li>MySQL</li><li>Spring Boot</li><li>SSM（Spring、Spring MVC、MyBatis）</li><li>Maven</li></ul><h2 id="02-软件开发整体介绍"><a href="#02-软件开发整体介绍" class="headerlink" title="02.软件开发整体介绍"></a>02.软件开发整体介绍</h2><ul><li>软件开发流程<ul><li><img src="/breeze/a1e1aa91/image-20230319143341399.png" alt="image-20230319143341399" style="zoom:80%"></li></ul></li><li>角色分公<ul><li>项目经理：对整个项目负责，任务分配、把控进度</li><li>产品经理：进行需求调研，输出需求调研文档、产品原型等</li><li>UI设计师：根据产品原型输出界面效果图</li><li>架构师：项目整体架构设计、技术选型等</li><li>开发工程师：代码实现</li><li>测试工程师：编写测试用例，输出测试报告</li><li>运维工程师：软件环境搭建、项目上线</li></ul></li><li>软件环境<ul><li>开发环境（development）：开发人员在开发阶段使用的环境，一般外部用户无法访问</li><li>测试环境（testing）：专门给测试人员使用的环境，用于测试项目，一般外部用户无法访问</li><li>生产环境（production）：即线上环境，正式提供对外服务的环境</li></ul></li></ul><h2 id="03-瑞吉外卖项目介绍"><a href="#03-瑞吉外卖项目介绍" class="headerlink" title="03.瑞吉外卖项目介绍"></a>03.瑞吉外卖项目介绍</h2><ul><li>项目介绍<ul><li>本项目(瑞吉外卖)是专门为餐饮企业(餐厅、饭店)定制的一款软件产品，包括系统管理后台和移动端应用两部分。其中系统管理后台主要提供给餐饮企业内部员工使用，可以对餐厅的菜品、套餐、订单等进行管理维护。移动端应用主要提供给消费者使用，可以在线浏览菜品、添加购物车、下单等。</li><li>本项目共分为3期进行开发:<ul><li>第一期主要实现基本需求，其中移动端应用通过H5实现，用户可以通过手机浏览器访问。</li><li>第二期主要针对移动端应用进行改进,使用微信小程序实现,用户使用起来更加方便。</li><li>第三期主要针对系统进行优化升级,提高系统的访问性能。</li></ul></li></ul></li><li>产品原型展示<ul><li>产品原型，就是一款产品成型之前的一个简单的框架，就是将页面的排版布局展现出来,使产品的初步构思有一一个可视化的展示。通过原型展示，可以更加直观的了解项目的需求和提供的功能。</li><li>当前产品原型：<ul><li>瑞吉外卖后台（管理端）</li><li>瑞吉外卖前台（用户端）</li></ul></li><li>注意：<ul><li>产品原型主要用于展示项目的功能，并不是最终的页面效果</li></ul></li></ul></li><li>技术选型<ul><li><img src="/breeze/a1e1aa91/image-20230319175442779-1679219685329-3.png" alt="image-20230319175442779"></li></ul></li><li>功能架构<ul><li><img src="/breeze/a1e1aa91/image-20230319175632664-1679219795197-5.png" alt="image-20230319175632664"></li></ul></li><li>角色<ul><li>后台系统管理员：登录后台管理系统，拥有后台系统中的所有操作权限</li><li>后台系统普通员工：登录后台管理系统，对菜品、套餐、订单等进行管理</li><li>C端用户：登录移动端应用，可以浏览菜品、添加购物车、设置地址、在线下单等</li></ul></li></ul><h2 id="04-开发环境搭建"><a href="#04-开发环境搭建" class="headerlink" title="04.开发环境搭建"></a>04.开发环境搭建</h2><h3 id="数据库环境搭建"><a href="#数据库环境搭建" class="headerlink" title="数据库环境搭建"></a>数据库环境搭建</h3><ul><li>创建项目对应的数据库（图形界面或者命令行都可以）<ul><li><img src="/breeze/a1e1aa91/image-20230319180317777-1679220198942-7.png" alt="image-20230319180317777"></li></ul></li><li>导入表结构<ul><li>可以使用图形界面，也可以使用MySQL命令。通过命令导入表结构时，注意sql文件不要放在中文目录中</li></ul></li></ul><h3 id="Maven项目搭建"><a href="#Maven项目搭建" class="headerlink" title="Maven项目搭建"></a>Maven项目搭建</h3><ul><li><p>注意：创建完项目后，注意检查项目的编码、maven仓库配置、jdk配置等</p></li><li><p>pom.xml文件</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.cdcas<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reggie_take_out<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatisPlus依赖 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-boot-starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Lombok能以简单的注解形式来简化java代码，提高开发人员的开发效率， 使用lombok还需要插件的配合 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.26<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.fastjson2/fastjson2 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.fastjson2<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 标准 Java 库无法提供足够的方法 操作其核心类。Apache Commons Lang 提供 这些额外的方法。 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Druid Spring Boot Starter 用于帮助你在Spring Boot项目中轻松集成Druid数据库连接池和监控。 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                在SpringBoot项目中，框架提供了一套自己的打包机制，是通过spring-boot-maven-plugin插件来实现的。可以在MAVEN的生命周期package后重新打包，生成新的JAR包。spring-boot-maven-plugin插件将SpringBoot的项目打包成FAT-JAR，也就是说将项目启动运行所需要的JAR都包含进来了。</span></span><br><span class="line"><span class="comment">            普通的JAR和SpringBoot打包成的FAT-JAR内部结构是不一样的。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-maven-plugin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--build放在&lt;/dependencies&gt;标签的后面，主要加入的是resources标签 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--resources标签可以告诉系统启动的时候能够读取到这些后缀的文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            其实下面的这些属性不指定，程序也能正常执行，对应的文件也能被正常编译</span></span><br><span class="line"><span class="comment">            但是既然指定这些属性，就一定要配置好，不然会引发额外的错误</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                        这里要特别注意：</span></span><br><span class="line"><span class="comment">                            如果像下面这样写，则除了.yml .properties .xml文件会被编译之外，其它文件都不会被编译</span></span><br><span class="line"><span class="comment">                        &lt;include&gt;**/*.yml&lt;/include&gt;</span></span><br><span class="line"><span class="comment">                        &lt;include&gt;**/*.properties&lt;/include&gt;</span></span><br><span class="line"><span class="comment">                        &lt;include&gt;**/*.xml&lt;/include&gt;</span></span><br><span class="line"><span class="comment">                    --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>lib<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.jar<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="拓展：java中-和-的作用-以及-和-和-的区别"><a href="#拓展：java中-和-的作用-以及-和-和-的区别" class="headerlink" title="拓展：java中*和**的作用 以及 &#x2F;和&#x2F;*和&#x2F;**的区别"></a>拓展：java中*和**的作用 以及 &#x2F;和&#x2F;*和&#x2F;**的区别</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">拓展：java中*和**的作用 以及 /和/*和/**的区别</span><br><span class="line"></span><br><span class="line">&quot;*&quot;就表示了所有的文件，但是“*”并不包括子目录下的文件；</span><br><span class="line"></span><br><span class="line">&quot;**&quot;匹配包含任意级子目录中所有的文件；</span><br><span class="line"></span><br><span class="line">Java中/和/*和/**的区别</span><br><span class="line"></span><br><span class="line">1.   /</span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">解释：会匹配到/login这样的路径型url，*.js和*.html等静态资源，不会匹配到*.jsp页面</span><br><span class="line"></span><br><span class="line">2.   /*</span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">解释：会匹配所有url（只匹配当前文件夹下文件，不匹配子文件夹下文件），包括*.jsp页面</span><br><span class="line"></span><br><span class="line">3.   /**</span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/**<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">解释：会匹配所有url（匹配当前文件夹下文件和子文件夹下文件）：路径型的和后缀型的url(包括/login,*.jsp,*.js和*.html等)</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>application.yml</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># 应用名称，可选，如果不设置，默认就是工程名称</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">reggie_take_out</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">      <span class="attr">driverClassName:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="comment"># druid:  这样写项目启动不了，报错：无法确定合适的驱动程序类</span></span><br><span class="line">      <span class="comment">#driver-class-name: com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/reggie?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 静态文件请求匹配方式</span></span><br><span class="line">  <span class="comment">#mvc:</span></span><br><span class="line">    <span class="comment">#static-path-pattern: /**</span></span><br><span class="line">  <span class="comment"># 修改默认的静态寻址资源目录</span></span><br><span class="line">  <span class="comment">#web:</span></span><br><span class="line">    <span class="comment">#resources:</span></span><br><span class="line">      <span class="comment">#static-locations: classpath:/templates/,classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span></span><br><span class="line">    <span class="comment"># 如：address_book ---&gt; AddressBook 表名</span></span><br><span class="line">    <span class="comment"># 如：user_name ---&gt; userName 字段名(属性名)</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Mybatis-plus 需要通过下面的方式开启控制台 SQL 日志打印</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在生产环境，不想打印 SQL 日志，可以通过下面的配置关闭。</span></span><br><span class="line">    <span class="comment"># log-impl: org.apache.ibatis.logging.nologging.NoLoggingImpl</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># // 指定主键生成策略使用雪花算法（默认策略）</span></span><br><span class="line">  <span class="comment"># @TableId(type = IdType.ASSIGN_ID)</span></span><br><span class="line">  <span class="comment"># private Long id;</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br></pre></td></tr></table></figure><ul><li>ReggieApplication(启动类)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: ReggieApplication</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: springboot的启动类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年02月14日 21:39:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">// lombok提供的一个注解，可以直接输出日志</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReggieApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ReggieApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;项目启动成功!!!&quot;</span>); <span class="comment">// 依赖于@Slf4j</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="引入前端资源拓展"><a href="#引入前端资源拓展" class="headerlink" title="引入前端资源拓展"></a>引入前端资源拓展</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">拓展：</span><br><span class="line">* 启动服务之后，在resources目录下的资源(html等资源)访问不了</span><br><span class="line"></span><br><span class="line">* springboot访问静态资源：</span><br><span class="line">    1. static目录一般用来存放js、css、图片等静态资源</span><br><span class="line">    2. templates目录一般用来存放html页面</span><br><span class="line">    3. 注意：templates目录下的页面文件是不能直接访问的，需要通过Controller进行访问</span><br><span class="line">    4. 为什么要将html静态页面放置在templates目录？</span><br><span class="line">       - templates目录下的html页面不能直接访问，需要通过服务器内部进行访问，可以避免无权限的用户访问到隐私页面，造成信息泄露。</span><br><span class="line"></span><br><span class="line">* spring boot默认将/**静态资源访问映射到以下目录：</span><br><span class="line">    1. classpath:/static</span><br><span class="line">    2. classpath:/public</span><br><span class="line">    3. classpath:/resources</span><br><span class="line">    4. classpath:/META-INF/resources</span><br><span class="line">    5. 这四个目录的访问优先级：META-INF/resources &gt; resources &gt; static &gt; public</span><br><span class="line">        即这四个目录中存在同样的静态资源时，spring boot会优先访问META-INF/resources目录中的静态资源</span><br><span class="line">    6. META-INF/resources的目录结构是这样的：java/resources/META-INF/resources</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* 在默认情况下，只能访问static目录下的资源</span><br><span class="line">  解决方法：</span><br><span class="line">    1. 将静态资源放在static目录下(亲测有效)</span><br><span class="line">    2. 通过配置类的方式指定静态资源的映射(当前模块就是这样处理的)</span><br><span class="line">    3. 通过添加配置文件属性，如：</span><br><span class="line">        <span class="comment"># 静态文件请求匹配方式</span></span><br><span class="line">        spring.mvc.static-path-pattern=/**</span><br><span class="line">        <span class="comment"># 修改默认的静态寻址资源目录</span></span><br><span class="line">        spring.resources.static-locations=classpath:/templates/,classpath:/META-INF/resources/,classpath:/resources/,classpath:/static/,classpath:/public/</span><br></pre></td></tr></table></figure><h4 id="设置静态资源映射"><a href="#设置静态资源映射" class="headerlink" title="设置静态资源映射"></a>设置静态资源映射</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.config</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: WebMvcConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: webMvc配置类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年02月15日 13:29:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 加上这个注解，让这个类成为配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;开始进行静态资源映射...&quot;</span>);  <span class="comment">// 依赖于@Slf4j</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 表示浏览器请求中携带backend的所有请求都映射到resources目录下的backend目录下的对应资源</span></span><br><span class="line">        <span class="comment">// classpath:表示类的根路径，resources也表示类的根路径</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/backend/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/backend/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/front/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/front/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="05-后台登录功能开发"><a href="#05-后台登录功能开发" class="headerlink" title="05.后台登录功能开发"></a>05.后台登录功能开发</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li><p>页面原型展示</p><ul><li><img src="/breeze/a1e1aa91/image-20230324144208673.png" alt="image-20230324144208673"></li></ul></li><li><p>登录页面展示</p><ul><li><img src="/breeze/a1e1aa91/image-20230324144334081.png" alt="image-20230324144334081"></li></ul></li><li><p>查看登录请求信息</p><ul><li>通过浏览器调试工具（F12），可以点击登录按钮时，页面会发送请求（请求地址为<a target="_blank" rel="noopener" href="http://localhost:8080/employee/login)%E5%B9%B6%E6%8F%90%E4%BA%A4%E5%8F%82%E6%95%B0%EF%BC%88username%E5%92%8Cpassword)%EF%BC%8C%E6%AD%A4%E6%97%B6%E6%8A%A5404%EF%BC%8C%E6%98%AF%E5%9B%A0%E4%B8%BA%E6%88%91%E4%BB%AC%E7%9A%84%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F%E8%BF%98%E6%B2%A1%E6%9C%89%E7%9B%B8%E5%BA%94%E6%AD%A4%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%85%B3%E7%B1%BB%E6%9D%A5%E5%A4%84%E7%90%86%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82%E3%80%82">http://localhost:8080/employee/login)并提交参数（username和password)，此时报404，是因为我们的后台系统还没有相应此请求的处理器，所以我们需要创建相关类来处理登录请求。</a></li><li><img src="/breeze/a1e1aa91/image-20230324144537831.png" alt="image-20230324144537831"></li></ul></li><li><p>数据模型（employee表）</p><ul><li><img src="/breeze/a1e1aa91/image-20230324145329721.png" alt="image-20230324145329721" style="zoom:150%"></li></ul></li><li><p>注意：</p><ul><li>在backend&#x2F;page&#x2F;login&#x2F;login.html中，要注意handleLogin函数中的这几个数据：code、data、msg，要求服务端处理之后，数据里面应该含有这三个值，这样才能取到前端页面。</li><li><img src="/breeze/a1e1aa91/image-20230324145458034.png" alt="image-20230324145458034" style="zoom:150%"></li></ul></li></ul><h3 id="代码开发"><a href="#代码开发" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li>创建实体类Employee，和employee表进行映射</li></ul><p></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idNumber;    <span class="comment">// 身份证号码</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>创建mapper接口，EmployeeMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在对应的Mapper 接口上继承基本的 BaseMapper&lt;T&gt; T是对应的pojo类</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Employee&gt; &#123;</span><br><span class="line">    <span class="comment">// 所有的crud都编写完成了</span></span><br><span class="line">    <span class="comment">// 继承了BaseMapper,所有的方法来自父类，可扩展</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>导入返回结果类R</p><ul><li>此类是一个通用结果类，服务端响应的所有结果最终都会包装成此种类型返回给前端页面</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.common</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: R</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 此类是一个通用结果类，服务端响应的所有结果最终都会包装成此种类型返回给前端页面</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年02月28日 14:24:18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：1成功，0和其它数字为失败</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>(); <span class="comment">//动态数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        R&lt;T&gt; r = <span class="keyword">new</span> <span class="title class_">R</span>&lt;T&gt;();</span><br><span class="line">        r.data = object;</span><br><span class="line">        r.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; R&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">R</span>();</span><br><span class="line">        r.msg = msg;</span><br><span class="line">        r.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> R&lt;T&gt; <span class="title function_">add</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>在Controller中创建登录方法</p><ul><li><p>处理逻辑如下：</p><ul><li><p>将页面提交的密码password进行md5加密处理</p></li><li><p>根据页面提交的用户名username查询数据库</p></li><li><p>如果没有查询到则返回登录失败结果</p></li><li><p>密码比对，如果不一致则返回登录失败结果</p></li><li><p>查看员工状态，如果为已禁用状态，则返回员工已禁用结果</p></li><li><p>登录成功，将员工id存入Session并返回登录成功结果</p></li><li><p><img src="/breeze/a1e1aa91/image-20230324205624523.png" alt="image-20230324205624523"></p></li></ul></li></ul></li><li><p>具体实现代码如下：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Employee;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.EmployeeService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: EmployeeController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年02月28日 14:10:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/employee&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 员工登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span>  <span class="comment">// 前端发送的是post请求，所以这里是@PostMapping</span></span><br><span class="line">    <span class="comment">// 因为前端传过来的数据是JSON对象，所以这里要用@RequestBody</span></span><br><span class="line">    <span class="comment">// 这里需要用到request对象，是因为当登录成功之后，需要把员工id存到session里面，用request来获取session对象</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">login</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span> &#123;</span><br><span class="line">        <span class="comment">// 1、将页面提交的密码password进行md5加密处理</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> employee.getPassword(); <span class="comment">// 从前端登录页面拿到的密码</span></span><br><span class="line">        password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、根据页面提交的用户名username查询数据库</span></span><br><span class="line">        LambdaQueryWrapper&lt;Employee&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(Employee::getUsername, employee.getUsername());</span><br><span class="line">        <span class="comment">// 在设计数据库的时候我们对username使用了唯一索引，所以这里可以使用getOne方法</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、如果没有查询到则返回登录失败结果</span></span><br><span class="line">        <span class="keyword">if</span> (emp == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、密码比对，如果不一致则返回登录失败结果</span></span><br><span class="line">        <span class="keyword">if</span> (!emp.getPassword().equals(password)) &#123;</span><br><span class="line">            <span class="comment">// emp.getPassword()用户存在后从数据库查询到的密码（加密状态的），password是前端用户自己输入的密码（已经加密处理）</span></span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//  5、查看员工状态，如果为已禁用状态，则返回员工已禁用结果</span></span><br><span class="line">        <span class="comment">// 在数据库employee表中有一个status字段，其中0表示禁用，1表示启用</span></span><br><span class="line">        <span class="keyword">if</span> (emp.getStatus() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;账号已禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//  6、登录成功，将员工id存入Session并返回登录成功结果</span></span><br><span class="line">        request.getSession().setAttribute(<span class="string">&quot;employee&quot;</span>, emp.getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(emp);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>拓展：</p><ul><li><p>md5加密</p></li><li><p>Spring注解之@RequestController和@Controller的区别</p></li></ul></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">* 开发RESTful API 时，一般都会在Controller上加上<span class="meta">@Controller</span>注解，但是有时候加上<span class="meta">@RestController</span>，现在就说说他们的区别。</span><br><span class="line"></span><br><span class="line">　　<span class="meta">@RestController</span>注解等价于<span class="meta">@ResponseBody</span> ＋ <span class="meta">@Controller</span>。</span><br><span class="line">   <span class="meta">@RestController</span>和<span class="meta">@Controller</span>的共同点是都用来表示Spring某个类是否可以接收HTTP请求，</span><br><span class="line">   二者区别：</span><br><span class="line">        <span class="meta">@RestController</span>无法返回指定页面，而<span class="meta">@Controller</span>可以；前者可以直接返回数据，后者需要<span class="meta">@ResponseBody</span>辅助。下面详细分析。</span><br><span class="line"></span><br><span class="line">   ① 是否可以返回页面</span><br><span class="line"></span><br><span class="line">　　  答：<span class="meta">@RestController</span>无法返回指定页面，而<span class="meta">@Controller</span>可以。</span><br><span class="line">　　  解析：对于Controller， 如果只是使用<span class="meta">@RestController</span>注解，则其方法无法返回指定页面，此时配置的视图解析器 InternalResourceViewResolver不起作用，</span><br><span class="line">          返回的内容就是 <span class="keyword">return</span> 里的内容。 如果需要返回到指定页面，则需要用 <span class="meta">@Controller</span>配合视图解析器InternalResourceViewResolver才行。</span><br><span class="line">   ② 返回内容</span><br><span class="line">　　  如果需要返回JSON，XML或自定义mediaType内容到页面，<span class="meta">@RestController</span>自己就可以搞定，这个注解对于返回数据比较方便，因为它会自动将</span><br><span class="line">     对象实体转换为JSON格式。而<span class="meta">@Controller</span>需要在对应的方法加上<span class="meta">@ResponseBody</span>注解。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * <span class="meta">@ResponseBody</span>注解的作用</span><br><span class="line">    <span class="number">1</span>、概念</span><br><span class="line">            注解 <span class="meta">@ResponseBody</span>，使用在控制层（controller）的方法上。</span><br><span class="line"></span><br><span class="line">    <span class="number">2</span>、作用</span><br><span class="line">            作用：将方法的返回值，以特定的格式写入到response的body区域，进而将数据返回给客户端。</span><br><span class="line"></span><br><span class="line">            当方法上面没有写ResponseBody,底层会将方法的返回值封装为ModelAndView对象。</span><br><span class="line"></span><br><span class="line">            如果返回值是字符串，那么直接将字符串写到客户端；如果是一个对象，会将对象转化为json串，然后写到客户端。</span><br><span class="line"></span><br><span class="line"> * RequestBody注解的作用</span><br><span class="line">    <span class="meta">@RequestBody</span>的作用</span><br><span class="line">    <span class="meta">@RequestBody</span>主要用来接收前端传递给后端的json字符串中的数据的(请求体中的数据的)，所以只能发送POST请求。</span><br><span class="line"></span><br><span class="line">    GET方式无请求体，所以使用<span class="meta">@RequestBody</span>接收数据时，前端不能使用GET方式提交数据，而是用POST方式进行提交。</span><br><span class="line"></span><br><span class="line">    在后端的同一个接收方法里，<span class="meta">@RequestBody</span>与<span class="meta">@RequestParam()</span>可以同时使用，<span class="meta">@RequestBody</span>最多只能有一个，而<span class="meta">@RequestParam()</span>可以有多个。</span><br><span class="line"></span><br><span class="line">    注：一个请求，只有一个RequestBody；一个请求，可以有多个RequestParam。</span><br></pre></td></tr></table></figure><h3 id="功能测试"><a href="#功能测试" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><p>使用debug的形式启动项目，然后在浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:8080/backend/page/login/login.html">http://localhost:8080/backend/page/login/login.html</a></p></li><li><p>然后打开浏览器的f12，查看具体的请求情况：</p></li><li><img src="/breeze/a1e1aa91/image-20230325202014867.png" alt="image-20230325202014867" style="zoom:150%"></li><li><p>报超时错误</p><ul><li>解决：将前端页面的超时时间设置长一点<img src="/breeze/a1e1aa91/image-20230325202159018.png" alt="image-20230325202159018"></li></ul></li><li><p>在后台查看debug状态：</p><ul><li><img src="/breeze/a1e1aa91/image-20230325202933076.png" alt="image-20230325202933076"></li></ul></li><li><p>运行成功后(默认密码是123546)，数据存在了浏览器中，这面这行代码是把返回的数据保存在了浏览器中：</p><ul><li><pre><code class="js">// 这行代码在backend/page/login/login.html中 
localStorage.setItem(&#39;userInfo&#39;,JSON.stringify(res.data))
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 在浏览器中，我么可以看见，key为userInfo，value为我们返回的数据：</span><br><span class="line"></span><br><span class="line">  - ![image-20230327153113600](瑞吉外卖/image-20230327153113600.png)</span><br><span class="line"></span><br><span class="line">- 创建service接口，EmployeeService</span><br><span class="line"></span><br><span class="line">- 创建service接口，EmployeeServiceImpl</span><br><span class="line"></span><br><span class="line">- 创建controller类，EmployeeController</span><br><span class="line"></span><br><span class="line"><span class="comment">## 06.后台系统退出功能</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### 需求分析</span></span><br><span class="line"></span><br><span class="line">- 员工登录成功后，页面跳转到后台系统首页面（backend/index.html),此时会显示当前登录用户的姓名，如果员工需要退出系统，直接点击右侧的退出按钮即可退出系统，退出系统后，系统因跳转到登录页面。</span><br><span class="line">- &lt;img src=<span class="string">&quot;瑞吉外卖/image-20230327154744985.png&quot;</span> alt=<span class="string">&quot;image-20230327154744985&quot;</span> style=<span class="string">&quot;zoom:150%;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 代码开发</span></span><br><span class="line"></span><br><span class="line">- 用户点击页面中退出按钮，发送请求，请求地址为/employee/logout，请求方式为post。我们只需要在Controller中创建对应的处理方法即可，具体的处理逻辑：</span><br><span class="line"></span><br><span class="line">  - 清理Session中共的用户<span class="built_in">id</span></span><br><span class="line">  - 返回结果(前端也买你也要进行跳转到登录页面)</span><br><span class="line">    - 前端代码也要把浏览器中的数据清除(在index.html中)</span><br><span class="line">    - &lt;img src=<span class="string">&quot;瑞吉外卖/image-20230327155529625.png&quot;</span> alt=<span class="string">&quot;image-20230327155529625&quot;</span> style=<span class="string">&quot;zoom:150%;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"> </span><br><span class="line">// 在EmployeeController中</span><br><span class="line">/**</span><br><span class="line">    * 退出功能</span><br><span class="line">    * 1. 在controller中创建对应的处理方法来接收前端的请求，请求方式为post(可在浏览器中查看)</span><br><span class="line">    * 2. 清理Session中的用户<span class="built_in">id</span></span><br><span class="line">    * 3. 返回结果（前端页面会进行跳转到登录页面）</span><br><span class="line">    * @param request</span><br><span class="line">    * @<span class="built_in">return</span></span><br><span class="line">    */</span><br><span class="line">   @PostMapping(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">   public R&lt;String&gt; <span class="built_in">logout</span>(HttpServletRequest request)&#123;</span><br><span class="line">       // 清理Session中保存的当前登录员工的<span class="built_in">id</span></span><br><span class="line">       request.getSession().removeAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">       <span class="built_in">return</span>  R.success(<span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</code></pre></li></ul></li></ul><h3 id="功能测试-1"><a href="#功能测试-1" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>先登录，F12查看浏览器的存储信息，然后再退出，查看浏览器中的数据是否会被清除，并且页面是否会跳转（前端实现了）</li></ul><h1 id="第二章-员工管理业务开发"><a href="#第二章-员工管理业务开发" class="headerlink" title="第二章 员工管理业务开发"></a>第二章 员工管理业务开发</h1><h2 id="01-员工管理模块"><a href="#01-员工管理模块" class="headerlink" title="01.员工管理模块"></a>01.员工管理模块</h2><h3 id="完善登录功能"><a href="#完善登录功能" class="headerlink" title="完善登录功能"></a>完善登录功能</h3><ul><li>问题分析：前面已经完成了后台系统的员工登录功能的开发，但是还存在一个问题：用户如果不登陆，直接访问系统首页面，照样可以正常访问。这种设计是不合理的，我们希望看到的效果应该是，只有登录成功后才可以访问系统中的页面，如果没有登录则跳转到登录页面。</li><li>如何实现呢？答案就是使用过滤器或者拦截器，在过滤器或者拦截器中判断用户是否已经完成登录，如果没有登录，则跳转到登录页面。</li></ul><h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><ul><li><p>这里使用的是过滤器</p></li><li><p>创建自定义过滤器LoginCheckFilter</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.reggie.filter;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查用户是否已经完成登陆</span></span><br><span class="line"><span class="comment"> * filterName过滤器名字</span></span><br><span class="line"><span class="comment"> * urlPatterns拦截的请求，这里是拦截所有的请求</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;LongCheckFilter&quot;,urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"> </span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line">        log.info(<span class="string">&quot;拦截到的请求:&#123;&#125;&quot;</span>,request.getRequestURL());</span><br><span class="line">        <span class="comment">//对请求进行放行</span></span><br><span class="line">        filterChain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p><img src="/breeze/a1e1aa91/image-20230327162920933.png" alt="image-20230327162920933"></p></li><li><p>在启动类上加上注解@ServletComponentScan</p></li><li><p>完善过滤器的处理逻辑</p><ul><li><img src="/breeze/a1e1aa91/image-20230327163154965.png" alt="image-20230327163154965" style="zoom:150%"></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.filter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.filter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: LoginCheckFilter</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 配置登录检查过滤器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年03月01日 19:59:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson2.JSON;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.AntPathMatcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检查用户是否已经完成登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@WebFilter(filterName = &quot;loginCheckFilter&quot;, urlPatterns = &quot;/*&quot;)</span> <span class="comment">// 所用的请求都拦截</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginCheckFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 路径匹配器，支持通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AntPathMatcher</span> <span class="variable">PATH_MATCHER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        过滤器需要执行的功能</span></span><br><span class="line"><span class="comment">            1、获取本次请求的URI</span></span><br><span class="line"><span class="comment">            2、判断本次请求是否需要处理</span></span><br><span class="line"><span class="comment">            3、如果不需要处理，则直接放行</span></span><br><span class="line"><span class="comment">            4、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line"><span class="comment">            5、如果未登录，则返回未登录结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) servletRequest;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) servletResponse;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、获取本次请求的URI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">requestURI</span> <span class="operator">=</span> request.getRequestURI();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印日志，查看结果</span></span><br><span class="line">        log.info(<span class="string">&quot;拦截到请求：&#123;&#125;&quot;</span>, requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以下请求不需要处理，直接放行</span></span><br><span class="line">        String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;/employee/login&quot;</span>,   <span class="comment">// 登录请求不需要处理</span></span><br><span class="line">                <span class="string">&quot;employee/logout&quot;</span>,   <span class="comment">// 退出登录请求不需要处理</span></span><br><span class="line">                <span class="string">&quot;/backend/**&quot;</span>,       <span class="comment">// backend目录下的所有静态资源都不需要处理(这些资源想看就看，因为看不到数据)</span></span><br><span class="line">                <span class="string">&quot;/front/**&quot;</span>          <span class="comment">// 类似于backend中的资源(这是移动端的资源)</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、判断本次请求是否需要处理(这里封装了一个方法进行判断)--&gt;check</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> check(urls, requestURI);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、如果不需要处理，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(check)&#123;</span><br><span class="line">            <span class="comment">// 打印日志，查看结果</span></span><br><span class="line">            log.info(<span class="string">&quot;本次请求&#123;&#125;不需要处理&quot;</span>, requestURI);</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;  <span class="comment">// 能够获取到session中的信息</span></span><br><span class="line">            <span class="comment">// 打印日志，查看结果</span></span><br><span class="line">            log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>, request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;用户未登录&quot;</span>);</span><br><span class="line">        <span class="comment">// 5、如果未登录则返回未登录结果，通过输入流方式向客户端页面响应数据，具体响应什么数据，看前端的要求，然后前端会根据登录状态做页面跳转</span></span><br><span class="line">        response.getWriter().write(JSON.toJSONString(R.error(<span class="string">&quot;NOTLOGIN&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 路径匹配，检查本次请求是否需要放行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> urls</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestURI</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String[] urls, String requestURI)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(String url : urls)&#123;</span><br><span class="line">            <span class="comment">// 把浏览器发送过来的请求和我们定义的不拦截的url做对比，匹配则放行</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">match</span> <span class="operator">=</span> PATH_MATCHER.match(url, requestURI);</span><br><span class="line">            <span class="keyword">if</span>(match)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="拓展过滤器"><a href="#拓展过滤器" class="headerlink" title="拓展过滤器"></a>拓展过滤器</h4><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* <span class="keyword">do</span><span class="built_in">Filter</span>()方法</span><br><span class="line"></span><br><span class="line">    在<span class="keyword">do</span><span class="built_in">Filter</span>()方法中，在chain.<span class="keyword">do</span><span class="built_in">Filter</span>()之前的代码，一般是对<span class="built_in">request</span>执行的过滤操作；</span><br><span class="line"></span><br><span class="line">    在chain.<span class="keyword">do</span><span class="built_in">Filter</span>()后面的代码，一般是对<span class="built_in">response</span>执行的操作;</span><br><span class="line"></span><br><span class="line">    chain.doFiter()执行下一个过滤器或者业务处理器。--&gt; 就是放行给下一个过滤器或者业务处理器~</span><br><span class="line"></span><br><span class="line">    如果在<span class="keyword">do</span><span class="built_in">Filter</span>()方法中，不写chain.<span class="keyword">do</span><span class="built_in">Filter</span>()，业务无法继续往下处理；</span><br><span class="line"></span><br><span class="line">    一般filter都是一个链,web.xml 里面配置了几个就有几个。一个一个的连在一起</span><br><span class="line">    <span class="built_in">request</span> -&gt; filter1 -&gt; filter2 -&gt;filter3 -&gt; …. -&gt; <span class="built_in">request</span> resource.</span><br><span class="line"></span><br><span class="line">    chain.doFilter将请求转发给过滤器链下一个filter , 如果没有filter那就是你请求的资源</span><br></pre></td></tr></table></figure><h4 id="功能测试-2"><a href="#功能测试-2" class="headerlink" title="功能测试"></a>功能测试</h4><ul><li>发起几个请求看看后台的输出，能不能访问到资源里面的数据，能不能跳转。</li></ul><h3 id="新增员工"><a href="#新增员工" class="headerlink" title="新增员工"></a>新增员工</h3><h4 id="需求分析-1"><a href="#需求分析-1" class="headerlink" title="需求分析"></a>需求分析</h4><ul><li><img src="/breeze/a1e1aa91/image-20230327164923628.png" alt="image-20230327164923628"></li></ul><h4 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h4><ul><li>新增员工，其实就是将我们新增页面录入的员工数据插入到employee表。需要注意：employee表中对username字段加入了唯一约束，因为username是员工的登录账号，必须是唯一的。<ul><li><img src="/breeze/a1e1aa91/image-20230327165217645.png" alt="image-20230327165217645"></li></ul></li><li>employee表中的status字段已经设置了默认值1，表示状态正常<ul><li><img src="/breeze/a1e1aa91/image-20230327165522426.png" alt="image-20230327165522426"></li></ul></li></ul><h4 id="代码开发-1"><a href="#代码开发-1" class="headerlink" title="代码开发"></a>代码开发</h4><ul><li><img src="/breeze/a1e1aa91/image-20230327165633655.png" alt="image-20230327165633655" style="zoom:150%"></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在EmployeeController类中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增员工</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span> <span class="comment">// 从浏览器控制台可以看到，这里的请求是 /employee， 而在该类上已经写了该注解，所以这里不需要写了</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span>&#123;  <span class="comment">// 因为传的参数是JSON对象，所以加了@RequestBody注解</span></span><br><span class="line">    log.info(<span class="string">&quot;新增员工，员工信息：&#123;&#125;&quot;</span>, employee.toString());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置初始密码123456，需要进行md5加密处理，后期员工可以自己登录账号，修改自己的密码</span></span><br><span class="line">    employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line">    employee.setCreateTime(LocalDateTime.now());    <span class="comment">// 设置创建时间</span></span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());    <span class="comment">// 设置更新时间</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得当前登录用户的id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"></span><br><span class="line">    employee.setCreateUser(empId);  <span class="comment">// 创建人的id，就是当前用户的id（在进行添加操作的人的id）</span></span><br><span class="line">    employee.setUpdateUser(empId);  <span class="comment">// 最后的更新人的id</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 直接调用了MybatisPlus的sava方法</span></span><br><span class="line">    employeeService.save(employee);	<span class="comment">// 已经提前在类中注入了employeeService对象</span></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新增员工成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmployeeService接口实现了MybatisPlus的IService接口</span></span><br><span class="line"><span class="comment">// 如果MybatisPlus中的方法，不能满足业务需求，可以在该接口中自定义方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Employee&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// EmployeeService接口的实现类</span></span><br><span class="line"><span class="comment">// 注意这里的范型</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EmployeeMapper, Employee&gt; <span class="keyword">implements</span> <span class="title class_">EmployeeService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对应的mapper接口</span></span><br><span class="line"><span class="comment">// 在对应的Mapper 接口上继承基本的 BaseMapper&lt;T&gt; T是对应的pojo类</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Employee&gt; &#123;</span><br><span class="line">    <span class="comment">// 所有的crud都编写完成了</span></span><br><span class="line">    <span class="comment">// 继承了BaseMapper,所有的方法来自父类，可扩展</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="功能测试-3"><a href="#功能测试-3" class="headerlink" title="功能测试"></a>功能测试</h4><ul><li><p>登录成功之后，进行添加操作，如果数据库中新增数据成功,表示代码没有问题。</p></li><li><p>注意：因为在数据库表中把username设置成了唯一索引，所以下次新增用户的时候，如果输出了相同的用户名，则会抛出异常。这个异常时mysql数据库跑出来的。</p></li><li><pre><code class="java">2023-03-27T17:31:48.753+08:00 ERROR 9504 --- [nio-8080-exec-7] c.c.r.common.GlobalExceptionHandler      : Duplicate entry &#39;zhangsan&#39; for key &#39;employee.idx_username&#39;
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">#### 解决bug</span><br><span class="line"></span><br><span class="line">##### 需求分析</span><br><span class="line"></span><br><span class="line">- ![image-<span class="number">20230327172942122</span>](瑞吉外卖/image-<span class="number">20230327172942122.</span>png)</span><br><span class="line"></span><br><span class="line">##### 代码开发</span><br><span class="line"></span><br><span class="line">- 全局异常捕获，这个全局异常捕获下载common包下</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="keyword">package</span> com.cdcas.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.<span class="keyword">annotation</span>.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLIntegrityConstraintViolationException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.common</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: GlobalExceptionHandler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 全局异常处理器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年03月10日 21:32:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice(annotations = &#123;RestController.class, Controller.class&#125;)</span>   <span class="comment">// 只要加了这两个注解的类都会被该处理器处理</span></span><br><span class="line"><span class="meta">@ResponseBody</span>   <span class="comment">// 需要返回json格式的字符串</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常处理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SQLIntegrityConstraintViolationException.class)</span>   <span class="comment">// 处理指定异常</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; exceptionHandler(SQLIntegrityConstraintViolationException ex)&#123;</span><br><span class="line">        log.error(ex.getMessage());	<span class="comment">// 打印报错的日志信息</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(ex.getMessage().contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;	<span class="comment">// 如果报错的日志信息中，包含这个关键字(Duplicate entry)，就执行方法体中的代码</span></span><br><span class="line">            String[] split = ex.getMessage().split(<span class="string">&quot; &quot;</span>); <span class="comment">// 将得到的异常信息按空格分隔，得到一个字符串数组</span></span><br><span class="line">            String msg = split[<span class="number">2</span>] + <span class="string">&quot;已存在&quot;</span>;  <span class="comment">// 返回xx用户已存在</span></span><br><span class="line">            <span class="keyword">return</span> R.error(msg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;未知错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre></li></ul><h5 id="功能测试-4"><a href="#功能测试-4" class="headerlink" title="功能测试"></a>功能测试</h5><ul><li>登录成功后，添加一个数据库表中已经存在的账号，看前端页面的提示信息和后台的错误日志。</li><li><img src="/breeze/a1e1aa91/image-20230327175211659.png" alt="image-20230327175211659"></li></ul><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li><img src="/breeze/a1e1aa91/image-20230327175456863.png" alt="image-20230327175456863"></li></ul><h2 id="02-员工信息分页查询"><a href="#02-员工信息分页查询" class="headerlink" title="02.员工信息分页查询"></a>02.员工信息分页查询</h2><h3 id="需求分析-2"><a href="#需求分析-2" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>系统中的员工有很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</li></ul><h3 id="代码开发-2"><a href="#代码开发-2" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p><img src="/breeze/a1e1aa91/image-20230328220324721.png" alt="image-20230328220324721"></p></li><li><p>页面发送ajax请求已经由前端实现了</p><ul><li><img src="/breeze/a1e1aa91/image-20230329135252104.png" alt="image-20230329135252104"></li></ul></li><li><p>所以我们只需要从第二步开始写java代码，从Controller开始写</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.config</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: MybatisPlusConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 配置MybatisPlus的分页插件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年03月29日 13:18:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">// 标识配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">// 让spring容器来管理，spring容器可以从该方法中拿到一个bean对象</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><pre><code class="java">// 该方法在EmployeeController类中

/**
 * 员工信息分页查询
 *
 * 这里之所以（范型是Page对象）是返回Page(MybatisPlus中的一个类)对象，是因为前端需要这些分页的数据（比如当前页，总页数）
 * 页面需要什么数据，我们就给什么数据
 *
 * 可以看到从前端发送的请求中携带了叁个参数，一个是page,一个是pageSize,(还有可能提交name参数)所以该方法中需要设置三个参数用来接收前端传过来的参数。（）
 *
 * @param page  接收前端传过来的参数page
 * @param pageSize 接收前端传过来的参数pageSize
 * @param name  接收前端传过来的筛选条件
 * @return
 */
@GetMapping(&quot;/page&quot;)    // 前端发送的是get请求
public R&lt;Page&gt; page(int page, int pageSize, String name)&#123;

    // 先测试一下，前端传过来的分页数据有没有被成功接收到
    // log.info(&quot;page = &#123;&#125;, pageSize = &#123;&#125;, name = &#123;&#125;&quot;, page, pageSize, name);  // 注意，参数和占位符是一一对应的，位置不能错

    // 构造分页构造器，就是创建page对象
    Page pageInfo = new Page(page, pageSize);

    // 构造条件构造器，就是动态的封装前端传过来的过滤条件，注意要加范型（Employee），因为需要取name参数
    LambdaQueryWrapper&lt;Employee&gt; queryWrapper = new LambdaQueryWrapper();

    // 添加过滤条件，根据条件查询。只有当name不等于空的时候，该条件才会被添加
    queryWrapper.like(StringUtils.isNotEmpty(name), Employee :: getName,name);

    // 添加排序条件
    queryWrapper.orderByDesc(Employee::getUpdateTime);

    // 执行查询，这里不用对查询结果进行封装了，MybatisPlus已经封装好了
    // employeeService 在前面已经注入好了
    employeeService.page(pageInfo, queryWrapper);

    return R.success(pageInfo);
&#125;
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 后端只需要把数据查询出来，分页的功能，前端已经实现了</span><br><span class="line"></span><br><span class="line">### 功能测试</span><br><span class="line"></span><br><span class="line">- 分页的三个时机：</span><br><span class="line">  - 用户登录成功时，分页查询一次</span><br><span class="line">  - 用户使用条件查询的时候分页一次</span><br><span class="line">  - 跳转页面的时候分页查询一次</span><br><span class="line"></span><br><span class="line">## <span class="number">04.</span>启用/禁用员工账号</span><br><span class="line"></span><br><span class="line">### 需求分许</span><br><span class="line"></span><br><span class="line">- 在员工管理页面，可以对某个员工账号进行启用或者禁用操作。账号禁用的员工不能登录系统，启用后的员工可以正常登录。</span><br><span class="line">- 需要注意，只有管理员（admin用户）可以对其它普通用户进行启用、禁用操作，所以普通用户登录系统后启用、禁用按钮不显示。</span><br><span class="line">- 管理员admin登录系统对所有员工账号进行启用、禁用操作。</span><br><span class="line">- 如果某个员工账号状态为正常，则按钮显示为“禁用” ，如果员工账号状态为已禁用，则按钮显示为“启用”。</span><br><span class="line">  - ![image<span class="number">-20230329154013368</span>](瑞吉外卖/image<span class="number">-20230329154013368.</span>png)</span><br><span class="line">- 普通员工登录系统后，启用、禁用按钮不显示。</span><br><span class="line">  - ![image<span class="number">-20230329154200781</span>](瑞吉外卖/image<span class="number">-20230329154200781.</span>png)</span><br><span class="line">- 管理员或者是普通员工登录后，是否显示启用、禁用按钮，这个功能前端已经写好了</span><br><span class="line"></span><br><span class="line">### 代码开发</span><br><span class="line"></span><br><span class="line">- ![image<span class="number">-20230329154508190</span>](瑞吉外卖/image<span class="number">-20230329154508190.</span>png)</span><br><span class="line"></span><br><span class="line">- &lt;img src=<span class="string">&quot;瑞吉外卖/image-20230329155055377.png&quot;</span> alt=<span class="string">&quot;image-20230329155055377&quot;</span> style=<span class="string">&quot;zoom:150%;&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">- ![image<span class="number">-20230329155743364</span>](瑞吉外卖/image<span class="number">-20230329155743364.</span>png)</span><br><span class="line"></span><br><span class="line">- 启用、禁用员工账号，本质上就是一个更新操作，也就是对status状态字段进行操作。在Controller创建update方法，此方法是一个通用的修改员工信息的方法。</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="comment">// 该方法在EmployeeController中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id修改员工信息</span></span><br><span class="line"><span class="comment"> * @param employee</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 因为前端提交的是put请求，所以用@PutMapping.前端的请求路径是employee，而employee在类上已经标注了，所以这里不需要写路径了</span></span><br><span class="line">@PutMapping</span><br><span class="line"><span class="comment">// 这里返回的对象是String类型，因为前端页面只需要对返回的code进行判断即可</span></span><br><span class="line"><span class="comment">// 前端传过来的数据格式是JSON类型的，所以要用@RequestBody注解</span></span><br><span class="line">public R&lt;String&gt; update(HttpServletRequest request, @RequestBody Employee employee)&#123;</span><br><span class="line">    log.info(employee.toString());  <span class="comment">// 查看员工信息是否封装成功(前端发送的请求，后端能否正常接收)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取本次执行操作的人(更新人)的id，当用户登录成功之后，该用户的id会以employee为key存储在session中</span></span><br><span class="line">    Long empId = (Long)request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库表中有 update_time(更新时间) 和 update_user(更新人) 这两个字段</span></span><br><span class="line">    <span class="comment">// 在更新之前设置一下更新时间和更新人。这里的employee是前端传过来的参数，也就是被修改的员工</span></span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateUser(empId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里有疑问？因为是根据id来更新，但是传入的参数却是一个employee对象</span></span><br><span class="line">    <span class="comment">// 猜想：这个employee接收的是前端传过来的参数，前端传过来的参数中，只有id和status，其它全是null，而且status的值是0.可能是这个原因。(不是)</span></span><br><span class="line">    <span class="comment">// 自己傻逼了，这个updateById()方法需要传入的参数就是一个对象，因为有范型，所以传入的范型是一个员工实体。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试：根据控制台打印的sql语句(UPDATE employee SET status=?, update_time=?, update_user=? WHERE id=?)可知，</span></span><br><span class="line">    <span class="comment">// 该更新操作修改了三个字段，分别是上面获取的更新人和更新时间还有前端传过来的被修改人的id。</span></span><br><span class="line">    <span class="comment">// 最终结论：updateById()方法通过获取传入的employee实体的id字段，来修改该employee实体中封装的其它字段（更新人、更新时间、状态码）</span></span><br><span class="line">    employeeService.updateById(employee);</span><br><span class="line"></span><br><span class="line">    return R.success(<span class="string">&quot;员工信息修改成功!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre></li></ul><h3 id="功能测试-5"><a href="#功能测试-5" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><p>测试过程中没有报错，但是功能并没有实现，查看数据库中的数据也没有变化。这是为什么呢？观察控制台输出的SQL：</p><ul><li><pre><code class="java">==&gt;  Preparing: UPDATE employee SET status=?, update_time=?, update_user=? WHERE id=?
==&gt; Parameters: 0(Integer), 2023-03-29T21:02:14.550720600(LocalDateTime), 1(Long), 1634195078247952400(Long)
&lt;==    Updates: 0

<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- SQL执行的结果是更新的数据行数为<span class="number">0</span>，仔细观察id的值，发现和数据库中对应记录的id值并不相同。</span><br><span class="line"></span><br><span class="line">  - ![image<span class="number">-20230329210812066</span>](瑞吉外卖/image<span class="number">-20230329210812066.</span>png)</span><br><span class="line"></span><br><span class="line">- 用户登录成功，展示员工列表之后，查看后端传到浏览器中的员工，查看对应员工的id值，发现此时浏览器中的员工id和数据库中的员工id是一样的</span><br><span class="line"></span><br><span class="line">  - ![image<span class="number">-20230329211459457</span>](瑞吉外卖/image<span class="number">-20230329211459457.</span>png)</span><br><span class="line"></span><br><span class="line">- 进行debug调试，发现当进行禁用操作时，前端传过来的id和数据库中对应员工的id值不匹配，这是为什么呢？</span><br><span class="line"></span><br><span class="line">  - ![image<span class="number">-20230329211752385</span>](瑞吉外卖/image<span class="number">-20230329211752385.</span>png)</span><br><span class="line"></span><br><span class="line">- 原因：因为使用MyBatisPlus对id使用了雪花算法，该策略（ASSIGN_ID)，能够得到一个<span class="number">19</span>位的Long类型的值，所以存入数据库中的id的长度为<span class="number">19</span>位。然而，在进行禁用操作的时候，会把对应员工的数据响应给js，但是前端的js只能保证数据前<span class="number">16</span>位的精度，对我们id后面三位数据进行了四舍五入，所以出现了精度丢失。就会导致在进行禁用操作时，前端传过来的id和数据库中对应员工的id不匹配，自然就没法修改我们想要的数据。</span><br><span class="line"></span><br><span class="line">### 代码修复</span><br><span class="line"></span><br><span class="line">- 如何解决这个问题呢？我们可以在服务端给页面响应json数据时进行处理，将Long类型数据统一转成<span class="type">String</span>字符串，效果如下：</span><br><span class="line">- 具体实现步骤：</span><br><span class="line">- 提供对象转换器JacksonObjectMapper,基于Jackson进行java对象到json数据的转换</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">package com.cdcas.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.std.ToStringSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalDateTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.deser.LocalTimeDeserializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalDateTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.datatype.jsr310.ser.LocalTimeSerializer;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalTime;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"><span class="keyword">import</span> <span class="type">static</span> com.fasterxml.jackson.databind.DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象映射器:基于jackson将Java对象转为json，或者将json转为Java对象</span></span><br><span class="line"><span class="comment"> * 将JSON解析为Java对象的过程称为 [从JSON反序列化Java对象]</span></span><br><span class="line"><span class="comment"> * 从Java对象生成JSON的过程称为 [序列化Java对象到JSON]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> extends ObjectMapper &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">String</span> DEFAULT_DATE_FORMAT = <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">String</span> DEFAULT_DATE_TIME_FORMAT = <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">static</span> <span class="keyword">final</span> <span class="type">String</span> DEFAULT_TIME_FORMAT = <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JacksonObjectMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//收到未知属性时不报异常</span></span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">configure</span>(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">getDeserializationConfig</span>().<span class="built_in">withoutFeatures</span>(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        SimpleModule simpleModule = <span class="keyword">new</span> <span class="built_in">SimpleModule</span>()</span><br><span class="line">                .<span class="built_in">addDeserializer</span>(LocalDateTime.<span class="keyword">class</span>, <span class="keyword">new</span> <span class="built_in">LocalDateTimeDeserializer</span>(DateTimeFormatter.<span class="built_in">ofPattern</span>(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .<span class="built_in">addDeserializer</span>(LocalDate.<span class="keyword">class</span>, <span class="keyword">new</span> <span class="built_in">LocalDateDeserializer</span>(DateTimeFormatter.<span class="built_in">ofPattern</span>(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .<span class="built_in">addDeserializer</span>(LocalTime.<span class="keyword">class</span>, <span class="keyword">new</span> <span class="built_in">LocalTimeDeserializer</span>(DateTimeFormatter.<span class="built_in">ofPattern</span>(DEFAULT_TIME_FORMAT)))</span><br><span class="line"></span><br><span class="line">                .<span class="built_in">addSerializer</span>(BigInteger.<span class="keyword">class</span>, ToStringSerializer.instance)</span><br><span class="line">                .<span class="built_in">addSerializer</span>(Long.<span class="keyword">class</span>, ToStringSerializer.instance)</span><br><span class="line">                .<span class="built_in">addSerializer</span>(LocalDateTime.<span class="keyword">class</span>, <span class="keyword">new</span> <span class="built_in">LocalDateTimeSerializer</span>(DateTimeFormatter.<span class="built_in">ofPattern</span>(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">                .<span class="built_in">addSerializer</span>(LocalDate.<span class="keyword">class</span>, <span class="keyword">new</span> <span class="built_in">LocalDateSerializer</span>(DateTimeFormatter.<span class="built_in">ofPattern</span>(DEFAULT_DATE_FORMAT)))</span><br><span class="line">                .<span class="built_in">addSerializer</span>(LocalTime.<span class="keyword">class</span>, <span class="keyword">new</span> <span class="built_in">LocalTimeSerializer</span>(DateTimeFormatter.<span class="built_in">ofPattern</span>(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span></span><br><span class="line">        <span class="keyword">this</span>.<span class="built_in">registerModule</span>(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre></li></ul></li><li><p>在WebMvcConfig配置类中扩展SpringMvc的消息转换器，在此消息转换器中使用提供的对象转换器进行java对象到json数据的转换</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在WebMvcConfig类中，这个类中的方法在项目启动的时候就会执行</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展mvc框架的消息转换器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> converters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;扩展消息转换器&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消息转换器对象</span></span><br><span class="line">    <span class="comment">// 作用：将Controller类中的方法的返回结果(R对象)，转成相应的json，然后通过输出流的方式响应给页面</span></span><br><span class="line">    <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置对象转换器，底层使用Jackson将java对象转成json</span></span><br><span class="line">    messageConverter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将上面的消息转换器对象追加到mvc框架的转换容器集合中</span></span><br><span class="line">    <span class="comment">// 转换器是有优先级的，我们设置其索引为0，放到集合中的第一个，所以会优先使用我们自己的转换器来进行相关的数据转换.</span></span><br><span class="line">    converters.add(<span class="number">0</span>, messageConverter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><img src="/breeze/a1e1aa91/image-20230330163219925.png" alt="image-20230330163219925"></li><li>启动服务器查看浏览器中的id是否是字符串类型，和数据库中的id是否相对应。发现是对应的，则消息转换器配置成功。然后测试启用与禁用员工账号这个功能，发小操作更新成功。</li><li><img src="/breeze/a1e1aa91/image-20230330163502776.png" alt="image-20230330163502776" style="zoom:150%"></li></ul><h2 id="05-编辑员工信息"><a href="#05-编辑员工信息" class="headerlink" title="05.编辑员工信息"></a>05.编辑员工信息</h2><h3 id="需求分析-3"><a href="#需求分析-3" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li><img src="/breeze/a1e1aa91/image-20230330164433130.png" alt="image-20230330164433130"></li></ul><h3 id="代码开发-3"><a href="#代码开发-3" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p><img src="/breeze/a1e1aa91/image-20230330164520202.png" alt="image-20230330164520202"></p></li><li><p>数据回显后端代码：其实主要逻辑在前端完成了</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据根据前端传过来的id查询员工信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 页面展示已经由前端完成了</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="comment">// 注意路径的写法，获取请求中的id。(完整的路径应该是employee/&#123;id&#125;)，employee在类上已经有了</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;  <span class="comment">// 注意要加注解@PathVariable(路径变量)</span></span><br><span class="line">    log.info(<span class="string">&quot;根据id查询员工信息...&quot;</span>);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeService.getById(id);</span><br><span class="line">    <span class="keyword">if</span> (employee != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;没有查询到对应员工信息&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>修改回显数据后，点击保存，会发送一个update的请求给后端，前面我们已经写了这个update的controller，所以只需要在前端跳发请求就行。这样就实现了方法的复用，减少了代码量。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230330225239004.png" alt="image-20230330225239004"></p></li></ul><h3 id="功能测试-6"><a href="#功能测试-6" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>自己测试编辑，看数据能不能回显，用户数据可不可以修改成功，修改后数据库的数据有没有跟着变化</li></ul><h1 id="第三章-分类管理业务开发"><a href="#第三章-分类管理业务开发" class="headerlink" title="第三章 分类管理业务开发"></a>第三章 分类管理业务开发</h1><h2 id="01-公共字段自动填充-有重点"><a href="#01-公共字段自动填充-有重点" class="headerlink" title="01.公共字段自动填充(有重点)"></a>01.公共字段自动填充(有重点)</h2><h3 id="问题分许"><a href="#问题分许" class="headerlink" title="问题分许"></a>问题分许</h3><ul><li><img src="/breeze/a1e1aa91/image-20230331183412462.png" alt="image-20230331183412462"></li></ul><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><ul><li><p><img src="/breeze/a1e1aa91/image-20230331193711680.png" alt="image-20230331193711680"></p></li><li><p>实现步骤：</p></li><li><p>1、在实体类的属性上加入@TableField注解，指定自动填充的策略</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该代码片段在entity包下的Employee类中</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span>            <span class="comment">// 插入时填充字段</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>     <span class="comment">// 插入和更新时填充字段</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span>            <span class="comment">// 插入时填充字段</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>     <span class="comment">// 插入和更新时填充字段</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br></pre></td></tr></table></figure><ul><li>2、按照框架要求编写元数据处理器，在此类中统一为公共字段赋值，此类需要实现MetaObjectHandler接口</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.common;    <span class="comment">// 该类在common包中，表示该类是通用的</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.common</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: MyMetaObjectHandler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 自定义元数据对象处理器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年03月31日 19:53:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入操作，自动填充</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 项目启动的时候，该方法并不会执行，该方法会在执行insert操作的时候才会执行</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line"><span class="comment">//        log.info(&quot;公共字段自动填充[insert]...&quot;);</span></span><br><span class="line"><span class="comment">//        log.info(metaObject.toString());</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里创建者的id是需要从session获取的，而session需要request对象获取，显然这里创建者的id是不能直接获取的</span></span><br><span class="line">        <span class="comment">// 所以这里先写死，后面在进行功能的完善，动态获取id</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;createUser&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 同上，这里的id也是不能直接获取的</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 项目启动的时候，该方法并不会执行，该方法会在执行update操作的时候才会执行</span></span><br><span class="line">    <span class="comment">// 执行更新操作时，例如在员工列表中编辑某员工的信息，然后点击保存之后，metaObject会接收浏览器传过来的一个员工对象</span></span><br><span class="line">    <span class="comment">// 此时metaObject中就会有该员工对象的相关属性。</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新操作，自动填充</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> metaObject</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line"><span class="comment">//        log.info(&quot;公共字段自动填充[update]...&quot;);</span></span><br><span class="line"><span class="comment">//        log.info(metaObject.toString());</span></span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateTime&quot;</span>, LocalDateTime.now());</span><br><span class="line">        metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, <span class="keyword">new</span> <span class="title class_">Long</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>注意：当前我们设置createUser和updateUser为固定值，后面我们需要改造，改为动态获取当前登录用户的id</p></li><li><p>因为更新操作和插入操作的公共字段进行了自动填充，所以原EmployeeController中insert方法和update方法中的公共字段的设置操作就不需要了</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 该方法在EmployeeController类中</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增员工</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span> <span class="comment">// 从浏览器控制台可以看到，这里的请求是 /employee， 而在该类上已经写了该注解，所以这里不需要写了</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span>&#123;  <span class="comment">// 因为传的参数是JSON对象，所以加了@RequestBody注解</span></span><br><span class="line">        log.info(<span class="string">&quot;新增员工，员工信息：&#123;&#125;&quot;</span>, employee.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置初始密码123456，需要进行md5加密处理，后期员工可以自己登录账号，修改自己的密码</span></span><br><span class="line">        employee.setPassword(DigestUtils.md5DigestAsHex(<span class="string">&quot;123456&quot;</span>.getBytes()));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        employee.setCreateTime(LocalDateTime.now());    // 设置创建时间</span></span><br><span class="line"><span class="comment">//        employee.setUpdateTime(LocalDateTime.now());    // 设置更新时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        // 获得当前登录用户的id</span></span><br><span class="line"><span class="comment">//        Long empId = (Long) request.getSession().getAttribute(&quot;employee&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        employee.setCreateUser(empId);  // 创建人的id，就是当前用户的id（在进行添加操作的人的id）</span></span><br><span class="line"><span class="comment">//        employee.setUpdateUser(empId);  // 最后的更新人的id</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 直接调用了MybatisPlus的sava方法</span></span><br><span class="line">        employeeService.save(employee);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增员工成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id修改员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 因为前端提交的是put请求，所以用@PutMapping.前端的请求路径是employee，而employee在类上已经标注了，所以这里不需要写路径了</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">// 这里返回的对象是String类型，因为前端页面只需要对返回的code进行判断即可</span></span><br><span class="line">    <span class="comment">// 前端传过来的数据格式是JSON类型的，所以要用@RequestBody注解</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(HttpServletRequest request, <span class="meta">@RequestBody</span> Employee employee)</span>&#123;</span><br><span class="line">        log.info(employee.toString());  <span class="comment">// 查看员工信息是否封装成功(前端发送的请求，后端能否正常接收)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取本次执行操作的人(更新人)的id，当用户登录成功之后，该用户的id会以employee为key存储在session中</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long)request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据库表中有 update_time(更新时间) 和 update_user(更新人) 这两个字段</span></span><br><span class="line">        <span class="comment">// 在更新之前设置一下更新时间和更新人。这里的employee是前端传过来的参数，也就是被修改的员工</span></span><br><span class="line">            <span class="comment">// updateTime和updateUser在common中进行了公共字段填充，所以这里就不要在进行设置了</span></span><br><span class="line">        <span class="comment">// employee.setUpdateTime(LocalDateTime.now());</span></span><br><span class="line">        <span class="comment">// employee.setUpdateUser(empId);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试：根据控制台打印的sql语句(UPDATE employee SET status=?, update_time=?, update_user=? WHERE id=?)可知，</span></span><br><span class="line">        <span class="comment">// 该更新操作修改了三个字段，分别是上面获取的更新人和更新时间还有前端传过来的被修改人的id。</span></span><br><span class="line">        <span class="comment">// 最终结论：updateById()方法通过获取传入的employee实体的id字段，来修改该employee实体中封装的其它字段,employee中的所有字段均可修改</span></span><br><span class="line">        employeeService.updateById(employee);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;员工信息修改成功!&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-7"><a href="#功能测试-7" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>此时，除了createUser和updateUser为固定值，不能动态获取之外，其它功能都可以正常执行。</li></ul><h4 id="拓展：什么是ThreadLocal？"><a href="#拓展：什么是ThreadLocal？" class="headerlink" title="拓展：什么是ThreadLocal？"></a>拓展：什么是ThreadLocal？</h4><ul><li><p>ThreadLocal并不是一个Thread，而是Java中的一个线程局部变量，它可以为每个线程提供一个独立的变量副本，避免了线程安全问题。</p></li><li><p>ThreadLocal是一种Java中的线程局部变量，它允许在多线程环境中对于每个线程都创建一个变量的副本，而不是共享同一个变量实例。从名字我们可以看到，ThreadLocal叫做本地线程变量，意思是说，ThreadLocal中填充的是当前线程的变量，该变量对其他线程而言是封闭且隔离的。换句话说，ThreadLocal为变量在每个线程中创建了一个副本，这样每个线程都可以访问自己内部的副本变量，不会相互干扰。</p></li><li><p>ThreadLocal通常应用于每个线程需要独立保存一份变量，以供后续操作使用的情况，比如在Web开发中，HTTP请求的处理线程需要访问用户上下文信息，这些信息需要在整个请求处理过程中被多次调用，如果使用ThreadLocal就可以方便地将这些信息存储在ThreadLocal中，在每个线程中创建一个副本，并且随时可以获取和修改，不会对其他线程造成影响，且不需要显式地进行同步。</p></li><li><p>ThreadLocal常用方法：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span>	<span class="comment">// 设置当前线程的线程局部变量的值</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span>		<span class="comment">// 返回当前线程所对应的线程局部变量的值</span></span><br></pre></td></tr></table></figure><h3 id="功能完善"><a href="#功能完善" class="headerlink" title="功能完善"></a>功能完善</h3><h4 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h4><ul><li><p>前面我们已经完成了公共字段自动填充功能的代码开发，但是还有一个问题没有解决，就是我们在自动填充createuser和updateUser时设置的用户id是固定值，现在我们需要改造成动态获取当前登录用户的id。</p></li><li><p>思考：用户登录成功后我们将用户id存入了HttpSession中，现在我们可以直接从HttpSession中把用户id中取出来吗？ 答案：不可以。因为在MyMetaObjectHandler类中是不能获得HttpSession对象的，所以我们需要通过其它方式来获取登录用户的id。</p></li><li><p>可以使用ThreadLocal来解决此问题，它是JDK中提供的一个类。</p></li><li><p>在学习ThreadLocal之前，我们需要确认一个事情，就是客户端发送的每次http请求，对应的在服务端都会分配一个新的线程来处理，在处理过程中涉及到下面类中的方法都属于相同的一个线程：</p><ul><li><p>LoginCheckFilter的doFilter方法</p></li><li><p>EmployeeController的update方法</p></li><li><p>MyMetaObjectHandler的updateFill方法</p></li><li><p>可以在上面的三个方法中分别加入下面代码(获取当前线程id)：</p></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">id</span> <span class="operator">=</span> Thread.currentThread().getId();</span><br><span class="line">log.info(<span class="string">&quot;线程id:&#123;&#125;&quot;</span>, id);		</span><br></pre></td></tr></table></figure><ul><li><p>执行编辑员工功能进行验证，通过观察控制台输出可以发现，一次请求对应的线程id（这三个方法）是相同的</p></li><li><p><img src="/breeze/a1e1aa91/image-20230401132619379.png" alt="image-20230401132619379"></p></li><li><p>既然这三个方法是同一个线程来处理的，那我们就可以利用ThreadLocal来拿到相应的值.</p></li><li><p>我们可以在LoginCheckFilter的doFilter方法中获取当前登录用户的id，并调用ThreadLocal的set方法来设置当前线程的线程局部变量的值(用户id)，然后在MyMetaObjectHandler的updateFill方法中调用ThreadLocal的get方法来获得当前线程所对应的线程局部变量的值（用户id）。</p></li></ul><h4 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h4><ul><li>编写BaseContext工具类，基于ThreadLocal封装的工具类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.common</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: BaseContext</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 基于ThreadLocal封装的工具类，用来保存和获取登录用户的id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 13:53:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建threadLocal，用来存放用户id</span></span><br><span class="line">    <span class="comment">// 指定范型为Long，因为登录用户的id是Long类型的</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 获取id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在LoginCheckFilter的doFilter方法中调用BaseContext来设置当前登录用户的id</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line"><span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>) != <span class="literal">null</span>)&#123;  <span class="comment">// 能够获取到session中的信息</span></span><br><span class="line">    <span class="comment">// 打印日志，查看结果</span></span><br><span class="line">    log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>, request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取登录用户的id</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;employee&quot;</span>);</span><br><span class="line">    <span class="comment">// 将id存储到threadLocal中</span></span><br><span class="line">    BaseContext.setCurrentId(empId</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	从这里可以知道，只要用户登录成功了，就把该用户的id保存在了threadLocal中。那么，该用户修改、新增员工等不同的操作时，都可以从对应线程的threadLocal中拿到该员工的id.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    filterChain.doFilter(request, response);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在MyMetaObjectHandler的方法中调用BaseContext获取登录用户的id</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把处理器中的静态id改为动态获取</span></span><br><span class="line">metaObject.setValue(<span class="string">&quot;createUser&quot;</span>, BaseContext.getCurrentId());       metaObject.setValue(<span class="string">&quot;updateUser&quot;</span>, BaseContext.getCurrentId());</span><br></pre></td></tr></table></figure><h3 id="功能测试-8"><a href="#功能测试-8" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>这里用张三登录系统，对员工进行修改操作</li><li><img src="/breeze/a1e1aa91/image-20230401143106789.png" alt="image-20230401143106789"></li></ul><h2 id="02-新增分类"><a href="#02-新增分类" class="headerlink" title="02.新增分类"></a>02.新增分类</h2><h3 id="需求分析-4"><a href="#需求分析-4" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>后台系统中可以管理分类信息，分类包括两种类型，分别是菜品分类和套餐分类。当我们在后台系统中添加菜品时需要选择一个菜品分类，当我们在后台系统中添加一个套餐时需要选择一个套餐分类，在移动端也会按照菜品分类和套餐分类来展示对应的菜品和套餐。<ul><li><img src="/breeze/a1e1aa91/image-20230401144532459.png" alt="image-20230401144532459"></li></ul></li><li>可以在后台系统的分类管理页面分别添加菜品分类和套餐分类，如下：<ul><li><img src="/breeze/a1e1aa91/image-20230401144730911.png" alt="image-20230401144730911"></li></ul></li></ul><h3 id="数据模型-1"><a href="#数据模型-1" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li>新增分类，其实就是将我们新增窗口录入的分类数据插入到category表，表结构如下：<ul><li><img src="/breeze/a1e1aa91/image-20230401145014917.png" alt="image-20230401145014917" style="zoom:150%"></li></ul></li><li>需要注意，category表中对name字段加入了唯一约束，保证分类的名称是唯一的</li></ul><h3 id="代码开发-4"><a href="#代码开发-4" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li>在开发业务功能前，先将需要用到的类和接口基本结构创建好：</li><li>实体类Category（直接从课程资料中导入即可）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//类型 1 菜品分类 2 套餐分类</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//分类名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//顺序</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新时间</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建人</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改人</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Mapper接口CategoryMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Category;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CategoryMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 16:59:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Category&gt; &#123;</span><br><span class="line">    <span class="comment">// 所有的crud都编写完成了</span></span><br><span class="line">    <span class="comment">// 继承了BaseMapper,所有的方法来自父类，可扩展</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层接口CategoryService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Category;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CategoryService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 17:00:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层实现类CategoryServiceImpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.CategoryService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CategoryServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 17:02:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>控制层CategoryController</p><ul><li>在开发代码之前，需要梳理一下整个程序的执行过程：<ul><li>页面（backend&#x2F;page&#x2F;category&#x2F;list.html）发送ajax请求，将新增分类窗口输入的数据以json形式提交到服务端</li><li>服务端Controller接收页面提交的数据并调用Service将数据进行保存</li><li>Service调用Mapper操作数据库，保存数据</li></ul></li><li>可以看到新增菜品分类（type:”1”）和新增套餐分类（type:”2”）请求的服务端地址和提交的json数据结构相同，所以服务端只需要提供一个方法统一处理即可：<ul><li><img src="/breeze/a1e1aa91/image-20230401175112277.png" alt="image-20230401175112277"></li></ul></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CategoryController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 分类管理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 17:13:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增分类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>    <span class="comment">// 请求方式是post，这里不需要加路径，因为前端请求的路径就是到category，已经在类上面加了</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;  <span class="comment">// 前端是以json格式传过来的category，所以要加@RequestBody才能拿到数据</span></span><br><span class="line">        log.info(<span class="string">&quot;category:&#123;&#125;&quot;</span>, category);</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增分类成功!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="拓展：-RequestBody作用是什么，什么时候使用？"><a href="#拓展：-RequestBody作用是什么，什么时候使用？" class="headerlink" title="拓展：@RequestBody作用是什么，什么时候使用？"></a>拓展：@RequestBody作用是什么，什么时候使用？</h4><ul><li><p>@RequestBody主要用来接收前端传递给后端的请求体中的数据，即HTTP请求的body部分数据，通常使用JSON格式传递数据。在Spring MVC中，它的作用是将HTTP请求的body部分序列化为Java对象，并将其绑定到controller方法参数上，方便在代码中进行处理。</p></li><li><p>一般情况下，@RequestBody注解应该与POST请求一起使用，因为POST请求会携带请求体，而GET请求则不会。但是，如果确实需要在GET请求中使用@RequestBody注解，也可以通过在@RequestParam中添加required&#x3D;false的参数，允许该参数为空。</p></li><li><p>总之，当我们需要从请求体中获取数据时，就可以使用@RequestBody注解。它可以使得前后端交互更方便，同时也可以避免手动进行数据类型转换的麻烦。</p></li></ul><h3 id="功能测试-9"><a href="#功能测试-9" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>登录后，点击添加新增菜品分类，看是否成功，数据库中的记录是否发生变化</li></ul><h2 id="03-分类信息分页查询"><a href="#03-分类信息分页查询" class="headerlink" title="03.分类信息分页查询"></a>03.分类信息分页查询</h2><h3 id="需求分析-5"><a href="#需求分析-5" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>系统中的分类很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</li></ul><h3 id="代码开发-5"><a href="#代码开发-5" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>在开发代码之前，需要梳理一下整个流程的执行过程：</p><ul><li>页面发送ajax请求，将分页查询参数（page、pageSize）提交到服务器</li><li>服务端Controller接收页面提交的数据并调用Service查询数据</li><li>Service调用Mapper操作数据库，查询分页数据</li><li>Controller将查询到的分页数据响应给页面</li><li>页面接收到分页数据并通过ElementUI的Table组件显示到页面上</li></ul></li><li><img src="/breeze/a1e1aa91/image-20230401190604746.png" alt="image-20230401190604746" style="zoom:150%"></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在CategoryController类中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize)</span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个分页构造器</span></span><br><span class="line">    Page&lt;Category&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个条件构造器，根据sort字段进行排序</span></span><br><span class="line">    <span class="comment">// 注意这个条件构造器一定要使用泛型，否则使用条件查询这个方法的时候会报错</span></span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加排序条件，根据sort进行排序</span></span><br><span class="line">    queryWrapper.orderByAsc(Category :: getSort);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进行分页查询</span></span><br><span class="line">    categoryService.page(pageInfo, queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-10"><a href="#功能测试-10" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><p>没有进行分页处理的时候，页面是这样的：</p><ul><li><img src="/breeze/a1e1aa91/image-20230401195501987.png" alt="image-20230401195501987"></li></ul></li><li><p>当进行分页处理之后，页面是这样的：</p><ul><li><img src="/breeze/a1e1aa91/image-20230401200717777.png" alt="image-20230401200717777"></li></ul></li></ul><h2 id="04-删除分类（这里有重点）"><a href="#04-删除分类（这里有重点）" class="headerlink" title="04.删除分类（这里有重点）"></a>04.删除分类（这里有重点）</h2><h3 id="需求分析-6"><a href="#需求分析-6" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>在分类管理列表页面，可以对某个分类进行删除操作。需要注意的是当分类关联了菜品或者套餐时，此分类不允许删除。</li><li><img src="/breeze/a1e1aa91/image-20230401201720692.png" alt="image-20230401201720692"></li></ul><h3 id="代码开发-6"><a href="#代码开发-6" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>在开发代码之前，需要梳理一下整个程序的执行过程：</p><ul><li>页面发送ajax请求，将参数（id）提交到服务端</li><li>服务端Controller接收页面提交的数据并调用Service删除数据</li><li>Service调用Mapper操作数据库</li></ul></li><li><p><img src="/breeze/a1e1aa91/image-20230401203153383.png" alt="image-20230401203153383"></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 根据id删除分类，后面有该方法的功能完善</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@DeleteMapping</span></span><br><span class="line">  <span class="comment">// 因为前端的参数名是ids，而要想该方法能够获取到前端传过来的参数，有两种方法：</span></span><br><span class="line">  <span class="comment">// 1. 定义该控制器的变量名为ids，即：Long ids</span></span><br><span class="line">  <span class="comment">// 2. 通过使用@RequestParam注解，指定传入的参数名，如下：</span></span><br><span class="line">  <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> Long id)</span>&#123;</span><br><span class="line">      log.info(<span class="string">&quot;删除分类，id为：&#123;&#125;&quot;</span>, id);</span><br><span class="line">      categoryService.removeById(id);</span><br><span class="line">      <span class="keyword">return</span> R.success(<span class="string">&quot;分类信息删除成功!&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="拓展1：java后端方法形参名与前端传参名是否需要保持一致？"><a href="#拓展1：java后端方法形参名与前端传参名是否需要保持一致？" class="headerlink" title="拓展1：java后端方法形参名与前端传参名是否需要保持一致？"></a>拓展1：java后端方法形参名与前端传参名是否需要保持一致？</h4><ul><li>Java后端方法的形参名并不一定要和前端传过来的参数名字一样。在Spring MVC等框架中，可以通过@RequestParam注解来实现将HTTP请求参数映射到Java方法的形参上。</li><li>@RequestParam注解中有一个value属性，可以指定请求参数的名称，如果不指定该属性，则默认使用形参的名称作为请求参数的名称。而前端传过来的请求参数的名称则是由前端人员定义的，通常都是根据接口文档来确定的。</li><li>因此，Java后端方法的形参名只需要与@RequestParam注解中的value属性名对应即可。如果不匹配，也可以通过修改@RequestParam注解的value属性来实现参数的映射。</li><li>总之，Java后端方法的形参名和前端传递的参数名并没有必然的联系，而是通过@RequestParam等注解来进行映射的。</li></ul><h4 id="拓展2：-RequestParam注解的使用"><a href="#拓展2：-RequestParam注解的使用" class="headerlink" title="拓展2：@RequestParam注解的使用"></a>拓展2：@RequestParam注解的使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加与不加的区别</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test1</span><span class="params">(<span class="type">int</span> userId)</span> &#123;</span><br><span class="line">　　<span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">int</span> userId)</span> &#123;</span><br><span class="line">　　<span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">（<span class="number">1</span>）不加<span class="meta">@RequestParam</span>前端的参数名需要和后端控制器的变量名保持一致才能生效</span><br><span class="line">（<span class="number">2</span>）不加<span class="meta">@RequestParam</span>参数为非必传，加<span class="meta">@RequestParam</span>写法参数为必传。但<span class="meta">@RequestParam</span>可以通过<span class="meta">@RequestParam(required = false)</span>设置为非必传。</span><br><span class="line">（<span class="number">3</span>）<span class="meta">@RequestParam</span>可以通过<span class="meta">@RequestParam(“userId”)</span>或者<span class="meta">@RequestParam(value = “userId”)</span>指定传入的参数名。</span><br><span class="line">（<span class="number">4</span>）<span class="meta">@RequestParam</span>可以通过<span class="meta">@RequestParam(defaultValue = “0”)</span>指定参数默认值</span><br><span class="line">（<span class="number">5</span>）如果接口除了前端调用还有后端RPC调用，则不能省略<span class="meta">@RequestParam</span>，否则RPC会找不到参数报错</span><br><span class="line">（<span class="number">6</span>）访问时：</span><br><span class="line">	不加<span class="meta">@RequestParam</span>注解：url可带参数也可不带参数，输入 localhost:<span class="number">8080</span>/list1 以及 localhost:<span class="number">8080</span>/list1?userId=xxx 方法都能执行</span><br><span class="line">	加<span class="meta">@RequestParam</span>注解：url必须带有参数。也就是说你直接输入localhost:<span class="number">8080</span>/list2 会报错，不会执行方法。只能输入localhost:<span class="number">8080</span>/list2?userId=xxx 才能执行相应的方法</span><br></pre></td></tr></table></figure><h3 id="功能测试-11"><a href="#功能测试-11" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>数据成功被删除</li></ul><h3 id="功能完善-1"><a href="#功能完善-1" class="headerlink" title="功能完善"></a>功能完善</h3><ul><li><p>前面我们已经实现了根据id删除分类的功能，但是并没有检测删除的分类是否关联了菜品或者套餐，所以我们需要进行功能完善。</p></li><li><p>要完善分类删除功能，需要先准备基础的类和接口：</p></li><li><p>实体类Dish和Setmeal（从课程资料中赋值即可）</p></li><li><p>实体类Dish</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 菜品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dish</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品价格</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//商品码</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//0 停售 1 起售</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//顺序</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>实体类Setmeal</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Setmeal</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐价格</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//状态 0:停用 1:启用</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//编码</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>Mapper接口DishMapper和SetmealMapper</p></li><li><p>DishMapper</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:35:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Dish&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>SetmealMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Setmeal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:37:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Setmeal&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>Service接口DishService和SetmealService</p></li><li><p>DishService</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Dish;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:39:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Dish&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>SetmealService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Setmeal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:40:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Setmeal&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>Service实现类DishServiceImpl和SetmealServiceImpl</p><ul><li>DishServiceImpl</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:43:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;DishMapper, Dish&gt; <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>SetmealServiceImpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.SetmealMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:44:44</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>在CategoryService中添加自定义的方法，MybatisPlus提供的删除方法不能满足业务需求</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Category;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CategoryService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 17:00:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CategoryService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Category&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// java接口里的方法默认是abstract的，public 的；不可以private 的，不可以是protected 的。</span></span><br><span class="line">    <span class="comment">// 进行共能完善，定义自己的删除方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>CategoryService实现类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.CustomException;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.CategoryMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.CategoryService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CategoryServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月01日 17:02:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除分类，删除之前需要进行判断</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询当前分类是否关联了菜品，如果已经关联，抛出一个业务异常</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建条件构造器</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; dishLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加查询条件，根据分类id进行查询</span></span><br><span class="line">        dishLambdaQueryWrapper.eq(Dish::getCategoryId, id);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count1</span> <span class="operator">=</span> dishService.count(dishLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(count1 &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// 已经关联菜品，抛出一个业务异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下关联了菜品，不能删除!&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 要想在浏览器页面上能够显示异常信息，需要在全局的异常处理器(GlobalExceptionHandler)中定义。</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询当前分类是否关联了套餐，如果已经关联，抛出一个业务异常</span></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; setmealLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        setmealLambdaQueryWrapper.eq(Setmeal::getCategoryId, id);</span><br><span class="line">        <span class="type">long</span> <span class="variable">count2</span> <span class="operator">=</span> setmealService.count(setmealLambdaQueryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count2 &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">// 已经关联套餐，抛出一个业务异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;当前分类下关联了套餐，不能删除!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (上面的两个if都没有成立，说明没有关联)正常删除分类</span></span><br><span class="line">        <span class="comment">// 直接调用父类的removeById方法，也就是MybatisPlus中，ServiceImpl中的方法</span></span><br><span class="line">        <span class="built_in">super</span>.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>自定义异常类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.common</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CustomException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 自定义业务异常类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 13:14:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CustomException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>为了使能在浏览器页面上显示抛出的异常信息，需要在全局异常处理器(GlobalExceptionHandler)中定义</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 处理自定义的异常，为了让前端展示我们的异常信息，这里需要把异常进行全局捕获，然后返回给前端</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ExceptionHandler(CustomException.class)</span>   <span class="comment">// 处理指定异常</span></span><br><span class="line">  <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">exceptionHandler</span><span class="params">(CustomException ex)</span>&#123;</span><br><span class="line">      log.error(ex.getMessage()); <span class="comment">// 在控制台打印报错的日志信息</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> R.error(ex.getMessage());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="功能再测试"><a href="#功能再测试" class="headerlink" title="功能再测试"></a>功能再测试</h3><ul><li>自己随便新增菜品分类或者套餐分类，但是不要关联数据，则新增分类可以正常删除；如果删除数据库中原本有关联数据的套餐，则不会删除，并且前端页面会抛出异常信息。</li></ul><h2 id="05-修改分类"><a href="#05-修改分类" class="headerlink" title="05.修改分类"></a>05.修改分类</h2><h3 id="需求分析-7"><a href="#需求分析-7" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>在分类管理列表页面点击修改按钮，弹出修改窗口，在修改窗口回显分类信息并进行修改，最后点击确定按钮完成修改操作。</li><li><img src="/breeze/a1e1aa91/image-20230402135347403.png" alt="image-20230402135347403"></li><li>这里的数据回显操作，前端已经做好了，并没有和后端服务进行交互。当我们点击确定按钮之后，就是在为classData.name classData.sort classData.id 模型数据赋值，赋好值之后就可以自动的进行数据回显了。</li><li><img src="/breeze/a1e1aa91/image-20230402140050596.png" alt="image-20230402140050596"></li></ul><h3 id="代码开发-7"><a href="#代码开发-7" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p><img src="/breeze/a1e1aa91/image-20230402141026847.png" alt="image-20230402141026847"></p></li><li><p>根据上面的图片可以知道，本次请求的地址是category，请求方式是put，请求携带的参数有id,name,sort,并且是json格式传到后端的，所以可以把传过来的数据封装成一个category对象。因为是以json格式传到后端的，所以后端控制器要加@RequestBody注解。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在CategoryController类中</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id修改分类信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;修改分类信息:&#123;&#125;&quot;</span>, category);</span><br><span class="line">    categoryService.updateById(category);</span><br><span class="line">    <span class="comment">// 这里不再需要设置更新人和创建人等公共字段的信息，因为之前进行了公共字段自动填充设置。</span></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改分类信息成功!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-12"><a href="#功能测试-12" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>对分类进行修改测试，看数据能否修改成功。</li></ul><h1 id="第四章-菜品管理业务开发"><a href="#第四章-菜品管理业务开发" class="headerlink" title="第四章 菜品管理业务开发"></a>第四章 菜品管理业务开发</h1><h2 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h2><ul><li><img src="/breeze/a1e1aa91/image-20230402142832083.png" alt="image-20230402142832083"></li><li><img src="/breeze/a1e1aa91/image-20230402142916801.png" alt="image-20230402142916801"></li></ul><h2 id="01-文件上传下载（重点）"><a href="#01-文件上传下载（重点）" class="headerlink" title="01.文件上传下载（重点）"></a>01.文件上传下载（重点）</h2><h3 id="文件上传介绍"><a href="#文件上传介绍" class="headerlink" title="文件上传介绍"></a>文件上传介绍</h3><ul><li><p>文件上传，也称upload，是指将本地图片、视频、音频等文件上传到服务器上，可以供其他用户浏览或下载的过程。文件上传在项目中应用非常广泛，我们经常发微博、发微信朋友圈都用到了文件上传功能。</p></li><li><p>文件上传时，对页面的form表单有如下要求：</p><ul><li><table><thead><tr><th align="left">method&#x3D;”post”</th><th align="left">采用post方式提交数据</th></tr></thead><tbody><tr><td align="left">enctype&#x3D;”multipart&#x2F;form-data”</td><td align="left">采用multipart格式上传文件</td></tr><tr><td align="left">type&#x3D;”file”</td><td align="left">使用input的file空间上传</td></tr></tbody></table></li></ul></li><li><p>举例：</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/common/upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;myFile&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="attr">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>目前一些前端组件库也提供了相应的上传组件，但是底层原理还是基于form表单的文件上传。例如ElementUI中提供的upload上传组件：</p><ul><li><img src="/breeze/a1e1aa91/image-20230402144558089.png" alt="image-20230402144558089"></li></ul></li><li><p>服务端要接收客户端页面上传的文件，通常都会使用Apache的两个组件</p><ul><li>commons-fileupload</li><li>commons-io</li></ul></li><li><p>Spring框架在spring-web包中对文件上传进行了封装，大大简化了服务端代码，我们只需要在Controller的方法中声明一个MultipartFile类型的参数即可接收上传的文件，例如：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 文件上传</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(value=&quot;/upload&quot;)</span></span><br><span class="line"><span class="comment">// 方法名随意，参数类型必须是MultipartFile，file表示上传的文件</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">    System.out.println(file);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="文件下载介绍"><a href="#文件下载介绍" class="headerlink" title="文件下载介绍"></a>文件下载介绍</h3><ul><li>文件下载，也称download，是指将文件从服务器传输到本地计算实际的过程。</li><li>通过浏览器进行文件下载，通常有两种表现形式：<ul><li>以附件形式下载，弹出保存对话框，将文件保存到指定磁盘目录。</li><li>直接在浏览器打开（因为浏览器支持打开这种格式的文件）。</li></ul></li><li>通过浏览器进行文件下载，本质上就是服务端将文件以流的形式写回浏览器的过程。</li></ul><h3 id="文件上传代码实现"><a href="#文件上传代码实现" class="headerlink" title="文件上传代码实现"></a>文件上传代码实现</h3><ul><li><p>文件上传，页面端可以使用ElementUI提供的上传组件。</p></li><li><p>可以直接使用资料中提供的上传页面，位置：资料&#x2F;文件上传下载页面&#x2F;upload.html.（将其放在resources&#x2F;page&#x2F;demo目录下）</p><ul><li><img src="/breeze/a1e1aa91/image-20230402150557822.png" alt="image-20230402150557822"></li></ul></li><li><p>前端页面需要注意的地方</p></li><li><p><img src="/breeze/a1e1aa91/image-20230402212535081.png" alt="image-20230402212535081"></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: CommonController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 进行文件上传和下载的处理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 21:28:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/common&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(value = &quot;$&#123;reggie.path&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String basePath;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 因为配置了过滤器，所以在浏览器地址栏上直接访问该控制器，是访问不了的（会被拦截）</span></span><br><span class="line"><span class="comment">     * 两种解决方法：</span></span><br><span class="line"><span class="comment">     *  1.先登录，然后再在浏览器地址栏上修改路径，访问该控制器</span></span><br><span class="line"><span class="comment">     *  2.在过滤器中对该控制器的访问请求放行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="comment">// 这里的参数必须是 MultipartFile类型的</span></span><br><span class="line">    <span class="comment">// 这里的参数名必须和页面上的标签&lt;input type=&quot;file&quot; name=&quot;file&quot; class=&quot;el-upload_input&quot;&gt;中的name一样，即file</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        log.info(file.toString());</span><br><span class="line">        <span class="comment">// 现在前端传过来的文件是一个临时文件，所以需要将该文件进行转存，否则当这次请求结束之后，该文件就不存在了</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取原始文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();   <span class="comment">// abc.jpg</span></span><br><span class="line">        <span class="comment">// 截取原始文件名的后缀，从最后一个 . 开始截取</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用UUID重新生成文件名，防止文件名重复造成文件覆盖，并手动拼接上文件名的后缀</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString() + suffix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建一个目录对象（用来接收上传的文件）</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(basePath);</span><br><span class="line">        <span class="comment">// 判断当前目录是否存在</span></span><br><span class="line">        <span class="keyword">if</span>(!dir.exists())&#123;</span><br><span class="line">            <span class="comment">// 目录不存在，则新建该目录</span></span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 将客户端传过来的临时文件转存到指定位置（并命名为hello.jpg）</span></span><br><span class="line">            <span class="comment">// file.transferTo(new File(&quot;D:\\hello.jpg&quot;)); // 路径写死了，在application.yml文件中进行路径的配置</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(basePath + fileName));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="拓展：SpringBoot中-Value的作用"><a href="#拓展：SpringBoot中-Value的作用" class="headerlink" title="拓展：SpringBoot中@Value的作用"></a>拓展：SpringBoot中@Value的作用</h3><ul><li><p>在Spring Boot中，使用@Value注解可以方便的注入配置文件中的属性值到java类中。@Value注解可用于注入单个基本类型的属性值，也可以用于注入集合类型的属性值。下面介绍一下@Value的使用方法</p></li><li><p>注入单个基本类型的属性值</p></li><li><p>在配置文件(application.properties或application.yml)中定义属性值，例如：</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">person.name=Tom</span></span><br></pre></td></tr></table></figure><ul><li>然后在Java类中使用@Value注解注入该属性值，例如：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">	<span class="meta">@Value(&quot;$&#123;person.name&#125;&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>其中，${}表示获取配置文件中的属性值，person.name为属性的名称，需要与配置文件中的名称保持一致。</p></li><li><p>注入集合类型的属性值</p></li><li><p>除了单个基本类型的属性值外，还可以使用@Value注解注入集合类型的属性值。假设在配置文件中定义了一个Map类型的属性值valuesMap，例如:</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">valuesMap=&#123;key1:</span> <span class="string">&#x27;1&#x27;</span><span class="string">,</span> <span class="attr">key2:</span> <span class="string">&#x27;2&#x27;</span><span class="string">,</span> <span class="attr">key3:</span> <span class="string">&#x27;3&#x27;</span><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>然后在Java类中使用@Value注解注入该Map属性值，例如：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValuesMap</span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;$&#123;valuesMap&#125;&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; valuesMap;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>其中，#{}表示SpEL表达式，${valuesMap}表示获取配置文件中的属性值，并将其转换为Map类型。</p></li><li><p>在Java类中使用@Value注解注入Map类型的属性值时，需要注意以下几点：</p><ul><li>@Value注解的value属性必须使用SpEL表达式</li><li>Map类型的属性值需要用#{}包裹</li></ul></li><li><p>在Java类中使用@Value注解时，需要注意以下几点：</p><ul><li>@Value注解必须放在待注入的属性前面</li><li>注入的属性必须是一个非final的变量</li></ul></li></ul><h3 id="文件下载代码实现"><a href="#文件下载代码实现" class="headerlink" title="文件下载代码实现"></a>文件下载代码实现</h3><ul><li>文件下载，页面端可以使用 <code>&lt;img&gt;</code> 标签展示下载的图片</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img v-<span class="keyword">if</span>=<span class="string">&quot;imageUrl&quot;</span> :src=<span class="string">&quot;imageUrl&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;avatar&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleAvatarSuccess</span>(<span class="params">response, file, fileList</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">imageUrl</span> = <span class="string">&#x27;/common/download=$&#123;response.data&#125;&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><img src="/breeze/a1e1aa91/image-20230403222634994.png" alt="image-20230403222634994"></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在CommonController类中</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(String name, HttpServletResponse response)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 输入流，通过输入流读取文件内容</span></span><br><span class="line">            <span class="comment">// bathPath文件存储的路径，name前端请求的要下载的文件名</span></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(basePath + name);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 输出流，通过输出流将文件写回浏览器，在浏览器展示图片</span></span><br><span class="line">            <span class="type">ServletOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置写回去的文件类型</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 准备一个字节数组，往该字节数组中读数据，一次最多读1024个字节</span></span><br><span class="line">            <span class="comment">// 避免一次只读一个字节，这样内存与硬盘之间的交互太频繁，效率较低</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">// 循环向byte数组中读数据，</span></span><br><span class="line">            <span class="comment">// 当方法返回-1，表示没有读取到任何数据，也说明已经读取到了文件的末尾</span></span><br><span class="line">            <span class="keyword">while</span>((len = fileInputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                outputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">                outputStream.flush();   <span class="comment">// 输出流需要刷新</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭资源</span></span><br><span class="line">            outputStream.close();</span><br><span class="line">            fileInputStream.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="02-新增菜品（重点是业务的实现）"><a href="#02-新增菜品（重点是业务的实现）" class="headerlink" title="02.新增菜品（重点是业务的实现）"></a>02.新增菜品（重点是业务的实现）</h2><h3 id="需求分析-8"><a href="#需求分析-8" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>后台系统中可以管理菜品信息，通过新增功能来添加一个新的菜品，在添加菜品时需要选择当前菜品所属的菜品分类,并且需要上传菜品图片，在移动端会按照菜品分类来展示对应的菜品信息。</li><li><img src="/breeze/a1e1aa91/image-20230403223130072.png" alt="image-20230403223130072"></li></ul><h3 id="数据模型-2"><a href="#数据模型-2" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li><p>新增菜品，其实就是将新增页面录入的菜品信息插入到dish表，如果添加了口味做法，还需要向dish_flavor表插入数据。所以在新增菜品时，涉及到两个表：</p></li><li><table><thead><tr><th align="left">dish</th><th align="left">菜品表</th></tr></thead><tbody><tr><td align="left"><strong>dish_flavor</strong></td><td align="left"><strong>菜品口味表</strong></td></tr></tbody></table></li><li><p><img src="/breeze/a1e1aa91/image-20230403223906212.png" alt="image-20230403223906212"></p></li><li><p><img src="/breeze/a1e1aa91/image-20230403224059626.png" alt="image-20230403224059626"></p></li></ul><h3 id="代码开发-8"><a href="#代码开发-8" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li>在开发业务功能前，先将需要用到的类和接口基本结构创建好：</li><li>实体类DishFlavor（直接从课程资料中导入即可，Dish实体前面课程中已经导入过了）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">菜品口味</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishFlavor</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品id</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//口味名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//口味数据list</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Mapper接口DishFlavorMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishFlavorMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月03日 22:47:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishFlavorMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;DishFlavor&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层接口DishFlavorService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.DishFlavor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishFlavorService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月03日 22:52:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishFlavorService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;DishFlavor&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层接口实现类DishFlavorServiceImpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.DishFlavorMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishFlavorService;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishFlavorServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月03日 22:55:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishFlavorServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;DishFlavorMapper, DishFlavor&gt; <span class="keyword">implements</span> <span class="title class_">DishFlavorService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>梳理交互过程</p><ul><li>页面（backend&#x2F;page&#x2F;food&#x2F;add.html）发送ajax请求，请求服务端获取菜品分类数据并展示到下拉框中。</li><li>页面发送请求进行图片上传，请求服务端将图片保存到服务器（该功能前面已经开发好了）。</li><li>页面发送请求进行图片下载，将上传的图片进行回显（该功能前面已经开发好了）。</li><li>点击保存按钮，发送ajax请求，将菜品相关数据以json形式提交到服务端。</li></ul></li><li><p>开发新增菜品功能，其实就是在服务端编写代码去处理前端页面发送的这四次请求即可。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230404123915660.png" alt="image-20230404123915660"></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在CategoryController类中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件查询分类数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 将前端传过来的type参数，封装到category实体中</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Category&gt;&gt; <span class="title function_">list</span><span class="params">(Category category)</span>&#123;</span><br><span class="line">    <span class="comment">// 条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 添加条件，根据前端传过来的type进行查询</span></span><br><span class="line">    queryWrapper.eq(category.getType() != <span class="literal">null</span>, Category::getType, category.getType());</span><br><span class="line">    <span class="comment">// 添加排序条件，优先使用sort进行排序，如果sort相同，就通过updateTime进行排序</span></span><br><span class="line">    queryWrapper.orderByAsc(Category::getSort).orderByDesc(Category::getUpdateTime);</span><br><span class="line">    List&lt;Category&gt; list = categoryService.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><img src="/breeze/a1e1aa91/image-20230404130031689.png" alt="image-20230404130031689"></p></li><li><p><img src="/breeze/a1e1aa91/image-20230404135132806.png" alt="image-20230404135132806"></p></li><li><p>接收页面提交的数据（涉及两张表）</p><ul><li><p>点击保存按钮的时候，把前端的json数据提交到后台，后台接收数据，对数据进行处理；要与两张表相关联，一个是dish表一个是dish_flavor表。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230404175844075.png" alt="image-20230404175844074"></p></li></ul></li><li><p>根据前端传过来的参数来选择接收这些数据的对象。这里传过来的参数比较复杂，所以提供两种方式进行参数的封装。</p></li><li><p>第一：使用map来接收。</p></li><li><p>第二：创建一个类来封装页面提交的数据。</p></li><li><p>导入DishDto（位置：资料&#x2F;dto）,用于封装页面提交的数据</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">// 继承Dish类，则继承了Dish类里面所有的属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishDto</span> <span class="keyword">extends</span> <span class="title class_">Dish</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用来封装flavors的</span></span><br><span class="line">    <span class="comment">// 菜品对应的口味数据</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 后面要使用的属性</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 后面要使用的属性</span></span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>注意：DTO，全称为Data Transfer Object，即数据传输对象，一般用于展示层与服务层之间的数据传输。</p></li><li><p>在DishService接口中定义一个新增菜品，同时插入菜品对应的口味数据的方法</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.dto.DishDto;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Dish;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:39:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Dish&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新增菜品，同时插入菜品对应的口味数据，需要操作两张表：dish、dish_flavor</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>在DishService接口的实现类中，实现该方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.dto.DishDto;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Dish;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.DishFlavor;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.DishMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishFlavorService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:43:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;DishMapper, Dish&gt; <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorService dishFlavorService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增菜品，同时保存对应的口味数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 因为涉及到多张表的操作，所以要添加事务控制。要想事务生效，需要在启动类上开启对事务的支持(@EnableTransactionManagement    // 开启对事务的支持)</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存菜品的基本信息到菜品表Dish</span></span><br><span class="line">        <span class="built_in">this</span>.save(dishDto);     <span class="comment">// 这里之所以可以直接传disDto，是因为DishDto继承了Dish</span></span><br><span class="line">        <span class="comment">// super.save(dishDto); 等价于this.save(dishDto);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注意：前端传过来的是categoryId。</span></span><br><span class="line">        <span class="comment">// 之前在application.yml文件中进行过全局配置，即每张表的每条记录的id字段都由雪花算法生成。</span></span><br><span class="line">        <span class="comment">// 但是一定要注意：每条记录中除了id字段是利用雪花算法生成的之外。还有xxxId不是生成的，需要对这类id进行传值</span></span><br><span class="line">        <span class="comment">// 这里取的id是将前端传过来的数据保存在dish表之后，利用雪花算法自动生成的id。也就是生成的菜品id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> dishDto.getId();  <span class="comment">// 获取菜品的id</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 得到前端提交的菜品口味</span></span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            flavors.stream(): 为list集合生成对应的Stream流，以一种函数式的编程风格来操作集合数据类型</span></span><br><span class="line"><span class="comment">            .map: 将集合中的每个元素转换为另一个新的元素</span></span><br><span class="line"><span class="comment">            (item) -&gt; &#123;&#125; : Lambda表达式，遍历出的每一项(都是json格式的口味分类)都取名为item，</span></span><br><span class="line"><span class="comment">            item.setDishId(dishId): 将之前获取的菜品id，写到item里面。其实就是写到dish_flavors表中</span></span><br><span class="line"><span class="comment">            return item; : 返回item</span></span><br><span class="line"><span class="comment">            .collect(Collectors.toList()); : 重新封装成一个集合对象，但是这个集合对象中的每一个元素都被重新加工了一下，都设置了dishId</span></span><br><span class="line"><span class="comment">            flavors = ... : 将得到的新的集合，重新赋值给flavors变量</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">       flavors =  flavors.stream().map((item) -&gt; &#123;</span><br><span class="line">            item.setDishId(dishId);</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存菜品口味数据到菜品口味表dish_flavor，因为flavors中有多条数据，所以采用saveBatch方法进行批量保存</span></span><br><span class="line">        dishFlavorService.saveBatch(flavors);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>控制层DishController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.dto.DishDto;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishFlavorService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.DishService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: DishController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: 菜品管理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月03日 23:02:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜品管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dish&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorService dishFlavorService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增菜品</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="comment">// 因为前端提交的是json格式的数据，所以要加@RequestBody注解</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sava</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span>&#123;</span><br><span class="line">        log.info(dishDto.toString());</span><br><span class="line"></span><br><span class="line">        dishService.saveWithFlavor(dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增菜品成功!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="拓展：什么是DTO以及DTO如何使用"><a href="#拓展：什么是DTO以及DTO如何使用" class="headerlink" title="拓展：什么是DTO以及DTO如何使用"></a>拓展：什么是DTO以及DTO如何使用</h4><ul><li><p>DTO即Data Transfer Object，数据传输对象，是一种Java的设计模式。它是一个简单的POJO对象（Plain Ordinary Java Object，普通Java对象），主要用于在不同层之间传递数据，避免直接暴露数据库实体给前端或其他层，从而增加了程序的安全性。</p></li><li><p>DTO通常是在业务层和展示层之间进行数据传输的，如在Spring框架中使用DTO可以在Web层与Service层之间传递数据，<strong>DTO对象除了包含业务数据外，还可以包含一些辅助属性、工具方法及验证数据等，方便对数据进行处理和校验</strong>。</p></li><li><p>使用DTO有以下几个<strong>好处</strong>：</p><ul><li><strong>简化数据的传输</strong>：DTO对象专门用来传输数据，可以<strong>封装多个实体或其他对象的数据</strong>，从而减少网络传输时的数据量，减轻服务器的负担。</li><li><strong>隐藏实现细节</strong>：DTO对象可以屏蔽实体类的实现细节，使各层之间的接口更加简单，降低耦合度，同时也增加了系统的安全性。</li><li><strong>支持数据自定义</strong>：<strong>DTO对象可以按照需求自定义属性和方法</strong>，更加贴近实际业务需要，提高代码可复用性。</li></ul></li><li><p>总之，当需要在不同层之间传递数据时，使用DTO对象可以简化数据传输的流程，提高程序的可重用性和安全性。</p></li><li><p>使用DTO的过程可以概括为以下几个步骤：</p><ul><li>定义DTO类：定义一个POJO对象，包含需要传输的数据属性及其getter&#x2F;setter方法。在业务逻辑中，需要将实体对象转换为DTO对象或者将DTO对象转换为实体对象。</li><li>数据转换：通过自定义Mapper或其他转换工具，将从数据库中查询到的实体对象转换成DTO对象，或者将DTO对象转换成实体对象。</li><li>在服务层与控制器之间进行数据传输：将DTO对象作为参数，传递给服务层操作来处理业务逻辑，最后再返回DTO对象给控制器，供前端调用。</li><li>在前端展示数据：控制器将DTO对象传递给前端页面，供用户展示数据。</li><li>数据验证：在DTO中添加验证逻辑，对于需要进行数据验证的字段进行验证操作</li></ul></li><li><p>下面是一个简单的DTO转换示例，假设有一个Student实体类和一个StudentDto数据传输对象：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getter/setter省略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentDto</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数、getter/setter方法省略</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> StudentDto <span class="title function_">from</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        <span class="type">StudentDto</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentDto</span>();</span><br><span class="line">        dto.setId(student.getId());</span><br><span class="line">        dto.setName(student.getName());</span><br><span class="line">        dto.setAge(student.getAge());</span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">toEntity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setId(<span class="built_in">this</span>.id);</span><br><span class="line">        student.setName(<span class="built_in">this</span>.name);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>上面的代码中，StudentDto类中包含了Student类中不存在的年龄(age)字段，并提供了from和toEntity两个转换方法，可以将实体对象(Student)转换成DTO对象(StudentDto)，以及将DTO对象(StudentDto)转换成实体对象(Student)。</li><li>总之，DTO是一个用于传输数据的POJO对象，在不同层之间传输数据时非常有用。进行DTO转换需要在定义DTO类时编写转换方法或使用其他转换工具实现，从而达到有效提高程序的可重用性和安全性的目的。</li></ul><h4 id="拓展：-Resource和-Autowired的使用和区别"><a href="#拓展：-Resource和-Autowired的使用和区别" class="headerlink" title="拓展：@Resource和@Autowired的使用和区别"></a>拓展：@Resource和@Autowired的使用和区别</h4><ul><li><p>@Resource和@Autowired都是Spring框架中用于依赖注入的注解。它们的作用都是将一个Bean注入到另一个Bean中，以实现依赖关系的自动装配。二者的区别如下：</p><ul><li>用法不同：@Resource是Java的注解，它在Java EE规范中定义，可以用于注入JNDI资源，EJB，Web服务等；而@Autowired则是Spring框架的注解，专门用于Spring容器中Bean的注入。</li><li>自动装配方式不同：@Resource实现自动装配的方式是通过名称匹配的方式来进行的，默认按照名称进行注入。如果没有指定name属性，它会将属性名作为Bean名称来进行查找并注入而<code>@Autowired</code>默认是按照类型进行自动装配的，如果多个Bean都满足依赖关系，它会根据Bean的名称进行选择性注入，并且还支持使用<code>@Qualifier</code>注解来指定要注入的Bean名称。</li><li>相关Class不同：<code>@Resource</code>是JSR250标准的注解，所以需要导入<code>javax.annotation.Resource</code>包才能使用；而<code>@Autowired</code>是Spring框架的注解，需要导入<code>org.springframework.beans.factory.annotation.Autowired</code>包才能使用。</li></ul></li><li><p>下面是@Resource和@Autowired的示例：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource(name=&quot;foo&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> FooService fooService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AutoWired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;bar&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BarService barService;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>在上面的示例中，@Resource注解将fooService注入到MyComponent中，使用指定名称foo来匹配Bean；而@Autowired注解将barService注入到@Component中，使用类型为BarService来进行自动装配，并且通过@Qualifier指定了要注入的Bean名称为bar</p></li><li><p>需要注意的是，在实际应用中，我们通常只会使用这两个注解中的其中一个。根据不同的应用场景和需求来选择使用哪个注解是很重要的。</p></li></ul><h4 id="拓展：使用-Autowired-注解导入-Mapper-对象报错的原因"><a href="#拓展：使用-Autowired-注解导入-Mapper-对象报错的原因" class="headerlink" title="拓展：使用 @Autowired 注解导入 Mapper 对象报错的原因"></a>拓展：使用 @Autowired 注解导入 Mapper 对象报错的原因</h4><ul><li><p>奇怪的是虽然代码报错，但丝毫不影响程序的正常执行，也就是虽然编译器 IDEA 报错，但程序却能正常的执行，那这其中的原因又是为何？</p></li><li><p>报错的原因首先是因为 IDEA 强大的报警机制，@Autowired 为 Spring 的注解，含义是将某类动态的注入到当前类中。@Autowired 默认是根据 type 进行注入，并且注入时要求（注入）对象不能为 NULL，默认值如下所示：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Declares whether the annotated dependency is required.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;Defaults to &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>IDEA 报错的原因是：@Autowired 为 Spring 的注解，而注入的 Mapper 对象使用的又是 @Mapper 的注解，然而 @Mapper 又为 MyBaits 的注解，IDEA 能很好的兼容并识别 Spring 的注解，但不能很好的识别 MyBatis 的注解，因此在使用 @Autowired 注解时，IDEA 并不能检测到 @Mapper 注解的对象不为 NULL，因此就会报错。</p></li><li><p>解决方案</p><ul><li><p>关闭报警机制。关闭IDEA注入报警机制，可以避免报错，实现步骤如下：</p><ul><li>打开 IDEA，找到参数设置选项 “Preferences…”</li><li>依次选择 “Editor” -&gt; “Inspections” -&gt; “Spring” -&gt; “Spring Core” -&gt; “Code” -&gt; “Autowiring for bean class” 将 “Error” 级别修改成 “Waring” 级别</li></ul></li><li><p>添加Spring注解。在 Mapper 的类(Mapper接口)上添加 Spring 的注解，也可以解决 IDEA 报错的问题，如 @Repository 或 @Component 这类注解</p></li><li><p>允许注入对象为NULL。设置允许注入的 Mapper 对象为 NULL，也可以避免 IDEA 报错，只需要设置 @Autowired(required&#x3D;false) 即可</p></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>()&#123;</span><br><span class="line">	<span class="meta">@Autowired(required = false)</span></span><br><span class="line">	<span class="keyword">private</span> UserMapper userMapper;    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>使用@Resource注解。使用 @Resource 注解替换 @Autowired 注解也可以避免报错。</p><ul><li>原因：@Resource 注解和 @Autowired 注解以当前的场景来说，它们的主要区别是 @Resource 是 Java 自身提供的注解，而 @Autowired 是 Spring 提供的注解，@Autowired 默认值为 required&#x3D;true，所以必须要一个非 NULL 的对象，当 IDEA 检测不到对象为 NULL 时就会报错，而 @Resource 并没有这项要求。</li></ul></li><li><p>总结：使用 @Autowired 注解导入 Mapper 对象报错的原因，是因为 @Autowired 默认情况下，需要注入一个非 NULL 的对象，而被 @Mapper 修饰的类为 MyBatis 的注解，IDEA 并不能很好的识别其为非 NULL 对象，因此就会报错。当然，它的解决方案也有很多，推荐使用 @Resource 替代 @Autowired 注解的方式来解决此问题。</p></li></ul><h4 id="拓展：Java中stream方法的使用"><a href="#拓展：Java中stream方法的使用" class="headerlink" title="拓展：Java中stream方法的使用"></a>拓展：Java中stream方法的使用</h4><ul><li><p>Java 8中Stream是一种新的抽象概念，它可以让你以一种函数式的编程风格来操作集合数据类型。Stream API 具有如下的特征：</p><ul><li>数据源：流的来源可以是集合，数组，I&#x2F;O channel，产生器generator等。</li><li>聚合操作：类似 SQL 语句一样的操作，比如 filter, map, reduce, find, match, sorted 等。</li><li>Pipelining：中间操作都会返回流对象本身。这样多个操作可以串联成一个管道(pipe)，如同流式风格(fluent style)。这样做可以对操作进行优化，比如延迟执行(laziness)和短路( short-circuiting)。</li><li>内部迭代：以前对集合遍历都是通过 Iterator 或者 For-Each 的方式, 显式地在集合外部进行迭代；Stream 提供了内部迭代的方式，通过访问者模式(Visitor)实现。</li></ul></li><li><p>使用Stream可以使得代码更加简洁、易读、易维护。下面是一些常用的Stream方法：</p></li><li><p><strong>创建Stream对象</strong></p><ul><li><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>Stream()</td><td>为Collection集合生成对应的Stream</td></tr><tr><td>of(T… values)</td><td>根据传入的一组可变参数来创建Strea</td></tr><tr><td>generate(Supplier s)</td><td>无限长度的Stream，由后面的Supplier生成元素</td></tr></tbody></table></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Array.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">Stream&lt;Integer&gt; stream1 = list.stream();</span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; stream2 = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">Stream&lt;Integer&gt; stream3 = Stream.generate(() -&gt; <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt());</span><br></pre></td></tr></table></figure><ul><li><p><strong>中间操作</strong></p><ul><li><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>filter(Predicate p)</td><td>过滤掉不符合条件的元素</td></tr><tr><td>map(Function f)</td><td>将集合中的每个元素转换为另一个新的元素</td></tr><tr><td>flatMap(Function f)</td><td>将多个Stream对象合并为一个</td></tr><tr><td>distinct()</td><td>去除重复元素</td></tr><tr><td>sorted()</td><td>排序</td></tr><tr><td>limit(long maxSize)</td><td>去除前n个元素</td></tr><tr><td>skip(long n)</td><td>删除前n个元素</td></tr></tbody></table></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Array.asList(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;car&quot;</span>, <span class="string">&quot;dog&quot;</span>);</span><br><span class="line">List&lt;String&gt; result = list.stream()</span><br><span class="line">    .filter(str -&gt; str.length() &gt; <span class="number">3</span>)</span><br><span class="line">    .map(String::toUpperCase)</span><br><span class="line">    .distinct()</span><br><span class="line">    .sorted()</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">System.out.println(result);	<span class="comment">// [APPLE, BANANA]</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure><ul><li><p>终止操作</p><ul><li><table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td>forEach(Consumer c)</td><td>遍历元素并进行指定操作</td></tr><tr><td>count()</td><td>统计Stream中元素的数量</td></tr><tr><td>max(Comparator c)</td><td>取出最大元素</td></tr><tr><td>min(Comparator c)</td><td>取出最小元素</td></tr><tr><td>reduce(T initial, BinaryOperator b)</td><td>至上而下归纳汇总</td></tr><tr><td>collect(Collector c)</td><td>将Stream转化为其他形式，如List、Set、Map等</td></tr><tr><td>toArray()</td><td>将Stream转化为数组</td></tr></tbody></table></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>, <span class="string">&quot;ghi&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line">list.stream()</span><br><span class="line">    .forEach(System.out::print);	<span class="comment">// abc, def, ghi, jkl</span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> list.stream.count();</span><br><span class="line">System.out.println(count);	<span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">Optional&lt;String&gt; maxStr = list.stream().max(String::comparaToIgnoreCase);</span><br><span class="line">System.out.println(maxStr.get());	<span class="comment">// jkl</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">reduceStr</span> <span class="operator">=</span> list.stream().reduce(<span class="string">&quot;&quot;</span>, String::concat);</span><br><span class="line">System.out.println(reduceStr);	<span class="comment">// abcdefghijkl</span></span><br></pre></td></tr></table></figure><ul><li><p>上述代码演示了如何使用Stream处理集合数据，这里只是列出了一些常用方法，更多的操作方式需要结合实际需求灵活运用。</p></li><li><p>Java中的Map集合也可以使用Stream方法。Map接口提供了多种操作Map的方法，因此我们可以通过这些方法将Map转换为一个流，然后针对流进行Stream API的操作。例如，我们可以使用Map.entrySet()方法将Map转换为一个由键值对映射关系（Entry）组成的集合视图，然后使用stream方法将其转换为一个流，最后使用Stream API的操作对该流进行处理。</p></li><li><p>以下是一个例子：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Integer&gt; wordCount = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">wordCount.put(<span class="string">&quot;hello&quot;</span>, <span class="number">2</span>);</span><br><span class="line">wordCount.put(<span class="string">&quot;world&quot;</span>, <span class="number">1</span>);</span><br><span class="line">wordCount.put(<span class="string">&quot;java&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">wordCount.entrySet().stream()</span><br><span class="line">         .filter(entry -&gt; entry.getValue() &gt; <span class="number">1</span>)</span><br><span class="line">         .forEach(System.out::println);</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>上述代码演示了如何使用Stream API的操作过滤出Map中值大于1的键值对。我们首先使用entrySet方法将map转化为一个键值对集合视图，然后再调用stream方法将其转化为一个流对象，最后使用filter和forEach方法对该流进行处理，输出符合条件的键值对。</li></ul><h3 id="功能测试-13"><a href="#功能测试-13" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>新建菜品，在页面上输入信息，看数据库中的dish表和dish_flavor表能否成功插入前端输入的数据。</li></ul><h2 id="03-菜品信息分页查询"><a href="#03-菜品信息分页查询" class="headerlink" title="03.菜品信息分页查询"></a>03.菜品信息分页查询</h2><h3 id="需求分析-9"><a href="#需求分析-9" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>系统中的菜品数据很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</li><li><img src="/breeze/a1e1aa91/image-20230404222248292.png" alt="image-20230404222248292"></li></ul><h3 id="代码开发-9"><a href="#代码开发-9" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li>在代码开发之前，需要梳理一下菜品分页查询时前端页面和服务端的交互过程：<ul><li>页面（backend&#x2F;page&#x2F;food&#x2F;list.html）发送ajax请求，将分页查询参数（page、pageSize、name）提交到服务端，获取分页数据。</li><li>页面发送请求，请求服务端进行图片下载，用于页面图片显示。（图片下载的请求前面已经写好了，前端也完成了相关的请求和数据回显，所以这里的图片下载和展示就不用管了）</li></ul></li><li>开发菜品信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这两次请求即可。</li><li><img src="/breeze/a1e1aa91/image-20230404225626455.png" alt="image-20230404225626455"></li><li>controller层代码，这里是有bug的，菜品管理页面的菜品分类显示不出来。只是单独使用Dish实体类作为泛型的话，则返回到前端的数据中有categoryId但是没有categoryName。因为dish表内没有categoryName字段，自然也就查询不到数据。所以前端的菜品分类页面也就不会显示对应的菜品分类。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本方法在DishController中</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 菜品信息分页查询</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span>&#123;</span><br><span class="line"> </span><br><span class="line">       <span class="comment">// 构造分页构造器</span></span><br><span class="line">       Page&lt;Dish&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">// 构造条件构造器</span></span><br><span class="line">       LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"> </span><br><span class="line">       <span class="comment">// 添加过滤条件</span></span><br><span class="line">       queryWrapper.like(name != <span class="literal">null</span>, Dish::getName, name);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">// 添加排序条件</span></span><br><span class="line">       queryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">// 执行分页查询</span></span><br><span class="line">       dishService.page(pageInfo, queryWrapper);</span><br><span class="line"> </span><br><span class="line">       <span class="keyword">return</span> R.success(pageInfo);</span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure><ul><li><p>用dish实体类做泛型查询出的数据，显示到浏览器页面上是这样的：</p><ul><li><img src="/breeze/a1e1aa91/image-20230405202856855.png" alt="image-20230405202856855"></li></ul></li><li><p>改进，再以DishDto实体类为泛型创建一个分页构造器对象dishDtoPage。然后，再用BeaUtils工具类的copyProperties方法将dishPageInfo条件构造器中的属性值拷贝到dishDtoPage条件构造器中。为什么不直接使用dishDtoPage构造器进行业务处理呢？因为没有dish_dto这张表，也就没有要查询的数据。其他注意事项看下面代码中的注释。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230405212506004.png" alt="image-20230405212506004"></p></li><li><p>contrller中的代码</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本方法在DishController中</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 菜品信息分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造分页构造器</span></span><br><span class="line">        Page&lt;Dish&gt; dishPageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 要想前端页面的菜品分类也能正常展示对应的字段，还需要创建一个以DishDto为泛型的分页构造器对象</span></span><br><span class="line">        Page&lt;DishDto&gt; dishDtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, pageSize);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造条件构造器</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加过滤条件</span></span><br><span class="line">        queryWrapper.like(name != <span class="literal">null</span>, Dish::getName, name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加排序条件</span></span><br><span class="line">        queryWrapper.orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行分页查询</span></span><br><span class="line">        dishService.page(dishPageInfo, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对象拷贝，使用的是框架自带的工具类，第三个参数是不拷贝的属性。（被忽略掉）</span></span><br><span class="line">        <span class="comment">// 为什么要忽略掉records属性，不拷贝它呢？ctrl+鼠标左键点击Page，进入Page类中</span></span><br><span class="line">        <span class="comment">// 可以看到records属性对应的是一个list集合，这个集合里面封装的是数据列表。其实这里对应的就是</span></span><br><span class="line">        <span class="comment">// 菜品管理页面的列表数据。这个属性需要先单独处理一下，所以不拷贝。</span></span><br><span class="line">        <span class="comment">// 这里拷贝的其实不是列表中的菜品信息，而是列表除了菜品信息之外的其他信息。例如：查询总数，每页记录条数等。</span></span><br><span class="line">        BeanUtils.copyProperties(dishPageInfo, dishDtoPage, <span class="string">&quot;records&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理records这个集合</span></span><br><span class="line">        List&lt;Dish&gt; records = dishPageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将records这个集合处理成下面这样的类型</span></span><br><span class="line">        List&lt;DishDto&gt; list = records.stream().map((item) -&gt;&#123; <span class="comment">// item就是集合中的每一个菜品对象</span></span><br><span class="line">            <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">            <span class="comment">// 需要将item中的数据拷贝到dishDto中，这里拷贝的是菜品信息</span></span><br><span class="line">            BeanUtils.copyProperties(item, dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据菜品对象拿到它所对应的分类id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId(); <span class="comment">// 菜品的分类id</span></span><br><span class="line">        <span class="comment">// 根据菜品的分类id，得到它所对应的分类名称，这里需要用到categoryService(先在本类中注入该对象)。</span></span><br><span class="line">        <span class="comment">// 根据id查询分类对象（通过sql文件导入的数据可能有问题，这里可能出现根据categoryId找不到category的情况，后面就可能会出现空指针异常）</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 从分类对象中拿到分类名称</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();   <span class="comment">// 如果category是null，这里就会出现空指针异常</span></span><br><span class="line">                dishDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> dishDto;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将处理好的records集合放到dishDtoPage中</span></span><br><span class="line">        dishDtoPage.setRecords(list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里要注意返回的对象时dishDtoPage，不是dishPageInfo</span></span><br><span class="line">        <span class="keyword">return</span> R.success(dishDtoPage);  </span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-14"><a href="#功能测试-14" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>功能测试直接看页面的展示效果即可。下面的图片中，除了展示页面效果之外，还解释了图片展示的原理。</li><li>浏览器自动发送图片的下载请求，前端代码实现</li><li><img src="/breeze/a1e1aa91/image-20230405222228362.png" alt="image-20230405222228362"></li><li><img src="/breeze/a1e1aa91/image-20230405222218975.png" alt="image-20230405222218975"></li></ul><h2 id="04-修改菜品"><a href="#04-修改菜品" class="headerlink" title="04.修改菜品"></a>04.修改菜品</h2><h3 id="需求分析-10"><a href="#需求分析-10" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>在菜品管理列表页面点击修改按钮，跳转到修改菜品页面，在修改页面回显菜品相关信息并进行修改，最后点击确定按钮完成修改操作。</li><li><img src="/breeze/a1e1aa91/image-20230405224225833.png" alt="image-20230405224225833"></li></ul><h3 id="代码开发-10"><a href="#代码开发-10" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li>在开发代码之前，需要梳理一下修改菜品时前端页面（add.html）和服务端的交互过程：<ul><li>页面发送aja请求，请求服务端获取分类数据，用于菜品分类下拉框中数据显示。（前面做新增菜品的时候已经实现了）</li><li>页面发送ajax请求，请求服务端，根据id查询当前菜品信息，用于菜品信息回显。</li><li>页面发送请求，请求服务端进行图片下载，用于页图片回显。（前面页已经实现了）</li><li>点击保存按钮，页面发送ajax请求，将修改后的菜品相关数据以json形式提交到服务端。</li></ul></li><li>开发修改菜品功能，其实就是在服务端编写代码去处理前端页面发送的这4次请求即可。</li><li><img src="/breeze/a1e1aa91/image-20230406160957718.png" alt="image-20230406160957717"></li><li>因为前端要回显的数据包括dish表和dish_flavor表中的内容，在Controller中直接使用dishService去调用它现有(MybatisPlus提供的)的方法是完不成业务需求的，所以需要在dishService中定义自己的方法来完成功能需求。另外，要用DishDto来封装查询的数据用来给前端进行数据回显。</li><li>在DishService接口中自定义的方法：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id查询菜品信息和对应的口味信息</span></span><br><span class="line">DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure><ul><li>在DishServiceImpl实现类中完成自定义方法的业务功能：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> DishDto <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">       <span class="comment">// 查询菜品基本信息，从dish表查询</span></span><br><span class="line">       <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);   <span class="comment">// this就是当前对象</span></span><br><span class="line"> </span><br><span class="line">       <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">       <span class="comment">// 将根据id查询出的dish中的信息拷贝到dishDto中</span></span><br><span class="line">       BeanUtils.copyProperties(dish, dishDto);</span><br><span class="line"> </span><br><span class="line">       <span class="comment">// 根据菜品id查询当前菜品对应的口味信息，从dish_flavor表查询</span></span><br><span class="line">       LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       queryWrapper.eq(DishFlavor::getDishId, dish.getId());</span><br><span class="line">       List&lt;DishFlavor&gt; flavors = dishFlavorService.list(queryWrapper);</span><br><span class="line">       dishDto.setFlavors(flavors);</span><br><span class="line">       <span class="keyword">return</span> dishDto;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li>在DishContrller中完成数据回显：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 根据id查询菜品信息和对应的口味信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span>    <span class="comment">// restful风格，参数在路径上面，没有携带在？后面</span></span><br><span class="line">   <span class="comment">// 这里用到的泛型要用DishDto，因为前端展示需要用什么数据，我们就得提供什么数据</span></span><br><span class="line">   <span class="keyword">public</span> R&lt;DishDto&gt; <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;   <span class="comment">// 用该注解接收路径上的参数</span></span><br><span class="line">       <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> dishService.getByIdWithFlavor(id);</span><br><span class="line">       <span class="keyword">return</span> R.success(dishDto);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li><p><img src="/breeze/a1e1aa91/image-20230406173243759.png" alt="image-20230406173243759"></p></li><li><p>由上面的图片可以知道，当修改完菜品信息点击了保存按钮之后，会发送一个put方式的请求，并把菜品信息以json格式提交到后端。</p></li><li><p>修改菜品和新增菜品类型，也是需要添加新的方法。</p></li><li><p>在DishService接口中自定义的方法：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新菜品信息，同时更新对应的口味信息</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span>;</span><br></pre></td></tr></table></figure><ul><li>在DishServiceImpl实现类中完成自定义方法的业务功能，这里需要注意的是，由于需要同时更新两张表的数据，所以需要添加事务：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新菜品信息，同时更新对应的口味信息</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span>  <span class="comment">// 因为要修改两张表，所以要加事务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDto dishDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新dish表基本信息</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(dishDto);   <span class="comment">// DishDto是Dish的子类，这里传dishDto也可以修改dish表中的属性</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理当前菜品对应口味数据---dish_flavor的delete操作</span></span><br><span class="line">    LambdaQueryWrapper&lt;DishFlavor&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(DishFlavor::getDishId, dishDto.getId());</span><br><span class="line">    <span class="comment">// 提问：为什么这里不直接使用removeById方法呢，这样就不需要条件构造器了，不是更简单吗？</span></span><br><span class="line">    <span class="comment">// 因为dishFlavorService如果调用removeById方法的话，就是根据dish_flavor中的id来删除了</span></span><br><span class="line">    <span class="comment">// 我们的目的是删除菜品对应的口味信息，所以这里应该用菜品的id，所以需要条件构造器</span></span><br><span class="line">    dishFlavorService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加当前提交过来的口味数据---dish_flavor的insert操作</span></span><br><span class="line">    List&lt;DishFlavor&gt; flavors = dishDto.getFlavors();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加菜品口味的时候，需要给菜品口味添加菜品id</span></span><br><span class="line">    flavors = flavors.stream().map((item) -&gt; &#123;</span><br><span class="line">        item.setDishId(dishDto.getId());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    dishFlavorService.saveBatch(flavors);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在DishContrller中完成数据回显：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 修改菜品</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> dishDto</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@PutMapping</span></span><br><span class="line"> <span class="comment">// 因为前端提交的是json格式的数据，所以要加@RequestBody注解</span></span><br><span class="line"> <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span>&#123;</span><br><span class="line">     log.info(dishDto.toString());</span><br><span class="line">   </span><br><span class="line">     dishService.updateWithFlavor(dishDto);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> R.success(<span class="string">&quot;修改菜品成功!&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h4 id="拓展：-PathVariable注解的使用："><a href="#拓展：-PathVariable注解的使用：" class="headerlink" title="拓展：@PathVariable注解的使用："></a>拓展：@PathVariable注解的使用：</h4><ul><li>@PathVariable是Spring MVC中用于获取URL路径中变量值的注解。它常用于RESTful风格的接口中，用来获取客户端传入的URL路径参数。URL路径参数是URL路径中的一部分，以”{}”括起来，例如：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/user/&#123;userId&#125;</span><br></pre></td></tr></table></figure><ul><li>上面的路径中，”{userId}”就是一个URL路径参数，用于描述操作对象的标识，其值可以通过@PathVariable注解获取，并传入方法中进行处理。在Spring MVC中，使用@PathVariable注解来声明方法参数，当请求路径中的对应变量被匹配时，Spring会自动将该变量的值传入方法中，例如：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/users/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserById(id);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>在上面的代码中，@PathVariable注解声明了一个名为”id”的参数，Spring会自动将请求路径中的”id”变量的值传入该参数中，以便后续进行相关逻辑处理。总之，使用@PathVariable注解可以使得我们更方便、简洁地获取URL路径参数，方便开发RESTful风格的接口。</p></li><li><p>@PathVariable是Spring框架中用于获取URL中的参数值的注解。使用@PathVariable时需要注意以下几点：</p><ul><li>在controller类的方法中，使用@PathVariable注解在方法参数中声明要获取的参数名。</li><li>@PathVariable(value&#x3D;”参数名”)中的value指的是URL路径中的参数名，必须与@RequestMapping注解中的参数名相同。</li><li>如果URL中的参数名与方法参数的名称相同，则可以省略value。</li></ul></li></ul><h3 id="功能测试-15"><a href="#功能测试-15" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>数据都能正常修改成功。这一小节里面有很多需要注意的地方，要细心。</li></ul><h2 id="05-删除菜品（实战）"><a href="#05-删除菜品（实战）" class="headerlink" title="05.删除菜品（实战）"></a>05.删除菜品（实战）</h2><h2 id="06-停售菜品（实战）"><a href="#06-停售菜品（实战）" class="headerlink" title="06.停售菜品（实战）"></a>06.停售菜品（实战）</h2><h2 id="07-批量修改（实战）"><a href="#07-批量修改（实战）" class="headerlink" title="07.批量修改（实战）"></a>07.批量修改（实战）</h2><h2 id="08-批量删除（实战）"><a href="#08-批量删除（实战）" class="headerlink" title="08.批量删除（实战）"></a>08.批量删除（实战）</h2><h2 id="09-批量停售（实战）"><a href="#09-批量停售（实战）" class="headerlink" title="09.批量停售（实战）"></a>09.批量停售（实战）</h2><h1 id="第五章-套餐管理业务开发"><a href="#第五章-套餐管理业务开发" class="headerlink" title="第五章 套餐管理业务开发"></a>第五章 套餐管理业务开发</h1><h2 id="效果展示-1"><a href="#效果展示-1" class="headerlink" title="效果展示"></a>效果展示</h2><ul><li><img src="/breeze/a1e1aa91/image-20230406183522723.png" alt="image-20230406183522723"></li><li><img src="/breeze/a1e1aa91/image-20230406183813465.png" alt="image-20230406183813465"></li><li><img src="/breeze/a1e1aa91/image-20230406183937861.png" alt="image-20230406183937861"></li></ul><h2 id="01-新增套餐"><a href="#01-新增套餐" class="headerlink" title="01.新增套餐"></a>01.新增套餐</h2><h3 id="需求分析-11"><a href="#需求分析-11" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>套餐就是菜品的集合。后台系统中可以管理套餐信息，通过新增套餐功能来添加一个新的套餐，在添加套餐时需要选择当前套餐所属的套餐分类和包含的菜品，并且需要上传套餐对应的图片，在移动端会按照套餐分类来展示对应的套餐。</li><li><img src="/breeze/a1e1aa91/image-20230406192236514.png" alt="image-20230406192236514"></li></ul><h3 id="数据模型-3"><a href="#数据模型-3" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li>新增套餐，其实就是将新增页面录入的套餐信息插入到setmeal表，还需要向setmeal_dish表插入套餐和菜品关联数据。所以在新增套餐时，涉及到两张表：<ul><li>setmeal 套餐表</li><li><img src="/breeze/a1e1aa91/image-20230406195145648.png" alt="image-20230406195145648"></li><li>setmeal_dish 套餐菜品关系表</li><li><img src="/breeze/a1e1aa91/image-20230406195226405.png" alt="image-20230406195226405"></li></ul></li></ul><h3 id="代码开发-11"><a href="#代码开发-11" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>准备工作。在开发业务功能前，先将需要用到的类和接口基本结构创建好：</p></li><li><p>实体类SetmealDish（直接从课程资料中导入即可，Setmeal实体前面课程中已经导入过了）</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 套餐菜品关系</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealDish</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐id</span></span><br><span class="line">    <span class="keyword">private</span> Long setmealId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品id</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品名称 （冗余字段，这个name属性没有其实也是可以的），可以通过id去数据库表中查</span></span><br><span class="line">    <span class="comment">// 设计了这个冗余字段，就不用去数据库查了，需要展示名字的时候，直接用这个属性去展示就可以了</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品原价</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//份数</span></span><br><span class="line">    <span class="keyword">private</span> Integer copies;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//排序</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>DTO SetmealDto（直接从课程资料中导入即可）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.SetmealDish;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承了Setmeal，意味着该类有了Setmeal中的全部属性</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealDto</span> <span class="keyword">extends</span> <span class="title class_">Setmeal</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 除了继承自Setmeal中的属性外，还额外添加了两个属性</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SetmealDish&gt; setmealDishes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Mapper接口 SetmealDishMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.SetmealDish;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealDishMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月06日 21:11:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;SetmealDish&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层接口 SetmealDishService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.SetmealDish;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealDishService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月06日 21:12:52</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SetmealDishService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;SetmealDish&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层实现类 SetmealDishServiceImpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.SetmealDish;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.SetmealDishMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealDishService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealDishServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月06日 21:13:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealDishServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealDishMapper, SetmealDish&gt; <span class="keyword">implements</span> <span class="title class_">SetmealDishService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>控制层 SetmealController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealDishService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月06日 21:16:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService service;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>梳理交互过程。在开发代码之前，需要梳理一下新增套餐时前端页面和服务端的交互过程：</p><ul><li>页面（backend&#x2F;page&#x2F;combo&#x2F;add.html）发送ajax请求，请求服务端获取套餐分类数据并展示到下拉框中（前面已经开发好了）</li><li>页面发送ajax请求，请求服务端获取菜品分类数据并展示到添加菜品窗口中（前面已经开发好了）</li><li>页面发送ajax请求，请求服务端，根据菜品分类查询对应的菜品数据并展示到添加菜品窗口中</li><li>页面发送请求进行图片上传，请求服务端将图片保存到服务器（前面已完成）</li><li>页面发送请求进行图片下载，将上传的图片进行回显（前面已完成）</li><li>点击保存按钮，发送ajax请求，将套餐相关数据以json形式提交到服务端</li></ul></li><li><p>开发新增套餐功能，其实就是在服务端编写代码去处理前端页面发送的这六次请求即可</p></li><li><p>第一个和第二个交互过程前面已经开发好了。它们对应的请求分别是：第一次（list?type&#x3D;2&amp;page&#x3D;1&amp;pageSize&#x3D;1000），第二次（list?type&#x3D;1）。所以我们从第三个交互过程开始开发。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230406221833678.png" alt="image-20230406221833678"></p></li><li><p>代码实现：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在DishController中</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据套餐id（categoryId)查询对应的菜品数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dish</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 因为查询出的是一个套餐的所有菜品，所以我们用List集合来接收数据</span></span><br><span class="line">    <span class="comment">// 前端传过来的参数是categoryId,我们声明一个Long类型的参数接收前端数据是可以完成业务需求的</span></span><br><span class="line">    <span class="comment">// 但是我们为了使该方法更具有通用性，我们用Dish实体来接收参数。</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;Dish&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造查询条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加条件，查询状态为1（起售状态）的菜品</span></span><br><span class="line">        queryWrapper.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加排序条件</span></span><br><span class="line">        queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>功能测试：</p><ul><li><img src="/breeze/a1e1aa91/image-20230406223748092.png" alt="image-20230406223748092"></li></ul></li><li><p>第四和第五交互过程前面也已经开发好了，这里开发最后一个交互过程</p></li><li><p><img src="/breeze/a1e1aa91/image-20230407125559526.png" alt="image-20230407125559526"></p></li><li><p>代码实现：</p></li><li><p>需要同时操作两张表的数据，这里再SetmealService中扩展一个自定义的方法</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 新增套餐，同时需要保存套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><ul><li>在SetmealServiceImpl中实现扩展的方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.dto.SetmealDto;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Setmeal;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.SetmealDish;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.SetmealMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealDishService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月02日 12:44:44</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;SetmealMapper, Setmeal&gt; <span class="keyword">implements</span> <span class="title class_">SetmealService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService setmealDishService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐，同时需要保存套餐和菜品的关联关系</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">// 需要同时操作两张表，添加事务的支持</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithDish</span><span class="params">(SetmealDto setmealDto)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存套餐的基本信息，操作setmeal，执行insert操作</span></span><br><span class="line">        <span class="built_in">this</span>.save(setmealDto);      <span class="comment">// SetmealDto继承自Setmeal，所以这里直接保存即可</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取套餐和菜品的关系（但是要注意这里获取的数据中没有setmealId这个值，需要通过stream来处理一下）</span></span><br><span class="line">        List&lt;SetmealDish&gt; setmealDishes = setmealDto.getSetmealDishes();</span><br><span class="line">        setmealDishes = setmealDishes.stream().map((item) -&gt;&#123;</span><br><span class="line">            <span class="comment">// setmealDto.getId()[等价于setmeal.getId()] id是通过雪花算法自动生成的，当数据成功插入到表中后，就可以取出id了</span></span><br><span class="line">            <span class="comment">// 取出setmealId后，再添加到setmeal_dish表中</span></span><br><span class="line">            item.setSetmealId(setmealDto.getId());</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存套餐和菜品的关联信息，操作setmeal_dish，执行insert操作</span></span><br><span class="line">        setmealDishService.saveBatch(setmealDishes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>在SetmealController中处理请求：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.dto.SetmealDto;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.SetmealDish;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealDishService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.SetmealService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: SetmealController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月06日 21:16:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setmeal&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetmealController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SetmealService setmealService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SetmealDishService service;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增套餐</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> setmealDto</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="comment">// 前端传过来的参数中除了套餐信息外，还有关联的菜品信息。所以这里用SetmealDtao实体来封装</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;套餐信息：&#123;&#125;&quot;</span>, setmealDto);    <span class="comment">// 查看前端提交的数据能否被封装到setmealDto这个实体上</span></span><br><span class="line"></span><br><span class="line">        setmealService.saveWithDish(setmealDto);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;新增套餐成功!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>功能测试：<ul><li>此时套餐管理的列表展示功能还没有开发完毕，但是可以在数据库表查看新增套餐（setmeal)和新增套餐与菜品之间的关系(setmeal_dish)</li></ul></li></ul><h2 id="02-套餐信息分页查询"><a href="#02-套餐信息分页查询" class="headerlink" title="02.套餐信息分页查询"></a>02.套餐信息分页查询</h2><h3 id="需求分析-12"><a href="#需求分析-12" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>系统中的套餐数据很多的时候，如果在一个页面中全部展示出来会显得比较乱，不便于查看，所以一般的系统中都会以分页的方式来展示列表数据。</li><li><img src="/breeze/a1e1aa91/image-20230407135222628.png" alt="image-20230407135222628"></li></ul><h3 id="代码开发-12"><a href="#代码开发-12" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>梳理交互过程。在开发代码之前，需要梳理一下套餐分页查询是前端页面和服务端的交互过程：</p><ul><li>页面（backend&#x2F;page&#x2F;combo&#x2F;list.html）发送ajax请求，将分页查询参数（page、pageSize、name）提交到服务端，获取分页数据。</li><li>页面发送请求，请求服务端进行图片下载，用于页面图片展示（该功能前面已经开发好了）</li></ul></li><li><p>开发套餐信息分页查询功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230407140859466.png" alt="image-20230407140859466"></p></li><li><p>在SetmealController中的实现代码（重点）</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;Page&gt; <span class="title function_">page</span><span class="params">(<span class="type">int</span> page, <span class="type">int</span> pageSize, String name)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 分页构造器</span></span><br><span class="line">        Page&lt;Setmeal&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        Page&lt;SetmealDto&gt; dtoPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加查询条件，根据name进行like模糊查询</span></span><br><span class="line">        queryWrapper.like(name != <span class="literal">null</span>, Setmeal::getName, name);</span><br><span class="line">        <span class="comment">// 添加排序条件，根据更新时间降序排列</span></span><br><span class="line">        queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        setmealService.page(pageInfo, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 页面是需要展示套餐名称的，但是setmeal表里面只有套餐id(categoryId)没有套餐名称</span></span><br><span class="line">        BeanUtils.copyProperties(pageInfo, dtoPage, <span class="string">&quot;records&quot;</span>);</span><br><span class="line">        List&lt;Setmeal&gt; setmeals = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">        List&lt;SetmealDto&gt; list = setmeals.stream().map((item) -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 自己new出来的对象，里面所有的属性都是空</span></span><br><span class="line">            <span class="type">SetmealDto</span> <span class="variable">setmealDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetmealDto</span>();</span><br><span class="line">            <span class="comment">// 对象拷贝</span></span><br><span class="line">            BeanUtils.copyProperties(item, setmealDto);</span><br><span class="line">            <span class="comment">// 分类id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId();</span><br><span class="line">            <span class="comment">// 根据分类id查询分类对象，需要categoryService，在前面注入一下</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">            <span class="keyword">if</span> (category != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 分类名称</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                setmealDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> setmealDto;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        dtoPage.setRecords(list);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(dtoPage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-16"><a href="#功能测试-16" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><img src="/breeze/a1e1aa91/image-20230407145530703.png" alt="image-20230407145530703"></li></ul><h2 id="03-删除套餐"><a href="#03-删除套餐" class="headerlink" title="03.删除套餐"></a>03.删除套餐</h2><h3 id="需求分析-13"><a href="#需求分析-13" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>在套餐管理列表页面点击删除按钮，可以删除对应的套餐信息。也可以通过复选框选择多个套餐，点此批量删除按钮一次删除多个套餐。注意，对于状态为售卖中的套餐不能删除，需要先停售，然后才能删除。</li><li><img src="/breeze/a1e1aa91/image-20230407151747603.png" alt="image-20230407151747603"></li></ul><h3 id="代码开发-13"><a href="#代码开发-13" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>在开发代码之前，需要梳理一下删除套餐时前端页面和服务端的交互过程：</p><ul><li>删除单个套餐时，页面发送ajax请求，根据套餐id删除对应套餐<ul><li><img src="/breeze/a1e1aa91/image-20230407152150925.png" alt="image-20230407152150925"></li></ul></li><li>删除多个套餐时，页面发送ajax请求，根据提交的多个套餐id删除对应套餐<ul><li><img src="/breeze/a1e1aa91/image-20230407152249448.png" alt="image-20230407152249448"></li></ul></li></ul></li><li><p>开发删除套餐功能，其实就是在服务端编写代码去处理前端页面发送的这两次请求即可。</p></li><li><p>观察删除单个套餐和批量删除套餐的请求信息可以发现，两种请求的地址和请求方式都是相同的，不同的则是传递id的个数，所以在服务端可以提供一个方法来统一处理。</p></li><li><p>注意：删除套餐不仅仅是删除套餐表中的数据，还要删除套餐和菜品的关联数据。</p></li><li><p>这里在SetmealService接口中扩展一个自定义的方法。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除套餐，同时需要删除套餐和菜品的关联数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">removeWithDish</span><span class="params">(List&lt;Long&gt; ids)</span>;</span><br></pre></td></tr></table></figure><ul><li>SetmealServiceImpl实现自定义的方法：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除套餐，同时需要删除套餐和菜品的关联数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeWithDish</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// select count(*) from setmeal where id in(1,2,3) and stats=1</span></span><br><span class="line">    <span class="comment">// 查询套餐状态，确定是否可以删除</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.in(Setmeal::getId, ids);</span><br><span class="line">    queryWrapper.eq(Setmeal::getStatus, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="built_in">super</span>.count(queryWrapper);</span><br><span class="line">    <span class="comment">// 如果不能删除，抛出一个业务异常</span></span><br><span class="line">    <span class="keyword">if</span>(count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;套餐正在售卖中，不能删除!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果可以删除，先删除套餐表中的数据</span></span><br><span class="line">    <span class="built_in">this</span>.removeByIds(ids);</span><br><span class="line"></span><br><span class="line">    LambdaQueryWrapper&lt;SetmealDish&gt; queryWrapper1 = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper1.in(SetmealDish::getSetmealId, ids);</span><br><span class="line">    <span class="comment">// 删除关系表中的数据</span></span><br><span class="line">    setmealDishService.remove(queryWrapper1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>SetmealController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除套餐</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line"><span class="comment">// public R&lt;String&gt; delete(Long[] ids)&#123;     // 这样写也是正确的，不用加@RequestParam注解</span></span><br><span class="line">    log.info(<span class="string">&quot;ids:&#123;&#125;&quot;</span>, ids);</span><br><span class="line">    setmealService.removeWithDish(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;套餐数据删除成功!!&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="拓展：-RequestParam"><a href="#拓展：-RequestParam" class="headerlink" title="拓展：@RequestParam"></a>拓展：@RequestParam</h4><ul><li><p>通常情况下，我们在 Spring 框架中使用 @RequestParam 注解来获取 HTTP 请求中传递的参数值。具体来说，在以下的情况下需要用到 @RequestParam:</p><ul><li>当我们需要从某个请求的 URI 中获取参数时，可以使用 @RequestParam 注解来指定参数名，并将其绑定到对应的方法参数上。例如：<code>/user?id=123</code>，那么我们可以使用 <code>@RequestParam(&quot;id&quot;)</code> 来绑定 id 参数的值到方法参数上。</li><li>当我们需要从请求的表单数据中获取参数时，也可以使用 @RequestParam 注解来指定参数名，并将其绑定到对应的方法参数上。例如：在 POST 请求中提交一个表单，那么我们可以使用 <code>@RequestParam(&quot;username&quot;)</code> 来获取表单中的 username 参数值，然后绑定到方法参数上。</li><li>当我们需要通过请求头传递参数时，同样也可以使用 @RequestParam 注解来指定参数名，并将其绑定到对应的方法参数上。例如：在 HTTP 请求头中传递一个 token 参数，那么我们可以使用 <code>@RequestParam(&quot;token&quot;)</code> 来获取该参数值，并将其绑定到方法参数上。</li></ul></li><li><p>总之，当我们需要从 HTTP 请求中获取参数值，并将其绑定到对应的方法参数上时，就可以使用 @RequestParam 注解来实现。方法参数必须要有该注解才能正确获取到参数值。</p></li><li><p>@RequestParam 注解通常用于从 HTTP 请求中获取参数值，并将之绑定到对应的方法参数上。但在某些情况下，即使 URL 上携带了参数，也不需要使用 @RequestParam 注解来获取参数值。这些情况主要包括以下两种：</p></li><li><p>RESTful 风格的 URL： 在 RESTful 风格的 API 中，参数通常是以路径的形式出现在 URL 中的，因此我们可以使用 Spring 的 @PathVariable 注解来从 URL 中提取参数值。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/users/&#123;id&#125;/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">getOrdersByUserId</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>我们可以使用 @PathVariable 注解来将 URL 中的 {id} 参数值提取出来，并绑定到方法参数 userId 上。</p></li><li><p>URL 使用了默认参数值： 有些 URL 在请求时可能不会携带所有的参数，而某些参数可能已经定义了默认值。在这种情况下，可以将方法参数指定为可选参数，然后在方法中使用默认值来处理缺少的参数。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProducts</span><span class="params">(<span class="meta">@RequestParam(value = &quot;brand&quot;, defaultValue = &quot;all&quot;)</span> String brand,</span></span><br><span class="line"><span class="params">                                 <span class="meta">@RequestParam(value = &quot;category&quot;, defaultValue = &quot;all&quot;)</span> String category)</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>我们指定了两个可选的参数（品牌和分类），并将它们的默认值分别设置为 “all”。这样，在请求时如果没有携带这些参数，就会使用默认值来处理。</p></li><li><p>综上所述，当参数已经出现在 URL 中（如 RESTful 风格的 API）或者参数具有默认值时，我们可以不使用 @RequestParam 注解来获取参数值。</p></li></ul><h3 id="功能测试-17"><a href="#功能测试-17" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>成功完成业务需求</li></ul><h2 id="04-修改套餐（实战）"><a href="#04-修改套餐（实战）" class="headerlink" title="04.修改套餐（实战）"></a>04.修改套餐（实战）</h2><h2 id="05-停售套餐（实战）"><a href="#05-停售套餐（实战）" class="headerlink" title="05.停售套餐（实战）"></a>05.停售套餐（实战）</h2><h2 id="06-批量修改（实战）"><a href="#06-批量修改（实战）" class="headerlink" title="06.批量修改（实战）"></a>06.批量修改（实战）</h2><h2 id="07-批量删除（实战）"><a href="#07-批量删除（实战）" class="headerlink" title="07.批量删除（实战）"></a>07.批量删除（实战）</h2><h2 id="06-批量停售（实战）"><a href="#06-批量停售（实战）" class="headerlink" title="06.批量停售（实战）"></a>06.批量停售（实战）</h2><h1 id="第六章-手机验证码登录"><a href="#第六章-手机验证码登录" class="headerlink" title="第六章 手机验证码登录"></a>第六章 手机验证码登录</h1><h2 id="效果展示-2"><a href="#效果展示-2" class="headerlink" title="效果展示"></a>效果展示</h2><ul><li><img src="/breeze/a1e1aa91/image-20230407192919820.png" alt="image-20230407192919820"></li></ul><h2 id="短信发送"><a href="#短信发送" class="headerlink" title="短信发送"></a>短信发送</h2><h3 id="短信服务介绍"><a href="#短信服务介绍" class="headerlink" title="短信服务介绍"></a>短信服务介绍</h3><ul><li>目前市面上有很多第三方提供的短信服务,这些第三方短信服务会和各个运营商(移动、联通、电信)对接,我们只需要注册成为会员并且按照提供的开发文档进行调用就可以发送短信。需要说明的是,这些短信服务-般都 是收费服务。</li><li>常用短信服务：<ul><li>阿里云</li><li>华为云</li><li>腾讯云</li><li>京东</li><li>梦网</li><li>乐信</li></ul></li></ul><h3 id="阿里云短信服务"><a href="#阿里云短信服务" class="headerlink" title="阿里云短信服务"></a>阿里云短信服务</h3><ul><li>阿里云短信服务( Short Message Service)是广大企业客户快速触达手机用户所优选使用的通信能力。调用API或用群发助手，即可发送验证码、通知类和营销类短信;国内验证短信秒级触达,到达率最高可达99%;国际&#x2F;港澳台短信覆盖200多个国家和地区，安全稳定，广受出海企业选用。</li><li>应用场景：<ul><li>验证码</li><li>短信通知</li><li>推广短信</li></ul></li><li>这里没有去注册阿里云的短信服务</li></ul><h3 id="代码开发-14"><a href="#代码开发-14" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>使用阿里云短信服务发送短信，可以参照官方提供的文档即可</p></li><li><p>具体开发步骤：</p></li><li><p>导入maven坐标</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 阿里云短信服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-dysmsapi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>调用API</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.DefaultAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.IAcsClient;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsRequest;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.dysmsapi.model.v20170525.SendSmsResponse;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.exceptions.ClientException;</span><br><span class="line"><span class="keyword">import</span> com.aliyuncs.profile.DefaultProfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 短信发送工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送短信</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> signName 签名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> templateCode 模板</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> phoneNumbers 手机号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> param 参数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String signName, String templateCode,String phoneNumbers,String param)</span>&#123;</span><br><span class="line">		<span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">		<span class="type">IAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line"></span><br><span class="line">		<span class="type">SendSmsRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendSmsRequest</span>();</span><br><span class="line">		request.setSysRegionId(<span class="string">&quot;cn-hangzhou&quot;</span>);</span><br><span class="line">		request.setPhoneNumbers(phoneNumbers);</span><br><span class="line">		request.setSignName(signName);</span><br><span class="line">		request.setTemplateCode(templateCode);</span><br><span class="line">		request.setTemplateParam(<span class="string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span>+param+<span class="string">&quot;\&quot;&#125;&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">SendSmsResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getAcsResponse(request);</span><br><span class="line">			System.out.println(<span class="string">&quot;短信发送成功&quot;</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="手机验证码登录"><a href="#手机验证码登录" class="headerlink" title="手机验证码登录"></a>手机验证码登录</h2><h3 id="需求分析-14"><a href="#需求分析-14" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li><img src="/breeze/a1e1aa91/image-20230407195801958.png" alt="image-20230407195801958"></li></ul><h3 id="数据模型-4"><a href="#数据模型-4" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li>通过手机验证码登陆时，涉及的表为user表，即用户表。结构如下：</li><li><img src="/breeze/a1e1aa91/image-20230407195955433.png" alt="image-20230407195955433"></li></ul><h3 id="代码开发-15"><a href="#代码开发-15" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>在开发代码之前，需要梳理一下登录时前端页面和服务端的交互过程:</p><ul><li>在登录页面(front&#x2F; page&#x2F;login.html)输入手机号,点击[获取验证码]按钮,页面发送ajax请求，在服务端调用短信服务API给指定手机号发送验证码短信</li><li>在登录页面输入验证码，点击l登录]按钮，发送ajax请求，在服务端处理登录请求</li></ul></li><li><p>开发手机验证码登录功能，其实就是在服务端编写代码去处理前端页面发送的这2次请求即可。</p></li><li><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好:</p></li><li><p>实体类User (直接从课程资料中导入即可)</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//姓名</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//性别 0 女 1 男</span></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//身份证号</span></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//头像</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//状态 0:禁用，1:正常</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Mapper接口UserMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: UserMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月07日 21:04:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层接口UserService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: UserService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月07日 21:05:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层实现类UserServicelmpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: UserServicelmpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月07日 21:06:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServicelmpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>控制层UserController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.UserService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: UserController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月07日 21:07:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>工具类SMSUtils（已经在前面导入了）、ValidateCodeUtils (直接从课程资料中导入即可)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 随机生成验证码工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValidateCodeUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度为4位或者6位</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">generateValidateCode</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">code</span> <span class="operator">=</span><span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(length == <span class="number">4</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">9999</span>);<span class="comment">//生成随机数，最大为9999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">1000</span>;<span class="comment">//保证随机数为4位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(length == <span class="number">6</span>)&#123;</span><br><span class="line">            code = <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">999999</span>);<span class="comment">//生成随机数，最大为999999</span></span><br><span class="line">            <span class="keyword">if</span>(code &lt; <span class="number">100000</span>)&#123;</span><br><span class="line">                code = code + <span class="number">100000</span>;<span class="comment">//保证随机数为6位数字</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;只能生成4位或6位数字验证码&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 随机生成指定长度字符串验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateValidateCode4String</span><span class="params">(<span class="type">int</span> length)</span>&#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rdm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash1</span> <span class="operator">=</span> Integer.toHexString(rdm.nextInt());</span><br><span class="line">        <span class="type">String</span> <span class="variable">capstr</span> <span class="operator">=</span> hash1.substring(<span class="number">0</span>, length);</span><br><span class="line">        <span class="keyword">return</span> capstr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p><strong>修改LoginCheckFilter</strong>。前面我们已经完成了LoginCheckFilter过滤器的开发，此过滤器用来检查用户的登录状态。我们在进行手机验证码登录时，发送的请求需要在此过滤器处理时直接放行。若不设置对这两个请求的放行，则在前端页面点了获取验证码或者登录按钮后，页面依旧不会跳转到其它页面，会重新刷新一下到原页面。</p><ul><li><img src="/breeze/a1e1aa91/image-20230407211201420.png" alt="image-20230407211201420"></li></ul></li><li><p>在LoginCheckFilter过滤器中扩展程序，判断移动端用户登录状态：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4-2、判断登录状态，如果已登录，则直接放行</span></span><br><span class="line">     <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) != <span class="literal">null</span>)&#123;  <span class="comment">// 能够获取到session中的信息</span></span><br><span class="line">         <span class="comment">// 打印日志，查看结果</span></span><br><span class="line">         log.info(<span class="string">&quot;用户已登录，用户id为：&#123;&#125;&quot;</span>, request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>));</span><br><span class="line">   </span><br><span class="line">         <span class="comment">// 获取登录用户的id</span></span><br><span class="line">         <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> (Long) request.getSession().getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">         <span class="comment">// 将id存储到threadLocal中</span></span><br><span class="line">         BaseContext.setCurrentId(userId);</span><br><span class="line">   </span><br><span class="line">         filterChain.doFilter(request, response);</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><ul><li>注意：给的资料有点问题，需要修改一下。（将front&#x2F;page&#x2F;login.html）中的代码做如下修改：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getCode</span>(<span class="params"></span>)&#123;</span><br><span class="line">                   <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">code</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    			<span class="comment">// 这是手机号码的正则表达式</span></span><br><span class="line">                 <span class="comment">//   const regex = /^(13[0-9]&#123;9&#125;)|(15[0-9]&#123;9&#125;)|(17[0-9]&#123;9&#125;)|(18[0-9]&#123;9&#125;)|(19[0-9]&#123;9&#125;)$/;</span></span><br><span class="line">    </span><br><span class="line">    			<span class="comment">// 这是qq邮箱的正则表达式（用qq邮箱登录就用这个）</span></span><br><span class="line">    			<span class="keyword">const</span> regex = <span class="regexp">/^[1-9][0-9]&#123;4,10&#125;@qq.com$/</span>;</span><br><span class="line">    </span><br><span class="line">                   <span class="keyword">if</span> (regex.<span class="title function_">test</span>(<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>)) &#123;</span><br><span class="line">                       <span class="variable language_">this</span>.<span class="property">msgFlag</span> = <span class="literal">false</span></span><br><span class="line">                       <span class="comment">// this.form.code = (Math.random()*1000000).toFixed(0)	这样代码是资料中的</span></span><br><span class="line">                      <span class="title function_">sendMsgApi</span>(&#123;<span class="attr">phone</span>:<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span>&#125;) <span class="comment">// 这行代码时新加的</span></span><br><span class="line">                  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">msgFlag</span> = <span class="literal">true</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;,</span><br></pre></td></tr></table></figure><ul><li>在（front&#x2F;api&#x2F;login.js）中添加一个如下方法：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sendMsgApi</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> $axios(&#123;</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;user/sendMsg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        data</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>使用验证码登录(使用map接收数据)</p></li><li><p>注意：测试的时候明明发现前端页面明明填了验证码，但是验证码并没有被携带在前端的请求参数中，所有后端也没有拿到验证码这个数据。这是因为前端发请求的时候，参数携带少了。在（front&#x2F;api&#x2F;login.js）中做如下修改：</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">btnLogin</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">phone</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">form</span>.<span class="property">code</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 下面这行是资料中的代码，把这行注释掉</span></span><br><span class="line">        <span class="comment">// const res = await loginApi(&#123;phone:this.form.phone&#125;) </span></span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">loginApi</span>(<span class="variable language_">this</span>.<span class="property">form</span>)	<span class="comment">// 这是自己加的代码</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span></span><br><span class="line">            ......</span><br></pre></td></tr></table></figure><ul><li>在UserController中编写处理请求的代码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.utils.SMSUtils;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.utils.ValidateCodeUtils;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: UserController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月07日 21:07:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送手机短信验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(phone)) &#123;</span><br><span class="line">            <span class="comment">// 生成随机的4位验证码</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line">            log.info(<span class="string">&quot;code=&#123;&#125;&quot;</span>, code);  <span class="comment">// 将输入手机号后生成的验证码打印在控制台上</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用阿里云提供的短信服务API完成发送短信</span></span><br><span class="line">            <span class="comment">// 这行代码的作用是给输入的手机号发送短信，这里把它注释了</span></span><br><span class="line">            <span class="comment">// SMSUtils.sendMessage(&quot;瑞吉外卖&quot;, &quot;&quot;, phone, code);</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 下面代码的作用是给用qq邮箱登录的人发验证码的</span></span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                MailUtils.sendMail(<span class="string">&quot;3311415973@qq.com&quot;</span>, Integer.parseInt(code));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 需要将生成的验证码保存到Session</span></span><br><span class="line">            session.setAttribute(phone, code);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> R.success(<span class="string">&quot;手机验证码发送成功!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;手机验证码发送失败!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动端用户登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="comment">// 前端传过来的参数是 key-value形式的，所以这里可以用map来接收</span></span><br><span class="line">    <span class="comment">// 返回值是User,登录成功之后需要给页面返回用户信息，需要在浏览器端保存一份用户信息</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(map.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从Session中获取保存的验证码</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;phone&quot;</span>); <span class="comment">// phone是key,session是value</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 进行验证码的比对（页面提交的验证码和Session中保存的验证码比对）</span></span><br><span class="line">        <span class="keyword">if</span> (codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code)) &#123;</span><br><span class="line">            <span class="comment">// 如果能够比对成功，说明登录成功</span></span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">            queryWrapper.eq(User::getPhone, phone);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);   <span class="comment">// 根据条件构造器中的条件到数据库查询用户</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;   <span class="comment">// 数据库中没有该用户信息</span></span><br><span class="line">                <span class="comment">// 当前手机号对应的用户是否为新用户，自动完成注册</span></span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setPhone(phone);</span><br><span class="line">                <span class="comment">// status状态码，0表示禁用，1表示启用。数据库中设置了默认值为1，这里再显示定义一下（这里也可以不进行设置）。</span></span><br><span class="line">                user.setStatus(<span class="number">1</span>);</span><br><span class="line">                userService.save(user);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存用户登录状态</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>, user.getId()); <span class="comment">// 在session中保存用户的登录信息，这样就不会被过滤器拦截了</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> R.success(user);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;用户登录失败!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="功能测试-18"><a href="#功能测试-18" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>登录成功后，跳转到手机端页面（有时间自己尝试用qq邮箱登录）</li></ul><h2 id="qq邮箱登录"><a href="#qq邮箱登录" class="headerlink" title="qq邮箱登录"></a>qq邮箱登录</h2><ul><li><p>​	开启QQ邮箱传输协议服务</p><ul><li><p>进入QQ邮箱界面，点击设置——账户——开启以下两个服务，当开启IMAP&#x2F;<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=SMTP&spm=1001.2101.3001.7020">SMTP</a>会有一串密文密码，保存起来，那个就是我们项目中所需要用到的邮箱密码，并非是你的QQ密码。</p></li><li><p><img src="/breeze/a1e1aa91/image-20230408151300137.png" alt="image-20230408151300137"></p></li></ul></li><li><p>pom.xml配置邮箱服务依赖</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--邮箱验证码验证--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><h3 id="在配置文件application-yml中添加邮箱配置"><a href="#在配置文件application-yml中添加邮箱配置" class="headerlink" title="在配置文件application.yml中添加邮箱配置"></a>在配置文件application.yml中添加邮箱配置</h3></li><li><p>username就是你的QQ邮箱账号，password就是你刚刚开启的邮箱服务所给的密文</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 邮箱密码验证</span></span><br><span class="line"><span class="attr">mail:</span></span><br><span class="line">  <span class="attr">default-encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">  <span class="attr">username:</span> <span class="number">3311415973</span><span class="string">@qq.com</span></span><br><span class="line">  <span class="comment"># 授权码</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">usojqoqeiuimciad</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">qq.com</span></span><br></pre></td></tr></table></figure><ul><li><h3 id="编写一个邮箱工具类"><a href="#编写一个邮箱工具类" class="headerlink" title="编写一个邮箱工具类"></a>编写一个邮箱工具类</h3></li><li><p>这个工具来用来给使用qq邮箱登录的人，发送生成的验证码</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.Authenticator;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.Message;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.Message.RecipientType;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.PasswordAuthentication;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.Session;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.Transport;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.AddressException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.InternetAddress;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> com.sun.mail.util.MailSSLSocketFactory;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 邮件发送工具类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailUtils</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//发送第二封验证码邮件</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMail</span><span class="params">(String to, <span class="type">int</span> vcode)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//设置发送邮件的主机  smtp.qq.com</span></span><br><span class="line"> </span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;smtp.qq.com&quot;</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//1.创建连接对象，连接到邮箱服务器</span></span><br><span class="line"> </span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> System.getProperties();</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//Properties 用来设置服务器地址，主机名 。。 可以省略</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">//设置邮件服务器</span></span><br><span class="line"> </span><br><span class="line">        props.setProperty(<span class="string">&quot;mail.smtp.host&quot;</span>, host);</span><br><span class="line"> </span><br><span class="line">        props.put(<span class="string">&quot;mail.smtp.auth&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//SSL加密</span></span><br><span class="line"> </span><br><span class="line">        <span class="type">MailSSLSocketFactory</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MailSSLSocketFactory</span>();</span><br><span class="line"> </span><br><span class="line">        sf.setTrustAllHosts(<span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line">        props.put(<span class="string">&quot;mail.smtp.ssl.enable&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        props.put(<span class="string">&quot;mail.smtp.ssl.socketFactory&quot;</span>, sf);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//props：用来设置服务器地址，主机名；Authenticator：认证信息</span></span><br><span class="line"> </span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> Session.getDefaultInstance(props,<span class="keyword">new</span> <span class="title class_">Authenticator</span>() &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line"> </span><br><span class="line">            <span class="comment">//通过密码认证信息</span></span><br><span class="line"> </span><br><span class="line">            <span class="keyword">protected</span> PasswordAuthentication <span class="title function_">getPasswordAuthentication</span><span class="params">()</span> &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="comment">//new PasswordAuthentication(用户名, password);</span></span><br><span class="line"> </span><br><span class="line">                <span class="comment">//这个用户名密码就可以登录到邮箱服务器了,用它给别人发送邮件</span></span><br><span class="line"> </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PasswordAuthentication</span>(<span class="string">&quot;22-----246@qq.com&quot;</span>,<span class="string">&quot;hx--------eced&quot;</span>);</span><br><span class="line"> </span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessage</span>(session);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//2.1设置发件人：</span></span><br><span class="line"> </span><br><span class="line">            message.setFrom(<span class="keyword">new</span> <span class="title class_">InternetAddress</span>(<span class="string">&quot;22-----246@qq.com&quot;</span>));</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//2.2设置收件人 这个TO就是收件人</span></span><br><span class="line"> </span><br><span class="line">            message.setRecipient(RecipientType.TO, <span class="keyword">new</span> <span class="title class_">InternetAddress</span>(to));</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//2.3邮件的主题</span></span><br><span class="line"> </span><br><span class="line">            message.setSubject(<span class="string">&quot;来自在线视频播放平台网站验证码邮件&quot;</span>);</span><br><span class="line"> </span><br><span class="line">            <span class="comment">//2.4设置邮件的正文 第一个参数是邮件的正文内容 第二个参数是：是文本还是html的连接</span></span><br><span class="line"> </span><br><span class="line">            message.setContent(<span class="string">&quot;&lt;h1&gt;来自在线视频播放平台网站验证码邮件,请接收你的验证码：&lt;/h1&gt;&lt;h3&gt;你的验证码是：&quot;</span>+vcode+<span class="string">&quot;，请妥善保管好你的验证码！&lt;/h3&gt;&quot;</span>, <span class="string">&quot;text/html;charset=UTF-8&quot;</span>);</span><br><span class="line">            <span class="comment">//3.发送一封激活邮件</span></span><br><span class="line">            Transport.send(message);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(MessagingException mex)&#123;</span><br><span class="line"> </span><br><span class="line">            mex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><img src="/breeze/a1e1aa91/image-20230408151950005.png" alt="image-20230408151950005"></li><li>想要改变一下前端页面的提示信息，可以在login.html中修改一下</li><li>UserController代码的改动：只需要添加MailUtils工具类中的方法用来给用户发送验证码即可，其它不需要修改</li></ul><h3 id="功能测试-19"><a href="#功能测试-19" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>登录成功之后，会自动跳转到手机端界面。</li></ul><h1 id="第七章-菜品展示、购物车、下单"><a href="#第七章-菜品展示、购物车、下单" class="headerlink" title="第七章 菜品展示、购物车、下单"></a>第七章 菜品展示、购物车、下单</h1><h2 id="效果展示-3"><a href="#效果展示-3" class="headerlink" title="效果展示"></a>效果展示</h2><ul><li><img src="/breeze/a1e1aa91/image-20230408125403301.png" alt="image-20230408125403301"></li></ul><h2 id="01-导入用户地址薄相关功能代码"><a href="#01-导入用户地址薄相关功能代码" class="headerlink" title="01.导入用户地址薄相关功能代码"></a>01.导入用户地址薄相关功能代码</h2><h3 id="需求分析-15"><a href="#需求分析-15" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>地址薄，指的是移动端消费者用户的地址信息，用户登录成功后可以维护自己的地址信息。同一个用户可以有多个地址信息，但是只能有一个<strong>默认地址</strong>。</li><li><img src="/breeze/a1e1aa91/image-20230408130014555.png" alt="image-20230408130014555"></li></ul><h3 id="数据模型-5"><a href="#数据模型-5" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li>用户的地址信息会存储在address_book表，即地址薄表中。具体表结构如下：<ul><li><img src="/breeze/a1e1aa91/image-20230408130152645.png" alt="image-20230408130152645"></li></ul></li></ul><h3 id="导入功能代码"><a href="#导入功能代码" class="headerlink" title="导入功能代码"></a>导入功能代码</h3><ul><li>实体类 AddressBook（直接从课程资料中导入即可）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 地址簿</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressBook</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//收货人</span></span><br><span class="line">    <span class="keyword">private</span> String consignee;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//性别 0 女 1 男</span></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//省级区划编号</span></span><br><span class="line">    <span class="keyword">private</span> String provinceCode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//省级名称</span></span><br><span class="line">    <span class="keyword">private</span> String provinceName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//市级区划编号</span></span><br><span class="line">    <span class="keyword">private</span> String cityCode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//市级名称</span></span><br><span class="line">    <span class="keyword">private</span> String cityName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//区级区划编号</span></span><br><span class="line">    <span class="keyword">private</span> String districtCode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//区级名称</span></span><br><span class="line">    <span class="keyword">private</span> String districtName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//详细地址</span></span><br><span class="line">    <span class="keyword">private</span> String detail;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//标签</span></span><br><span class="line">    <span class="keyword">private</span> String label;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否默认 0 否 1是</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDefault;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新时间</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建人</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改人</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否删除</span></span><br><span class="line">    <span class="keyword">private</span> Integer isDeleted;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>Mapper接口 AddressBookMapper</p><ul><li><pre><code class="java">package com.cdcas.reggie.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.cdcas.reggie.entity.AddressBook;
import org.apache.ibatis.annotations.Mapper;

/**
 * @author: Mr.Huang
 * @projectName: reggie_take_out
 * @packageName: com.cdcas.reggie.mapper
 * @className: AddressBookMapper
 * @describe: TODO
 * @date: 2023年04月08日 13:11:35
 * @version: 1.0.0
 */

@Mapper
public interface AddressBookMapper extends BaseMapper&lt;AddressBook&gt; &#123;
&#125;

<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">- 业务层接口 AddressBookService</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.AddressBook;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: AddressBookService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月08日 13:12:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AddressBookService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">AddressBook</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre></li></ul></li><li><p>业务层实现类 AddressBookServiceImpl</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.AddressBook;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.AddressBookMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.AddressBookService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: AddressBookServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月08日 13:13:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressBookServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;AddressBookMapper, AddressBook&gt; <span class="keyword">implements</span> <span class="title class_">AddressBookService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>控制层AddressBookController（直接从课程资料中导入即可）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.AddressBook;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.AddressBookService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 地址簿管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/addressBook&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddressBookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AddressBookService addressBookService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">        addressBookService.save(addressBook);</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置默认地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;default&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">setDefault</span><span class="params">(<span class="meta">@RequestBody</span> AddressBook addressBook)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line">        LambdaUpdateWrapper&lt;AddressBook&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">        wrapper.set(AddressBook::getIsDefault, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//SQL:update address_book set is_default = 0 where user_id = ?</span></span><br><span class="line">        addressBookService.update(wrapper);</span><br><span class="line"></span><br><span class="line">        addressBook.setIsDefault(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//SQL:update address_book set is_default = 1 where id = ?</span></span><br><span class="line">        addressBookService.updateById(addressBook);</span><br><span class="line">        <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (addressBook != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;没有找到该对象&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询默认地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;default&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;AddressBook&gt; <span class="title function_">getDefault</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(AddressBook::getUserId, BaseContext.getCurrentId());</span><br><span class="line">        queryWrapper.eq(AddressBook::getIsDefault, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//SQL:select * from address_book where user_id = ? and is_default = 1</span></span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == addressBook) &#123;</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="string">&quot;没有找到该对象&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> R.success(addressBook);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询指定用户的全部地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">        addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">        log.info(<span class="string">&quot;addressBook:&#123;&#125;&quot;</span>, addressBook);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//条件构造器</span></span><br><span class="line">        LambdaQueryWrapper&lt;AddressBook&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="literal">null</span> != addressBook.getUserId(), AddressBook::getUserId, addressBook.getUserId());</span><br><span class="line">        queryWrapper.orderByDesc(AddressBook::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//SQL:select * from address_book where user_id = ? order by update_time desc</span></span><br><span class="line">        <span class="keyword">return</span> R.success(addressBookService.list(queryWrapper));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="功能测试-20"><a href="#功能测试-20" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><img src="/breeze/a1e1aa91/image-20230408161914052.png" alt="image-20230408161914052"></li></ul><h2 id="02-菜品展示"><a href="#02-菜品展示" class="headerlink" title="02.菜品展示"></a>02.菜品展示</h2><h3 id="需求分析-16"><a href="#需求分析-16" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li><img src="/breeze/a1e1aa91/image-20230408162112294-1680942079665-1.png" alt="image-20230408162112294"></li></ul><h3 id="代码开发-16"><a href="#代码开发-16" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>在开发代码之前，需要梳理一下前端页面和服务端的交互过程</p><ul><li>页面（front&#x2F;index.html）发送ajax请求，获取分类数据（菜品分类和套餐分类）</li><li>页面发送ajax请求，获取第一个分类下的菜品或者套餐</li></ul></li><li><p>开发菜品展示功能，其实就是在服务端编写代码去处理前端页面发送的这两次请求即可</p></li><li><p>注意：首页加载完成之后，还完成了一次ajax请求用于加载购物车数据，此处可以将这次请求的地址暂时修改一下，从静态json文件获取数据，等后续开发购物车功能时再修改回来 ，如下：</p><ul><li><img src="/breeze/a1e1aa91/image-20230408163117101.png" alt="image-20230408163117101"></li></ul></li><li><p>前端重点代码</p></li><li><p>在index.html中</p></li><li><p><img src="/breeze/a1e1aa91/image-20230409191627516.png" alt="image-20230409191627516"></p></li><li><p>main.js中</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取所有的菜品分类</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">categoryListApi</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $axios(&#123;</span><br><span class="line">      <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;/category/list&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取购物车内商品的集合</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cartListApi</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $axios(&#123;</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;/shoppingCart/list&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>:&#123;...data&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><img src="/breeze/a1e1aa91/image-20230409193019383.png" alt="image-20230409193019383"></p></li><li><p>这里我们先在其它地方静态的接收购物车的请求，这样就可以先显示category的数据，先用假数据测试一下：</p></li><li><p>修改购物车的请求地址</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取购物车内商品的集合</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cartListApi</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $axios(&#123;</span><br><span class="line">        <span class="comment">// &#x27;url&#x27;: &#x27;/shoppingCart/list&#x27;,</span></span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;/front/carData.json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>:&#123;...data&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>在&#x2F;front新建一个文件(carData.json)并输入以下内容：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;map&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li><p>测试：</p><ul><li><p><img src="/breeze/a1e1aa91/image-20230409194912565.png" alt="image-20230409194912565"></p></li><li><p>如果还是显示不出来数据，需要Ctrl+F5清空浏览器静态缓存</p></li><li><p>我们也发现了bug，就是展示的菜品没有对应的口味信息，比如甜度、辣度等。但是我们之前是添加过口味数据的，为什么这里不展示呢？</p></li><li><p>这是因为我们在请求获取菜品信息的时候，我们返回的数据是R&lt;List<dish>&gt;，Dish这个类是没有相关的口味信息的，所以即便前端请求了这个口味的信息，但是后端是没有给它返回的，所以体现在前端就是口味信息没有展示出来；所以我们需要对DishController中的list接口进行修改：</dish></p></li><li><p>bug修复：修改在DishController中的list请求对应的方法</p></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对方法的改进</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span>    <span class="comment">// 前端传过来的是套餐id</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造查询条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加条件，查询状态为1（起售状态）的菜品</span></span><br><span class="line">        queryWrapper.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加排序条件</span></span><br><span class="line">        queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这里查询出来的是套餐的所有菜品</span></span><br><span class="line">        List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        List&lt;DishDto&gt; DishDtoList = list.stream().map((item) -&gt; &#123;</span><br><span class="line">            <span class="comment">// item表示每一个菜品</span></span><br><span class="line">            <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将菜品拷贝到dishDto中,为dishDto的基本对象拷贝</span></span><br><span class="line">            BeanUtils.copyProperties(item, dishDto);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId(); <span class="comment">// 分类id</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">            <span class="keyword">if</span>(category != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                dishDto.setCategoryName(categoryName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 当前菜品id</span></span><br><span class="line">            <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> item.getId();</span><br><span class="line">            <span class="comment">// 创建查询条件对象</span></span><br><span class="line">            LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            lambdaQueryWrapper.eq(DishFlavor::getDishId, dishId);</span><br><span class="line">            <span class="comment">// select * from dish_flavor where dish_id = ?</span></span><br><span class="line">            <span class="comment">// 这里之所以使用list来条件查询，这是因为同一个菜品，其口味数据可能不止一条</span></span><br><span class="line">            List&lt;DishFlavor&gt; flavors = dishFlavorService.list(lambdaQueryWrapper);</span><br><span class="line">            dishDto.setFlavors(flavors);</span><br><span class="line">            <span class="keyword">return</span> dishDto;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(DishDtoList);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>口味信息可以正常展示了</p></li><li><p><img src="/breeze/a1e1aa91/image-20230409204127035.png" alt="image-20230409204127035"></p></li><li><p>当客户端点击商务套餐或者是学生套餐的时候，会报404错误。在后端还没有对该请求进行处理，接下来编写代码处理请求：</p></li><li><p><img src="/breeze/a1e1aa91/image-20230409204753526.png" alt="image-20230409204753526"></p></li><li><p>可以看到这两个请求，只有categoryId不一样</p></li><li><p>在SetmealController中添加相应的方法来接收前端的请求：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 根据条件查询套餐数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> setmeal</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="comment">// 返回的是一个list集合的套餐类型。</span></span><br><span class="line"> <span class="comment">// 因为套餐中可能不止一种套餐。例如：商务套餐中可能有 xxA套餐 xxB套餐等</span></span><br><span class="line"> <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>&#123;</span><br><span class="line">     LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">     queryWrapper.eq(setmeal.getCategoryId() != <span class="literal">null</span>, Setmeal::getCategoryId, setmeal.getCategoryId());</span><br><span class="line">     queryWrapper.eq(setmeal.getStatus() != <span class="literal">null</span>, Setmeal::getStatus, setmeal.getStatus());</span><br><span class="line">   </span><br><span class="line">     <span class="comment">// 添加排序条件</span></span><br><span class="line">     queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">     List&lt;Setmeal&gt; list = setmealService.list(queryWrapper);</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> R.success(list);</span><br><span class="line">   </span><br><span class="line"> &#125;</span><br><span class="line">   </span><br></pre></td></tr></table></figure><h3 id="功能测试-21"><a href="#功能测试-21" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li>套餐查询功能开发成功</li></ul><h2 id="03-购物车"><a href="#03-购物车" class="headerlink" title="03.购物车"></a>03.购物车</h2><h3 id="需求分析-17"><a href="#需求分析-17" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>移动端用户可以将菜品或者套餐添加到购物车。对于菜品来说，如果设置了口味信息，则需要选择规格后才能加入购物车；对于套餐来说，可以直接点击 <strong>+</strong> 将当前套餐加入购物车。在购物车中可以修改菜品和套餐的数量，也可以清空购物车。</li><li><img src="/breeze/a1e1aa91/image-20230409214235923.png" alt="image-20230409214235923"></li></ul><h3 id="数据模型-6"><a href="#数据模型-6" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li>购物车对应的数据表为shopping_cart表。</li></ul><h3 id="代码开发-17"><a href="#代码开发-17" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>梳理交互过程：</p><ul><li>点击 <strong>加入购物车</strong> 或者 <strong>+</strong> 按钮，页面发送ajax请求，请求服务端，将菜品或者套餐添加到购物车</li><li>点击购物车图标，页面发送ajax请求，请求服务端查询购物车中的菜品和套餐</li><li>点击清空购物车按钮，页面发送ajax请求，请求服务端来执行清空购物车擦操作</li></ul></li><li><p>开发购物车功能，其实就是在服务端编写代码去处理前端页面发送的这3次请求即可</p></li><li><p>在开发业务功能前，先将需要用到的类和接口基本结构创建好：</p></li><li><p>实体类 ShoppingCart(直接从课程资料中导入即可)</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 购物车</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCart</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品id</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐id</span></span><br><span class="line">    <span class="keyword">private</span> Long setmealId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//口味</span></span><br><span class="line">    <span class="keyword">private</span> String dishFlavor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数量</span></span><br><span class="line">    <span class="keyword">private</span> Integer number;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//金额</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Mapper接口 ShoppingCartMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.ShoppingCart;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: ShoppingCartMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月09日 21:55:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;ShoppingCart&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层接口 ShoppingCartService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.ShoppingCart;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: ShoppingCartService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月09日 21:56:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ShoppingCartService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;ShoppingCart&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层实现类 ShoppingCartServiceImpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.ShoppingCart;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.ShoppingCartMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.ShoppingCartService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: ShoppingCartServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月09日 21:57:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ShoppingCartMapper, ShoppingCart&gt; <span class="keyword">implements</span> <span class="title class_">ShoppingCartService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>控制层 ShoppingCartController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.ShoppingCartService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: ShoppingCartController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月09日 21:59:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/shoppingCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCartController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p><img src="/breeze/a1e1aa91/image-20230410145648717.png" alt="image-20230410145648717"></p></li><li><p>可以看到在前端选择好要添加的口味之后，点击购物车，浏览器会发送一个post方式的请求并以json格式携带要加入到购物车的菜品信息。</p></li><li><p>代码开发：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该方法在ShoppingCartController类中</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shoppingCart</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;ShoppingCart&gt; <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> ShoppingCart shoppingCart)</span>&#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;购物车数据：&#123;&#125;&quot;</span>, shoppingCart);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 先设置用户id，指定当前是哪个用户的购物车数据，因为前端没有传这个用户id给我们，但是这个id又非常重要（数据库表中这个字段不能为null）</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();    <span class="comment">// 从threadLocal中获取当前登录用户的id</span></span><br><span class="line">        shoppingCart.setUserId(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询当前菜品或者套餐是否在购物车中</span></span><br><span class="line">        <span class="comment">// 如果添加的是caip，则返回的是dishId;如果添加的是套餐，返回的是setmealId</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> shoppingCart.getDishId();</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getUserId, userId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dishId != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 添加到购物车的是菜品</span></span><br><span class="line">            queryWrapper.eq(ShoppingCart::getDishId, dishId);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 添加到购物车的是套餐</span></span><br><span class="line">            queryWrapper.eq(ShoppingCart::getSetmealId, shoppingCart.getSetmealId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SQL:select * from shoping_cart where user_id = ? and dish_id/setmeal_id = ?</span></span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cartServiceOne</span> <span class="operator">=</span> shoppingCartService.getOne(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(cartServiceOne != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 如果已经存在，（又要添加多份相同的数据到购物车的话）就在原来的数量基础上加一</span></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">number</span> <span class="operator">=</span> cartServiceOne.getNumber();</span><br><span class="line">            cartServiceOne.setNumber(number + <span class="number">1</span>);</span><br><span class="line">            shoppingCartService.updateById(cartServiceOne);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果不存在，则添加到购物车，数量默认就是一</span></span><br><span class="line">            shoppingCart.setNumber(<span class="number">1</span>);</span><br><span class="line">            shoppingCartService.save(shoppingCart);</span><br><span class="line">            <span class="comment">// 为了方便后面对象的返回，我们把shoppingCart赋值给cartServiceOne，</span></span><br><span class="line">            <span class="comment">// 因为进入了这个else分支，就说明前面的cartServiceOne为null</span></span><br><span class="line">            cartServiceOne = shoppingCart;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.success(cartServiceOne);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-22"><a href="#功能测试-22" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><img src="/breeze/a1e1aa91/image-20230410155314221.png" alt="image-20230410155314221"></li><li>可以成功添加菜品或套餐到购物车，这里点击加号可以直接把对应的菜品或者套餐添加到购物车，但是点击减号是没有用的，这里还没有进行开发。</li></ul><h3 id="查看购物车"><a href="#查看购物车" class="headerlink" title="查看购物车"></a>查看购物车</h3><ul><li><p>把相关的前端请求地址给改掉，不再请求假数据，至于存放假数据的json文件是否删除，都无影响。</p></li><li><p>在main.js中修改如下代码：</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取购物车内商品的集合</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cartListApi</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $axios(&#123;</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;/shoppingCart/list&#x27;</span>,</span><br><span class="line">        <span class="comment">// &#x27;url&#x27;: &#x27;/front/carData.json&#x27;,</span></span><br><span class="line">        <span class="string">&#x27;method&#x27;</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>:&#123;...data&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>注意：一定要有用户的概念，不同的用户看到的购物车是不一样的!</p></li><li><p>在ShoppingCartConroller中处理前端的请求：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看购物车</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 一个实体对象对应数据库表中的一条记录，所以返回的对象是list集合的ShoppingCart</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;List&lt;ShoppingCart&gt;&gt; <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;查看购物车...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getUserId, BaseContext.getCurrentId());</span><br><span class="line">        queryWrapper.orderByAsc(ShoppingCart::getCreateTime);</span><br><span class="line"></span><br><span class="line">        List&lt;ShoppingCart&gt; list = shoppingCartService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(list);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>功能测试</p></li><li><p><img src="/breeze/a1e1aa91/image-20230410162939717.png" alt="image-20230410162939717"></p></li><li><p>购物车可以成功展示了，并且依旧可以点击加号添加数据。注意：开发完代码之后初次登录可能会出现购物车图标为灰色（不能的问题），此时Ctrl+F5刷新即可。</p></li></ul><h3 id="清空购物车"><a href="#清空购物车" class="headerlink" title="清空购物车"></a>清空购物车</h3><ul><li><p><img src="/breeze/a1e1aa91/image-20230410163516320.png" alt="image-20230410163516320"></p></li><li><p>当在购物车中点击了清空按钮后，就会发送一个delete方式的请求。</p></li><li><p>在ShoppingCartConroller中处理前端的请求：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 清空购物车</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/clean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">clean</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL:delete from shopping_cart where user_id = ?</span></span><br><span class="line">    LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(ShoppingCart::getUserId, BaseContext.getCurrentId());</span><br><span class="line"></span><br><span class="line">    shoppingCartService.remove(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;清空购物车&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>功能测试</li><li><img src="/breeze/a1e1aa91/image-20230410164357874.png" alt="image-20230410164357874" style="zoom:150%"></li><li>购物车中图标变成灰色，数据被清空。数据库表中的数据也被成功清空。</li></ul><h2 id="04-下单"><a href="#04-下单" class="headerlink" title="04.下单"></a>04.下单</h2><h3 id="需求分析-18"><a href="#需求分析-18" class="headerlink" title="需求分析"></a>需求分析</h3><ul><li>移动端用户将菜品或者套餐加入购物车后，可以点击购物车中的<strong>去结算</strong>按钮，页面跳转到订单确认页面，点击<strong>去支付</strong>按钮则完成下单操作。</li><li><img src="/breeze/a1e1aa91/image-20230410164759092.png" alt="image-20230410164759092"></li></ul><h3 id="数据模型-7"><a href="#数据模型-7" class="headerlink" title="数据模型"></a>数据模型</h3><ul><li>订单表 orders</li><li>订单明细表 order_detail</li></ul><h3 id="代码开发-18"><a href="#代码开发-18" class="headerlink" title="代码开发"></a>代码开发</h3><ul><li><p>梳理交互过程：</p><ul><li>在购物车点击<strong>去结算</strong>按钮，页面跳转到订单确认页面</li><li>在订单确认页面，发送ajax请求，请求服务端获取当前登录用户的默认地址</li><li>在订单确认页面，发送ajax请求，请求服务端获取当前登录用户的购物车数据</li><li>在订单确认页面点击<strong>去支付</strong>按钮，发送ajax请求，请求服务端完成下单操作</li></ul></li><li><p>开发用户下单功能，其实就是在服务端编写代码去处理前端页面发送的请求即可</p></li><li><p>在开发代码功能前，先将需要用到的类和接口基本结构创建好：</p></li><li><p>实体类 Orders、OrderDetail（直接从课程资料中导入）</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Orders</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单号</span></span><br><span class="line">    <span class="keyword">private</span> String number;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单状态 1待付款，2待派送，3已派送，4已完成，5已取消</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//下单用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//地址id</span></span><br><span class="line">    <span class="keyword">private</span> Long addressBookId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//下单时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime orderTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//结账时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime checkoutTime;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//支付方式 1微信，2支付宝</span></span><br><span class="line">    <span class="keyword">private</span> Integer payMethod;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//实收金额</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//备注</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户名</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//手机号</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//地址</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//收货人</span></span><br><span class="line">    <span class="keyword">private</span> String consignee;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单明细</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetail</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单id</span></span><br><span class="line">    <span class="keyword">private</span> Long orderId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜品id</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//套餐id</span></span><br><span class="line">    <span class="keyword">private</span> Long setmealId;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//口味</span></span><br><span class="line">    <span class="keyword">private</span> String dishFlavor;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//数量</span></span><br><span class="line">    <span class="keyword">private</span> Integer number;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//金额</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>Mapper接口 OrderMapper、OrderDetailMapper</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Orders;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:11:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Orders&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.OrderDetail;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.mapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderDetailMapper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:13:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDetailMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;OrderDetail&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务接口层 OrderService、OrderDetailService</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Orders;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:14:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Orders&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.OrderDetail;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderDetailService</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>: TODO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:14:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDetailService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;OrderDetail&gt; &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>业务层实现类 OrderServiceImpl、OrderDetailServiceImpl</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.Orders;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.OrderMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:15:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;OrderMapper, Orders&gt; <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.OrderDetail;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.OrderDetailMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.OrderDetailService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderDetailServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:16:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetailServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;OrderDetailMapper, OrderDetail&gt; <span class="keyword">implements</span> <span class="title class_">OrderDetailService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>控制层 OrderController、OrderDetailController</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.OrderService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:19:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.OrderDetailService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderDetailController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:22:18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/orderDetail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetailController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderDetailService orderDetailService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><img src="/breeze/a1e1aa91/image-20230410172742937.png" alt="image-20230410172742937"></li><li>可以看到当点击了<strong>去支付</strong>按钮后，会发送一个post方式的请求到后端，并把订单中的数据以json格式提交到后端。可以看到前端提交的参数只有三个，但是我们可以通过session或者threadLocal获取到当前用户的id，获取了用户的id之后，就可以根据用户id查找购物车的信息、菜品的信息等。</li><li>在OrderService接口中扩展一个自定义的方法：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户下单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">submit</span><span class="params">(Orders orders)</span>;</span><br></pre></td></tr></table></figure><ul><li>在OrderServiceImpl实现类中处理业务功能(这里面的代码基本上是赋值粘贴的，抽空多琢磨一下)：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.IdWorker;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.CustomException;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.*;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.mapper.OrderMapper;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.*;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.service.impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: OrderServiceImpl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月10日 17:15:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;OrderMapper, Orders&gt; <span class="keyword">implements</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ShoppingCartService shoppingCartService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AddressBookService addressBookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> OrderDetailService orderDetailService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户下单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orders</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">submit</span><span class="params">(Orders orders)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取当前用户的id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询当前用户的购物车数据</span></span><br><span class="line">        LambdaQueryWrapper&lt;ShoppingCart&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(ShoppingCart::getUserId, userId);</span><br><span class="line">        List&lt;ShoppingCart&gt; shoppingCarts = shoppingCartService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (shoppingCarts == <span class="literal">null</span> || shoppingCarts.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;购物车为空，不能下单!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询用户数据</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询地址数据</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">addressBookId</span> <span class="operator">=</span> orders.getAddressBookId();</span><br><span class="line">        <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> addressBookService.getById(addressBookId);</span><br><span class="line">        <span class="keyword">if</span> (addressBook == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">CustomException</span>(<span class="string">&quot;用户地址信息有误，不能下单!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">orderId</span> <span class="operator">=</span> IdWorker.getId();<span class="comment">//使用工具生成订单号</span></span><br><span class="line">        orders.setId(orderId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行购物车的金额数据计算 顺便把订单明细给计算出来</span></span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);<span class="comment">//使用原子类来保存计算的金额结果</span></span><br><span class="line">        <span class="comment">//这个item是集合中的每一个shoppingCarts对象,是在变化的</span></span><br><span class="line">        List&lt;OrderDetail&gt; orderDetails = shoppingCarts.stream().map((item) -&gt; &#123;</span><br><span class="line">            <span class="comment">//每对item进行一次遍历就产生一个新的orderDetail对象,然后对orderDetail进行设置,然后返回被收集,被封装成一个集合</span></span><br><span class="line">            <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">            orderDetail.setOrderId(orderId);</span><br><span class="line">            orderDetail.setNumber(item.getNumber());</span><br><span class="line">            orderDetail.setDishFlavor(item.getDishFlavor());</span><br><span class="line">            orderDetail.setDishId(item.getDishId());</span><br><span class="line">            orderDetail.setSetmealId(item.getSetmealId());</span><br><span class="line">            orderDetail.setName(item.getName());</span><br><span class="line">            orderDetail.setImage(item.getImage());</span><br><span class="line">            orderDetail.setAmount(item.getAmount());<span class="comment">//单份的金额</span></span><br><span class="line">            <span class="comment">//addAndGet进行累加 item.getAmount()单份的金额  multiply乘  item.getNumber()份数</span></span><br><span class="line">            amount.addAndGet(item.getAmount().multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(item.getNumber())).intValue());</span><br><span class="line">            <span class="keyword">return</span> orderDetail;</span><br><span class="line"></span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向订单插入数据,一条数据  因为前端传过来的数据太少了,所以我们需要对相关的属性进行填值</span></span><br><span class="line"></span><br><span class="line">        orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">        orders.setCheckoutTime(LocalDateTime.now());</span><br><span class="line">        orders.setStatus(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//Amount是指订单总的金额</span></span><br><span class="line">        orders.setAmount(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(amount.get()));<span class="comment">//总金额</span></span><br><span class="line">        orders.setUserId(userId);</span><br><span class="line">        orders.setNumber(String.valueOf(orderId));</span><br><span class="line">        <span class="keyword">if</span> (user.getName() != <span class="literal">null</span>) &#123;</span><br><span class="line">            orders.setUserName(user.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">        orders.setPhone(addressBook.getPhone());</span><br><span class="line">        orders.setAddress((addressBook.getProvinceName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getProvinceName())</span><br><span class="line">                + (addressBook.getCityName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getCityName())</span><br><span class="line">                + (addressBook.getDistrictName() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getDistrictName())</span><br><span class="line">                + (addressBook.getDetail() == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : addressBook.getDetail()));</span><br><span class="line">        <span class="built_in">this</span>.save(orders);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//先明细表插入数据,多条数据</span></span><br><span class="line">        orderDetailService.saveBatch(orderDetails);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//清空购物车数据  queryWrapper封装了userId我们直接使用这个条件来进行删除就行</span></span><br><span class="line">        shoppingCartService.remove(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>在OrderControlelr中处理请求：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/submit&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> Orders orders)</span>&#123;</span><br><span class="line">     log.info(<span class="string">&quot;订单数据:&#123;&#125;&quot;</span>, orders);</span><br><span class="line">     orderService.submit(orders);</span><br><span class="line">     <span class="keyword">return</span> R.success(<span class="string">&quot;下单成功!!&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-23"><a href="#功能测试-23" class="headerlink" title="功能测试"></a>功能测试</h3><ul><li><img src="/breeze/a1e1aa91/image-20230410213602469.png" alt="image-20230410213602469"></li></ul><hr><p>总结：还有很多功能没有实现，抽时间把这些没有实现的功能都做一下。</p><h1 id="第八章-项目优化之缓存优化"><a href="#第八章-项目优化之缓存优化" class="headerlink" title="第八章 项目优化之缓存优化"></a>第八章 项目优化之缓存优化</h1><hr><hr><h2 id="01-问题说明："><a href="#01-问题说明：" class="headerlink" title="01.问题说明："></a>01.问题说明：</h2><p><img src="/breeze/a1e1aa91/image-20230420112341854.png" alt="image-20230420112341854"></p><p><strong>当用户数量很多的时候，系统访问量就会很大。而频繁访问数据库，会导致系统性能下降，用户体验差（页面需要加载很久）。</strong></p><hr><h2 id="02-环境搭建"><a href="#02-环境搭建" class="headerlink" title="02.环境搭建"></a>02.环境搭建</h2><p><strong>准备：</strong>在码云上创建一个仓库<code>reggit_take_out</code>，然后在本地的<code>reggit_take_out</code>目录添加一个本地仓库，将之前开发好的代码提交到远程仓库的master分支中。然后在本地新建一个分支v1.0，这个分支专门用来操作缓存，然后将该分支提交到远程的v1.0分支中。</p><p><strong>maven坐标：</strong>在项目的pom.xml文件中导入spring data redis 的maven坐标</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>配置文件：</strong>在项目的application.yml中加入redis相关配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spring</span></span><br><span class="line">	<span class="attr">redis:</span></span><br><span class="line">		<span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">		<span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">		<span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">		<span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>配置类：</strong>在项目中加入配置类RedisConfig（这不是必须的，而且该配置类在Spring6中已经淘汰了）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: springdataredis_demo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: config</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: RedisConfig</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月19日 18:16:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Redis配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>  <span class="comment">// 交给spring容器管理</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">RedisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认的key序列化器为：JdkSerializationRedisSerializer</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        redisTemplate.setConnectionFactory(connectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>可以直接注入StringRedisTemplate</strong>，StringRedisTemplate 是 Redis 在 Spring 框架中提供的一个操作字符串类型数据的模板类。</p><p><strong>StringRedisTemplate的使用方法：</strong></p><ol><li><p>在 Spring 配置文件中定义 StringRedisTemplate bean：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;redisTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.redis.core.StringRedisTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;jedisConnectionFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jedisConnectionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hostName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;localhost&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6379&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>需要说明的是：</strong>在springboot项目中，会自动引入StringRedisTemplate对象，我们只需要注入即可，不需要再Spring配置文件中定义。</p></li><li><p>在 Java 代码中使用 StringRedisTemplate 对 Redis 中的字符串类型数据进行操作：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">    redisTemplate.opsForValue().set(key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.opsForValue().get(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="03-缓存短信验证码"><a href="#03-缓存短信验证码" class="headerlink" title="03.缓存短信验证码"></a>03.缓存短信验证码</h2><p><strong>问题分析：</strong>前面我们已经实现了移动端手机验证码登录，随机生成的验证码我们是保存在HttpSession中的（默认存活时间是三十分钟，时间太长了）。</p><p>现在需要改造为将验证码缓存在Redis中，具体的<strong>实现思路</strong>如下：</p><ol><li><p>在服务端UserController中注入RedisTemplate对象，用于操作Redis。（我们在这里使用StringRedisTemplate对象）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure></li><li><p>在服务端UserController的sendMsg方法中，将随机生成的验证码缓存到Redis中，并设置有效期为5分钟。</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将生成的验证码缓存到Redis中，并设置有效期为5分钟</span></span><br><span class="line">redisTemplate.opsForValue().set(phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// TimeUnit.MINUTES 表示设置的时间单位是分钟</span></span><br><span class="line"><span class="comment">// TimeUnit.SECONDS 表示设置的时间是秒</span></span><br></pre></td></tr></table></figure><ol><li>在服务端UserController的login方法中，从Redis中获取缓存的验证码，如果登录成功则删除Redis中的验证码。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从Redis中获取缓存的验证码</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果用户登录成功，删除Redis中缓存的验证码</span></span><br><span class="line">redisTemplate.delete(phone);</span><br></pre></td></tr></table></figure><p>改造后的<code>UserController</code>中的完整代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cdcas.reggie.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.common.R;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.cdcas.reggie.utils.ValidateCodeUtils;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Huang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@projectName</span>: reggie_take_out</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@packageName</span>: com.cdcas.reggie.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@className</span>: UserController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@describe</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023年04月07日 21:07:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送手机短信验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotEmpty(phone)) &#123;</span><br><span class="line">            <span class="comment">// 生成随机的4位验证码</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> ValidateCodeUtils.generateValidateCode(<span class="number">4</span>).toString();</span><br><span class="line">            log.info(<span class="string">&quot;code=&#123;&#125;&quot;</span>, code);  <span class="comment">// 将输入手机号后生成的验证码打印在控制台上</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 调用阿里云提供的短信服务API完成发送短信</span></span><br><span class="line">            <span class="comment">// 这行代码的作用是给输入的手机号发送短信，这里把它注释了</span></span><br><span class="line">            <span class="comment">// SMSUtils.sendMessage(&quot;瑞吉外卖&quot;, &quot;&quot;, phone, code);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 给qq用户发送邮件</span></span><br><span class="line"><span class="comment">//            try &#123;</span></span><br><span class="line"><span class="comment">//                MailUtils.sendMail(&quot;3311415973@qq.com&quot;, Integer.parseInt(code));</span></span><br><span class="line"><span class="comment">//            &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">//                throw new RuntimeException(e);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 需要将生成的验证码保存到Session</span></span><br><span class="line">            <span class="comment">// session.setAttribute(phone, code);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将生成的验证码缓存到Redis中，并设置有效期为5分钟</span></span><br><span class="line">            redisTemplate.opsForValue().set(phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> R.success(<span class="string">&quot;手机验证码发送成功!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;手机验证码发送失败!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动端用户登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="comment">// 前端传过来的参数是 key-value形式的，所以这里可以用map来接收</span></span><br><span class="line">    <span class="comment">// 返回值是User,登录成功之后需要给页面返回用户信息，需要在浏览器端保存一份用户信息</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(map.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取手机号</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从Session中获取保存的验证码</span></span><br><span class="line">        <span class="comment">// Object codeInSession = session.getAttribute(phone); // phone是key,session是value</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从Redis中获取缓存的验证码</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 进行验证码的比对（页面提交的验证码和Session中保存的验证码比对）</span></span><br><span class="line">        <span class="keyword">if</span> (codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code)) &#123;</span><br><span class="line">            <span class="comment">// 如果能够比对成功，说明登录成功</span></span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line">            queryWrapper.eq(User::getPhone, phone);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);   <span class="comment">// 根据条件构造器中的条件到数据库查询用户</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;   <span class="comment">// 数据库中没有该用户信息</span></span><br><span class="line">                <span class="comment">// 当前手机号对应的用户是否为新用户，自动完成注册</span></span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setPhone(phone);</span><br><span class="line">                <span class="comment">// status状态码，0表示禁用，1表示启用。数据库中设置了默认值为1，这里再显示定义一下（这里也可以不进行设置）。</span></span><br><span class="line">                user.setStatus(<span class="number">1</span>);</span><br><span class="line">                userService.save(user);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存用户登录状态</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>, user.getId()); <span class="comment">// 在session中保存用户的登录信息，这样就不会被过滤器拦截了</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果用户登录成功，删除Redis中缓存的验证码</span></span><br><span class="line">            redisTemplate.delete(phone);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> R.success(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;用户登录失败!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>重要的小技巧：</strong>当我们拷贝代码到<code>IDEA</code>中时，我们拷贝的代码没有错，代码格式没有错，代码放的位置没有错，<code>IDEA</code>更没有报错，那么就可能是我们拷贝的时候拷贝了其它字符，而且这些字符可能在空白处，我们根本就看到。这个时候就需要手动处理了，删除原先拷贝的代码（或空白部分），手动输入。</p><p><strong>注意：</strong>项目启动成功，但是在获取验证码的时候报了这个异常（io.lettuce.core.RedisCommandExecutionException: ERR Client sent AUTH, but no password is set）【Redis服务器没有设置密码，但客户端向其发送了AUTH（authentication，身份验证）请求携带着密码，导致报错】。明明在配置文件中设置了密码，而且这个设置应该是永久生效的，那为什么会报这个异常呢？</p><p><strong>原因：</strong>原来<strong>Redis启动时需要指定配置文件，否则还会使用默认配置</strong>，而我在Windows里启动.exe应用程序时，还是习惯性的双击应用程序启动，导致Redis一直使用的是默认配置。</p><p><strong>这样我们就需要在命令行窗口通过命令行的方式来启动并指定配置文件：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">D:\Apps\dev\Redis&gt;redis-server.exe redis.windows.conf</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ &#x27;&#x27;-._</span><br><span class="line">      _.-``    `.  `_.  &#x27;&#x27;-._           Redis 3.0.504 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ &#x27;&#x27;-._</span><br><span class="line"> (    &#x27;      ,       .-`  | `,    )     Running in standalone mode</span><br><span class="line"> |`-._`-...-` __...-.``-._|&#x27;` _.-&#x27;|     Port: 6379</span><br><span class="line"> |    `-._   `._    /     _.-&#x27;    |     PID: 7008</span><br><span class="line">  `-._    `-._  `-./  _.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |           http://redis.io</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line"> |`-._`-._    `-.__.-&#x27;    _.-&#x27;_.-&#x27;|</span><br><span class="line"> |    `-._`-._        _.-&#x27;_.-&#x27;    |</span><br><span class="line">  `-._    `-._`-.__.-&#x27;_.-&#x27;    _.-&#x27;</span><br><span class="line">      `-._    `-.__.-&#x27;    _.-&#x27;</span><br><span class="line">          `-._        _.-&#x27;</span><br><span class="line">              `-.__.-&#x27;</span><br><span class="line"></span><br><span class="line">[7008] 20 Apr 14:56:07.724 # Server started, Redis version 3.0.504</span><br><span class="line">[7008] 20 Apr 14:56:07.725 * DB loaded from disk: 0.000 seconds</span><br><span class="line">[7008] 20 Apr 14:56:07.725 * The server is now ready to accept connections on port 6379</span><br></pre></td></tr></table></figure><p><strong>通过这种方式启动，就会加载配置文件，就不会报错了。</strong></p><p><strong>总结：</strong>如果登录Redis之后，使用命令的方式设置密码，那么这个密码只在本次Redis服务器运行过程中有效，<strong>当我们将Redis服务器关掉之后，这些配置就会失效，下次再启动服务器，需要重新设置</strong>。而在配置文件中设置的密码则是永久有效的，但是启动的时候需要指定配置文件，否则Redis使用的还是默认设置。</p><p><strong>功能测试：</strong></p><p>项目启动成功之后，输入手机号，然后点击获取验证码。可以看到以手机号为key，code为value存储在了Redis的指定数据库中。</p><p><img src="/breeze/a1e1aa91/image-20230420150016102.png" alt="image-20230420150016102"></p><p>当我们登录成功后，数据库中的值就被删除了。说明功能开发成功。</p><hr><h2 id="04-缓存菜品数据"><a href="#04-缓存菜品数据" class="headerlink" title="04.缓存菜品数据"></a>04.缓存菜品数据</h2><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>前面我们已经实现了移动端菜品查看功能，对应的服务端方法为DishController的list方法，此方法会根据前端提交的查询条件进行数据库查询操作。在高并发的情况下频繁查询数据库会导致系统性能下降，服务端响应时间增长。现在需要对此方法进行缓存优化，提高系统的性能。</p><p>具体实现思路如下：</p><ol><li>改造DishController的list方法，先从Redis中获取菜品数据，如果有则直接返回，无需查询数据库；如果没有则查询数据库，并将查询到的菜品数据放入Redis。</li></ol><h3 id="代码改造"><a href="#代码改造" class="headerlink" title="代码改造"></a>代码改造</h3><ul><li>先在DishController中注入RedisTemplate对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure><ul><li>再修改DishController中的list方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span>    <span class="comment">// 前端传过来的是套餐id</span></span><br><span class="line">  <span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>&#123;</span><br><span class="line">      <span class="comment">// 在从Redis获取缓存数据之前，先动态构造一下key。这个key的构造是重点</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dish.getCategoryId() + <span class="string">&quot;_&quot;</span> + dish.getStatus(); <span class="comment">// 例如：dish_13978443910402565_1</span></span><br><span class="line"></span><br><span class="line">      List&lt;DishDto&gt; dishDtoList = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 先从Redis中获取缓存数据（是以菜品分类和状态来获取的）</span></span><br><span class="line">      <span class="comment">// 我们需要返回的是一个list集合，里面封装的是DishDto</span></span><br><span class="line">      dishDtoList  = (List&lt;DishDto&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (dishDtoList != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="comment">// 如果存在，直接返回，无需查询数据库</span></span><br><span class="line">          <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 代码走到这里，说明Redis中不存在该缓存数据，继续执行下面的代码</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 构造查询条件</span></span><br><span class="line">      LambdaQueryWrapper&lt;Dish&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">      queryWrapper.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 添加条件，查询状态为1（起售状态）的菜品</span></span><br><span class="line">      queryWrapper.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 添加排序条件</span></span><br><span class="line">      queryWrapper.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 这里查询出来的是套餐的所有菜品</span></span><br><span class="line">      List&lt;Dish&gt; list = dishService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">      dishDtoList = list.stream().map((item) -&gt; &#123;</span><br><span class="line">          <span class="comment">// item表示每一个菜品</span></span><br><span class="line">          <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 将菜品拷贝到dishDto中,为dishDto的基本对象拷贝</span></span><br><span class="line">          BeanUtils.copyProperties(item, dishDto);</span><br><span class="line">          <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> item.getCategoryId(); <span class="comment">// 分类id</span></span><br><span class="line">          <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">          <span class="keyword">if</span>(category != <span class="literal">null</span>)&#123;</span><br><span class="line">              <span class="type">String</span> <span class="variable">categoryName</span> <span class="operator">=</span> category.getName();</span><br><span class="line">              dishDto.setCategoryName(categoryName);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 当前菜品id</span></span><br><span class="line">          <span class="type">Long</span> <span class="variable">dishId</span> <span class="operator">=</span> item.getId();</span><br><span class="line">          <span class="comment">// 创建查询条件对象</span></span><br><span class="line">          LambdaQueryWrapper&lt;DishFlavor&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">          lambdaQueryWrapper.eq(DishFlavor::getDishId, dishId);</span><br><span class="line">          <span class="comment">// select * from dish_flavor where dish_id = ?</span></span><br><span class="line">          <span class="comment">// 这里之所以使用list来条件查询，这是因为同一个菜品，其口味数据可能不止一条</span></span><br><span class="line">          List&lt;DishFlavor&gt; flavors = dishFlavorService.list(lambdaQueryWrapper);</span><br><span class="line">          dishDto.setFlavors(flavors);</span><br><span class="line">          <span class="keyword">return</span> dishDto;</span><br><span class="line">      &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 如果不存在，需要查询数据库，将查询到的菜品数据缓存到Redis,设置过期时间为60分钟，60分钟过后，数据被自动清除</span></span><br><span class="line">      redisTemplate.opsForValue().set(key, dishDtoList, <span class="number">60</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol><li>改造DishController的save和update方法，加入清理缓存的逻辑（其实这两个方法中，添加的都是相同的代码）。</li></ol><ul><li>save方法改造</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="comment">// 因为前端提交的是json格式的数据，所以要加@RequestBody注解</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sava</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span>&#123;</span><br><span class="line">    log.info(dishDto.toString());</span><br><span class="line"></span><br><span class="line">    dishService.saveWithFlavor(dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理所有菜品的缓存数据</span></span><br><span class="line">    <span class="comment">// Set keys = redisTemplate.keys(&quot;dish_*&quot;);</span></span><br><span class="line">    <span class="comment">// redisTemplate.delete(keys);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理某个分类下面的菜品缓存数据（精确清理）</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDto.getCategoryId() + dishDto.getStatus(); <span class="comment">// 其实这里的status可以直接写死，因为前端提交过来的状态码都是1</span></span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新增菜品成功!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>update方法改造</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="comment">// 因为前端提交的是json格式的数据，所以要加@RequestBody注解</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span>&#123;</span><br><span class="line">    log.info(dishDto.toString());</span><br><span class="line"></span><br><span class="line">    dishService.updateWithFlavor(dishDto);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理所有菜品的缓存数据</span></span><br><span class="line">    <span class="comment">// Set keys = redisTemplate.keys(&quot;dish_*&quot;);</span></span><br><span class="line">    <span class="comment">// redisTemplate.delete(keys);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理某个分类下面的菜品缓存数据（精确清理）</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDto.getCategoryId() + dishDto.getStatus(); <span class="comment">// 其实这里的status可以直接写死，因为前端提交过来的状态码都是1</span></span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改菜品成功!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意事项：</strong>在使用缓存过程中，要注意保证数据库中的数据和缓存中的数据一致，如果数据库中的数据发生变化，需要及时清理缓存数据。</p><h3 id="功能测试-24"><a href="#功能测试-24" class="headerlink" title="功能测试"></a>功能测试</h3><p>用debug模式运行，查看第一次访问菜品的时候Redis中是否有缓存数据，第二次访问菜品的时候Redis中是否有缓存数据。并新增菜品，修改菜品之后，查看Redis中缓存的数据是否会被清空。</p><p><strong>将改造后的代码，在检查没有bug之后，合并到主分支。</strong></p><hr><h2 id="05-Spring-Cache"><a href="#05-Spring-Cache" class="headerlink" title="05.Spring Cache"></a>05.Spring Cache</h2><h3 id="Spring-Cache介绍"><a href="#Spring-Cache介绍" class="headerlink" title="Spring Cache介绍"></a>Spring Cache介绍</h3><p><strong>Spring Cache 是一个框架，实现了基于注解的缓存功能，只需要简单的加一个注解，就能实现缓存功能。</strong></p><p>Spring Cache提供了一层抽象，底层可以切换不同的Cache实现。具体就是通过<strong>CacheManager</strong>接口来统一不同的缓存技术。</p><p><strong>CacheManager是Spring提供的各种缓存技术抽象接口</strong></p><p>针对不同的缓存技术需要实现不同的CacheManager:</p><table><thead><tr><th>CacheManager</th><th>描述</th></tr></thead><tbody><tr><td>EhCacheCacheManager</td><td>使用EhCache作为缓存技术</td></tr><tr><td>GuavaCacheManager</td><td>使用Google的GuavaCache作为缓存技术</td></tr><tr><td>RedisCacheManager</td><td>使用Redis作为缓存技术</td></tr></tbody></table><h3 id="Spring-Cache常用注解"><a href="#Spring-Cache常用注解" class="headerlink" title="Spring Cache常用注解"></a>Spring Cache常用注解</h3><table><thead><tr><th>注解</th><th>说明</th></tr></thead><tbody><tr><td>@EnableCaching</td><td>开启缓存注解功能</td></tr><tr><td>@Cacheable</td><td>在方法执行前spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</td></tr><tr><td>@CahcePut</td><td>将方法的返回值放到缓存中</td></tr><tr><td>@CacheEvict</td><td>将一条或多条数据从缓存中删除</td></tr></tbody></table><p>在spring boot项目中，使用缓存技术只需要在项目中导入相关缓存技术的依赖包，并在启动类上使用@EnableCaching开启缓存支持即可。</p><p>例如：使用Redis作为缓存技术，只需要导入Spring data Redis的maven坐标即可。</p><h3 id="Spring-Cache使用方式（扩展）"><a href="#Spring-Cache使用方式（扩展）" class="headerlink" title="Spring Cache使用方式（扩展）"></a>Spring Cache使用方式（扩展）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CachePut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CacheManager cacheManager;	<span class="comment">// 注入对象</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * CachePut：将方法返回值放入缓存</span></span><br><span class="line"><span class="comment">     * value：缓存的名称，每个缓存名称下面可以有多个key</span></span><br><span class="line"><span class="comment">     * key：缓存的key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CachePut(value = &quot;userCache&quot;,key = &quot;#user.id&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        userService.save(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * CacheEvict：清理指定缓存</span></span><br><span class="line"><span class="comment">     * value：缓存的名称，每个缓存名称下面可以有多个key</span></span><br><span class="line"><span class="comment">     * key：缓存的key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;userCache&quot;,key = &quot;#p0&quot;)</span></span><br><span class="line">    <span class="comment">//@CacheEvict(value = &quot;userCache&quot;,key = &quot;#root.args[0]&quot;)</span></span><br><span class="line">    <span class="comment">//@CacheEvict(value = &quot;userCache&quot;,key = &quot;#id&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">        userService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@CacheEvict(value = &quot;userCache&quot;,key = &quot;#p0.id&quot;)</span></span><br><span class="line">    <span class="comment">//@CacheEvict(value = &quot;userCache&quot;,key = &quot;#user.id&quot;)</span></span><br><span class="line">    <span class="comment">//@CacheEvict(value = &quot;userCache&quot;,key = &quot;#root.args[0].id&quot;)</span></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;userCache&quot;,key = &quot;#result.id&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">update</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        userService.updateById(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Cacheable：在方法执行前spring先查看缓存中是否有数据，如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</span></span><br><span class="line"><span class="comment">     * value：缓存的名称，每个缓存名称下面可以有多个key</span></span><br><span class="line"><span class="comment">     * key：缓存的key</span></span><br><span class="line"><span class="comment">     * condition：条件，满足条件时才缓存数据</span></span><br><span class="line"><span class="comment">     * unless：满足条件则不缓存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;,key = &quot;#id&quot;,unless = &quot;#result == null&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;userCache&quot;,key = &quot;#user.id + &#x27;_&#x27; + #user.name&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">list</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(user.getId() != <span class="literal">null</span>,User::getId,user.getId());</span><br><span class="line">        queryWrapper.eq(user.getName() != <span class="literal">null</span>,User::getName,user.getName());</span><br><span class="line">        List&lt;User&gt; list = userService.list(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>在Spring Boot项目中使用Spring Cache的操作步骤（使用Redis缓存技术）：</strong></p><ol><li>导入Maven坐标</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>配置application.yml</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">cache:</span></span><br><span class="line">		<span class="attr">redis:</span></span><br><span class="line">			<span class="attr">time-to-live:</span> <span class="number">1800000</span>  <span class="comment"># 设置缓存有效期</span></span><br></pre></td></tr></table></figure><p>完整的application.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment">#应用的名称，可选</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cache_demo</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/cache_demo?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">172.17</span><span class="number">.2</span><span class="number">.94</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="number">1800000</span> <span class="comment">#设置缓存过期时间，可选</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#在映射实体或者属性时，将数据库中表名和字段名中的下划线去掉，按照驼峰命名法映射</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">ASSIGN_ID</span></span><br></pre></td></tr></table></figure><ol start="3"><li>在启动类上加入@EnableCaching注解，开启缓存注解功能</li><li>在Controller的方法上加上@Cacheable、@CacheEvict等注解，进行缓存操作</li></ol><h2 id="06-缓存套餐数据"><a href="#06-缓存套餐数据" class="headerlink" title="06.缓存套餐数据"></a>06.缓存套餐数据</h2><h3 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h3><p>前面我们已经实现了移动端套餐查看功能，对应的服务端方法为SetmealControler的list方法，此方法会根据前端提交的查询条件进行数据库查询操作。在高并发的情况下，频繁查询数据库会导致系统性能下降，服务端响应时间增长。具体实现思路如下：</p><ol><li>导入Spring Cache和Redis相关maven坐标</li><li>在application.yml中配置缓存数据的过期时间</li><li>在启动类上加入@EnableCaching注解，开启缓存注解功能</li><li>在SetmealController的list方法上加入@Cacheabel注解</li><li>在SetmealController的save和delete方法上加入CacheEvict注解</li></ol><h3 id="代码改造-1"><a href="#代码改造-1" class="headerlink" title="代码改造"></a>代码改造</h3><p>1.导入Spring Cache和Redis相关maven坐标</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.在application.yml中配置缓存数据的过期时间</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 下面的是本次配置的内容    </span></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">time-to-live:</span> <span class="number">1800000</span> <span class="comment"># 设置缓存过期时间为30分钟</span></span><br></pre></td></tr></table></figure><p>3.在启动类上加入@EnableCaching注解，开启缓存注解功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span>  <span class="comment">// lombok提供的一个注解，可以直接输出日志</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ServletComponentScan</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>    <span class="comment">// 开启对事务的支持</span></span><br><span class="line"><span class="meta">@EnableCaching</span>  <span class="comment">// 开启Spring Cache注解方式的缓存功能（本次添加的内容）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReggieApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ReggieApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;项目启动成功!!!&quot;</span>); <span class="comment">// 依赖于@Slf4j</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.在SetmealController的list方法上加入@Cacheabel注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">// key和传过来的查询条件有关系, #setmeal表示setmeal对象</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;setmealCache&quot;, key = &quot;#setmeal.categoryId + &#x27;_&#x27; + #setmeal.status&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>&#123;</span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(setmeal.getCategoryId() != <span class="literal">null</span>, Setmeal::getCategoryId, setmeal.getCategoryId());</span><br><span class="line">    queryWrapper.eq(setmeal.getStatus() != <span class="literal">null</span>, Setmeal::getStatus, setmeal.getStatus());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加排序条件</span></span><br><span class="line">    queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">    List&lt;Setmeal&gt; list = setmealService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(list);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>此次代码改造是为了缓存套餐数据。将代码进行上述改造后，启动服务，进入移动端页面，发现湘菜、川菜、粤菜、饮品和主食都可以正常展示，但是商品套餐和儿童套餐这种套餐数据显示不出来，而且报500错误。这是为什么呢？</p><p><strong>原因：</strong>我们已经在该方法上加了@Cacheable注解，这个方法的返回对象是R，这个R没有实现序列化器，所以报错。</p><p><strong>解决方法：</strong>让R类实现序列化接口即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">R</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>将R类实现了序列化接口后，套餐数据就可以正常显示了</p><p><img src="/breeze/a1e1aa91/image-20230422204805466.png" alt="image-20230422204805466"></p><h3 id="拓展1：为什么实现了-Cacheable注解之后，方法返回值的类型需要实现序列化接口？"><a href="#拓展1：为什么实现了-Cacheable注解之后，方法返回值的类型需要实现序列化接口？" class="headerlink" title="拓展1：为什么实现了@Cacheable注解之后，方法返回值的类型需要实现序列化接口？"></a>拓展1：为什么实现了@Cacheable注解之后，方法返回值的类型需要实现序列化接口？</h3><p>因为在使用@Cacheable注解进行方法缓存时，返回值会被序列化后存储到缓存中，以便下次可以直接从缓存中获取数据。如果方法的返回值类型没有实现序列化接口，就无法将其转换成字节流来进行序列化，就无法存入缓存。因此，为了让方法返回值能够被正确序列化并存储到缓存中，需要让其实现序列化接口。</p><h3 id="拓展2：序列化和反序列化"><a href="#拓展2：序列化和反序列化" class="headerlink" title="拓展2：序列化和反序列化"></a>拓展2：序列化和反序列化</h3><p>Java序列化是将Java对象转换为字节流的过程，使得这些对象可以在网络上传输、存储到磁盘或在应用程序之间共享。Java反序列化是将字节流还原成Java对象的过程。</p><p>Java序列化是通过实现Serializable接口来实现的，该接口标记了一个类的对象可以被序列化。序列化过程中，Java会将对象的状态保存为字节流，并且可以选择将其压缩或加密以提高传输效率和安全性。通常情况下，可以使用ObjectOutputStream类将Java对象序列化并写入文件或网络连接。</p><p>反序列化过程与序列化相反，通过使用ObjectInputStream类将字节流读取为Java对象。反序列化的过程中，Java会根据序列化时使用的信息重新构建对象的状态。</p><p>Java序列化的过程涉及到将对象的状态信息写入字节流中，包括对象的类型信息、属性值等，并且还需要处理继承关系和循环引用等问题。反序列化则是从字节流中读取对象信息，并创建出对应的Java对象。</p><p>需要注意的是，Java序列化虽然方便易用，但也存在一些问题。例如，序列化数据的格式可能会随着Java版本的变化而变化，因此反序列化时需要确保使用相同的Java版本；同时，序列化也可能存在安全漏洞，例如恶意用户可以通过序列化来注入恶意代码。因此，在进行Java序列化操作时，需要谨慎考虑安全性和兼容性问题。</p><p>5.在SetmealController的save和delete方法上加入CacheEvict注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="comment">// allEntries = true，这个属性默认是false,要显示的定义为true，表示删除所有缓存的套餐数据。</span></span><br><span class="line">    <span class="comment">// 注意：是删除setmealCache中的所有套餐数据，例如：在setmealCache套餐中有商务套餐和儿童套餐等，但是即便我只操作了儿童套餐，</span></span><br><span class="line">    <span class="comment">// 则setmealCache中的所有的缓存套餐数据都会被删除</span></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    <span class="comment">// public R&lt;String&gt; delete(Long[] ids)&#123;     // 这样写也是正确的，不用加@RequestParam注解</span></span><br><span class="line">        log.info(<span class="string">&quot;ids:&#123;&#125;&quot;</span>, ids);</span><br><span class="line">        setmealService.removeWithDish(ids);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;套餐数据删除成功!!&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="comment">// allEntries = true，这个属性默认是false,要显示的定义为true，表示删除所有缓存的套餐数据。</span></span><br><span class="line"> <span class="comment">// 注意：是删除setmealCache中的所有套餐数据，例如：在setmealCache套餐中有商务套餐和儿童套餐等，但是即便我只操作了儿童套餐，</span></span><br><span class="line"> <span class="comment">// 则setmealCache中的所有的缓存套餐数据都会被删除</span></span><br><span class="line"> <span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"> <span class="comment">// 前端传过来的参数中除了套餐信息外，还有关联的菜品信息。所以这里用SetmealDtao实体来封装</span></span><br><span class="line"> <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;</span><br><span class="line">     log.info(<span class="string">&quot;套餐信息：&#123;&#125;&quot;</span>, setmealDto);    <span class="comment">// 查看前端提交的数据能否被封装到setmealDto这个实体上</span></span><br><span class="line"></span><br><span class="line">     setmealService.saveWithDish(setmealDto);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> R.success(<span class="string">&quot;新增套餐成功!&quot;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="功能测试-25"><a href="#功能测试-25" class="headerlink" title="功能测试"></a>功能测试</h3><p>查看Redis中能否正常缓存套餐数据，以及修改了套餐数据后Redis中的套餐缓存数据能否被全部删除即可。</p><hr><h1 id="第九章-读写分离"><a href="#第九章-读写分离" class="headerlink" title="第九章 读写分离"></a>第九章 读写分离</h1><h2 id="问题说明"><a href="#问题说明" class="headerlink" title="问题说明"></a>问题说明</h2><p><img src="/breeze/a1e1aa91/image-20230422211128197.png" alt="image-20230422211128197"></p><h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p><img src="/breeze/a1e1aa91/image-20230422211749038.png" alt="image-20230422211749038"></p><h2 id="Mysql主从复制"><a href="#Mysql主从复制" class="headerlink" title="Mysql主从复制"></a>Mysql主从复制</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>MySQL主从复制是一个异步的复制过程，底层是基于Mysql数据库自带的<strong>二进制</strong>日志功能。就是一台或多台MySQL数据库（slave，即<strong>从库</strong>）从另一台MySQL数据库（master，即<strong>主库</strong>）进行日志的复制然后在解析日志并应用到自身，最终实现<strong>从库</strong>的数据和<strong>主库</strong>的数据保持一致。MySQL主从复制是MySQL数据库自带的功能，无需借助第三方工具。（主库是一个，从库可以有多个）</p><p><strong>MySQL复制过程分成三步：</strong></p><ul><li>master将改变记录到二进制日志（binary log）</li><li>slave将master的binary log拷贝到它的中继日志（relay log）</li><li>slave重做中继日志中的事件，将改变应用到自己的数据库中</li></ul><p><img src="/breeze/a1e1aa91/image-20230422213654905.png" alt="image-20230422213654905"></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="配置-前提条件"><a href="#配置-前提条件" class="headerlink" title="配置-前提条件"></a><strong>配置-前提条件</strong></h4><p>提前准备好两台服务器，分别安装MySQL并启动服务成功</p><ul><li>主库Master 192.168.8.98</li><li>从库Slave 192.168.8.99</li></ul><hr><h4 id="配置-主库Master"><a href="#配置-主库Master" class="headerlink" title="配置-主库Master"></a><strong>配置-主库Master</strong></h4><p>第一步：修改MySQL数据库的配置文件&#x2F;etc&#x2F;my.cnf</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log-bin=mysql-bin	  # 【必须】启用二进制日志</span><br><span class="line">server-id=100         # 【必须】服务器唯一ID</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：这个ID 100 并不是固定的，只需要保证多台数据库服务器的server-id是唯一的即可</span></span><br></pre></td></tr></table></figure><p>第二步：修改完成后，重启mysql服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><p>第三步：登录MySQL数据库，执行下面的SQL</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MySQL5用这条命令即可</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GRANT REPLICATION SLAVE ON *.* to <span class="string">&#x27;summer&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;root&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MySQL8用下面两条命令</span></span><br><span class="line">create user summer identified by &#x27;root&#x27;;     # 第一步</span><br><span class="line">grant replication slave on *.* to summer;    # 第二步</span><br></pre></td></tr></table></figure><p>第四步：登录MySQL数据库，执行下面的SQL，记录下结果中<strong>File</strong>和<strong>Position</strong>的值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">结果如下：</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000002 |      157 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>注：上面SQL的作用是查看Master的状态，执行完此SQL之后<strong>不要再执行任何操作</strong>。因为再执行其他操作后，这里的File和Position的值会发生变化，而这里的File和Position会在从库中被使用到。</p><p>注：上面SQL的作用是创建一个用户<strong>summer</strong>，密码为<strong>root</strong>，并且给summer授权<strong>REPLICATION SLAVE</strong>权限。常用于建立复制时所需要用到的用户权限，也就是slave必须被master授权具有该权限的用户，才能通过该用户复制。</p><hr><h4 id="配置-从库Slave"><a href="#配置-从库Slave" class="headerlink" title="配置-从库Slave"></a>配置-从库Slave</h4><p>第一步：修改MySQL数据库的配置文件&#x2F;etc&#x2F;my.cnf</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id=101	# 【必须】服务器唯一ID</span><br></pre></td></tr></table></figure><p>第二步：重启MySQL服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><p>第三步：登录MySQL数据库，执行下面的SQL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 注意，一个分号对应一条语句。这里共两条SQL语句</span><br><span class="line">change master to</span><br><span class="line">master_host=&#x27;192.168.8.98&#x27;,master_user=&#x27;summer&#x27;,master_password=&#x27;root&#x27;,</span><br><span class="line">master_log_file=&#x27;mysql-bin.000002&#x27;,master_log_pos=157;</span><br><span class="line"></span><br><span class="line">start slave;</span><br></pre></td></tr></table></figure><p>第四步：登录MySQL数据库，执行下面SQL，查看从数据库的状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show slave status;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行该SQL语句之后，会出现很多的信息，只要以下几项内容是正确的接口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Slave_IO_Running 和 Slave_SQL_Running 是正常的，即连接成功</span></span><br><span class="line">+--------------------+-----------------------+-----------------------+----------------------+</span><br><span class="line">|   Relay_Log_Pos    | Relay_Master_Log_File |   Slave_IO_Running    |  Slave_SQL_Running   |</span><br><span class="line">+--------------------+-----------------------+-----------------------+----------------------+</span><br><span class="line">|        4           |   mysql-bin.000002    |     Yes        |         Yes          |     </span><br><span class="line">+--------------------+-----------------------+-----------------------+----------------------+</span><br></pre></td></tr></table></figure><p><strong>测试：</strong>这里可以利用navicat测试一下。用Navicat分别连接两台数据库，然后在主库中新建数据库和表，看从库中是否会自动添加对应的数据库和表。</p><hr><h2 id="Docker部署Mysql8-0-32并配置主从复制"><a href="#Docker部署Mysql8-0-32并配置主从复制" class="headerlink" title="Docker部署Mysql8.0.32并配置主从复制"></a>Docker部署Mysql8.0.32并配置主从复制</h2><h3 id="1-前提准备"><a href="#1-前提准备" class="headerlink" title="1.前提准备"></a>1.前提准备</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建主从数据库文件夹</span></span><br><span class="line">mkdir -p /usr/local/mysql/master1/conf</span><br><span class="line">mkdir -p /usr/local/mysql/master1/data</span><br><span class="line">mkdir -p /usr/local/mysql/slave1/conf</span><br><span class="line">mkdir -p /usr/local/mysql/slave1/data</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化主数据库配置文件</span></span><br><span class="line">cd /usr/local/mysql/master1/conf</span><br><span class="line">touch my.cnf</span><br><span class="line">vi my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">粘贴以下内容</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir = /usr/local/mysql/master1/data</span><br><span class="line">character-set-server = utf8</span><br><span class="line">lower-case-table-names = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主从复制-主机配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主服务器唯一ID</span></span><br><span class="line">server-id = 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用二进制日志</span></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置logbin格式</span></span><br><span class="line">binlog_format = STATEMENT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化从数据库配置文件</span></span><br><span class="line">cd /usr/local/mysql/slave1/conf</span><br><span class="line">touch my.cnf</span><br><span class="line">vi my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">粘贴以下内容</span></span><br><span class="line">[mysqld]</span><br><span class="line">datadir = /usr/local/mysql/slave1/data</span><br><span class="line">character-set-server = utf8</span><br><span class="line">lower-case-table-names = 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主从复制-从机配置</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从服务器唯一ID</span></span><br><span class="line">server-id = 2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启用中继日志</span></span><br><span class="line">relay-log = mysql-relay</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">文件夹授权</span></span><br><span class="line">chmod -R 777 /usr/local/mysql # 这里有坑</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">看错误信息：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mysql: [Warning] World-writable config file <span class="string">&#x27;/etc/mysql/my.cnf&#x27;</span> is ignored.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上述错误的大概意思是：权限全局可写，任何一个用户都可以写。mysql担心这种文件被其他用户恶意修改，所以忽略掉这个配置文件。导致无法进入，这也是mysql的安全机制之一。所以我们必须得改一些权限。设置其他用户不可写。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改权限如下：</span></span><br><span class="line">chmod 644 /usr/local/mysql/master1/conf/my.cnf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">然后重启Mysql服务</span></span><br><span class="line">docker restart mysql-master-1</span><br></pre></td></tr></table></figure><h3 id="2-Docker部署Mysql8-0-32"><a href="#2-Docker部署Mysql8-0-32" class="headerlink" title="2.Docker部署Mysql8.0.32"></a>2.Docker部署Mysql8.0.32</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull mysql:8.0.32</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看镜像</span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建主数据库容器</span></span><br><span class="line">docker run -p 3306:3306 --name mysql-master-1 --privileged=true -v /usr/local/mysql/master1/data/:/var/lib/mysql -v /usr/local/mysql/master1/conf/my.cnf:/etc/mysql/my.cnf -v /usr/local/mysql/master1/mysql-files/:/var/lib/mysql-files/ -e MYSQL_ROOT_PASSWORD=root -d mysql:8.0.32</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若是先部署的容器，然后再配置的步骤1中的配置文件，配完成配置文件的配置后，重启</span></span><br><span class="line">docker restart mysql-master-1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询是否启动成功</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证是否可以登录</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">交互式进入容器</span></span><br><span class="line">docker exec -it mysql-master-1 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录（使用构建时指定的密码：3edc<span class="comment">#EDC）</span></span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出</span></span><br><span class="line">quit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建从数据库容器</span></span><br><span class="line">docker run --name=mysql-slave-1 --privileged=true -p 3307:3306 -v /usr/local/mysql/slave1/data/:/var/lib/mysql -v /usr/local/mysql/slave1/conf/my.cnf:/etc/mysql/my.cnf -v /usr/local/mysql/slave1/mysql-files/:/var/lib/mysql-files/ -e  MYSQL_ROOT_PASSWORD=root -d mysql:8.0.32</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询是否启动成功</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同样修改权限如下：</span></span><br><span class="line">chmod 644 /usr/local/mysql/slave1/conf/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务</span></span><br><span class="line">docker restart mysql-slave-1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证是否可以登录</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">交互式进入容器</span></span><br><span class="line">docker exec -it mysql-slave-1 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录（使用构建时指定的密码：3edc<span class="comment">#EDC）</span></span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出</span></span><br><span class="line">quit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭防火墙</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看防火墙状态</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br></pre></td></tr></table></figure><h3 id="3-配置主从复制"><a href="#3-配置主从复制" class="headerlink" title="3.配置主从复制"></a>3.配置主从复制</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入主数据库</span></span><br><span class="line">mysql -uroot -p -h192.168.8.99 -P3306</span><br><span class="line"></span><br><span class="line">- 主数据库创建用户slave并授权</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建用户</span></span><br><span class="line">create user &#x27;slave&#x27;@&#x27;%&#x27;identified with mysql_native_password by &#x27;root&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">授权</span></span><br><span class="line">grant replication slave on *.* to &#x27;slave&#x27;@&#x27;%&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">刷新权限</span></span><br><span class="line">flush privileges;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询server_id值</span></span><br><span class="line">show variables like &#x27;server_id&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可临时（重启后失效）指定server_id的值（主从数据库的server_id不能相同）</span></span><br><span class="line">set global server_id = 1;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询Master状态，并记录File和Position的值</span></span><br><span class="line">show master status;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000004 |   836    |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：执行完此步骤后退出主数据库，防止再次操作导致File和Position的值发生变化</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证slave用户是否可用</span></span><br><span class="line">mysql -uslave -p -h192.168.8.99 -P3306</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入从数据库</span></span><br><span class="line">mysql -uroot -p -h192.168.8.99 -P3307</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询server_id值</span></span><br><span class="line">show variables like &#x27;server_id&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可临时（重启后失效）指定server_id的值（主从数据库的server_id不能相同）</span></span><br><span class="line">set global server_id = 2;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若之前设置过同步，请先重置</span></span><br><span class="line">stop slave;</span><br><span class="line">reset slave;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置主数据库（在从数据库中运行下列命令）</span></span><br><span class="line">change master to master_host=&#x27;192.168.8.99&#x27;,master_port=3306,master_user=&#x27;slave&#x27;,master_password=&#x27;root&#x27;,master_log_file=&#x27;mysql-bin.000020&#x27;,master_log_pos=1324;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开始同步</span></span><br><span class="line">start slave;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若出现错误，则停止同步，重置后再次启动</span></span><br><span class="line">stop slave;</span><br><span class="line">reset slave;</span><br><span class="line">start slave;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询Slave状态</span></span><br><span class="line">show slave status\G</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看是否配置成功</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看参数 Slave_IO_Running 和 Slave_SQL_Running 是否都为<span class="built_in">yes</span>，则证明配置成功。若为no，则需要查看对应的 Last_IO_Error 或 Last_SQL_Error 的异常值。</span></span><br></pre></td></tr></table></figure><h3 id="4-测试"><a href="#4-测试" class="headerlink" title="4.测试"></a>4.测试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在主数据库创建数据库<span class="built_in">test</span></span></span><br><span class="line">create database test;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从数据库查看</span></span><br><span class="line">show databases;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在主数据库创建表</span></span><br><span class="line">use test;</span><br><span class="line">create table t_user(id int, name varchar(20));</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">插入数据</span></span><br><span class="line">insert into t_user values(1, &#x27;C3Stones&#x27;);</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在从数据库查看</span></span><br><span class="line">use test;</span><br><span class="line">select * from t_user;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其他删改查操作请自行测试</span></span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>在主库中新建一个数据库，在该数据库中新建一张表。然后在该表中进行增、删、改操作，在从库中会自动建一个对应的数据库，并且数据库中的内容会随着主库中的内容发生对应的变化（对应的增、删、改）。</p><h2 id="读写分离案例"><a href="#读写分离案例" class="headerlink" title="读写分离案例"></a>读写分离案例</h2><p>面对日益增长的系统访问量，数据库的吞吐量面临着巨大瓶颈。对于同一时刻有大量并发读操作和较少写操作的应用系统来说，将数据库拆分为<strong>主库</strong>和<strong>从库</strong>，主库负责处理事务性的增删改操作，从库负责处理查询操作，能够有效的避免有数据更新导致的行锁，使得整个系统的查询性能得到	极大的改善。</p><p><img src="/breeze/a1e1aa91/image-20230502112327125.png" alt="image-20230502112327125"></p><h3 id="Sharding-JDBC介绍"><a href="#Sharding-JDBC介绍" class="headerlink" title="Sharding-JDBC介绍"></a>Sharding-JDBC介绍</h3><p>Sharding-JDBC定位为轻量级的Java框架，在Java的JDBC层提供额外的服务。它使用客户端直连数据库，以jar包形式提供服务，无需额外部署和依赖，可理解为增强版本的JDBC驱动，完全兼容JDBC和各种ORM框架。</p><p>使用Sharding-JDBC可以在程序中轻松的实现数据库读写分离。</p><ul><li>适用于任何基于JDBC的ORM框架，如：JPA、Hibernate、Mybatis、Spring JDBC Template或直接使用JDBC。</li><li>支持任何第三方的数据库连接池，如：DBCP、C3P0、BoneCP、Druid、HikriCP等。</li><li>支持任意实现JDBC规范的数据库。目前支持MySQL、Oracle、SQLServer、PostgreSQL以及任何遵循SQL92标准的数据库。</li></ul><p><strong>Sharding-JDBC的依赖</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.shardingsphere/sharding-jdbc-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="入门案例（有问题，没有运行成功）"><a href="#入门案例（有问题，没有运行成功）" class="headerlink" title="入门案例（有问题，没有运行成功）"></a>入门案例（有问题，没有运行成功）</h3><p>使用Sharding-JDBC	实现读写分离步骤（三步）：</p><ul><li><p>导入maven坐标</p></li><li><p>在配置文件中配置读写分离规则</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">sharding-sphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span></span><br><span class="line">        <span class="comment"># 这两个名字可以随意，但是必须和下面数据源的名字相同</span></span><br><span class="line">        <span class="comment"># 主库和从库是在下面定义的，这里只是两个名字而已（master不一定就是主库）</span></span><br><span class="line">        <span class="string">master,slave1,slave2</span></span><br><span class="line">      <span class="comment"># 主数据源</span></span><br><span class="line">      <span class="attr">master:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.8.99:3306/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="comment"># 从数据源</span></span><br><span class="line">      <span class="attr">slave1:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.8.99:3307/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="comment"># 假设有两个从库</span></span><br><span class="line">      <span class="attr">slave2:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.8.99:3307/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">masters-lave:</span></span><br><span class="line">      <span class="comment"># 读写分离配置</span></span><br><span class="line">      <span class="attr">load-balance-algorithm-type:</span> <span class="string">round_robin</span> <span class="comment"># 从库负责均衡的策略（轮询）</span></span><br><span class="line">      <span class="comment"># 最终的数据源名称</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dataSource</span></span><br><span class="line">      <span class="comment"># 主库数据源名称</span></span><br><span class="line">      <span class="attr">master-data-source-name:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># 从库数据源名称列表，多个逗号分隔</span></span><br><span class="line">      <span class="attr">slave-data-source-names:</span> <span class="string">slave1,slave2</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql:</span></span><br><span class="line">        <span class="attr">show:</span> <span class="literal">true</span> <span class="comment">#开启SQL显示，默认false</span></span><br></pre></td></tr></table></figure><ul><li>在配置文件中配置<strong>允许bean定义覆盖</strong>配置项</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">main:</span></span><br><span class="line">  <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="项目实现读写分离（未做，Sharding-JDBC）"><a href="#项目实现读写分离（未做，Sharding-JDBC）" class="headerlink" title="项目实现读写分离（未做，Sharding-JDBC）"></a>项目实现读写分离（未做，Sharding-JDBC）</h2><hr><h1 id="第十章-前后端分离开发"><a href="#第十章-前后端分离开发" class="headerlink" title="第十章 前后端分离开发"></a>第十章 前后端分离开发</h1><h2 id="问题说明-1"><a href="#问题说明-1" class="headerlink" title="问题说明"></a>问题说明</h2><p><img src="/breeze/a1e1aa91/image-20230502173305209.png" alt="image-20230502173305209"></p><ul><li>开发人员同时负责前端和后端代码开发，分工不明确。</li><li>开发效率低。</li><li>前后端代码混合在一个工程中，不便于管理。</li><li>对开发人员要求高，人员招聘困难。</li></ul><h2 id="前后端分离开发"><a href="#前后端分离开发" class="headerlink" title="前后端分离开发"></a>前后端分离开发</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p><strong>前后端分离开发，</strong>就是在项目开发过程中，对于前端代码的开发由专门的<strong>前端开发人员</strong>负责，后端代码则有<strong>后端开发人员</strong>负责，这样可以做到分工明确、各司其职，提高开发效率，前后端代码并行开发，可以加快项目开发进度。目前，前后端分离开发方式已经被越来越多的公司所采用，成为当前项目开发的主流开发方式。</p><p>前后端分离开发后，从工程结构上也会发生变化，即前后端代码不再混合在同一个maven工程中，而是分为<strong>前端功臣</strong>和<strong>后端工程</strong>。</p><p><img src="/breeze/a1e1aa91/QQ%E6%88%AA%E5%9B%BE20230502174843.png" alt="20230502174843"></p><h3 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h3><p>前后端分离开发后，面临着一个问题，就是前端开发人员和后端开发人员如何进行配合来共同开发一个项目？</p><p>可以按照如下流程进行：</p><p><img src="/breeze/a1e1aa91/image-20230502175346531.png" alt="image-20230502175346531"></p><p>**注意：接口（API接口）:**就是一个http的请求地址，主要就是去定义：请求路径、请求方式、请求参数、响应数据等内容。</p><p><strong>接口样例:</strong></p><p><img src="/breeze/a1e1aa91/image-20230502175835917.png" alt="image-20230502175835917"></p><h3 id="前端技术栈"><a href="#前端技术栈" class="headerlink" title="前端技术栈"></a>前端技术栈</h3><p><strong>开发工具：</strong></p><ul><li>Visual Studio Code</li><li>hbuilder</li></ul><p><strong>技术框架：</strong></p><ul><li>nodejs</li><li>VUE</li><li>ElementUI</li><li>mock</li><li>webpack</li></ul><h2 id="Yapi"><a href="#Yapi" class="headerlink" title="Yapi"></a>Yapi</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>YApi是高效、易用、功能强大的api管理平台，旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护API、YApi还为用户提供了优秀的交互体验，开发人员只需利用平台提供的接口数据写入工具以及简单的点击操作就可以实现接口的管理。</p><p>YApi让接口开发更加简单高效，让接口的管理更具可读性、可维护性、让团队协作更合理。</p><p>要使用YApi， 需要自己进行部署。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>使用YApi，可以执行下面的操作：</p><ul><li>添加项目</li><li>添加分类</li><li>添加接口</li><li>编辑接口</li><li>查看接口</li></ul><h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><p>使用Swagger你只需要按照它的规范去定义接口及接口相关的信息，再通过Swagger衍生出来的一系列项目和工具，就可以做到生成各种各样的接口文档，以及在线接口调试页面等等。</p><p>knife4j是为Java MVC框架集成Swagger生成Api文档的增强解决方案。</p><p>knife4j依赖地址：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.xiaoymin/knife4j-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><p><strong>操作步骤：</strong></p><ol><li>导入knife4j的maven坐标</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.xiaoymin/knife4j-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>导入knife4j相关配置（WebMvcConfig）</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要加入这两个注解</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableKnife4j</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 需要新增这两个方法</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个方法的作用是：扫描controller包，里面每一个controller中的公共的方法都会被映射为一个接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 文档类型</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.cdcas.reggie.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述Api文档，可以看出这个方法是在封装ApiInfo对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;瑞吉外卖&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;瑞吉外卖接口文档&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>设置静态资源，否则接口文档页面无法访问（在WebMvcConfig类中的addResourceHandlers方法），否则接口文档页面无法访问。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars&quot;</span>);</span><br></pre></td></tr></table></figure><ol start="4"><li>在LoginCheckFilter中设置不需要处理请求路径</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">               <span class="comment">// ...</span></span><br><span class="line">               <span class="string">&quot;/doc.html&quot;</span>,</span><br><span class="line">               <span class="string">&quot;/webjars/**&quot;</span>,</span><br><span class="line">               <span class="string">&quot;/swagger-resources&quot;</span>,</span><br><span class="line">               <span class="string">&quot;/v2/api-docs&quot;</span></span><br><span class="line">       &#125;;</span><br></pre></td></tr></table></figure><h3 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h3><p>正常情况下：项目启动成功后，在浏览器页面输入<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html%E5%8D%B3%E5%8F%AF%E8%AE%BF%E9%97%AE%E5%88%B0%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%9A%84%E5%86%85%E5%AE%B9%E3%80%82">http://localhost:8080/doc.html即可访问到接口文档的内容。</a></p><p>实际情况：会报错 –&gt; Type javax.servlet.http.HttpServletRequest not present</p><p><strong>原因：</strong></p><p>运行环境 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Swagger&spm=1001.2101.3001.7020">Swagger</a> 3.0.3、springboot 3.0.02</p><p>产生原因： Swagger 3.0.不支持spring3.0.0</p><p><strong>两个解决方案：</strong></p><ul><li>降低springboot版本为2.x</li><li>放弃Swagger，使用springdoc-openapi-starter-webmvc-ui</li></ul><p><strong>解决bug，这里采用第二种方案使用springdoc-openapi-starter-webmvc-ui（也没有做好）：</strong></p><ol><li>引入依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springdoc/springdoc-openapi-starter-webmvc-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springdoc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>接口文档全局基础信息配置</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * spring doc配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDocConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">restfulOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">                .info(<span class="keyword">new</span> <span class="title class_">Info</span>().title(<span class="string">&quot;瑞吉外卖&quot;</span>)</span><br><span class="line">                        .description(<span class="string">&quot;reggie Detail APi&quot;</span>)</span><br><span class="line">                        .version(<span class="string">&quot;v1.0.0&quot;</span>)</span><br><span class="line">                        .license(<span class="keyword">new</span> <span class="title class_">License</span>().name(<span class="string">&quot;Apache 2.0&quot;</span>).url(<span class="string">&quot;http://springdoc.org&quot;</span>)))</span><br><span class="line">                .externalDocs(<span class="keyword">new</span> <span class="title class_">ExternalDocumentation</span>()</span><br><span class="line">                        .description(<span class="string">&quot;SpringDoc Wiki Documentation&quot;</span>)</span><br><span class="line">                        .url(<span class="string">&quot;https://springdoc.org/v2&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="常用注解（Swagger已经停更了，这里就不做笔记了）"><a href="#常用注解（Swagger已经停更了，这里就不做笔记了）" class="headerlink" title="常用注解（Swagger已经停更了，这里就不做笔记了）"></a>常用注解（Swagger已经停更了，这里就不做笔记了）</h3><table><thead><tr><th>注解</th><th>说明</th></tr></thead><tbody><tr><td>@Api</td><td>用在请求的类上，例如Controller，表示对类的说明</td></tr><tr><td>@ApiModel</td><td>用在类上，通常是实体类，表示一个返回响应数据的信息</td></tr><tr><td>@ApiModelProperty</td><td>用在属性上，描述响应类的属性</td></tr><tr><td>@ApiOperation</td><td>用在请求的方法上，说明方法的用途、作用</td></tr><tr><td>@ApilmplicitParams</td><td>用在请求的方法上，表示一组参数说明</td></tr><tr><td>@ApilmpliciParam</td><td>用在@ApilmplicitParams注解中，指定一个请求参数的各个方面</td></tr></tbody></table><h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="部署架构"><a href="#部署架构" class="headerlink" title="部署架构"></a>部署架构</h3><p><img src="/breeze/a1e1aa91/image-20230502220205594.png" alt="image-20230502220205594"></p><h3 id="部署环境说明"><a href="#部署环境说明" class="headerlink" title="部署环境说明"></a>部署环境说明</h3><p><img src="/breeze/a1e1aa91/image-20230502220232989.png" alt="image-20230502220232989"></p><h3 id="部署前端项目"><a href="#部署前端项目" class="headerlink" title="部署前端项目"></a>部署前端项目</h3><p>第一步：在服务器A中安装nginx，将课程资料中的dist目录上传到nginx目录的html目录下（资料在day03中）</p><p>第二步：配置nginx.conf</p><h3 id="部署后端项目"><a href="#部署后端项目" class="headerlink" title="部署后端项目"></a>部署后端项目</h3><p>第一步：在服务器B中安装jdk、git、maven、MySQL，使用git clone命令将git远程仓库的代码克隆下来</p><p>第二步：将资料中提供的reggieStart.sh文件上传到服务器B，通过chmod命令设置执行权限。</p><hr><hr><h1 id="整个项目中未完成的功能"><a href="#整个项目中未完成的功能" class="headerlink" title="整个项目中未完成的功能"></a>整个项目中未完成的功能</h1><p><strong>1.需要自己完成的功能没有完成</strong></p><p><strong>2.mysql主从复制没有完成</strong></p><p><strong>3.Swagger的使用没有完成</strong></p><p><strong>4.项目部署没有完成</strong></p><hr><h2><a href="#" class="headerlink"></a></h2></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mliutm.github.io">清风</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mliutm.github.io/breeze/a1e1aa91.html">https://mliutm.github.io/breeze/a1e1aa91.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mliutm.github.io" target="_blank">清风</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post_share"><div class="social-share" data-image="/img/photo-1653549892896-dde02867edee.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/breeze/836fab41.html" title="学成在线--项目介绍与环境搭建v3.1（一）"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">学成在线--项目介绍与环境搭建v3.1（一）</div></div></a></div><div class="next-post pull-right"><a href="/breeze/b68160eb.html" title="后悔是在欺负以前的自己"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">后悔是在欺负以前的自己</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/breeze/c8b66f0a.html" title="File类"><img class="cover" src="/img/photo-1692708632140-ee01624d558d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">File类</div></div></a></div><div><a href="/breeze/fed4c017.html" title="IO流"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">IO流</div></div></a></div><div><a href="/breeze/ecebeadb.html" title="BIO-NIO-AIO深入剖析"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-15</div><div class="title">BIO-NIO-AIO深入剖析</div></div></a></div><div><a href="/breeze/a4950fb1.html" title="Redis实战-黑马点评"><img class="cover" src="/img/photo-1653549892896-dde02867edee.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">Redis实战-黑马点评</div></div></a></div><div><a href="/breeze/ab319c68.html" title="SpringCloud-Alibaba快速入门"><img class="cover" src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-13</div><div class="title">SpringCloud-Alibaba快速入门</div></div></a></div><div><a href="/breeze/4c9bef51.html" title="base抽取与代码生成器（三）"><img class="cover" src="/img/photo-1645943020355-305df166473d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-28</div><div class="title">base抽取与代码生成器（三）</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">清风</div><div class="author-info__description">清风洒六合，邈然不可攀</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">169</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">82</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:huangpan0805@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0"><span class="toc-text">第一章 瑞吉外卖项目概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-text">01.前置知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E6%95%B4%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-text">02.软件开发整体介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E7%91%9E%E5%90%89%E5%A4%96%E5%8D%96%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D"><span class="toc-text">03.瑞吉外卖项目介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">04.开发环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">数据库环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Maven%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-text">Maven项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9Ajava%E4%B8%AD-%E5%92%8C-%E7%9A%84%E4%BD%9C%E7%94%A8-%E4%BB%A5%E5%8F%8A-%E5%92%8C-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">拓展：java中*和**的作用 以及 &#x2F;和&#x2F;*和&#x2F;**的区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E5%85%A5%E5%89%8D%E7%AB%AF%E8%B5%84%E6%BA%90%E6%8B%93%E5%B1%95"><span class="toc-text">引入前端资源拓展</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84"><span class="toc-text">设置静态资源映射</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E5%BC%80%E5%8F%91"><span class="toc-text">05.后台登录功能开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="toc-text">功能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-1"><span class="toc-text">功能测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91"><span class="toc-text">第二章 员工管理业务开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E5%91%98%E5%B7%A5%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97"><span class="toc-text">01.员工管理模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-text">完善登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">拓展过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-2"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E5%91%98%E5%B7%A5"><span class="toc-text">新增员工</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-1"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-1"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-3"><span class="toc-text">功能测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-4"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">02.员工信息分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-2"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-2"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-5"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-%E7%BC%96%E8%BE%91%E5%91%98%E5%B7%A5%E4%BF%A1%E6%81%AF"><span class="toc-text">05.编辑员工信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-3"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-3"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-6"><span class="toc-text">功能测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0-%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91"><span class="toc-text">第三章 分类管理业务开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E5%85%AC%E5%85%B1%E5%AD%97%E6%AE%B5%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85-%E6%9C%89%E9%87%8D%E7%82%B9"><span class="toc-text">01.公共字段自动填充(有重点)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E8%AE%B8"><span class="toc-text">问题分许</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="toc-text">代码实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-7"><span class="toc-text">功能测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AFThreadLocal%EF%BC%9F"><span class="toc-text">拓展：什么是ThreadLocal？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84"><span class="toc-text">功能完善</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-text">实现步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-8"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB"><span class="toc-text">02.新增分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-4"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-1"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-4"><span class="toc-text">代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A-RequestBody%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%EF%BC%9F"><span class="toc-text">拓展：@RequestBody作用是什么，什么时候使用？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-9"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E5%88%86%E7%B1%BB%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">03.分类信息分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-5"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-5"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-10"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-%E5%88%A0%E9%99%A4%E5%88%86%E7%B1%BB%EF%BC%88%E8%BF%99%E9%87%8C%E6%9C%89%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-text">04.删除分类（这里有重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-6"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-6"><span class="toc-text">代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%951%EF%BC%9Ajava%E5%90%8E%E7%AB%AF%E6%96%B9%E6%B3%95%E5%BD%A2%E5%8F%82%E5%90%8D%E4%B8%8E%E5%89%8D%E7%AB%AF%E4%BC%A0%E5%8F%82%E5%90%8D%E6%98%AF%E5%90%A6%E9%9C%80%E8%A6%81%E4%BF%9D%E6%8C%81%E4%B8%80%E8%87%B4%EF%BC%9F"><span class="toc-text">拓展1：java后端方法形参名与前端传参名是否需要保持一致？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%952%EF%BC%9A-RequestParam%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">拓展2：@RequestParam注解的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-11"><span class="toc-text">功能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AE%8C%E5%96%84-1"><span class="toc-text">功能完善</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%86%8D%E6%B5%8B%E8%AF%95"><span class="toc-text">功能再测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-%E4%BF%AE%E6%94%B9%E5%88%86%E7%B1%BB"><span class="toc-text">05.修改分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-7"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-7"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-12"><span class="toc-text">功能测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E8%8F%9C%E5%93%81%E7%AE%A1%E7%90%86%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91"><span class="toc-text">第四章 菜品管理业务开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="toc-text">效果展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD%EF%BC%88%E9%87%8D%E7%82%B9%EF%BC%89"><span class="toc-text">01.文件上传下载（重点）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%8B%E7%BB%8D"><span class="toc-text">文件上传介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%8B%E7%BB%8D"><span class="toc-text">文件下载介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">文件上传代码实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9ASpringBoot%E4%B8%AD-Value%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">拓展：SpringBoot中@Value的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">文件下载代码实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E6%96%B0%E5%A2%9E%E8%8F%9C%E5%93%81%EF%BC%88%E9%87%8D%E7%82%B9%E6%98%AF%E4%B8%9A%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="toc-text">02.新增菜品（重点是业务的实现）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-8"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-2"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-8"><span class="toc-text">代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AFDTO%E4%BB%A5%E5%8F%8ADTO%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-text">拓展：什么是DTO以及DTO如何使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A-Resource%E5%92%8C-Autowired%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E5%8C%BA%E5%88%AB"><span class="toc-text">拓展：@Resource和@Autowired的使用和区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A%E4%BD%BF%E7%94%A8-Autowired-%E6%B3%A8%E8%A7%A3%E5%AF%BC%E5%85%A5-Mapper-%E5%AF%B9%E8%B1%A1%E6%8A%A5%E9%94%99%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text">拓展：使用 @Autowired 注解导入 Mapper 对象报错的原因</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9AJava%E4%B8%ADstream%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">拓展：Java中stream方法的使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-13"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E8%8F%9C%E5%93%81%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">03.菜品信息分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-9"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-9"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-14"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-%E4%BF%AE%E6%94%B9%E8%8F%9C%E5%93%81"><span class="toc-text">04.修改菜品</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-10"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-10"><span class="toc-text">代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A-PathVariable%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-text">拓展：@PathVariable注解的使用：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-15"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-%E5%88%A0%E9%99%A4%E8%8F%9C%E5%93%81%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">05.删除菜品（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06-%E5%81%9C%E5%94%AE%E8%8F%9C%E5%93%81%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">06.停售菜品（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#07-%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">07.批量修改（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#08-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">08.批量删除（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#09-%E6%89%B9%E9%87%8F%E5%81%9C%E5%94%AE%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">09.批量停售（实战）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%A5%97%E9%A4%90%E7%AE%A1%E7%90%86%E4%B8%9A%E5%8A%A1%E5%BC%80%E5%8F%91"><span class="toc-text">第五章 套餐管理业务开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-1"><span class="toc-text">效果展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E6%96%B0%E5%A2%9E%E5%A5%97%E9%A4%90"><span class="toc-text">01.新增套餐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-11"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-3"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-11"><span class="toc-text">代码开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E5%A5%97%E9%A4%90%E4%BF%A1%E6%81%AF%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">02.套餐信息分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-12"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-12"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-16"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E5%88%A0%E9%99%A4%E5%A5%97%E9%A4%90"><span class="toc-text">03.删除套餐</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-13"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-13"><span class="toc-text">代码开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A-RequestParam"><span class="toc-text">拓展：@RequestParam</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-17"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-%E4%BF%AE%E6%94%B9%E5%A5%97%E9%A4%90%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">04.修改套餐（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-%E5%81%9C%E5%94%AE%E5%A5%97%E9%A4%90%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">05.停售套餐（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06-%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">06.批量修改（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#07-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">07.批量删除（实战）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06-%E6%89%B9%E9%87%8F%E5%81%9C%E5%94%AE%EF%BC%88%E5%AE%9E%E6%88%98%EF%BC%89"><span class="toc-text">06.批量停售（实战）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-text">第六章 手机验证码登录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-2"><span class="toc-text">效果展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E5%8F%91%E9%80%81"><span class="toc-text">短信发送</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-text">短信服务介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1"><span class="toc-text">阿里云短信服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-14"><span class="toc-text">代码开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81%E7%99%BB%E5%BD%95"><span class="toc-text">手机验证码登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-14"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-4"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-15"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-18"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#qq%E9%82%AE%E7%AE%B1%E7%99%BB%E5%BD%95"><span class="toc-text">qq邮箱登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6application-yml%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%82%AE%E7%AE%B1%E9%85%8D%E7%BD%AE"><span class="toc-text">在配置文件application.yml中添加邮箱配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E9%82%AE%E7%AE%B1%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">编写一个邮箱工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-19"><span class="toc-text">功能测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-%E8%8F%9C%E5%93%81%E5%B1%95%E7%A4%BA%E3%80%81%E8%B4%AD%E7%89%A9%E8%BD%A6%E3%80%81%E4%B8%8B%E5%8D%95"><span class="toc-text">第七章 菜品展示、购物车、下单</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-3"><span class="toc-text">效果展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E5%AF%BC%E5%85%A5%E7%94%A8%E6%88%B7%E5%9C%B0%E5%9D%80%E8%96%84%E7%9B%B8%E5%85%B3%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="toc-text">01.导入用户地址薄相关功能代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-15"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-5"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81"><span class="toc-text">导入功能代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-20"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E8%8F%9C%E5%93%81%E5%B1%95%E7%A4%BA"><span class="toc-text">02.菜品展示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-16"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-16"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-21"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">03.购物车</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-17"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-6"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-17"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-22"><span class="toc-text">功能测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">查看购物车</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E8%B4%AD%E7%89%A9%E8%BD%A6"><span class="toc-text">清空购物车</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-%E4%B8%8B%E5%8D%95"><span class="toc-text">04.下单</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90-18"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-7"><span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91-18"><span class="toc-text">代码开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-23"><span class="toc-text">功能测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96%E4%B9%8B%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96"><span class="toc-text">第八章 项目优化之缓存优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#01-%E9%97%AE%E9%A2%98%E8%AF%B4%E6%98%8E%EF%BC%9A"><span class="toc-text">01.问题说明：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#02-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">02.环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#03-%E7%BC%93%E5%AD%98%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">03.缓存短信验证码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#04-%E7%BC%93%E5%AD%98%E8%8F%9C%E5%93%81%E6%95%B0%E6%8D%AE"><span class="toc-text">04.缓存菜品数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%94%B9%E9%80%A0"><span class="toc-text">代码改造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-24"><span class="toc-text">功能测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#05-Spring-Cache"><span class="toc-text">05.Spring Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cache%E4%BB%8B%E7%BB%8D"><span class="toc-text">Spring Cache介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cache%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-text">Spring Cache常用注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Cache%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%EF%BC%88%E6%89%A9%E5%B1%95%EF%BC%89"><span class="toc-text">Spring Cache使用方式（扩展）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#06-%E7%BC%93%E5%AD%98%E5%A5%97%E9%A4%90%E6%95%B0%E6%8D%AE"><span class="toc-text">06.缓存套餐数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-1"><span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%94%B9%E9%80%A0-1"><span class="toc-text">代码改造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%951%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%9E%E7%8E%B0%E4%BA%86-Cacheable%E6%B3%A8%E8%A7%A3%E4%B9%8B%E5%90%8E%EF%BC%8C%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E7%B1%BB%E5%9E%8B%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A5%E5%8F%A3%EF%BC%9F"><span class="toc-text">拓展1：为什么实现了@Cacheable注解之后，方法返回值的类型需要实现序列化接口？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E5%B1%952%EF%BC%9A%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">拓展2：序列化和反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95-25"><span class="toc-text">功能测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-text">第九章 读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%AF%B4%E6%98%8E"><span class="toc-text">问题说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-text">读写分离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">Mysql主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-text">配置-前提条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-%E4%B8%BB%E5%BA%93Master"><span class="toc-text">配置-主库Master</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-%E4%BB%8E%E5%BA%93Slave"><span class="toc-text">配置-从库Slave</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E9%83%A8%E7%BD%B2Mysql8-0-32%E5%B9%B6%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">Docker部署Mysql8.0.32并配置主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%89%8D%E6%8F%90%E5%87%86%E5%A4%87"><span class="toc-text">1.前提准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Docker%E9%83%A8%E7%BD%B2Mysql8-0-32"><span class="toc-text">2.Docker部署Mysql8.0.32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">3.配置主从复制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%8B%E8%AF%95"><span class="toc-text">4.测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%A1%88%E4%BE%8B"><span class="toc-text">读写分离案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sharding-JDBC%E4%BB%8B%E7%BB%8D"><span class="toc-text">Sharding-JDBC介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B%EF%BC%88%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E6%B2%A1%E6%9C%89%E8%BF%90%E8%A1%8C%E6%88%90%E5%8A%9F%EF%BC%89"><span class="toc-text">入门案例（有问题，没有运行成功）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%88%E6%9C%AA%E5%81%9A%EF%BC%8CSharding-JDBC%EF%BC%89"><span class="toc-text">项目实现读写分离（未做，Sharding-JDBC）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91"><span class="toc-text">第十章 前后端分离开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E8%AF%B4%E6%98%8E-1"><span class="toc-text">问题说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91"><span class="toc-text">前后端分离开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-text">前端技术栈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yapi"><span class="toc-text">Yapi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swagger"><span class="toc-text">Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-text">使用方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%EF%BC%9A"><span class="toc-text">测试：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%EF%BC%88Swagger%E5%B7%B2%E7%BB%8F%E5%81%9C%E6%9B%B4%E4%BA%86%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E5%81%9A%E7%AC%94%E8%AE%B0%E4%BA%86%EF%BC%89"><span class="toc-text">常用注解（Swagger已经停更了，这里就不做笔记了）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-text">项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84"><span class="toc-text">部署架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="toc-text">部署环境说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">部署前端项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-text">部署后端项目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B4%E4%B8%AA%E9%A1%B9%E7%9B%AE%E4%B8%AD%E6%9C%AA%E5%AE%8C%E6%88%90%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-text">整个项目中未完成的功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text"></span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/breeze/1d13ce0d.html" title="WYDG-产品目录列表-20200506"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="WYDG-产品目录列表-20200506"></a><div class="content"><a class="title" href="/breeze/1d13ce0d.html" title="WYDG-产品目录列表-20200506">WYDG-产品目录列表-20200506</a><time datetime="2025-04-13T05:43:05.000Z" title="发表于 2025-04-13 13:43:05">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/6f268337.html" title="雨雀文件下载"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="雨雀文件下载"></a><div class="content"><a class="title" href="/breeze/6f268337.html" title="雨雀文件下载">雨雀文件下载</a><time datetime="2024-05-22T12:25:08.000Z" title="发表于 2024-05-22 20:25:08">2024-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7832219d.html" title="十万字面试总结"><img src="/img/premium_photo-1695185954894-e9382c6f4da8.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="十万字面试总结"></a><div class="content"><a class="title" href="/breeze/7832219d.html" title="十万字面试总结">十万字面试总结</a><time datetime="2024-02-29T02:50:00.000Z" title="发表于 2024-02-29 10:50:00">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/7ae0ca37.html" title="Redis_30道经典面试题"><img src="/img/photo-1688475747590-d0db5e2412cb.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Redis_30道经典面试题"></a><div class="content"><a class="title" href="/breeze/7ae0ca37.html" title="Redis_30道经典面试题">Redis_30道经典面试题</a><time datetime="2024-02-29T02:45:00.000Z" title="发表于 2024-02-29 10:45:00">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/breeze/2a548e97.html" title="面试实战"><img src="/img/photo-1645943020355-305df166473d.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="面试实战"></a><div class="content"><a class="title" href="/breeze/2a548e97.html" title="面试实战">面试实战</a><time datetime="2024-02-29T02:43:59.000Z" title="发表于 2024-02-29 10:43:59">2024-02-29</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/photo-1653549892896-dde02867edee.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 <i id="heartbeat" class="fa fas fa-heartbeat"></i> 清风</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/timing.js"></script><script id="canvas_nest" defer color="255,0,255" opacity="0.7" zindex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="true" data-text="天枢,天璇,天玑,天权,玉衡,开阳,瑶光" data-fontsize="15px" data-random="true" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>